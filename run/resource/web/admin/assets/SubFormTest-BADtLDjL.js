var d=(R,w,p)=>new Promise((D,t)=>{var c=o=>{try{n(p.next(o))}catch(f){t(f)}},m=o=>{try{n(p.throw(o))}catch(f){t(f)}},n=o=>o.done?D(o.value):Promise.resolve(o.value).then(c,m);n((p=p.apply(R,w)).next())});import{d as J,c as I,ao as q,f as b,o as z,r as U,a7 as Z,Z as _,a8 as S,a9 as u,k as i,m as k,A as h,u as s,$ as C,G as y,ac as H,_ as x,ab as g}from"./vue-Cw15aJ-2.js";import{u as Q,_ as X}from"./useForm-BsovIqMX.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./componentMap-qA-f8iV4.js";import{vxeTableColumns as ee,validRules as ae,modalSchemas as te}from"./purchase.data-DrRrrmUP.js";import{P as oe}from"./index-C4nZBquz.js";import{p as se,a as re,b as ie}from"./index-BG1aTYCU.js";import{k as le,C as $,h as ne}from"./entry/index-BbJQUQ84-1718268303552.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-tbsKhTM1.js";import{u as ue}from"./index-BIkrAlj7.js";import{s as me}from"./index-DH8S7RKQ.js";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang-DuvhP-Bt.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-CTFjNtYq.js";import{V as fe}from"./index-DnheMbIF.js";import ve from"./Preview-D4EFluGb.js";import{o as be,y as _e,f as we}from"./antd-DMGzOvrA.js";import"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import"./helper-CXVLNTBN.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./index-DCvxWw7W.js";import"./useSortable-BTdBE9Oa.js";import"./download-DOz9ltI1.js";import"./useLoading-D1in2ACg.js";import"./copyTextToClipboard-uEEWQikS.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./style-CLEvKZSv.js";import"./useRender-D1Q3fAQ3.js";import"./index-Dx0uas1b.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./dict-vVDMuEaq.js";import"./dictEnum-DeC8h6ZR.js";import"./useContentViewHeight-BDi3O9lC.js";import"./index-BsD3RzB-.js";import"./index-BcLdq1Bd.js";import"./index-Bys7JeoU.js";import"./useTable-CNbfTOCZ.js";import"./sortable.esm-DFFrMEeC.js";import"./index-m3nShAF-.js";import"./index-Dwl0vFWZ.js";import"./index-BQijfeh-.js";import"./index-DeqOXDrL.js";import"./RejectModal.vue_vue_type_script_setup_true_lang-BLpwfAdl.js";import"./DeleteMultiInstanceModal-B4C_d8R1.js";import"./index-UH6lRBqh.js";import"./index-BVlzXcPd.js";import"./useDescription-DLkhA-M6.js";const ye={class:"w-full px-6 mb-16px flex gap-8px"},ge={key:0},ke={key:0,class:"flex justify-end gap-8px mt-8px"},he={key:2},ba=J({__name:"SubFormTest",setup(R){const w=I(()=>t.type==="add"||t.type==="update"),p=I(()=>t.type==="preview"||t.type==="approval"),t=q().query,c=b(""),m=b(),n=b(!1);z(()=>d(this,null,function*(){var a;n.value=!0;const{type:e,id:r=""}=t;if(e){if(e==="preview"||e==="update"||e==="approval"){yield Y({disabled:e==="preview"||e==="approval"});const l=yield se(r);c.value=l.id,yield V(be(l,"subForm")),l.subForm=JSON.parse(l.subForm),m.value=l,(a=v.value)==null||a.loadData(l.subForm)}n.value=!1}}));const o=b(!1),[f,{setFieldsValue:V,validate:B,setProps:Y}]=Q({labelWidth:100,name:"leave_form",showActionButtonGroup:!1,baseColProps:{xs:24,sm:24,md:24,lg:24},schemas:te,fieldMapToTime:[["dateTime",["startDate","endDate"],["YYYY-MM-DD 00:00:00","YYYY-MM-DD 00:00:00"]]]}),v=b(),N=U({id:"CodeGenVxeTable",keepSource:!0,border:!0,editConfig:{trigger:"click",mode:"cell",showStatus:!0},columns:ee,toolbarConfig:{enabled:!1},columnConfig:{resizable:!0},data:[],proxyConfig:{enabled:!1},editRules:ae});function E(){return d(this,null,function*(){const e=v.value;if(e){const r={},{row:a}=yield e.insertAt(r,-1);yield e.setEditCell(a,"name")}})}function A(){const e=v.value;e&&e.removeCheckboxRow()}function K(){return d(this,null,function*(){const e=v.value;if(!e)return;if(yield e.validate())return Promise.reject(new Error("编辑表格校验失败"));const a=e.getTableData();return Promise.resolve(we(a.fullData))})}const{closeCurrent:M}=le(),[O,{openModal:W}]=ue(),{createMessage:G}=ne();function F(e){return d(this,null,function*(){try{o.value=!0;const r=yield B(),a=yield K();if(a&&a.length===0){G.warn("子表单不能为空");return}const l=t.type==="update"?re:ie;r.subForm=JSON.stringify(a);const T=yield l(r);if(e==="temp"){yield M();return}const L={businessKey:T.id,tableName:"test_purchase",variables:{entity:T,userList:[1,3],userList2:[1,3]}},j=yield me(L);W(!0,j.taskId)}catch(r){}finally{o.value=!1}})}function P(){return d(this,null,function*(){yield M()})}return(e,r)=>{const a=Z("a-button");return _(),S(s(oe),{dense:"",contentClass:"p-16px"},{default:u(()=>[i(s($),{title:"表单信息"},{default:u(()=>[k(i(s(_e),{active:""},null,512),[[h,n.value]]),k(C("div",null,[k(C("div",null,[i(s(X),{onRegister:s(f)},null,8,["onRegister"]),C("div",ye,[i(a,{type:"dashed",onClick:E},{default:u(()=>[y("新增")]),_:1}),i(a,{onClick:A},{default:u(()=>[y("选中删除")]),_:1})]),i(s(fe),H({ref_key:"tableRef",ref:v},N),null,16)],512),[[h,w.value]]),m.value&&p.value?(_(),x("div",ge,[i(s(ve),{data:m.value,records:m.value.subForm},null,8,["data","records"])])):g("",!0)],512),[[h,!n.value]])]),_:1}),w.value?(_(),x("div",ke,[i(a,{loading:o.value,disabled:o.value,onClick:r[0]||(r[0]=l=>F("temp"))},{default:u(()=>[y("保存草稿")]),_:1},8,["loading","disabled"]),i(a,{loading:o.value,disabled:o.value,type:"primary",onClick:r[1]||(r[1]=l=>F("submit"))},{default:u(()=>[y("提交")]),_:1},8,["loading","disabled"])])):g("",!0),s(t).type==="approval"&&s(t).taskId?(_(),S(s($),{key:1,class:"mt-16px",title:"审批"},{default:u(()=>[i(ce,{class:"md:w-full lg:w-1/2",taskId:s(t).taskId,onReload:P},null,8,["taskId"])]),_:1})):g("",!0),p.value&&c.value?(_(),x("div",he,[i(de,{businessKey:c.value},null,8,["businessKey"])])):g("",!0),i(pe,{approvalMode:s(t).type==="approval",taskId:s(t).taskId,onRegister:s(O),onReload:P},null,8,["approvalMode","taskId","onRegister"])]),_:1})}}});export{ba as default};
