var v=(_,g,d)=>new Promise((f,h)=>{var n=r=>{try{m(d.next(r))}catch(s){h(s)}},i=r=>{try{m(d.throw(r))}catch(s){h(s)}},m=r=>r.done?f(r.value):Promise.resolve(r.value).then(n,i);m((d=d.apply(_,g)).next())});import{a as P,B as V}from"./index-CMSTH4sS.js";import{u as $,_ as G}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{f as j,i as D,j as E}from"./index-CYdIkwig.js";import{r as O,e as W}from"./index-Bz-s2yf4.js";import{_ as q}from"./index-CwwL6bPg.js";import{e as z,m as H}from"./role.data-DFU5aoTG.js";import{bA as J,bn as Q,bB as X}from"./entry/index-CMepwc5X-1716790511191.js";import{b7 as Y,R as Z}from"./antd-BRjMhd0C.js";import{d as ee,f as p,c as te,y as ae,_ as S,a8 as R,a9 as k,k as C,u as o,ac as oe,ad as re}from"./vue-Bw3NQgLF.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import"./helper-CfJJkrf5.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./index-Rv_3g2e8.js";import"./useSortable-CwI952Jx.js";import"./download-CYeVxFqw.js";import"./useLoading-iCq4GOHr.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./onMountedOrActivated-B2y-oH2N.js";import"./dictEnum-DeC8h6ZR.js";import"./dict-C9gNHjAh.js";import"./useRender-C6p2srTi.js";import"./index-BhefpKLc.js";const se=1,Ae=ee({name:"RoleModal",__name:"RoleModal",emits:["register","reload"],setup(_,{emit:g}){const d=g,f=p(!1),h=te(()=>f.value?"编辑角色":"新增角色"),n=p([]),i=p(!1),m=p(),[r,{modalLoading:s,closeModal:T}]=P(e=>v(this,null,function*(){s(!0),i.value=!1;const{record:t,update:c}=e;if(f.value=c,c&&t){const a=yield j(t.roleId);i.value=!a.menuCheckStrictly,yield w(a);const u=yield O(a.roleId),{menus:M,checkedKeys:y}=u,L=I(M);if(n.value=L,a.menuCheckStrictly){const N=J(M,y);l.value=[...N,...y]}else l.value=y;yield w({menuIds:y})}else{const a=yield W(),u=I(a);n.value=u}ae(()=>{var a;(a=m.value)==null||a.filterByLevel(se)}),s(!1)}));function I(e){return Q(e,t=>!z.includes(t.id),{id:"id",pid:"parentId",children:"children"})}const[x,{setFieldsValue:w,resetForm:B,validate:F}]=$({labelWidth:100,layout:"vertical",showActionButtonGroup:!1,baseColProps:{span:24},schemas:H}),l=p([]);function A(e,t){if(e instanceof Array){const c=t.halfCheckedKeys||[];l.value=[...c,...e]}else l.value=[...e.checked]}function U(e){if(e instanceof Array){const t=X(n.value);e.length===0&&(console.log("取消全部"),l.value=[]),e.length===t.length&&(console.log("选择全部"),l.value=t)}}function K(){return v(this,null,function*(){try{s(!0);const e=yield F();e.menuCheckStrictly=!o(i),e.menuIds=[...o(l)],o(f)?yield D(e):yield E(e),yield b(),d("reload",T)}catch(e){}finally{s(!1)}})}function b(){return v(this,null,function*(){yield B(),l.value=[]})}return(e,t)=>(S(),R(o(V),re(e.$attrs,{title:h.value,width:600,onRegister:o(r),onOk:K,onCancel:b}),{default:k(()=>[C(o(G),{onRegister:o(x)},{menuTree:k(({model:c,field:a})=>[C(o(Y),null,{default:k(()=>[C(o(Z),{"body-style":{padding:0}},{default:k(()=>[n.value.length?(S(),R(o(q),{key:0,ref_key:"roleTreeRef",ref:m,title:"菜单分配","tree-data":n.value,fieldNames:{title:"label",key:"id"},checkable:!0,selectable:!1,enableCustomTool:!0,checkStrictly:i.value,"onUpdate:checkStrictly":t[0]||(t[0]=u=>i.value=u),checkedKeys:c[a],"onUpdate:checkedKeys":u=>c[a]=u,onCheck:A,onChange:U},null,8,["tree-data","checkStrictly","checkedKeys","onUpdate:checkedKeys"])):oe("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{Ae as default};
