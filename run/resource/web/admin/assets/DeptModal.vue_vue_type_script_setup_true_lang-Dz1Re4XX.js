var r=(i,f,d)=>new Promise((l,u)=>{var I=a=>{try{m(d.next(a))}catch(c){u(c)}},p=a=>{try{m(d.throw(a))}catch(c){u(c)}},m=a=>a.done?l(a.value):Promise.resolve(a.value).then(I,p);m((d=d.apply(i,f)).next())});import{a as y,B as A}from"./index-CMSTH4sS.js";import{u as M,_ as P}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{d as x,a as v,b as C,c as O,e as k}from"./index-Cxb1HX4m.js";import{l as E}from"./index-Cm0AtxlD.js";import{D as h}from"./dictEnum-DeC8h6ZR.js";import{g as _}from"./dict-C9gNHjAh.js";import{bp as F,bq as T}from"./entry/index-CMepwc5X-1716790511191.js";import"./helper-CfJJkrf5.js";import{c as D}from"./rules-Boel_RXz.js";import{u as q}from"./useRender-C6p2srTi.js";import{d as U,f as V,c as $,u as s,_ as G,a8 as W,a9 as j,k as z,ad as H}from"./vue-Bw3NQgLF.js";const{renderDict:J}=q(),pe=[{dataIndex:"deptName",title:"导航名称"},{dataIndex:"orderNum",title:"排序",width:180},{dataIndex:"status",width:180,title:"状态",customRender({value:i}){return J(i,h.NORMAL_DISABLE)}},{dataIndex:"createTime",title:"创建时间"}],me=[{field:"deptName",label:"导航名称",component:"Input"},{field:"status",label:"导航状态",component:"Select",componentProps:{options:_(h.NORMAL_DISABLE)}}],K=[{field:"deptId",label:"部门ID",component:"Input",show:!1},{field:"parentId",label:"上级部门",required:!0,defaultValue:100,component:"TreeSelect",show({model:i}){return i.parentId!==0}},{field:"deptName",label:"部门名称",component:"Input",required:!0},{field:"orderNum",label:"显示排序",component:"InputNumber",required:!0},{field:"leader",label:"负责人",component:"Select",componentProps:{allowClear:!1}},{field:"phone",label:"联系电话",component:"Input",rules:D("phone")},{field:"email",label:"邮箱地址",component:"Input",rules:D("email")},{field:"status",label:"部门状态",component:"RadioButtonGroup",defaultValue:"0",componentProps:{options:_(h.NORMAL_DISABLE)}}],ce=U({name:"DeptModal",__name:"DeptModal",emits:["register","reload"],setup(i,{emit:f}){const d=f,l=V(!1),u=$(()=>l.value?"编辑部门":"新增部门"),[I,{modalLoading:p,closeModal:m}]=y(e=>r(this,null,function*(){p(!0);const{deptId:t,update:o}=e;if(l.value=o,t&&(yield b({parentId:t}),s(l))){const n=yield x(t);yield b(n)}t&&o?yield c(t):yield g(),yield a(t),p(!1)}));function a(e){return r(this,null,function*(){const t=yield L(e,!s(l));yield w({field:"parentId",componentProps:{treeData:t,treeLine:{showLeafIcon:!1},fieldNames:{label:"deptName",value:"deptId"},treeDefaultExpandAll:!0,treeNodeLabelProp:"fullName"}})})}function c(e){return r(this,null,function*(){const t=yield E(e),o=t.map(n=>({label:`${n.userName} | ${n.nickName}`,value:n.userId}));yield w({field:"leader",componentProps:{options:o,disabled:t.length===0,placeholder:t.length===0?"该部门暂无用户":"请选择部门负责人"}})})}function g(){return r(this,null,function*(){yield w({field:"leader",componentProps:{options:[],disabled:!0,placeholder:"仅在更新时可选部门负责人"}})})}function L(e,t=!1){return r(this,null,function*(){let o=[];!e||t?o=yield v({}):o=yield C(e);const n=F(o,{id:"deptId",pid:"parentId"});return T(n,"deptName"," / "),n})}const[R,{updateSchema:w,setFieldsValue:b,resetForm:N,validate:S}]=M({labelWidth:100,name:"dept_modal",showActionButtonGroup:!1,schemas:K,baseColProps:{span:24}});function B(){return r(this,null,function*(){try{p(!0);const e=yield S();s(l)?yield O(e):yield k(e),d("reload"),m(),yield N()}catch(e){console.log(e)}finally{p(!1)}})}return(e,t)=>(G(),W(s(A),H(e.$attrs,{title:u.value,width:700,"min-height":350,onRegister:s(I),onOk:B,onCancel:s(N)}),{default:j(()=>[z(s(P),{onRegister:s(R)},null,8,["onRegister"])]),_:1},16,["title","onRegister","onCancel"]))}});export{ce as _,pe as c,me as f};
