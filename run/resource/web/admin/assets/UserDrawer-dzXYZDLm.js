var m=(y,g,p)=>new Promise((b,d)=>{var S=o=>{try{u(p.next(o))}catch(c){d(c)}},D=o=>{try{u(p.throw(o))}catch(c){d(c)}},u=o=>o.done?b(o.value):Promise.resolve(o.value).then(S,D);u((p=p.apply(y,g)).next())});import{a as M,B as Z}from"./index-BLDmWVyR.js";import{u as j,_ as q}from"./useForm-BsovIqMX.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./componentMap-qA-f8iV4.js";import{a as k,d as H,b as J,c as K}from"./index-Bys7JeoU.js";import{f as Q}from"./index-DGT8hE2-.js";import{d as X}from"./user.data--syaYDXk.js";import{bx as Y,l as ee}from"./entry/index-BbJQUQ84-1718268303552.js";import{u as te}from"./useSize-CUNtmCvH.js";import{b as ae}from"./role.data-wz2Oc4N6.js";import{z as N,A as B}from"./antd-DMGzOvrA.js";import{d as oe,f as x,c as re,Z as f,a8 as L,a9 as l,k as w,u as t,_ as O,F as C,aa as R,$ as h,a0 as I,G as A,ac as se}from"./vue-Cw15aJ-2.js";import"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import"./helper-CXVLNTBN.js";import"./index-BIkrAlj7.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./index-DCvxWw7W.js";import"./useSortable-BTdBE9Oa.js";import"./download-DOz9ltI1.js";import"./useLoading-D1in2ACg.js";import"./copyTextToClipboard-uEEWQikS.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./style-CLEvKZSv.js";import"./rules-Boel_RXz.js";import"./dict-vVDMuEaq.js";import"./dictEnum-DeC8h6ZR.js";import"./useRender-D1Q3fAQ3.js";import"./index-Dx0uas1b.js";const le={class:"flex flex-row gap-1.5"},ie={class:"flex flex-row gap-1.5"},pe=oe({name:"UserDrawer",__name:"UserDrawer",emits:["register","reload"],setup(y,{emit:g}){const p=N.Option,b=g,d=x(!1),S=te(700),D=re(()=>d.value?"编辑用户":"新增用户"),u=x([]),o=x([]),[c,{drawerLoading:_,closeDrawer:T}]=M(a=>m(this,null,function*(){_(!0);const{record:n,update:r}=a;d.value=r,yield P([{field:"userName",componentProps:{disabled:r}},{field:"password",ifShow:!r}]);const s=n?yield k(n.userId):yield k(),{postIds:e=[],roleIds:v=[],user:i,roles:z}=s;i&&(i.postIds=e,i.roleIds=v),o.value=z,yield V(),i&&r&&(yield $(i)),_(!1)}));function V(){return m(this,null,function*(){const a=yield H();Y(a,"label"," / "),yield P([{field:"deptId",componentProps:({formModel:n})=>({treeData:a,fieldNames:{value:"id",label:"label"},treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeLabelProp:"fullName",onSelect(s){return m(this,null,function*(){const e=yield Q(s);u.value=e,n.postIds=[]})}})}])})}const[W,{setFieldsValue:$,resetForm:F,validate:E,updateSchema:P}]=j({labelWidth:100,name:"user-drawer",showActionButtonGroup:!1,baseColProps:{span:24},schemas:X});function U(a){return ae.find(n=>n.value===a)}function G(){return m(this,null,function*(){try{_(!0);const a=yield E();t(d)?yield J(a):yield K(a),b("reload"),T(),yield F()}catch(a){}finally{_(!1)}})}return(a,n)=>(f(),L(t(Z),se(a.$attrs,{width:t(S),title:D.value,"show-footer":!0,onRegister:t(c),onOk:G,onClose:t(F)}),{default:l(()=>[w(t(q),{onRegister:t(W)},{postIds:l(({model:r,field:s})=>[w(t(N),{value:r[s],"onUpdate:value":e=>r[s]=e,optionFilterProp:"title",placeholder:"请选择岗位",mode:"multiple",optionLabelProp:"title"},{default:l(()=>[(f(!0),O(C,null,R(u.value,e=>(f(),L(t(p),{key:e.postId,value:e.postId,title:e.postName},{default:l(()=>[h("div",le,[h("span",null,I(e.postName),1),w(t(B),null,{default:l(()=>[A(I(e.postCode),1)]),_:2},1024)])]),_:2},1032,["value","title"]))),128))]),_:2},1032,["value","onUpdate:value"])]),roleIds:l(({model:r,field:s})=>[w(t(N),{value:r[s],"onUpdate:value":e=>r[s]=e,optionFilterProp:"title",placeholder:"请选择角色",mode:"multiple",optionLabelProp:"title"},{default:l(()=>[(f(!0),O(C,null,R(o.value,e=>(f(),L(t(p),{key:e.roleId,value:e.roleId,title:e.roleName},{default:l(()=>{var v;return[h("div",ie,[h("span",null,I(e.roleName),1),w(t(B),{color:(v=U(e.dataScope))==null?void 0:v.color},{default:l(()=>{var i;return[A(I((i=U(e.dataScope))==null?void 0:i.label),1)]}),_:2},1032,["color"])])]}),_:2},1032,["value","title"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:1},8,["onRegister"])]),_:1},16,["width","title","onRegister","onClose"]))}}),We=ee(pe,[["__scopeId","data-v-6c9499ca"]]);export{We as default};
