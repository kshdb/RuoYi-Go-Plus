var f=(v,w,l)=>new Promise((u,k)=>{var I=t=>{try{c(l.next(t))}catch(m){k(m)}},d=t=>{try{c(l.throw(t))}catch(m){k(m)}},c=t=>t.done?u(t.value):Promise.resolve(t.value).then(I,d);c((l=l.apply(v,w)).next())});import{a as L,B as N}from"./index-BLDmWVyR.js";import{u as V,_ as W}from"./useForm-BsovIqMX.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./componentMap-qA-f8iV4.js";import{e as $,m as O}from"./tenantPackage.data-3RzivsLS.js";import{a as E,b as G,c as Z}from"./index-BwotnLdp.js";import{_ as j}from"./index-BcLdq1Bd.js";import{t as q,m as z}from"./index-CCBbV1HU.js";import{bw as H,bn as J,bD as Q}from"./entry/index-BbJQUQ84-1718268303552.js";import{u as X}from"./useSize-CUNtmCvH.js";import Y from"./TreeItem-BtBK2Bxd.js";import{ba as ee,R as ae}from"./antd-DMGzOvrA.js";import{d as te,f as p,c as ne,y as re,u as n,Z as C,a8 as b,a9 as h,k as g,ab as se,ac as oe}from"./vue-Cw15aJ-2.js";const ce=1,_e=te({name:"TenantPackageDrawer",__name:"TenantPackageDrawer",emits:["register","reload"],setup(v,{emit:w}){const l=w,u=p(!1),k=ne(()=>u.value?"编辑租户套餐":"新增租户套餐"),I=X(700),d=p(),c=p([]),t=p(!1),[m,{closeDrawer:T,drawerLoading:y}]=L(e=>f(this,null,function*(){y(!0),yield S(),t.value=!1;const{record:a,update:s}=e;if(u.value=s,s&&a){const o=yield E(a.packageId),r=F(o.menuIds);i.value=r,t.value=!o.menuCheckStrictly;const{checkedKeys:K}=yield q(a.packageId);o.menuIds=K,yield x(o)}re(()=>{n(d)&&n(d).filterByLevel(ce)}),y(!1)}));function S(){return f(this,null,function*(){const a=(yield z()).map(r=>(r.menuType==="F"&&(r.icon=""),r)),s=D(a),o=H(s,{id:"menuId"});c.value=o})}function D(e){return J(e,a=>!$.includes(a.menuId),{id:"menuId",pid:"parentId",children:"children"})}function F(e){return e?e.split(", "):[]}const[R,{setFieldsValue:x,validate:M,resetForm:B}]=V({layout:"vertical",labelWidth:80,name:"tenant_package_drawer",showActionButtonGroup:!1,baseColProps:{span:24},schemas:O}),i=p([]);function A(e,a){if(e instanceof Array){const s=a.halfCheckedKeys||[];i.value=[...s,...e]}else i.value=[...e.checked]}function P(e){if(e instanceof Array){const a=Q(c.value,{id:"menuId",children:"children",pid:"parentId"});e.length===0&&(i.value=[]),e.length===a.length&&(i.value=a)}}function U(){return f(this,null,function*(){try{y(!0);const e=yield M();e.menuIds=i.value.sort(),e.menuCheckStrictly=!n(t),n(u)?yield G(e):yield Z(e),l("reload"),T(),yield _()}catch(e){}finally{y(!1)}})}function _(){return f(this,null,function*(){yield B(),i.value=[]})}return(e,a)=>(C(),b(n(N),oe(e.$attrs,{title:k.value,width:n(I),"show-footer":!0,onRegister:n(m),onOk:U,onClose:_}),{default:h(()=>[g(n(W),{onRegister:n(R)},{menuIds:h(({model:s,field:o})=>[g(n(ee),null,{default:h(()=>[g(n(ae),{"body-style":{padding:0}},{default:h(()=>[c.value.length?(C(),b(n(j),{key:0,ref_key:"menuTreeRef",ref:d,title:"菜单分配","tree-data":c.value,fieldNames:{title:"label",key:"menuId"},checkable:!0,selectable:!1,enableCustomTool:!0,checkStrictly:t.value,"onUpdate:checkStrictly":a[0]||(a[0]=r=>t.value=r),checkedKeys:s[o],"onUpdate:checkedKeys":r=>s[o]=r,onCheck:A,onChange:P},{title:h(r=>[g(n(Y),{data:r},null,8,["data"])]),_:2},1032,["tree-data","checkStrictly","checkedKeys","onUpdate:checkedKeys"])):se("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["title","width","onRegister"]))}});export{_e as _};
