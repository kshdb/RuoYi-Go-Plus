var m=(y,I,n)=>new Promise((g,d)=>{var S=o=>{try{u(n.next(o))}catch(c){d(c)}},D=o=>{try{u(n.throw(o))}catch(c){d(c)}},u=o=>o.done?g(o.value):Promise.resolve(o.value).then(S,D);u((n=n.apply(y,I)).next())});import{a as q,B as z}from"./index-ov0mgIjt.js";import{u as M,_ as H}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{a as U,d as J,b as K,c as Q}from"./index-Cm0AtxlD.js";import{f as X}from"./index-tTbWyNHk.js";import{d as Y}from"./shebei.data-D993yXyd.js";import{bq as Z,j as ee}from"./entry/index-CMepwc5X-1716790511191.js";import{u as te}from"./useSize-tRF5RUOv.js";import{b as ae}from"./role.data-DFU5aoTG.js";import{z as N,O as k}from"./antd-BRjMhd0C.js";import{d as oe,f as x,c as re,_ as f,a8 as L,a9 as l,k as w,u as t,$ as B,F as C,ab as R,a0 as h,a1 as b,G as A,ad as se}from"./vue-Bw3NQgLF.js";import"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import"./helper-CfJJkrf5.js";import"./index-CMSTH4sS.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./index-Rv_3g2e8.js";import"./useSortable-CwI952Jx.js";import"./download-CYeVxFqw.js";import"./useLoading-iCq4GOHr.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./onMountedOrActivated-B2y-oH2N.js";import"./rules-Boel_RXz.js";import"./dict-C9gNHjAh.js";import"./dictEnum-DeC8h6ZR.js";import"./useRender-C6p2srTi.js";import"./index-BhefpKLc.js";const le={class:"flex flex-row gap-1.5"},ie={class:"flex flex-row gap-1.5"},ne=oe({name:"UserDrawer",__name:"shebeiDrawer",emits:["register","reload"],setup(y,{emit:I}){const n=N.Option,g=I,d=x(!1),S=te(700),D=re(()=>d.value?"编辑用户":"新增用户"),u=x([]),o=x([]),[c,{drawerLoading:_,closeDrawer:T}]=q(a=>m(this,null,function*(){_(!0);const{record:p,update:r}=a;d.value=r,yield P([{field:"userName",componentProps:{disabled:r}},{field:"password",ifShow:!r}]);const s=p?yield U(p.userId):yield U(),{postIds:e=[],roleIds:v=[],user:i,roles:j}=s;i&&(i.postIds=e,i.roleIds=v),o.value=j,yield V(),i&&r&&(yield $(i)),_(!1)}));function V(){return m(this,null,function*(){const a=yield J();Z(a,"label"," / "),yield P([{field:"deptId",componentProps:({formModel:p})=>({treeData:a,fieldNames:{value:"id",label:"label"},treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeLabelProp:"fullName",onSelect(s){return m(this,null,function*(){const e=yield X(s);u.value=e,p.postIds=[]})}})}])})}const[W,{setFieldsValue:$,resetForm:F,validate:E,updateSchema:P}]=M({labelWidth:100,name:"user-drawer",showActionButtonGroup:!1,baseColProps:{span:24},schemas:Y});function O(a){return ae.find(p=>p.value===a)}function G(){return m(this,null,function*(){try{_(!0);const a=yield E();t(d)?yield K(a):yield Q(a),g("reload"),T(),yield F()}catch(a){}finally{_(!1)}})}return(a,p)=>(f(),L(t(z),se(a.$attrs,{width:t(S),title:D.value,"show-footer":!0,onRegister:t(c),onOk:G,onClose:t(F)}),{default:l(()=>[w(t(H),{onRegister:t(W)},{postIds:l(({model:r,field:s})=>[w(t(N),{value:r[s],"onUpdate:value":e=>r[s]=e,optionFilterProp:"title",placeholder:"请选择岗位",mode:"multiple",optionLabelProp:"title"},{default:l(()=>[(f(!0),B(C,null,R(u.value,e=>(f(),L(t(n),{key:e.postId,value:e.postId,title:e.postName},{default:l(()=>[h("div",le,[h("span",null,b(e.postName),1),w(t(k),null,{default:l(()=>[A(b(e.postCode),1)]),_:2},1024)])]),_:2},1032,["value","title"]))),128))]),_:2},1032,["value","onUpdate:value"])]),roleIds:l(({model:r,field:s})=>[w(t(N),{value:r[s],"onUpdate:value":e=>r[s]=e,optionFilterProp:"title",placeholder:"请选择角色",mode:"multiple",optionLabelProp:"title"},{default:l(()=>[(f(!0),B(C,null,R(o.value,e=>(f(),L(t(n),{key:e.roleId,value:e.roleId,title:e.roleName},{default:l(()=>{var v;return[h("div",ie,[h("span",null,b(e.roleName),1),w(t(k),{color:(v=O(e.dataScope))==null?void 0:v.color},{default:l(()=>{var i;return[A(b((i=O(e.dataScope))==null?void 0:i.label),1)]}),_:2},1032,["color"])])]}),_:2},1032,["value","title"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:1},8,["onRegister"])]),_:1},16,["width","title","onRegister","onClose"]))}}),Ve=ee(ne,[["__scopeId","data-v-7642f5bb"]]);export{Ve as default};
