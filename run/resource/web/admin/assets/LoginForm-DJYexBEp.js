var de=Object.defineProperty,ue=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var G=(c,o,r)=>o in c?de(c,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[o]=r,j=(c,o)=>{for(var r in o||(o={}))me.call(o,r)&&G(c,r,o[r]);if(V)for(var r of V(o))fe.call(o,r)&&G(c,r,o[r]);return c},Q=(c,o)=>ue(c,ce(o));var S=(c,o,r)=>new Promise((m,C)=>{var u=f=>{try{b(r.next(f))}catch(_){C(_)}},D=f=>{try{b(r.throw(f))}catch(_){C(_)}},b=f=>f.done?m(f.value):Promise.resolve(f.value).then(u,D);b((r=r.apply(c,o)).next())});import{d as pe,f as R,r as O,c as W,o as ge,u as e,a7 as ve,Z as w,_ as Z,m as H,A as J,k as s,a9 as n,a8 as N,F as X,aa as ye,G as g,a0 as v,ab as Y,ar as ee}from"./vue-Cw15aJ-2.js";import{u as Ie,a as be,b as _e,L as k,_ as Se}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-CnUuUGo-.js";import{m as we,q as ke,a as Ce,b as he,aD as xe,_ as Ee,aE as Le,h as Re,l as Te}from"./entry/index-BbJQUQ84-1718268303552.js";import{c as Fe}from"./captcha-BOwx-rNG.js";import De from"./OAuthLogin-DPKvUE9_.js";import{a8 as ae,E as A,z as Me,at as $e,au as qe,av as Be,B as T,ap as ze,as as Oe,ar as Ne}from"./antd-DMGzOvrA.js";import"./componentMap-qA-f8iV4.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./index-DCvxWw7W.js";import"./index-BIkrAlj7.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./useSortable-BTdBE9Oa.js";import"./download-DOz9ltI1.js";import"./useLoading-D1in2ACg.js";import"./copyTextToClipboard-uEEWQikS.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./style-CLEvKZSv.js";import"./helper-CXVLNTBN.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./rules-Boel_RXz.js";import"./common-8BH4CJGh.js";const I="000000",F="rememberMe",Ae=pe({__name:"LoginForm",setup(c){const o=Oe,r=Ne,m=ae.Item,C=A.Password,{t:u}=we(),{notification:D,createErrorModal:b}=Re(),{prefixCls:f}=ke("login"),_=Ce(),{setLoginState:h,getLoginState:te}=Ie(),{getFormRules:se}=be(),U=R(),x=R(!1),i=O({account:"admin",password:"admin123",code:"",uuid:"",tenantId:I}),p=O({requiredCaptcha:!1,imageInfo:"",loadSuccess:!1}),y=O({tenantEnabled:!1,voList:[],loadSuccess:!1});function M(){return S(this,null,function*(){var l;try{const a=yield Fe();i.uuid=a.uuid,p.requiredCaptcha=a.captchaEnabled,p.imageInfo=`data:image/gif;base64,${a.img}`,i.code="",(l=e(B))==null||l.focus(),p.loadSuccess=!0}catch(a){p.loadSuccess=!1}})}const $=he("tenantId",I);function ne(l){$.value=l}function oe(){return S(this,null,function*(){try{const l=yield Le(),{tenantEnabled:a,voList:d}=l;if(a){const t=d.length?d[0].tenantId:I;i.tenantId=t,$.value=t}Object.assign(y,l),y.loadSuccess=!0}catch(l){y.loadSuccess=!1}})}const P=W(()=>y.loadSuccess&&p.loadSuccess),E=xe(),q=R(!!E.get(F));function le(l){const{tenantId:a=I,username:d,password:t}=l,L={tenantId:a,username:d,password:t};q.value?E.set(F,L):E.remove(F)}function re(){const l=E.get(F);if(l){const{tenantId:a=I,username:d="",password:t=""}=l;i.tenantId=a,i.account=d,i.password=t}}ge(()=>S(this,null,function*(){yield M(),yield oe(),re()}));const{validForm:ie}=_e(U),K=W(()=>e(te)===k.LOGIN),B=R();function z(){return S(this,null,function*(){var a;if(!P.value)return;const l=yield ie();if(l)try{x.value=!0;const d={username:l.account,password:l.password,grantType:"password"};p.requiredCaptcha&&(d.uuid=i.uuid,d.code=l.code),y.tenantEnabled?d.tenantId=i.tenantId:d.tenantId=I;const t=yield _.login(Q(j({},d),{mode:"none"}));t&&($.value=(a=d.tenantId)!=null?a:I,le(d),D.success({message:u("sys.login.loginSuccessTitle"),description:`${u("sys.login.loginSuccessDesc")}: ${t.nickName}`,duration:3}))}catch(d){yield M();const t=d.message||u("sys.api.networkExceptionMsg");b({title:u("sys.api.errorTip"),content:t,getContainer:()=>document.body.querySelector(`.${f}`)||document.body,onOk(){var L;p.requiredCaptcha&&(t.includes("验证码")||t.includes("Captcha"))&&(i.code="",(L=e(B))==null||L.focus())}})}finally{x.value=!1}})}return(l,a)=>{const d=ve("a-button");return w(),Z(X,null,[H(s(Se,{class:"enter-x"},null,512),[[J,K.value]]),H(s(e(ae),{class:"p-4 enter-x",model:i,rules:e(se),ref_key:"formRef",ref:U},{default:n(()=>[y.tenantEnabled?(w(),N(e(m),{key:0,name:"tenantId",class:"enter-x"},{default:n(()=>[s(e(Me),{value:i.tenantId,"onUpdate:value":a[0]||(a[0]=t=>i.tenantId=t),size:"large",onChange:ne},{suffixIcon:n(()=>[s(Ee,{icon:"mdi:company"})]),default:n(()=>[(w(!0),Z(X,null,ye(y.voList,t=>(w(),N(e($e),{key:t.tenantId,value:t.tenantId},{default:n(()=>[g(v(t.companyName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):Y("",!0),s(e(m),{name:"account",class:"enter-x"},{default:n(()=>[s(e(A),{size:"large",value:i.account,"onUpdate:value":a[1]||(a[1]=t=>i.account=t),placeholder:e(u)("sys.login.userName")},null,8,["value","placeholder"])]),_:1}),s(e(m),{name:"password",class:"enter-x"},{default:n(()=>[s(e(C),{size:"large",visibilityToggle:"",value:i.password,"onUpdate:value":a[2]||(a[2]=t=>i.password=t),placeholder:e(u)("sys.login.password"),onKeypress:ee(z,["enter"])},null,8,["value","placeholder"])]),_:1}),p.requiredCaptcha?(w(),N(e(m),{key:1,name:"code",class:"enter-x"},{default:n(()=>[s(e(A),{ref_key:"imageCodeRef",ref:B,size:"large",value:i.code,"onUpdate:value":a[3]||(a[3]=t=>i.code=t),placeholder:"输入验证码",onKeypress:ee(z,["enter"])},{addonAfter:n(()=>[s(e(qe),{class:"rounded-r-lg",preview:!1,height:40,width:105,src:p.imageInfo,onClick:M},null,8,["src"])]),_:1},8,["value"])]),_:1})):Y("",!0),s(e(r),{class:"enter-x"},{default:n(()=>[s(e(o),{span:12},{default:n(()=>[s(e(m),null,{default:n(()=>[s(e(Be),{checked:q.value,"onUpdate:checked":a[4]||(a[4]=t=>q.value=t),size:"small"},{default:n(()=>[g(v(e(u)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(o),{span:12},{default:n(()=>[s(e(m),{style:{"text-align":"right"}},{default:n(()=>[s(e(T),{disabled:!0,type:"link",size:"small",onClick:a[5]||(a[5]=t=>e(h)(e(k).RESET_PASSWORD))},{default:n(()=>[g(v(e(u)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(m),{class:"enter-x"},{default:n(()=>[s(d,{type:"primary",size:"large",block:"",disabled:!P.value,onClick:z,loading:x.value},{default:n(()=>[g(v(e(u)("sys.login.loginButton")),1)]),_:1},8,["disabled","loading"])]),_:1}),s(e(r),{class:"enter-x",gutter:[16,16]},{default:n(()=>[s(e(o),{md:8,xs:24},{default:n(()=>[s(e(T),{block:"",onClick:a[6]||(a[6]=t=>e(h)(e(k).MOBILE))},{default:n(()=>[g(v(e(u)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(o),{md:8,xs:24},{default:n(()=>[s(e(T),{block:"",onClick:a[7]||(a[7]=t=>e(h)(e(k).QR_CODE)),disabled:""},{default:n(()=>[g(v(e(u)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(o),{md:8,xs:24},{default:n(()=>[s(e(T),{block:"",onClick:a[8]||(a[8]=t=>e(h)(e(k).REGISTER)),disabled:""},{default:n(()=>[g(v(e(u)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(ze),{class:"enter-x"},{default:n(()=>[g(v(e(u)("sys.login.otherSignIn")),1)]),_:1}),s(De,{disabled:x.value},null,8,["disabled"])]),_:1},8,["model","rules"]),[[J,K.value]])],64)}}}),da=Te(Ae,[["__scopeId","data-v-b894943e"]]);export{da as default};
