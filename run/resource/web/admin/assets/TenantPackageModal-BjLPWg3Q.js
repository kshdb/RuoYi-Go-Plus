var g=(C,v,u)=>new Promise((m,h)=>{var d=s=>{try{n(u.next(s))}catch(f){h(f)}},o=s=>{try{n(u.throw(s))}catch(f){h(f)}},n=s=>s.done?m(s.value):Promise.resolve(s.value).then(d,o);n((u=u.apply(C,v)).next())});import{a as L,B as V}from"./index-BIkrAlj7.js";import{u as $,_ as D}from"./useForm-BsovIqMX.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./componentMap-qA-f8iV4.js";import{e as E,m as G}from"./tenantPackage.data-3RzivsLS.js";import{a as O,b as W,c as Z}from"./index-BwotnLdp.js";import{_ as j}from"./index-BcLdq1Bd.js";import{t as q,e as z}from"./index-CCBbV1HU.js";import{bn as H,bD as J}from"./entry/index-BbJQUQ84-1718268303552.js";import{ba as Q,R as X}from"./antd-DMGzOvrA.js";import{d as Y,f as p,c as ee,y as ae,u as t,Z as w,a8 as M,a9 as y,k as _,ab as te,ac as ne}from"./vue-Cw15aJ-2.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import"./helper-CXVLNTBN.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./index-DCvxWw7W.js";import"./useSortable-BTdBE9Oa.js";import"./download-DOz9ltI1.js";import"./useLoading-D1in2ACg.js";import"./copyTextToClipboard-uEEWQikS.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./style-CLEvKZSv.js";const se=1,Re=Y({name:"TenantPackageModal",__name:"TenantPackageModal",emits:["register","reload"],setup(C,{emit:v}){const u=v,m=p(!1),h=ee(()=>m.value?"编辑租户套餐":"新增租户套餐"),d=p(),o=p([]),n=p(!1),[s,{closeModal:f,modalLoading:k}]=L(e=>g(this,null,function*(){k(!0),n.value=!1;const{record:a,update:i}=e;if(m.value=i,i&&a){const r=yield O(a.packageId),c=S(r.menuIds);l.value=c,n.value=!r.menuCheckStrictly;const{checkedKeys:U,menus:K}=yield q(a.packageId),N=I(K);o.value=N,r.menuIds=U,yield R(r)}else{const r=yield z(),c=I(r);o.value=c}ae(()=>{t(d)&&t(d).filterByLevel(se)}),k(!1)}));function I(e){return H(e,a=>!E.includes(a.id),{id:"id",pid:"parentId",children:"children"})}function S(e){return e?e.split(", "):[]}const[T,{setFieldsValue:R,validate:x,resetForm:F}]=$({layout:"vertical",labelWidth:80,name:"tenant_package_modal",showActionButtonGroup:!1,baseColProps:{span:24},schemas:G}),l=p([]);function B(e,a){if(e instanceof Array){const i=a.halfCheckedKeys||[];l.value=[...i,...e]}else l.value=[...e.checked]}function A(e){if(e instanceof Array){const a=J(o.value);e.length===0&&(l.value=[]),e.length===a.length&&(l.value=a)}}function P(){return g(this,null,function*(){try{k(!0);const e=yield x();e.menuIds=l.value.sort(),e.menuCheckStrictly=!t(n),t(m)?yield W(e):yield Z(e),yield b(),u("reload",f)}catch(e){}finally{k(!1)}})}function b(){return g(this,null,function*(){yield F(),l.value=[]})}return(e,a)=>(w(),M(t(V),ne(e.$attrs,{title:h.value,width:600,onRegister:t(s),onOk:P,onCancel:b}),{default:y(()=>[_(t(D),{onRegister:t(T)},{menuIds:y(({model:i,field:r})=>[_(t(Q),null,{default:y(()=>[_(t(X),{"body-style":{padding:0}},{default:y(()=>[o.value.length?(w(),M(t(j),{key:0,ref_key:"menuTreeRef",ref:d,title:"菜单分配","tree-data":o.value,fieldNames:{title:"label",key:"id"},checkable:!0,selectable:!1,enableCustomTool:!0,checkStrictly:n.value,"onUpdate:checkStrictly":a[0]||(a[0]=c=>n.value=c),checkedKeys:i[r],"onUpdate:checkedKeys":c=>i[r]=c,onCheck:B,onChange:A},null,8,["tree-data","checkStrictly","checkedKeys","onUpdate:checkedKeys"])):te("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{Re as default};
