var h=(B,I,c)=>new Promise((b,p)=>{var k=o=>{try{u(c.next(o))}catch(f){p(f)}},v=o=>{try{u(c.throw(o))}catch(f){p(f)}},u=o=>o.done?b(o.value):Promise.resolve(o.value).then(k,v);u((c=c.apply(B,I)).next())});import{a as D,u as E,B as j}from"./index-CMSTH4sS.js";import{u as q,_ as W}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{aa as H,e as J,I as K,h as Q}from"./entry/index-CMepwc5X-1716790511191.js";import X from"./index-BMkdtMeE.js";import{c as Y}from"./index-D8V_F1G-.js";import{P as Z,O as ee,aF as se}from"./antd-BRjMhd0C.js";import{d as ae,f as U,aa as te,_ as M,a8 as R,a9 as a,k as n,G as r,u as l,a0 as x,$ as oe,ab as le,a1 as S,F as ne,ad as re}from"./vue-Bw3NQgLF.js";const ie=[{value:"1",label:"站内信",disabled:!0},{value:"2",label:"邮箱"},{value:"3",label:"短信"}],ce=[{label:"taskId",component:"Input",field:"taskId",show:!1},{label:"消息提醒",field:"messageType",component:"CheckboxGroup",defaultValue:["1"],componentProps:{options:ie}},{label:"抄送",field:"wfCopyList",slot:"wfCopyList"},{label:"附件",field:"fileId",slot:"fileId"}],de={class:"flex flex-col gap-4px"},pe=x("p",{class:"mt-4"},[r(" 请上传 大小不超过 "),x("span",{class:"text-red-500"},"20MB"),r(" 格式为 "),x("span",{class:"text-red-500"},"doc/xls/ppt/txt/pdf/xlsx/docx/zip"),r(" 的文件 ")],-1),ue=".doc,.docx,.xls,.xlsx,.ppt, .pptx, .pdf, .txt, .zip",Ce=ae({name:"PreSubmitModal",__name:"index",emits:["register","reload"],setup(B,{emit:I}){const c=I,[b,{closeModal:p}]=D(e=>h(this,null,function*(){yield o({taskId:e})})),[k,{resetFields:v,getFieldsValue:u,setFieldsValue:o}]=q({name:"pre_submit",schemas:ce,showActionButtonGroup:!1,labelWidth:100,baseColProps:{span:24}}),{apiUrl:f,clientId:P}=H(),O=`${f}/resource/oss/upload`,T={Authorization:"Bearer "+J(),clientId:P},m=U([]),g=U([]),{createMessage:F}=Q();function V(e){console.log(e);const s=e.file,i=s==null?void 0:s.status;if(i==="done"){const{response:t}=s,{code:d,msg:_="服务器错误",data:w}=t;if(d===200){const{ossId:y}=w;m.value.push(y)}else F.error(_)}if(i==="removed"){const{response:t}=s,{code:d,msg:_="服务器错误",data:w}=t;if(d===200){const{ossId:y}=w,N=m.value.indexOf(y);N!==-1&&m.value.splice(N,1)}else F.error(_)}}const[G,{openModal:$}]=E();function z(){const e=g.value.map(s=>s.userId);$(!0,e)}function A(e){console.log(e),g.value=e.map(s=>({userId:s.userId,userName:s.userName,nickName:s.nickName}))}function L(){return h(this,null,function*(){const e=u();e.fileId=m.value.join(","),e.wfCopyList=g.value,yield Y(e),p(),yield C(),c("reload")})}function C(){return h(this,null,function*(){yield v(),m.value=[],g.value=[],p()})}return(e,s)=>{const i=te("a-button");return M(),R(l(j),re(e.$attrs,{title:"提示",width:600,"can-fullscreen":!1,onRegister:l(b),onOk:L,onCancel:C}),{footer:a(()=>[n(i,{onClick:C},{default:a(()=>[r("取消")]),_:1}),n(l(Z),{placement:"topRight",title:"确认提交吗?","ok-text":"确认","cancel-text":"再想想",onConfirm:L},{default:a(()=>[n(i,{type:"primary"},{default:a(()=>[r("提交")]),_:1})]),_:1})]),default:a(()=>[n(l(W),{onRegister:l(k)},{wfCopyList:a(()=>[x("div",de,[x("div",null,[(M(!0),oe(ne,null,le(g.value,t=>(M(),R(l(ee),{key:t.userId},{default:a(()=>[r(S(t.nickName)+"/"+S(t.userName),1)]),_:2},1024))),128))]),n(i,{class:"w-fit","pre-icon":"bi:cc-square-fill",onClick:z},{default:a(()=>[r(" 选择抄送人 ")]),_:1})])]),fileId:a(({model:t,field:d})=>[n(l(se),{"file-list":t[d],"onUpdate:fileList":_=>t[d]=_,name:"file",multiple:!0,action:O,headers:T,accept:ue,onChange:V},{default:a(()=>[n(i,{"pre-icon":l(K).UPLOAD},{default:a(()=>[r("上传附件")]),_:1},8,["pre-icon"])]),_:2},1032,["file-list","onUpdate:fileList"]),pe]),_:1},8,["onRegister"]),n(X,{onRegister:l(G),onSelectDone:A},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});export{Ce as _};
