var Re=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var ge=(s,c,a)=>c in s?Re(s,c,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[c]=a,j=(s,c)=>{for(var a in c||(c={}))Ce.call(c,a)&&ge(s,a,c[a]);if(be)for(var a of be(c))Ne.call(c,a)&&ge(s,a,c[a]);return s};var y=(s,c,a)=>new Promise((i,A)=>{var v=f=>{try{l(a.next(f))}catch(d){A(d)}},t=f=>{try{l(a.throw(f))}catch(d){A(d)}},l=f=>f.done?i(f.value):Promise.resolve(f.value).then(v,t);l((a=a.apply(s,c)).next())});import{u as n,c as X,w as J,at as ke,g as Ue,y as me,J as we,h as He,d as We,K as Ye,r as Ve,f as z,o as qe,Z as he,a8 as Be,a9 as le,k as Te,ae as fe,_ as Xe,aa as ye,ad as Ie,ac as Ae,F as ze,ak as De,al as Ee,ar as Ge,b as Je}from"./vue-Cw15aJ-2.js";import{_ as Qe}from"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import{b as Ze,c as Me,_ as et}from"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import{i as ue,d as Pe,a as tt}from"./helper-CXVLNTBN.js";import{K as H,aH as te,j as W,b4 as nt,O as je,aP as de,d as xe,q as st,aO as at,be as rt}from"./entry/index-BbJQUQ84-1718268303552.js";import{e as se,l as pe,s as Q,ay as ne,b0 as Oe,d as G,t as Se,f as Z,Q as it,ad as _e,b1 as ot,al as ct,ar as lt,a8 as ft}from"./antd-DMGzOvrA.js";import{b as ut}from"./index-BIkrAlj7.js";function dt(s,c,a){const i=/^\[(.+)\]$/;if(i.test(s)){const A=s.match(i);if(A&&A[1]){const v=A[1].split(",");return c=Array.isArray(c)?c:[c],v.forEach((t,l)=>{Q(a,t.trim(),c[l])}),!0}}}function pt(s,c,a){const i=/^\{(.+)\}$/;if(i.test(s)){const A=s.match(i);if(A&&A[1]){const v=A[1].split(",");return c=H(c)?c:{},v.forEach(t=>{Q(a,t.trim(),c[t.trim()])}),!0}}}function mt({defaultValueRef:s,getSchema:c,formModel:a,getProps:i}){function A(f){var b,E;if(!H(f))return{};const d={};for(const D of Object.entries(f)){let[,u]=D;const[I]=D;if(!I||te(u)&&u.length===0||se(u))continue;const p=n(i).transformDateFunc;H(u)&&(u=p==null?void 0:p(u)),te(u)&&((b=u[0])!=null&&b.format)&&((E=u[1])!=null&&E.format)&&(u=u.map(F=>p==null?void 0:p(F))),pe(u)&&(u=u.trim()),!dt(I,u,d)&&!pt(I,u,d)&&Q(d,I,u)}return v(d)}function v(f){const d=n(i).fieldMapToTime;if(!d||!Array.isArray(d))return f;for(const[b,[E,D],u="YYYY-MM-DD"]of d){if(!b||!E||!D)continue;if(!ne(f,b)){Oe(f,b);continue}const[I,p]=ne(f,b),[F,w]=Array.isArray(u)?u:[u,u];!G(I)&&!Se(I)&&Q(f,E,t(I,F)),!G(p)&&!Se(p)&&Q(f,D,t(p,w)),Oe(f,b)}return f}function t(f,d){return d==="timestamp"?W(f).unix():d==="timestampStartDay"?W(f).startOf("day").unix():W(f).format(d)}function l(){const f=n(c),d={};f.forEach(b=>{const{defaultValue:E,defaultValueObj:D,componentProps:u={}}=b,I=Object.keys(D||{});I.length&&I.forEach(p=>{d[p]=D[p],a[p]===void 0&&(a[p]=D[p])}),G(E)||(d[b.field]=E,a[b.field]===void 0&&(a[b.field]=E)),G(u==null?void 0:u.defaultValue)||(d[b.field]=u==null?void 0:u.defaultValue,a[b.field]===void 0&&(a[b.field]=u==null?void 0:u.defaultValue))}),s.value=Z(d)}return{handleFormValues:A,initDefault:l}}const q=24;function ht({advanceState:s,emit:c,getProps:a,getSchema:i,formModel:A,defaultValueRef:v}){const t=Ue(),{realWidthRef:l,screenEnum:f,screenRef:d}=nt(),b=X(()=>{if(!s.isAdvanced)return 0;const F=n(a).emptySpan||0;if(it(F))return F;if(H(F)){const{span:w=0}=F,R=n(d);return F[R.toLowerCase()]||w||0}return 0}),E=je(I,30);J([()=>n(i),()=>s.isAdvanced,()=>n(l)],()=>{const{showAdvancedButton:F}=n(a);F&&E()},{immediate:!0});function D(F,w=0,R=!1){const O=n(l),_=parseInt(F.md)||parseInt(F.xs)||parseInt(F.sm)||F.span||q,C=parseInt(F.lg)||_,x=parseInt(F.xl)||C,N=parseInt(F.xxl)||x;return O<=f.LG?w+=_:O<f.XL?w+=C:O<f.XXL?w+=x:w+=N,R?(s.hideAdvanceBtn=!1,w<=q*2?(s.hideAdvanceBtn=!0,s.isAdvanced=!0):w>q*2&&w<=q*(n(a).autoAdvancedLine||3)?s.hideAdvanceBtn=!1:s.isLoad||(s.isLoad=!0,s.isAdvanced=!s.isAdvanced),{isAdvanced:s.isAdvanced,itemColSum:w}):w>q*(n(a).alwaysShowLines||1)?{isAdvanced:s.isAdvanced,itemColSum:w}:{isAdvanced:!0,itemColSum:w}}const u=ke({});function I(){var O;let F=0,w=0;const{baseColProps:R={}}=n(a);for(const _ of n(i)){const{show:C,ifShow:x,colProps:N}=_,U={schema:_,model:A,field:_.field,values:j(j({},n(v)),A)};let S=!0;if(S&&_e(x)&&(S=x),S&&se(x)&&(S=x(U)),S&&_e(C)&&(S=C),S&&se(C)&&(S=C(U)),S&&(N||R)){const{itemColSum:M,isAdvanced:e}=D(j(j({},R),N),F);F=M||0,e&&(w=F),u[_.field]=e}}(O=t==null?void 0:t.proxy)==null||O.$forceUpdate(),s.actionSpan=w%q+n(b),D(n(a).actionColOptions||{span:q},F,!0),c("advanced-change",s.isAdvanced)}function p(){s.isAdvanced=!s.isAdvanced}return{handleToggleAdvanced:p,fieldsIsAdvancedMap:u}}function yt(s,c={}){const a=/^\[(.+)\]$/;if(a.test(s)){const i=s.match(a);if(i&&i[1]){const A=i[1].split(",");if(!A.length)return;const v=[];return A.forEach((t,l)=>{Q(v,l,c[t.trim()])}),v.filter(Boolean).length?v:void 0}}}function At({emit:s,getProps:c,formModel:a,getSchema:i,defaultValueRef:A,formElRef:v,schemaRef:t,handleFormValues:l}){function f(){return y(this,null,function*(){const{resetFunc:e,submitOnReset:o}=n(c);e&&se(e)&&(yield e()),n(v)&&(Object.keys(a).forEach(r=>{const g=n(i).find(V=>V.field===r),T=g==null?void 0:g.defaultValueObj,$=Object.keys(T||{});$.length&&$.forEach(V=>{a[V]=T[V]}),a[r]=vt(g,A,r)}),me(()=>N()),s("reset",we(a)),o&&S())})}const d=()=>n(i).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function b(e){return y(this,null,function*(){if(Object.keys(e).length===0)return;const o=d(),h=[];o.forEach(r=>{const g=n(i).find(P=>P.field===r),T=ne(e,r),$=ot(e,r),{componentProps:V}=g||{};let L=V;typeof V=="function"&&(L=L({formModel:n(a),formActionType:M}));let Y;const ae=P=>P?L!=null&&L.valueFormat?P:W(P):null;if(O(g==null?void 0:g.component)&&(Y=yt(r,e),Y)){const P=Y||T;if(Array.isArray(P)){const re=[];for(const ee of P)re.push(ae(ee));n(a)[r]=re,h.push(r)}else n(a)[r]=ae(P),h.push(r)}if($){Y=ne(T,r);const P=Y||T;n(a)[r]=P,L!=null&&L.onChange&&(L==null||L.onChange(P)),h.push(r)}}),_(h).catch(r=>{})})}function E(e){if(!Array.isArray(e)||Array.isArray(e)&&e.length===0)return;const o=[],h=Object.keys(n(a));h&&(e.forEach(r=>{h.includes(r)&&(o.push(r),n(a)[r]=Z(n(ne(A.value,r))))}),_(o).catch(r=>{}))}function D(e){return y(this,null,function*(){const o=Z(n(i));if(!e)return;let h=pe(e)?[e]:e;pe(e)&&(h=[e]);for(const r of h)u(r,o);t.value=o})}function u(e,o){if(pe(e)){const h=o.findIndex(r=>r.field===e);h!==-1&&(delete a[e],o.splice(h,1))}}function I(e,o,h=!1){return y(this,null,function*(){const r=Z(n(i)),g=Array.isArray(e)?e.map(V=>V.field):[e.field];if(r.find(V=>g.includes(V.field))){de("There are schemas that have already been added");return}const T=r.findIndex(V=>V.field===o),$=H(e)?[e]:e;!o||T===-1||h?h?r.unshift(...$):r.push(...$):T!==-1&&r.splice(T+1,0,...$),t.value=r,w(e)})}function p(e){return y(this,null,function*(){let o=[];if(H(e)&&o.push(e),te(e)&&(o=[...e]),!o.every(r=>ue(r.component)||Reflect.has(r,"field")&&r.field)){de("All children of the form Schema array that need to be updated must contain the `field` field");return}t.value=o})}function F(e){return y(this,null,function*(){let o=[];if(H(e)&&o.push(e),te(e)&&(o=[...e]),!o.every(T=>ue(T.component)||Reflect.has(T,"field")&&T.field)){de("All children of the form Schema array that need to be updated must contain the `field` field");return}const r=[],g=[];n(i).forEach(T=>{const $=o.find(V=>T.field===V.field);if($){const V=xe(T,$);g.push(V),r.push(V)}else r.push(T)}),w(g),t.value=ct(r,"field")})}function w(e){let o=[];H(e)&&o.push(e),te(e)&&(o=[...e]);const h={},r=R();o.forEach(g=>{!ue(g.component)&&Reflect.has(g,"field")&&g.field&&!G(g.defaultValue)&&(!(g.field in r)||G(r[g.field]))&&(h[g.field]=g.defaultValue)}),b(h)}function R(){return n(v)?l(we(n(a))):{}}function O(e){return Pe.includes(e)}function _(e){return y(this,null,function*(){var h;const o=yield(h=n(v))==null?void 0:h.validateFields(e);return l(o)})}function C(e){return y(this,null,function*(){var o;yield(o=n(v))==null?void 0:o.setProps(e)})}function x(e){return y(this,null,function*(){var r;let o;e===void 0?o=d():o=e===Array.isArray(e)?e:void 0;const h=yield(r=n(v))==null?void 0:r.validate(o);return l(h)})}function N(e){return y(this,null,function*(){var o;yield(o=n(v))==null?void 0:o.clearValidate(e)})}function U(e,o){return y(this,null,function*(){var h;yield(h=n(v))==null?void 0:h.scrollToField(e,o)})}function S(e){return y(this,null,function*(){e&&e.preventDefault();const{submitFunc:o}=n(c);if(o&&se(o)){yield o();return}if(n(v))try{const r=yield x();s("submit",r)}catch(r){if((r==null?void 0:r.outOfDate)===!1&&(r!=null&&r.errorFields))return;throw new Error(r)}})}const M={getFieldsValue:R,setFieldsValue:b,resetFields:f,updateSchema:F,resetSchema:p,setProps:C,removeSchemaByField:D,appendSchemaByField:I,clearValidate:N,validateFields:_,validate:x,submit:S,scrollToField:U};return{handleSubmit:S,clearValidate:N,validate:x,validateFields:_,getFieldsValue:R,updateSchema:F,resetSchema:p,appendSchemaByField:I,removeSchemaByField:D,resetFields:f,setFieldsValue:b,scrollToField:U,resetDefaultField:E}}function vt(s,c,a){let i=Z(c.value[a]);return bt(s)?G(i)?void 0:i:(!i&&s&&Ft(s)&&(i=[0,0]),!i&&s&&s.component==="ApiTree"&&(i=[]),i)}function Ft(s){if(s.component==="Slider"&&s.componentProps&&"range"in s.componentProps)return!0}function bt(s){return(s==null?void 0:s.component)&&tt.includes(s.component)}function gt(A){return y(this,arguments,function*({getSchema:s,getProps:c,formElRef:a,isInitedDefault:i}){He(()=>y(this,null,function*(){if(n(i)||!n(c).autoFocusFirstItem)return;yield me();const v=n(s),t=n(a),l=t==null?void 0:t.$el;if(!t||!l||!v||v.length===0)return;const f=v[0];if(!f.component||!f.component.includes("Input"))return;const d=l.querySelector(".ant-row:first-child input");d&&(d==null||d.focus())}))})}const St=We({name:"BasicForm",__name:"BasicForm",props:Ze,emits:["advanced-change","reset","submit","register","field-value-change"],setup(s,{expose:c,emit:a}){const i=s,A=a,v=Ye(),t=Ve({}),l=ut(),f=Ve({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),d=z({}),b=z(!1),E=z(),D=z(null),u=z(null),{prefixCls:I}=st("basic-form"),p=X(()=>j(j({},i),n(E))),F=X(()=>[I,{[`${I}--compact`]:n(p).compact}]),w=X(()=>{const{baseRowStyle:m={},rowProps:K}=n(p);return j({style:m},K)}),R=X(()=>j(j(j({},v),i),n(p))),O=X(()=>{var K;const m=Z(n(D)||n(p).schemas);for(const B of m){const{defaultValue:k,component:ie,componentProps:oe={},isHandleDateDefaultValue:Le=!0}=B;if(Le&&k&&ie&&Pe.includes(ie)){const Ke={schema:B,tableAction:(K=i.tableAction)!=null?K:{},formModel:t,formActionType:{}},ce=oe?typeof oe=="function"?oe(Ke).valueFormat:oe.valueFormat:null;if(!Array.isArray(k))B.defaultValue=ce?W(k).format(ce):W(k);else{const ve=[];k.forEach(Fe=>{ve.push(ce?W(Fe).format(ce):W(Fe))}),B.defaultValue=ve}}}return n(p).showAdvancedButton?m.filter(B=>!ue(B.component)):m}),{handleToggleAdvanced:_,fieldsIsAdvancedMap:C}=ht({advanceState:f,emit:A,getProps:p,getSchema:O,formModel:t,defaultValueRef:d}),{handleFormValues:x,initDefault:N}=mt({getProps:p,defaultValueRef:d,getSchema:O,formModel:t});gt({getSchema:O,getProps:p,isInitedDefault:b,formElRef:u});const{handleSubmit:U,setFieldsValue:S,clearValidate:M,validate:e,validateFields:o,getFieldsValue:h,updateSchema:r,resetSchema:g,appendSchemaByField:T,removeSchemaByField:$,resetFields:V,scrollToField:L,resetDefaultField:Y}=At({emit:A,getProps:p,formModel:t,getSchema:O,defaultValueRef:d,formElRef:u,schemaRef:D,handleFormValues:x});Me({resetAction:V,submitAction:U}),J(()=>n(p).model,()=>{const{model:m}=n(p);m&&S(m)},{immediate:!0}),J(()=>i.schemas,m=>{g(m!=null?m:[])}),J(()=>O.value,m=>{me(()=>{var K;(K=l==null?void 0:l.redoModalHeight)==null||K.call(l)}),!n(b)&&m!=null&&m.length&&(N(),b.value=!0)}),J(()=>t,je(()=>{n(p).submitOnChange&&U()},300),{deep:!0});function ae(m){return y(this,null,function*(){E.value=xe(n(E)||{},m)})}function P(m,K,B){t[m]=K,A("field-value-change",m,K),B&&B.itemProps&&!B.itemProps.autoLink&&o([m]).catch(k=>{})}function re(m){const{autoSubmitOnEnter:K}=n(p);if(K&&m.key==="Enter"&&m.target&&m.target instanceof HTMLElement){const B=m.target;B&&B.tagName&&B.tagName.toUpperCase()==="INPUT"&&U()}}const ee={getFieldsValue:h,setFieldsValue:S,resetFields:V,updateSchema:r,resetSchema:g,setProps:ae,removeSchemaByField:$,appendSchemaByField:T,clearValidate:M,validateFields:o,validate:e,submit:U,scrollToField:L,resetDefaultField:Y},$e=X(()=>j(j({},p.value),f));return c(j({},ee)),qe(()=>{N(),A("register",ee)}),(m,K)=>(he(),Be(n(ft),Ae(R.value,{class:F.value,ref_key:"formElRef",ref:u,model:t,onKeypress:Ge(re,["enter"])}),{default:le(()=>[Te(n(lt),De(Ee(w.value)),{default:le(()=>[fe(m.$slots,"formHeader"),(he(!0),Xe(ze,null,ye(O.value,B=>(he(),Be(Qe,{key:B.field,isAdvanced:n(C)[B.field],tableAction:m.tableAction,formActionType:ee,schema:B,formProps:p.value,allDefaultValues:d.value,formModel:t,setFormModel:P},Ie({_:2},[ye(Object.keys(m.$slots),k=>({name:k,fn:le(ie=>[fe(m.$slots,k,Ae({ref_for:!0},ie||{}))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Te(et,Ae($e.value,{onToggleAdvanced:n(_)}),Ie({_:2},[ye(["resetBefore","submitBefore","advanceBefore","advanceAfter"],B=>({name:B,fn:le(k=>[fe(m.$slots,B,De(Ee(k||{})))])}))]),1040,["onToggleAdvanced"]),fe(m.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});function _t(s){const c=z(null),a=z(!1);function i(){return y(this,null,function*(){const t=n(c);return t||de("The form instance has not been obtained, please make sure that the form has been rendered when performing the form operation!"),yield me(),t})}function A(t){Je(()=>{c.value=null,a.value=null}),!(n(a)&&at()&&t===n(c))&&(c.value=t,a.value=!0,J(()=>s,()=>{s&&t.setProps(rt(s))},{immediate:!0,deep:!0}))}return[A,{scrollToField:(t,l)=>y(this,null,function*(){(yield i()).scrollToField(t,l)}),setProps:t=>y(this,null,function*(){(yield i()).setProps(t)}),updateSchema:t=>y(this,null,function*(){(yield i()).updateSchema(t)}),resetSchema:t=>y(this,null,function*(){(yield i()).resetSchema(t)}),clearValidate:t=>y(this,null,function*(){(yield i()).clearValidate(t)}),resetFields:()=>y(this,null,function*(){i().then(t=>y(this,null,function*(){yield t.resetFields()}))}),resetForm:()=>y(this,null,function*(){i().then(t=>y(this,null,function*(){yield t.resetFields(),yield t.clearValidate()}))}),removeSchemaByField:t=>y(this,null,function*(){var l;(l=n(c))==null||l.removeSchemaByField(t)}),getFieldsValue:()=>{var t;return(t=n(c))==null?void 0:t.getFieldsValue()},setFieldsValue:t=>y(this,null,function*(){(yield i()).setFieldsValue(t)}),appendSchemaByField:(t,l,f)=>y(this,null,function*(){(yield i()).appendSchemaByField(t,l,f)}),submit:()=>y(this,null,function*(){return(yield i()).submit()}),validate:t=>y(this,null,function*(){return(yield i()).validate(t)}),validateFields:t=>y(this,null,function*(){return(yield i()).validateFields(t)}),resetDefaultField:t=>y(this,null,function*(){var l;(l=n(c))==null||l.resetDefaultField(t)})}]}export{St as _,_t as u};
