var Re=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var ge=(s,i,a)=>i in s?Re(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,_=(s,i)=>{for(var a in i||(i={}))Ne.call(i,a)&&ge(s,a,i[a]);if(be)for(var a of be(i))Ce.call(i,a)&&ge(s,a,i[a]);return s};var y=(s,i,a)=>new Promise((o,m)=>{var h=l=>{try{f(a.next(l))}catch(u){m(u)}},e=l=>{try{f(a.throw(l))}catch(u){m(u)}},f=l=>l.done?o(l.value):Promise.resolve(l.value).then(h,e);f((a=a.apply(s,i)).next())});import{u as n,g as ke,c as X,w as J,as as Ue,y as pe,J as we,h as He,d as Ke,K as We,r as Ve,f as z,o as Ye,_ as me,a8 as Be,a9 as ie,k as Te,af as ce,$ as qe,ab as he,ae as Ie,ad as ye,F as Xe,al as De,am as Ee,aq as ze,b as Qe}from"./vue-Bw3NQgLF.js";import{_ as Ge}from"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import{b as Je,c as Me,_ as Ze}from"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import{h as et,i as le,d as _e,a as tt}from"./helper-CfJJkrf5.js";import{H as W,aE as Z,be as K,b3 as nt,L as xe,aV as Oe,aR as fe,d as Le,o as st,aQ as at,bd as ot}from"./entry/index-CMepwc5X-1716790511191.js";import{e as de,l as ue,s as Q,az as Ae,b0 as Pe,d as ee,t as Se,f as M,Q as rt,ag as it,ao as ct,at as lt,ab as ft}from"./antd-BRjMhd0C.js";import{b as ut}from"./index-CMSTH4sS.js";function dt(s,i,a){const o=/^\[(.+)\]$/;if(o.test(s)){const m=s.match(o);if(m&&m[1]){const h=m[1].split(",");return i=Array.isArray(i)?i:[i],h.forEach((e,f)=>{Q(a,e.trim(),i[f])}),!0}}}function pt(s,i,a){const o=/^\{(.+)\}$/;if(o.test(s)){const m=s.match(o);if(m&&m[1]){const h=m[1].split(",");return i=W(i)?i:{},h.forEach(e=>{Q(a,e.trim(),i[e.trim()])}),!0}}}function mt({defaultValueRef:s,getSchema:i,formModel:a,getProps:o}){function m(l){var V,D;if(!W(l))return{};const u={};for(const P of Object.entries(l)){let[,p]=P;const[B]=P;if(!B||Z(p)&&p.length===0||de(p))continue;const A=n(o).transformDateFunc;W(p)&&(p=A==null?void 0:A(p)),Z(p)&&((V=p[0])!=null&&V.format)&&((D=p[1])!=null&&D.format)&&(p=p.map(F=>A==null?void 0:A(F))),ue(p)&&(p=p.trim()),!dt(B,p,u)&&!pt(B,p,u)&&Q(u,B,p)}return h(u)}function h(l){const u=n(o).fieldMapToTime;if(!u||!Array.isArray(u))return l;for(const[V,[D,P],p="YYYY-MM-DD"]of u){if(!V||!D||!P)continue;if(!Ae(l,V)){Pe(l,V);continue}const[B,A]=Ae(l,V),[F,g]=Array.isArray(p)?p:[p,p];!ee(B)&&!Se(B)&&Q(l,D,e(B,F)),!ee(A)&&!Se(A)&&Q(l,P,e(A,g)),Pe(l,V)}return l}function e(l,u){return u==="timestamp"?K(l).unix():u==="timestampStartDay"?K(l).startOf("day").unix():K(l).format(u)}function f(){const l=n(i),u={};l.forEach(V=>{const{defaultValue:D,defaultValueObj:P}=V,p=Object.keys(P||{});p.length&&p.map(B=>{u[B]=P[B],a[B]===void 0&&(a[B]=P[B])}),ee(D)||(u[V.field]=D,a[V.field]===void 0&&(a[V.field]=D))}),s.value=M(u)}return{handleFormValues:m,initDefault:f}}const q=24;function ht({advanceState:s,emit:i,getProps:a,getSchema:o,formModel:m,defaultValueRef:h}){const e=ke(),{realWidthRef:f,screenEnum:l,screenRef:u}=nt(),V=X(()=>{if(!s.isAdvanced)return 0;const F=n(a).emptySpan||0;if(rt(F))return F;if(W(F)){const{span:g=0}=F,k=n(u);return F[k.toLowerCase()]||g||0}return 0}),D=xe(B,30);J([()=>n(o),()=>s.isAdvanced,()=>n(f)],()=>{const{showAdvancedButton:F}=n(a);F&&D()},{immediate:!0});function P(F,g=0,k=!1){const E=n(f),$=parseInt(F.md)||parseInt(F.xs)||parseInt(F.sm)||F.span||q,x=parseInt(F.lg)||$,R=parseInt(F.xl)||x,N=parseInt(F.xxl)||R;return E<=l.LG?g+=$:E<l.XL?g+=x:E<l.XXL?g+=R:g+=N,k?(s.hideAdvanceBtn=!1,g<=q*2?(s.hideAdvanceBtn=!0,s.isAdvanced=!0):g>q*2&&g<=q*(n(a).autoAdvancedLine||3)?s.hideAdvanceBtn=!1:s.isLoad||(s.isLoad=!0,s.isAdvanced=!s.isAdvanced),{isAdvanced:s.isAdvanced,itemColSum:g}):g>q*(n(a).alwaysShowLines||1)?{isAdvanced:s.isAdvanced,itemColSum:g}:{isAdvanced:!0,itemColSum:g}}const p=Ue({});function B(){var E;let F=0,g=0;const{baseColProps:k={}}=n(a);for(const $ of n(o)){const{show:x,colProps:R}=$;let N=!0;if(it(x)&&(N=x),de(x)&&(N=x({schema:$,model:m,field:$.field,values:_(_({},n(h)),m)})),N&&(R||k)){const{itemColSum:U,isAdvanced:Y}=P(_(_({},k),R),F);F=U||0,Y&&(g=F),p[$.field]=Y}}(E=e==null?void 0:e.proxy)==null||E.$forceUpdate(),s.actionSpan=g%q+n(V),P(n(a).actionColOptions||{span:q},F,!0),i("advanced-change")}function A(){s.isAdvanced=!s.isAdvanced}return{handleToggleAdvanced:A,fieldsIsAdvancedMap:p}}function yt(s,i={}){const a=/^\[(.+)\]$/;if(a.test(s)){const o=s.match(a);if(o&&o[1]){const m=o[1].split(",");if(!m.length)return;const h=[];return m.forEach((e,f)=>{Q(h,f,i[e.trim()])}),h.filter(Boolean).length?h:void 0}}}function At(s,i={}){const a=/^\{(.+)\}$/;if(a.test(s)){const o=s.match(a);if(o&&o[1]){const m=o[1].split(",");if(!m.length)return;const h={};return m.forEach(e=>{Q(h,e.trim(),i[e.trim()])}),Object.values(h).filter(Boolean).length?h:void 0}}}function vt({emit:s,getProps:i,formModel:a,getSchema:o,defaultValueRef:m,formElRef:h,schemaRef:e,handleFormValues:f}){function l(){return y(this,null,function*(){const{resetFunc:t,submitOnReset:r}=n(i);t&&de(t)&&(yield t()),n(h)&&(Object.keys(a).forEach(c=>{const w=n(o).find(T=>T.field===c),v=w==null?void 0:w.defaultValueObj,S=Object.keys(v||{});S.length&&S.map(T=>{a[T]=v[T]}),a[c]=Ft(w,m,c)}),pe(()=>R()),s("reset",we(a)),r&&U())})}const u=()=>n(o).map(t=>[...t.fields||[],t.field]).flat(1).filter(Boolean);function V(t){return y(this,null,function*(){if(Object.keys(t).length===0)return;const r=u(),b=".",c=r.filter(v=>String(v).indexOf(b)>=0),w=[];r.forEach(v=>{const S=n(o).find(O=>O.field===v);let T=Ae(t,v);const te=Reflect.has(t,v);T=et(S==null?void 0:S.component,T);const{componentProps:ne}=S||{};let L=ne;typeof ne=="function"&&(L=L({formModel:n(a),formActionType:Y}));const se=yt(v,t)||At(v,t);if(te||se){const O=se||T;if(k(v))if(Array.isArray(O)){const H=[];for(const G of O)H.push(G?K(G):null);n(a)[v]=H}else n(a)[v]=O?L!=null&&L.valueFormat?O:K(O):null;else n(a)[v]=O;L!=null&&L.onChange&&(L==null||L.onChange(O)),w.push(v)}else c.forEach(O=>{try{const H=O.split(".").reduce((G,d)=>G[d],t);Oe(H)&&(n(a)[O]=n(H),w.push(O))}catch(H){Oe(m.value[O])&&(n(a)[O]=M(n(m.value[O])))}})}),E(w).catch(v=>{})})}function D(t){return y(this,null,function*(){const r=M(n(o));if(!t)return;let b=ue(t)?[t]:t;ue(t)&&(b=[t]);for(const c of b)P(c,r);e.value=r})}function P(t,r){if(ue(t)){const b=r.findIndex(c=>c.field===t);b!==-1&&(delete a[t],r.splice(b,1))}}function p(t,r,b=!1){return y(this,null,function*(){const c=M(n(o)),w=Array.isArray(t)?t.map(T=>T.field):[t.field];if(c.find(T=>w.includes(T.field))){fe("There are schemas that have already been added");return}const v=c.findIndex(T=>T.field===r),S=W(t)?[t]:t;!r||v===-1||b?b?c.unshift(...S):c.push(...S):v!==-1&&c.splice(v+1,0,...S),e.value=c,F(t)})}function B(t){return y(this,null,function*(){let r=[];if(W(t)&&r.push(t),Z(t)&&(r=[...t]),!r.every(c=>le(c.component)||Reflect.has(c,"field")&&c.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}e.value=r})}function A(t){return y(this,null,function*(){let r=[];if(W(t)&&r.push(t),Z(t)&&(r=[...t]),!r.every(v=>le(v.component)||Reflect.has(v,"field")&&v.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const c=[],w=[];n(o).forEach(v=>{const S=r.find(T=>v.field===T.field);if(S){const T=Le(v,S);w.push(T),c.push(T)}else c.push(v)}),F(w),e.value=ct(c,"field")})}function F(t){let r=[];W(t)&&r.push(t),Z(t)&&(r=[...t]);const b={},c=g();r.forEach(w=>{!le(w.component)&&Reflect.has(w,"field")&&w.field&&!ee(w.defaultValue)&&(!(w.field in c)||ee(c[w.field]))&&(b[w.field]=w.defaultValue)}),V(b)}function g(){return n(h)?f(we(n(a))):{}}function k(t){return n(o).some(r=>r.field===t&&r.component?_e.includes(r.component):!1)}function E(t){return y(this,null,function*(){var b;const r=yield(b=n(h))==null?void 0:b.validateFields(t);return f(r)})}function $(t){return y(this,null,function*(){var r;yield(r=n(h))==null?void 0:r.setProps(t)})}function x(t){return y(this,null,function*(){var c;let r;t===void 0?r=u():r=t===Array.isArray(t)?t:void 0;const b=yield(c=n(h))==null?void 0:c.validate(r);return f(b)})}function R(t){return y(this,null,function*(){var r;yield(r=n(h))==null?void 0:r.clearValidate(t)})}function N(t,r){return y(this,null,function*(){var b;yield(b=n(h))==null?void 0:b.scrollToField(t,r)})}function U(t){return y(this,null,function*(){t&&t.preventDefault();const{submitFunc:r}=n(i);if(r&&de(r)){yield r();return}if(n(h))try{const c=yield x();s("submit",c)}catch(c){if((c==null?void 0:c.outOfDate)===!1&&(c!=null&&c.errorFields))return;throw new Error(c)}})}const Y={getFieldsValue:g,setFieldsValue:V,resetFields:l,updateSchema:A,resetSchema:B,setProps:$,removeSchemaByField:D,appendSchemaByField:p,clearValidate:R,validateFields:E,validate:x,submit:U,scrollToField:N};return{handleSubmit:U,clearValidate:R,validate:x,validateFields:E,getFieldsValue:g,updateSchema:A,resetSchema:B,appendSchemaByField:p,removeSchemaByField:D,resetFields:l,setFieldsValue:V,scrollToField:N}}function Ft(s,i,a){let o=M(i.value[a]);return gt(s)?o||void 0:(!o&&s&&bt(s)&&(o=[0,0]),!o&&s&&s.component==="ApiTree"&&(o=[]),o)}function bt(s){if(s.component==="Slider"&&s.componentProps&&"range"in s.componentProps)return!0}function gt(s){return(s==null?void 0:s.component)&&tt.includes(s.component)}function wt(m){return y(this,arguments,function*({getSchema:s,getProps:i,formElRef:a,isInitedDefault:o}){He(()=>y(this,null,function*(){if(n(o)||!n(i).autoFocusFirstItem)return;yield pe();const h=n(s),e=n(a),f=e==null?void 0:e.$el;if(!e||!f||!h||h.length===0)return;const l=h[0];if(!l.component||!l.component.includes("Input"))return;const u=f.querySelector(".ant-row:first-child input");u&&(u==null||u.focus())}))})}const St=Ke({name:"BasicForm",__name:"BasicForm",props:Je,emits:["advanced-change","reset","submit","register","field-value-change"],setup(s,{expose:i,emit:a}){const o=s,m=a,h=We(),e=Ve({}),f=ut(),l=Ve({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),u=z({}),V=z(!1),D=z(),P=z(null),p=z(null),{prefixCls:B}=st("basic-form"),A=X(()=>_(_({},o),n(D))),F=X(()=>[B,{[`${B}--compact`]:n(A).compact}]),g=X(()=>{const{baseRowStyle:d={},rowProps:j}=n(A);return _({style:d},j)}),k=X(()=>_(_(_({},h),o),n(A))),E=X(()=>{var j;const d=M(n(P)||n(A).schemas);for(const I of d){const{defaultValue:C,component:ae,componentProps:oe={},isHandleDateDefaultValue:je=!0}=I;if(je&&C&&ae&&_e.includes(ae)){const $e={schema:I,tableAction:(j=o.tableAction)!=null?j:{},formModel:e,formActionType:{}},re=oe?typeof oe=="function"?oe($e).valueFormat:oe.valueFormat:null;if(!Array.isArray(C))I.defaultValue=re?K(C).format(re):K(C);else{const ve=[];C.forEach(Fe=>{ve.push(re?K(Fe).format(re):K(Fe))}),I.defaultValue=ve}}}return n(A).showAdvancedButton?d.filter(I=>!le(I.component)):d}),{handleToggleAdvanced:$,fieldsIsAdvancedMap:x}=ht({advanceState:l,emit:m,getProps:A,getSchema:E,formModel:e,defaultValueRef:u}),{handleFormValues:R,initDefault:N}=mt({getProps:A,defaultValueRef:u,getSchema:E,formModel:e});wt({getSchema:E,getProps:A,isInitedDefault:V,formElRef:p});const{handleSubmit:U,setFieldsValue:Y,clearValidate:t,validate:r,validateFields:b,getFieldsValue:c,updateSchema:w,resetSchema:v,appendSchemaByField:S,removeSchemaByField:T,resetFields:te,scrollToField:ne}=vt({emit:m,getProps:A,formModel:e,getSchema:E,defaultValueRef:u,formElRef:p,schemaRef:P,handleFormValues:R});Me({resetAction:te,submitAction:U}),J(()=>n(A).model,()=>{const{model:d}=n(A);d&&Y(d)},{immediate:!0}),J(()=>o.schemas,d=>{v(d!=null?d:[])}),J(()=>E.value,d=>{pe(()=>{var j;(j=f==null?void 0:f.redoModalHeight)==null||j.call(f)}),!n(V)&&d!=null&&d.length&&(N(),V.value=!0)}),J(()=>e,xe(()=>{n(A).submitOnChange&&U()},300),{deep:!0});function L(d){return y(this,null,function*(){D.value=Le(n(D)||{},d)})}function se(d,j,I){e[d]=j,m("field-value-change",d,j),I&&I.itemProps&&!I.itemProps.autoLink&&b([d]).catch(C=>{})}function O(d){const{autoSubmitOnEnter:j}=n(A);if(j&&d.key==="Enter"&&d.target&&d.target instanceof HTMLElement){const I=d.target;I&&I.tagName&&I.tagName.toUpperCase()=="INPUT"&&U()}}const H={getFieldsValue:c,setFieldsValue:Y,resetFields:te,updateSchema:w,resetSchema:v,setProps:L,removeSchemaByField:T,appendSchemaByField:S,clearValidate:t,validateFields:b,validate:r,submit:U,scrollToField:ne},G=X(()=>_(_({},A.value),l));return i(_({},H)),Ye(()=>{N(),m("register",H)}),(d,j)=>(me(),Be(n(ft),ye(k.value,{class:F.value,ref_key:"formElRef",ref:p,model:e,onKeypress:ze(O,["enter"])}),{default:ie(()=>[Te(n(lt),De(Ee(g.value)),{default:ie(()=>[ce(d.$slots,"formHeader"),(me(!0),qe(Xe,null,he(E.value,I=>(me(),Be(Ge,{key:I.field,isAdvanced:n(x)[I.field],tableAction:d.tableAction,formActionType:H,schema:I,formProps:A.value,allDefaultValues:u.value,formModel:e,setFormModel:se},Ie({_:2},[he(Object.keys(d.$slots),C=>({name:C,fn:ie(ae=>[ce(d.$slots,C,ye({ref_for:!0},ae||{}))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Te(Ze,ye(G.value,{onToggleAdvanced:n($)}),Ie({_:2},[he(["resetBefore","submitBefore","advanceBefore","advanceAfter"],I=>({name:I,fn:ie(C=>[ce(d.$slots,I,De(Ee(C||{})))])}))]),1040,["onToggleAdvanced"]),ce(d.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});function _t(s){const i=z(null),a=z(!1);function o(){return y(this,null,function*(){const e=n(i);return e||fe("The form instance has not been obtained, please make sure that the form has been rendered when performing the form operation!"),yield pe(),e})}function m(e){Qe(()=>{i.value=null,a.value=null}),!(n(a)&&at()&&e===n(i))&&(i.value=e,a.value=!0,J(()=>s,()=>{s&&e.setProps(ot(s))},{immediate:!0,deep:!0}))}return[m,{scrollToField:(e,f)=>y(this,null,function*(){(yield o()).scrollToField(e,f)}),setProps:e=>y(this,null,function*(){(yield o()).setProps(e)}),updateSchema:e=>y(this,null,function*(){(yield o()).updateSchema(e)}),resetSchema:e=>y(this,null,function*(){(yield o()).resetSchema(e)}),clearValidate:e=>y(this,null,function*(){(yield o()).clearValidate(e)}),resetFields:()=>y(this,null,function*(){o().then(e=>y(this,null,function*(){yield e.resetFields()}))}),resetForm:()=>y(this,null,function*(){o().then(e=>y(this,null,function*(){yield e.resetFields(),yield e.clearValidate()}))}),removeSchemaByField:e=>y(this,null,function*(){var f;(f=n(i))==null||f.removeSchemaByField(e)}),getFieldsValue:()=>{var e;return(e=n(i))==null?void 0:e.getFieldsValue()},setFieldsValue:e=>y(this,null,function*(){(yield o()).setFieldsValue(e)}),appendSchemaByField:(e,f,l)=>y(this,null,function*(){(yield o()).appendSchemaByField(e,f,l)}),submit:()=>y(this,null,function*(){return(yield o()).submit()}),validate:e=>y(this,null,function*(){return(yield o()).validate(e)}),validateFields:e=>y(this,null,function*(){return(yield o()).validateFields(e)})}]}export{St as _,_t as u};
