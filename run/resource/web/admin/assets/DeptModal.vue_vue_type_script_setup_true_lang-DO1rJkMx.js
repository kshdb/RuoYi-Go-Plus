var i=(e,I,d)=>new Promise((l,f)=>{var h=o=>{try{m(d.next(o))}catch(u){f(u)}},p=o=>{try{m(d.throw(o))}catch(u){f(u)}},m=o=>o.done?l(o.value):Promise.resolve(o.value).then(h,p);m((d=d.apply(e,I)).next())});import{a as A,B}from"./index-BIkrAlj7.js";import{u as x,_ as P}from"./useForm-BsovIqMX.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./componentMap-qA-f8iV4.js";import{aA as c,bw as v,bx as C}from"./entry/index-BbJQUQ84-1718268303552.js";import{l as O}from"./index-Bys7JeoU.js";import{D as b}from"./dictEnum-DeC8h6ZR.js";import{g as _}from"./dict-vVDMuEaq.js";import"./helper-CXVLNTBN.js";import{c as D}from"./rules-Boel_RXz.js";import{u as k}from"./useRender-D1Q3fAQ3.js";import{d as E,f as F,c as T,u as r,Z as U,a8 as V,a9 as W,k as $,ac as q}from"./vue-Cw15aJ-2.js";function G(e){return c.get({url:"/system/dept/list",params:e})}function H(e){return c.get({url:"/system/dept/list/exclude/"+e})}function Z(e){return c.get({url:"/system/dept/"+e})}function j(e){return c.postWithMsg({url:"/system/dept",data:e})}function z(e){return c.putWithMsg({url:"/system/dept",data:e})}function pe(e){return c.deleteWithMsg({url:"/system/dept/"+e})}const{renderDict:J}=k(),ce=[{dataIndex:"deptName",title:"部门名称"},{dataIndex:"orderNum",title:"排序",width:180},{dataIndex:"status",width:180,title:"状态",customRender({value:e}){return J(e,b.NORMAL_DISABLE)}},{dataIndex:"createTime",title:"创建时间"}],me=[{field:"deptName",label:"部门名称",component:"Input"},{field:"status",label:"部门状态",component:"Select",componentProps:{options:_(b.NORMAL_DISABLE)}}],K=[{field:"deptId",label:"部门ID",component:"Input",show:!1},{field:"parentId",label:"上级部门",required:!0,defaultValue:100,component:"TreeSelect",show({model:e}){return e.parentId!==0}},{field:"deptName",label:"部门名称",component:"Input",required:!0},{field:"orderNum",label:"显示排序",component:"InputNumber",required:!0},{field:"leader",label:"负责人",component:"Select",componentProps:{allowClear:!1}},{field:"phone",label:"联系电话",component:"Input",rules:D("phone")},{field:"email",label:"邮箱地址",component:"Input",rules:D("email")},{field:"status",label:"部门状态",component:"RadioButtonGroup",defaultValue:"0",componentProps:{options:_(b.NORMAL_DISABLE)}}],ue=E({name:"DeptModal",__name:"DeptModal",emits:["register","reload"],setup(e,{emit:I}){const d=I,l=F(!1),f=T(()=>l.value?"编辑部门":"新增部门"),[h,{modalLoading:p,closeModal:m}]=A(a=>i(this,null,function*(){p(!0);const{deptId:t,update:n}=a;if(l.value=n,t&&(yield g({parentId:t}),r(l))){const s=yield Z(t);yield g(s)}t&&n?yield u(t):yield y(),yield o(t),p(!1)}));function o(a){return i(this,null,function*(){const t=yield L(a,!r(l));yield w({field:"parentId",componentProps:{treeData:t,treeLine:{showLeafIcon:!1},fieldNames:{label:"deptName",value:"deptId"},treeDefaultExpandAll:!0,treeNodeLabelProp:"fullName"}})})}function u(a){return i(this,null,function*(){const t=yield O(a),n=t.map(s=>({label:`${s.userName} | ${s.nickName}`,value:s.userId}));yield w({field:"leader",componentProps:{options:n,disabled:t.length===0,placeholder:t.length===0?"该部门暂无用户":"请选择部门负责人"}})})}function y(){return i(this,null,function*(){yield w({field:"leader",componentProps:{options:[],disabled:!0,placeholder:"仅在更新时可选部门负责人"}})})}function L(a,t=!1){return i(this,null,function*(){let n=[];!a||t?n=yield G({}):n=yield H(a);const s=v(n,{id:"deptId",pid:"parentId"});return C(s,"deptName"," / "),s})}const[M,{updateSchema:w,setFieldsValue:g,resetForm:N,validate:R}]=x({labelWidth:100,name:"dept_modal",showActionButtonGroup:!1,schemas:K,baseColProps:{span:24}});function S(){return i(this,null,function*(){try{p(!0);const a=yield R();r(l)?yield z(a):yield j(a),d("reload"),m(),yield N()}catch(a){}finally{p(!1)}})}return(a,t)=>(U(),V(r(B),q(a.$attrs,{title:f.value,width:700,"min-height":350,onRegister:r(h),onOk:S,onCancel:r(N)}),{default:W(()=>[$(r(P),{onRegister:r(M)},null,8,["onRegister"])]),_:1},16,["title","onRegister","onCancel"]))}});export{ue as _,pe as a,ce as c,G as d,me as f};
