var m=(u,p,n)=>new Promise((h,y)=>{var d=i=>{try{f(n.next(i))}catch(l){y(l)}},_=i=>{try{f(n.throw(i))}catch(l){y(l)}},f=i=>i.done?h(i.value):Promise.resolve(i.value).then(d,_);f((n=n.apply(u,p)).next())});import{P as j}from"./index-C4nZBquz.js";import{_ as q}from"./index-BcLdq1Bd.js";import{a as z}from"./index-C0XwB-DV.js";import{u as Z,_ as J}from"./useTable-CNbfTOCZ.js";import{_ as S}from"./index-DCvxWw7W.js";import{u as O}from"./useRender-D1Q3fAQ3.js";import{D as Q}from"./dictEnum-DeC8h6ZR.js";import{bw as X,bj as Y,bx as ee,c as te,I as x,l as ae}from"./entry/index-BbJQUQ84-1718268303552.js";import{u as R}from"./index-BIkrAlj7.js";import{b as k,e as ne,f as oe,h as se}from"./index-m3nShAF-.js";import{_ as ie}from"./SwitchVersionModal.vue_vue_type_script_setup_true_lang-Cx4JS8CK.js";import{_ as le}from"./CancelModal.vue_vue_type_script_setup_true_lang-DohYYed3.js";import{ar as re,as as T,y as ce,a3 as de,a2 as V}from"./antd-DMGzOvrA.js";import{d as ue,f as v,r as me,o as pe,c as fe,a7 as ge,Z as w,a8 as D,a9 as s,k as o,u as e,ac as he,ab as P,ak as ye,al as be,G as I,_ as _e,F as ve}from"./vue-Cw15aJ-2.js";import"./useContentViewHeight-BDi3O9lC.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./useForm-BsovIqMX.js";import"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import"./componentMap-qA-f8iV4.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./copyTextToClipboard-uEEWQikS.js";import"./style-CLEvKZSv.js";import"./helper-CXVLNTBN.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./sortable.esm-DFFrMEeC.js";import"./useSortable-BTdBE9Oa.js";import"./download-DOz9ltI1.js";import"./useLoading-D1in2ACg.js";import"./index-Dx0uas1b.js";import"./dict-vVDMuEaq.js";import"./index-C2Dnm87M.js";const{renderTag:we,renderDict:Ie}=O(),b=[{dataIndex:"processDefinitionName",title:"流程名称"},{dataIndex:"processDefinitionKey",title:"流程key"},{dataIndex:"processDefinitionVersion",title:"版本号",customRender({value:u}){return we(`V${u}.0`,"blue")}},{dataIndex:"businessStatus",title:"流程状态",customRender({value:u}){return Ie(u,Q.WF_BUSINESS_STATUS)}},{dataIndex:"startTime",title:"启动时间"},{dataIndex:"endTime",title:"结束时间",ifShow:!1}],Ce=[{field:"name",label:"流程名称",component:"Input"},{field:"key",label:"流程key",component:"Input"}],Se=ue({name:"ProcessInstance",__name:"index",setup(u){const p=v(""),n=me({tree:[],selectId:[]}),h=v(!0);function y(){return m(this,null,function*(){yield l()})}const d=v("running");function _(){return m(this,null,function*(){const a=d.value==="running"?k:se;i({api:a}),b[b.length-1].ifShow=d.value==="finished",F(b),K([]),yield l()})}pe(()=>m(this,null,function*(){const a=yield z();let t=X(a,{id:"id",pid:"parentId"});t=[{categoryName:"根目录",id:0,children:t}],Y(t,g=>{g.icon="flat-color-icons:folder"}),ee(t,"categoryName"," / "),n.tree=t,h.value=!1}));const[f,{setProps:i,reload:l,selected:N,multipleRemove:E,setColumns:F,setTableData:K}]=Z({rowSelection:{type:"checkbox"},title:"流程实例列表",showIndexColumn:!1,api:k,rowKey:"businessKey",useSearchForm:!0,formConfig:{schemas:Ce,baseColProps:{xs:24,sm:24,md:24,lg:6},labelWidth:80,resetFunc:()=>m(this,null,function*(){n.selectId=[],p.value=""})},columns:b,beforeFetch(a){return n.selectId.length===1&&(a.categoryCode=n.selectId[0]),a},actionColumn:{title:"操作",key:"action",fixed:"right"}}),B=te();function M(a){const t=a.wfNodeConfigVo.wfFormManageVo.router;B({path:t,query:{id:a.businessKey,type:"preview"}})}const[$,{openModal:A}]=R();function U(a){const{processDefinitionKey:t,processDefinitionId:g}=a;A(!0,{processDefinitionKey:t,processDefinitionId:g})}const[L,{openModal:W}]=R();function G(a){const{businessKey:t}=a;W(!0,t)}const C=fe(()=>d.value==="running"?ne:oe);function H(a){return m(this,null,function*(){yield C.value([a.businessKey]),yield l()})}return(a,t)=>{const g=ge("a-button");return w(),D(e(j),{dense:""},{default:s(()=>[o(e(re),null,{default:s(()=>[o(e(T),he({xs:24,sm:24,md:24,lg:4},{class:"h-[calc(100vh-80px)]"}),{default:s(()=>[o(e(ce),{active:!0,paragraph:{rows:8},loading:h.value},{default:s(()=>[n.tree.length?(w(),D(e(q),{key:0,fieldNames:{title:"categoryName",key:"categoryCode"},"tree-data":n.tree,showLine:{showLeafIcon:!1},search:!0,searchValue:p.value,"onUpdate:searchValue":t[0]||(t[0]=r=>p.value=r),defaultExpandAll:"",onSelect:y,selectedKeys:n.selectId,"onUpdate:selectedKeys":t[1]||(t[1]=r=>n.selectId=r)},null,8,["tree-data","searchValue","selectedKeys"])):P("",!0)]),_:1},8,["loading"])]),_:1},16),o(e(T),ye(be({xs:24,sm:24,md:24,lg:20})),{default:s(()=>[o(e(J),{onRegister:e(f)},{toolbar:s(()=>[o(g,{class:"<sm:hidden",type:"primary",danger:"",onClick:t[2]||(t[2]=r=>e(E)(C.value)),disabled:!e(N)},{default:s(()=>[I("删除")]),_:1},8,["disabled"]),o(e(de),{"button-style":"solid",value:d.value,"onUpdate:value":t[3]||(t[3]=r=>d.value=r),onChange:_},{default:s(()=>[o(e(V),{value:"running"},{default:s(()=>[I("运行中")]),_:1}),o(e(V),{value:"finished"},{default:s(()=>[I("已完成")]),_:1})]),_:1},8,["value"])]),bodyCell:s(({column:r,record:c})=>[r&&c&&r.key==="action"?(w(),_e(ve,{key:0},[o(e(S),{stopButtonPropagation:"",actions:[{label:"审批记录",icon:e(x).PREVIEW,onClick:M.bind(null,c)},{label:"删除",icon:e(x).DELETE,danger:!0,popConfirm:{placement:"left",title:`是否确认删除流程实例[${c.processDefinitionName}]`,confirm:H.bind(null,c)}}]},null,8,["actions"]),o(e(S),{stopButtonPropagation:"",actions:[{label:"切换版本",icon:"mi:switch",onClick:U.bind(null,c),ifShow:c.isSuspended!==null},{label:"作废",icon:"flat-color-icons:cancel",onClick:G.bind(null,c),ifShow:c.isSuspended!==null}]},null,8,["actions"])],64)):P("",!0)]),_:1},8,["onRegister"]),o(ie,{onRegister:e($),onReload:e(l)},null,8,["onRegister","onReload"]),o(le,{onRegister:e(L),onReload:e(l)},null,8,["onRegister","onReload"])]),_:1},16)]),_:1})]),_:1})}}}),ot=ae(Se,[["__scopeId","data-v-516a760a"]]);export{ot as default};
