var v=(C,k,u)=>new Promise((d,h)=>{var _=s=>{try{n(u.next(s))}catch(f){h(f)}},l=s=>{try{n(u.throw(s))}catch(f){h(f)}},n=s=>s.done?d(s.value):Promise.resolve(s.value).then(_,l);n((u=u.apply(C,k)).next())});import{a as P,B as V}from"./index-ov0mgIjt.js";import{u as W,_ as $}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{f as G,i as O,j}from"./index-CYdIkwig.js";import{r as E,e as q}from"./index-Bz-s2yf4.js";import{_ as z}from"./index-CwwL6bPg.js";import{e as H,m as J}from"./role.data-DFU5aoTG.js";import{bA as Q,bn as X,bB as Y}from"./entry/index-CMepwc5X-1716790511191.js";import{u as Z}from"./useSize-tRF5RUOv.js";import{b7 as ee,R as ae}from"./antd-BRjMhd0C.js";import{d as te,f as m,c as re,y as se,_ as x,a8 as D,a9 as w,k as g,u as r,ac as ne,ad as oe}from"./vue-Bw3NQgLF.js";const le=1,ge=te({name:"RoleDrawer",__name:"RoleDrawer",emits:["register","reload"],setup(C,{emit:k}){const u=k,d=m(!1),h=Z(700),_=re(()=>d.value?"编辑角色":"新增角色"),l=m([]),n=m(!1),s=m(),[f,{drawerLoading:p,closeDrawer:T}]=P(e=>v(this,null,function*(){p(!0),n.value=!1;const{record:a,update:i}=e;if(d.value=i,i&&a){const t=yield G(a.roleId);n.value=!t.menuCheckStrictly,yield b(t);const c=yield E(t.roleId),{menus:R,checkedKeys:y}=c,L=I(R);if(l.value=L,t.menuCheckStrictly){const N=Q(R,y);o.value=[...N,...y]}else o.value=y;yield b({menuIds:y})}else{const t=yield q(),c=I(t);l.value=c}se(()=>{var t;(t=s.value)==null||t.filterByLevel(le)}),p(!1)}));function I(e){return X(e,a=>!H.includes(a.id),{id:"id",pid:"parentId",children:"children"})}const[B,{setFieldsValue:b,resetForm:F,validate:M}]=W({labelWidth:100,layout:"vertical",name:"role_drawer",showActionButtonGroup:!1,baseColProps:{span:24},schemas:J}),o=m([]);function A(e,a){if(e instanceof Array){const i=a.halfCheckedKeys||[];o.value=[...i,...e]}else o.value=[...e.checked]}function U(e){if(e instanceof Array){const a=Y(l.value);e.length===0&&(console.log("取消全部"),o.value=[]),e.length===a.length&&(console.log("选择全部"),o.value=a)}}function K(){return v(this,null,function*(){try{p(!0);const e=yield M();e.menuCheckStrictly=!r(n),e.menuIds=[...r(o)],r(d)?yield O(e):yield j(e),u("reload"),T(),yield S()}catch(e){}finally{p(!1)}})}function S(){return v(this,null,function*(){yield F(),o.value=[]})}return(e,a)=>(x(),D(r(V),oe(e.$attrs,{title:_.value,width:r(h),"show-footer":!0,onRegister:r(f),onOk:K,onClose:S}),{default:w(()=>[g(r($),{onRegister:r(B)},{menuTree:w(({model:i,field:t})=>[g(r(ee),null,{default:w(()=>[g(r(ae),{"body-style":{padding:0}},{default:w(()=>[l.value.length?(x(),D(r(z),{key:0,ref_key:"roleTreeRef",ref:s,title:"菜单分配","tree-data":l.value,fieldNames:{title:"label",key:"id"},checkable:!0,selectable:!1,enableCustomTool:!0,checkStrictly:n.value,"onUpdate:checkStrictly":a[0]||(a[0]=c=>n.value=c),checkedKeys:i[t],"onUpdate:checkedKeys":c=>i[t]=c,onCheck:A,onChange:U},null,8,["tree-data","checkStrictly","checkedKeys","onUpdate:checkedKeys"])):ne("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["title","width","onRegister"]))}});export{ge as _};
