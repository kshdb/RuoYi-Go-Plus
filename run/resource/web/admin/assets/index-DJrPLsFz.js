var p=(R,d,n)=>new Promise((y,_)=>{var C=m=>{try{u(n.next(m))}catch(f){_(f)}},c=m=>{try{u(n.throw(m))}catch(f){_(f)}},u=m=>m.done?y(m.value):Promise.resolve(m.value).then(C,c);u((n=n.apply(R,d)).next())});import{P as Z}from"./index-C4nZBquz.js";import{_ as q}from"./index-BcLdq1Bd.js";import{b as J,p as $,u as Q,c as X}from"./index-C2Dnm87M.js";import{a as Y}from"./index-C0XwB-DV.js";import{u as ee,_ as te}from"./useTable-CNbfTOCZ.js";import{_ as b}from"./index-DCvxWw7W.js";import{schemas as oe,columns as ae}from"./definition.data-_N5vyh0o.js";import{bw as ne,bj as ie,bx as se,c as le,I as v,h as re,l as ce}from"./entry/index-BbJQUQ84-1718268303552.js";import{u as I}from"./index-BIkrAlj7.js";import{_ as me}from"./DeployModal.vue_vue_type_script_setup_true_lang-Bz1wuJ8N.js";import pe from"./PreviewModal-C9idMr_i.js";import{_ as de}from"./FormConfigModal.vue_vue_type_script_setup_true_lang-C4_fSRKc.js";import{ar as ue,as as N,y as fe}from"./antd-DMGzOvrA.js";import{d as ge,f as P,r as ye,o as _e,a7 as he,Z as g,a8 as h,a9 as r,k as s,u as t,ac as ke,ab as k,ak as we,al as Ce,G as w,a0 as S,_ as be,F as ve}from"./vue-Cw15aJ-2.js";import"./useContentViewHeight-BDi3O9lC.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./useForm-BsovIqMX.js";import"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import"./componentMap-qA-f8iV4.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./copyTextToClipboard-uEEWQikS.js";import"./style-CLEvKZSv.js";import"./helper-CXVLNTBN.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./sortable.esm-DFFrMEeC.js";import"./useSortable-BTdBE9Oa.js";import"./download-DOz9ltI1.js";import"./useLoading-D1in2ACg.js";import"./useRender-D1Q3fAQ3.js";import"./index-Dx0uas1b.js";import"./dict-vVDMuEaq.js";import"./index-BQijfeh-.js";import"./index-DeqOXDrL.js";import"./index-m3nShAF-.js";const Ie=ge({name:"ProcessDefinition",__name:"index",setup(R){const d=P(""),n=ye({tree:[],selectId:[]}),y=P(!0);function _(){return p(this,null,function*(){yield c()})}_e(()=>p(this,null,function*(){const e=yield Y();let a=ne(e,{id:"id",pid:"parentId"});a=[{categoryName:"根目录",id:0,children:a}],ie(a,l=>{l.icon="flat-color-icons:folder"}),se(a,"categoryName"," / "),n.tree=a,y.value=!1}));const[C,{reload:c,selected:u,getSelectRows:m}]=ee({rowSelection:{type:"checkbox"},title:"流程定义列表",showIndexColumn:!1,api:J,rowKey:"id",useSearchForm:!0,formConfig:{schemas:oe,baseColProps:{xs:24,sm:24,md:24,lg:6},labelWidth:80,resetFunc:()=>p(this,null,function*(){n.selectId=[],d.value=""})},columns:ae,beforeFetch(e){return n.selectId.length===1&&(e.categoryCode=n.selectId[0]),e},actionColumn:{width:220,title:"操作",key:"action",fixed:"right"}}),[f,{openModal:T}]=I(),[D,{openModal:F}]=I(),[B,{openModal:L}]=I();function x(e,a){T(!0,{type:e,id:a.id})}function E(e){L(!0,e)}const K=le();function V(e){K(`/workflow/definition/history/${e.key}`)}function O(e){return p(this,null,function*(){const{deploymentId:a,id:l}=e;yield $(a,l),yield c()})}const{createMessage:M,createConfirm:j}=re();function U(){if(n.selectId.length!==1){M.warning("请在左侧选择要上传的分类");return}if(n.selectId.length===1&&!n.selectId[0]){M.warning("不可上传到根目录, 请选择子目录上传");return}const e=n.selectId[0];F(!0,e)}function A(e){return p(this,null,function*(){yield Q(e.id),yield c()})}function G(e){const a=e.suspensionState=="1"?"暂停":"启动",l=e.suspensionState=="1"?"不允许":"允许",i=e.suspensionState=="1"?"挂起":"激活";return`${a}后，此流程下的所有任务都${l}往后流转, 您确定${i}【${e.name}】吗?`}function W(e){return p(this,null,function*(){yield X(e.id),yield c()})}function z(){j({title:"提示",iconType:"warning",content:"确定要删除选中的流程定义吗?",okButtonProps:{type:"primary",danger:!0},onOk:()=>p(this,null,function*(){const e=m(),a=e.map(i=>i.deploymentId).join(","),l=e.map(i=>i.id).join(",");yield $(a,l),yield c()})})}return(e,a)=>{const l=he("a-button");return g(),h(t(Z),{dense:""},{default:r(()=>[s(t(ue),null,{default:r(()=>[s(t(N),ke({xs:24,sm:24,md:24,lg:4},{class:"h-[calc(100vh-80px)]"}),{default:r(()=>[s(t(fe),{active:!0,paragraph:{rows:8},loading:y.value},{default:r(()=>[n.tree.length?(g(),h(t(q),{key:0,fieldNames:{title:"categoryName",key:"categoryCode"},"tree-data":n.tree,showLine:{showLeafIcon:!1},search:!0,searchValue:d.value,"onUpdate:searchValue":a[0]||(a[0]=i=>d.value=i),defaultExpandAll:"",onSelect:_,selectedKeys:n.selectId,"onUpdate:selectedKeys":a[1]||(a[1]=i=>n.selectId=i)},null,8,["tree-data","searchValue","selectedKeys"])):k("",!0)]),_:1},8,["loading"])]),_:1},16),s(t(N),we(Ce({xs:24,sm:24,md:24,lg:20})),{default:r(()=>[s(t(te),{onRegister:t(C)},{toolbar:r(()=>[s(l,{type:"primary",danger:"",disabled:!t(u),onClick:z},{default:r(()=>[w("删除")]),_:1},8,["disabled"]),s(l,{type:"primary",onClick:U},{default:r(()=>[w("部署")]),_:1})]),bodyCell:r(({column:i,record:o})=>[i&&o&&i.key==="resourceName"?(g(),h(l,{key:0,type:"link",onClick:H=>x("xml",o)},{default:r(()=>[w(S(o.resourceName),1)]),_:2},1032,["onClick"])):k("",!0),i&&o&&i.key==="diagramResourceName"?(g(),h(l,{key:1,type:"link",onClick:H=>x("image",o)},{default:r(()=>[w(S(o.diagramResourceName),1)]),_:2},1032,["onClick"])):k("",!0),i&&o&&i.key==="action"?(g(),be(ve,{key:2},[s(t(b),{stopButtonPropagation:"",actions:[{label:o.suspensionState==1?"挂起流程":"激活流程",icon:o.suspensionState==1?t(v).LOCK:t(v).UNLOCK,popConfirm:{placement:"left",title:G(o),confirm:A.bind(null,o)}},{label:"删除流程",icon:t(v).DELETE,danger:!0,popConfirm:{placement:"left",title:`是否确认删除[${o.name}] - [${o.key}]`,confirm:O.bind(null,o)}}]},null,8,["actions"]),s(t(b),{stopButtonPropagation:"",actions:[{label:"转换模型",icon:"lets-icons:transger",popConfirm:{placement:"left",title:`是否确认转换为模型[${o.name}] - [${o.key}]`,confirm:W.bind(null,o)}},{label:"历史版本",icon:"ic:sharp-history",onClick:V.bind(null,o)}]},null,8,["actions"]),s(t(b),{stopButtonPropagation:"",actions:[{label:"绑定业务",icon:"lets-icons:transger",onClick:E.bind(null,o)}]},null,8,["actions"])],64)):k("",!0)]),_:1},8,["onRegister"]),s(pe,{onRegister:t(f)},null,8,["onRegister"]),s(me,{onRegister:t(D),onReload:t(c)},null,8,["onRegister","onReload"]),s(de,{onRegister:t(B),onReload:t(c)},null,8,["onRegister","onReload"])]),_:1},16)]),_:1})]),_:1})}}}),lt=ce(Ie,[["__scopeId","data-v-5a49a81c"]]);export{lt as default};
