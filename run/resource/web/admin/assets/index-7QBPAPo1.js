var h=(u,c,o)=>new Promise((_,y)=>{var v=i=>{try{f(o.next(i))}catch(g){y(g)}},m=i=>{try{f(o.throw(i))}catch(g){y(g)}},f=i=>i.done?_(i.value):Promise.resolve(i.value).then(v,m);f((o=o.apply(u,c)).next())});import{P as q}from"./index-DrfqwNLV.js";import{_ as J}from"./index-CwwL6bPg.js";import{aw as k,bj as O,aU as Q,I as R,j as X}from"./entry/index-CMepwc5X-1716790511191.js";import{u as Z,_ as ee}from"./useTable-BlleqRm-.js";import{_ as te}from"./index-Rv_3g2e8.js";import{_ as oe}from"./shebeiResetPwdModal.vue_vue_type_script_setup_true_lang-C41vnNTt.js";import{_ as ae}from"./shebeiImportModal.vue_vue_type_script_setup_true_lang-YGF5-IaA.js";import{u as x}from"./index-CMSTH4sS.js";import{b as se}from"./download-CYeVxFqw.js";import{s as re,c as ne}from"./shebei.data-D993yXyd.js";import ie from"./shebeiDrawer-BVeYab7h.js";import{u as le}from"./index-ov0mgIjt.js";import{_ as me}from"./shebeiInfoModal.vue_vue_type_script_setup_true_lang-Boq9Q0uq.js";import{at as de,au as M,y as pe,ay as E,ad as ue,U as P}from"./antd-BRjMhd0C.js";import{d as ce,f as S,r as fe,o as ge,aa as he,n as _e,_ as n,a8 as p,a9 as s,k as r,u as e,ad as ye,$ as C,al as we,am as be,m as b,G as I,F as Ie,ac as $}from"./vue-Bw3NQgLF.js";import"./useContentViewHeight-xBSq9xFC.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./onMountedOrActivated-B2y-oH2N.js";import"./useForm-uR1ZVBCA.js";import"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import"./componentMap-DPcekmXH.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./helper-CfJJkrf5.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./sortable.esm-DFFrMEeC.js";import"./useSortable-CwI952Jx.js";import"./index-Cm0AtxlD.js";import"./index-ByLT-Lkv.js";import"./useDescription-Cm6mcuk5.js";import"./useLoading-iCq4GOHr.js";import"./rules-Boel_RXz.js";import"./dict-C9gNHjAh.js";import"./dictEnum-DeC8h6ZR.js";import"./useRender-C6p2srTi.js";import"./index-BhefpKLc.js";import"./index-tTbWyNHk.js";import"./useSize-tRF5RUOv.js";import"./role.data-DFU5aoTG.js";import"./shebei.info-D3mt3fPD.js";function ke(u){return k.get({url:"/zhongkong/shebei/list",params:u})}function ve(){return k.post({url:"/system/user/export",responseType:"blob"},{isTransformResponse:!1})}function Y(u){return k.deleteWithMsg({url:"/system/user/"+u})}function De(){return k.get({url:"/zhongkong/shebei/deptTree"},{ignoreCancelToken:!0})}const Re={key:1,class:"mt-5"},xe=ce({name:"User",__name:"index",setup(u){const c=S(""),o=fe({tree:[],selectDeptId:[]}),_=S(!0);function y(){return h(this,null,function*(){yield m()})}ge(()=>h(this,null,function*(){yield g({showIndexColumn:!0,rowSelection:!0});const t=yield De();O(t,a=>{a.icon="mdi:workflow-outline"}),o.tree=t,_.value=!1}));const[v,{reload:m,selected:f,multipleRemove:i,setProps:g}]=Z({rowSelection:{type:"checkbox",getCheckboxProps:t=>({disabled:t.userId===1})},title:"点位列表",showIndexColumn:!1,api:ke,rowKey:"userId",useSearchForm:!0,formConfig:{schemas:re,name:"dianwei",baseColProps:{xs:24,sm:24,md:24,lg:6},labelWidth:100,resetFunc:()=>h(this,null,function*(){o.selectDeptId=[],c.value="",yield m()}),fieldMapToTime:[["createTime",["params[beginTime]","params[endTime]"],["YYYY-MM-DD 00:00:00","YYYY-MM-DD 23:59:59"]]]},columns:ne,beforeFetch(t){return o.selectDeptId.length===1&&(t.deptId=o.selectDeptId[0]),t},actionColumn:{width:220,title:"操作",key:"action",fixed:"right"}}),[N,{openDrawer:T}]=le(),[U,{openModal:A}]=x(),[B,{openModal:V}]=x(),[F,{openModal:L}]=x();function K(){V(!0)}function W(t){A(!0,t)}function z(t){const{userId:a}=t;L(!0,a)}function j(t){T(!0,{update:!0,record:t})}function G(){T(!0,{update:!1})}function H(t){return h(this,null,function*(){yield Y([t.userId]),yield m()})}return(t,a)=>{const D=he("a-button"),w=_e("auth");return n(),p(e(q),{dense:""},{default:s(()=>[r(e(de),null,{default:s(()=>[r(e(M),ye({xs:24,sm:24,md:24,lg:4},{class:"h-[calc(100vh-80px)]"}),{default:s(()=>[r(e(pe),{active:!0,paragraph:{rows:8},loading:_.value},{default:s(()=>[o.tree.length?(n(),p(e(J),{key:0,fieldNames:{title:"label",key:"id"},"tree-data":o.tree,showLine:{showLeafIcon:!1},search:!0,searchValue:c.value,"onUpdate:searchValue":a[0]||(a[0]=d=>c.value=d),defaultExpandAll:"",onSelect:y,selectedKeys:o.selectDeptId,"onUpdate:selectedKeys":a[1]||(a[1]=d=>o.selectDeptId=d)},null,8,["tree-data","searchValue","selectedKeys"])):(n(),C("div",Re,[r(e(E),{image:e(E).PRESENTED_IMAGE_SIMPLE,description:"无设备数据"},null,8,["image"])]))]),_:1},8,["loading"])]),_:1},16),r(e(M),we(be({xs:24,sm:24,md:24,lg:20})),{default:s(()=>[r(e(ee),{onRegister:e(v)},{toolbar:s(()=>[r(e(ue),{class:"<sm:hidden"},{default:s(()=>[b((n(),p(D,{onClick:K},{default:s(()=>[I("导入")]),_:1})),[[w,"system:user:import"]]),b((n(),C("div",null,[r(e(Q),{placement:"left",title:"确认导出表格吗?",onConfirm:a[2]||(a[2]=d=>e(se)(e(ve),"用户数据"))},{default:s(()=>[I("导出")]),_:1})])),[[w,"system:user:export"]]),b((n(),p(D,{class:"<sm:hidden",type:"primary",danger:"",preIcon:"ant-design:delete-outlined",onClick:a[3]||(a[3]=d=>e(i)(e(Y))),disabled:!e(f)},{default:s(()=>[I(" 删除")]),_:1},8,["disabled"])),[[w,"system:user:remove"]]),b((n(),p(D,{type:"primary",preIcon:"ant-design:file-add-outlined",onClick:G},{default:s(()=>[I(" 新增 ")]),_:1})),[[w,"system:user:add"]])]),_:1})]),bodyCell:s(({column:d,record:l})=>[d.dataIndex==="avatar"?(n(),C(Ie,{key:0},[l.avatar?(n(),p(e(P),{key:0,src:l.avatar},null,8,["src"])):(n(),p(e(P),{key:1,src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}))],64)):$("",!0),d.key==="action"?(n(),p(e(te),{key:1,stopButtonPropagation:"",dropDownBtnDisplay:"",actions:[{label:"修改",icon:e(R).EDIT,type:"primary",ghost:!0,auth:"system:user:edit",onClick:j.bind(null,l)},{label:"删除",icon:e(R).DELETE,type:"primary",danger:!0,ghost:!0,auth:"system:user:remove",popConfirm:{placement:"left",title:`是否删除用户[${l.userName}]-${l.nickName}?`,confirm:H.bind(null,l)}}],dropDownActions:[{label:"用户信息",icon:"ph:user-light",auth:"system:user:list",onClick:z.bind(null,l)},{label:"重置密码",icon:e(R).RESET_PWD,auth:"system:user:resetPwd",ifShow:l.userId!==1,onClick:W.bind(null,l)}]},null,8,["actions","dropDownActions"])):$("",!0)]),_:1},8,["onRegister"])]),_:1},16)]),_:1}),r(ie,{onRegister:e(N),onReload:e(m)},null,8,["onRegister","onReload"]),r(oe,{onRegister:e(U),onReload:e(m)},null,8,["onRegister","onReload"]),r(ae,{onRegister:e(B),onReload:e(m)},null,8,["onRegister","onReload"]),r(me,{onRegister:e(F)},null,8,["onRegister"])]),_:1})}}}),ft=X(xe,[["__scopeId","data-v-8a078f83"]]);export{ft as default};
