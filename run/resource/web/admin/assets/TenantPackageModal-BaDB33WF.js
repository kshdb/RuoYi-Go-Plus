var g=(C,v,u)=>new Promise((d,h)=>{var m=s=>{try{n(u.next(s))}catch(f){h(f)}},r=s=>{try{n(u.throw(s))}catch(f){h(f)}},n=s=>s.done?d(s.value):Promise.resolve(s.value).then(m,r);n((u=u.apply(C,v)).next())});import{a as L,B as V}from"./index-CMSTH4sS.js";import{u as $,_ as D}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{e as E,m as G}from"./tenantPackage.data-3RzivsLS.js";import{a as O,b as W,c as j}from"./index-De2oYrBu.js";import{_ as q}from"./index-CwwL6bPg.js";import{t as z,e as H}from"./index-Bz-s2yf4.js";import{bn as J,bB as Q}from"./entry/index-CMepwc5X-1716790511191.js";import{b7 as X,R as Y}from"./antd-BRjMhd0C.js";import{d as Z,f as p,c as ee,y as ae,u as t,_ as w,a8 as M,a9 as y,k as _,ac as te,ad as ne}from"./vue-Bw3NQgLF.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import"./helper-CfJJkrf5.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./index-Rv_3g2e8.js";import"./useSortable-CwI952Jx.js";import"./download-CYeVxFqw.js";import"./useLoading-iCq4GOHr.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./onMountedOrActivated-B2y-oH2N.js";const se=1,Te=Z({name:"TenantPackageModal",__name:"TenantPackageModal",emits:["register","reload"],setup(C,{emit:v}){const u=v,d=p(!1),h=ee(()=>d.value?"编辑租户套餐":"新增租户套餐"),m=p(),r=p([]),n=p(!1),[s,{closeModal:f,modalLoading:k}]=L(e=>g(this,null,function*(){k(!0),n.value=!1;const{record:a,update:c}=e;if(d.value=c,c&&a){const o=yield O(a.packageId),i=S(o.menuIds);l.value=i,n.value=!o.menuCheckStrictly;const{checkedKeys:U,menus:K}=yield z(a.packageId),N=I(K);r.value=N,o.menuIds=U,yield R(o)}else{const o=yield H(),i=I(o);r.value=i}ae(()=>{t(m)&&t(m).filterByLevel(se)}),k(!1)}));function I(e){return J(e,a=>!E.includes(a.id),{id:"id",pid:"parentId",children:"children"})}function S(e){return e?e.split(", "):[]}const[T,{setFieldsValue:R,validate:x,resetForm:B}]=$({layout:"vertical",labelWidth:80,name:"tenant_package_modal",showActionButtonGroup:!1,baseColProps:{span:24},schemas:G}),l=p([]);function F(e,a){if(e instanceof Array){const c=a.halfCheckedKeys||[];l.value=[...c,...e]}else l.value=[...e.checked]}function A(e){if(e instanceof Array){const a=Q(r.value);e.length===0&&(console.log("取消全部"),l.value=[]),e.length===a.length&&(console.log("选择全部"),l.value=a)}}function P(){return g(this,null,function*(){try{k(!0);const e=yield x();e.menuIds=l.value.sort(),e.menuCheckStrictly=!t(n),t(d)?yield W(e):yield j(e),yield b(),u("reload",f)}catch(e){}finally{k(!1)}})}function b(){return g(this,null,function*(){yield B(),l.value=[]})}return(e,a)=>(w(),M(t(V),ne(e.$attrs,{title:h.value,width:600,onRegister:t(s),onOk:P,onCancel:b}),{default:y(()=>[_(t(D),{onRegister:t(T)},{menuIds:y(({model:c,field:o})=>[_(t(X),null,{default:y(()=>[_(t(Y),{"body-style":{padding:0}},{default:y(()=>[r.value.length?(w(),M(t(q),{key:0,ref_key:"menuTreeRef",ref:m,title:"菜单分配","tree-data":r.value,fieldNames:{title:"label",key:"id"},checkable:!0,selectable:!1,enableCustomTool:!0,checkStrictly:n.value,"onUpdate:checkStrictly":a[0]||(a[0]=i=>n.value=i),checkedKeys:c[o],"onUpdate:checkedKeys":i=>c[o]=i,onCheck:F,onChange:A},null,8,["tree-data","checkStrictly","checkedKeys","onUpdate:checkedKeys"])):te("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{Te as default};
