var m=(u,p,o)=>new Promise((h,y)=>{var c=i=>{try{f(o.next(i))}catch(l){y(l)}},b=i=>{try{f(o.throw(i))}catch(l){y(l)}},f=i=>i.done?h(i.value):Promise.resolve(i.value).then(c,b);f((o=o.apply(u,p)).next())});import{P as q}from"./index-DrfqwNLV.js";import{_ as H}from"./index-CwwL6bPg.js";import{a as z}from"./index-HlBkaR6C.js";import{u as J,_ as O}from"./useTable-BlleqRm-.js";import{_ as S}from"./index-Rv_3g2e8.js";import{u as Q}from"./useRender-C6p2srTi.js";import{D as X}from"./dictEnum-DeC8h6ZR.js";import{bp as Y,bj as Z,bq as ee,c as te,I as R,j as ae}from"./entry/index-CMepwc5X-1716790511191.js";import{u as x}from"./index-CMSTH4sS.js";import{b as k,e as oe,f as ne,h as se}from"./index-CU-vYa55.js";import{_ as ie}from"./SwitchVersionModal.vue_vue_type_script_setup_true_lang-CQ8Sglo1.js";import{_ as le}from"./CancelModal.vue_vue_type_script_setup_true_lang-CXQjF_z-.js";import{at as re,au as T,y as de,a6 as ce,a5 as V}from"./antd-BRjMhd0C.js";import{d as ue,f as v,r as me,o as pe,c as fe,aa as ge,_ as I,a8 as D,a9 as s,k as n,u as e,ad as he,ac as P,al as ye,am as _e,G as w,$ as be,F as ve}from"./vue-Bw3NQgLF.js";import"./useContentViewHeight-xBSq9xFC.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./onMountedOrActivated-B2y-oH2N.js";import"./useForm-uR1ZVBCA.js";import"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import"./componentMap-DPcekmXH.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./helper-CfJJkrf5.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./sortable.esm-DFFrMEeC.js";import"./useSortable-CwI952Jx.js";import"./download-CYeVxFqw.js";import"./useLoading-iCq4GOHr.js";import"./index-BhefpKLc.js";import"./dict-C9gNHjAh.js";import"./index-CigIE-O6.js";const{renderTag:Ie,renderDict:we}=Q(),_=[{dataIndex:"processDefinitionName",title:"流程名称"},{dataIndex:"processDefinitionKey",title:"流程key"},{dataIndex:"processDefinitionVersion",title:"版本号",customRender({value:u}){return Ie(`V${u}.0`,"blue")}},{dataIndex:"businessStatus",title:"流程状态",customRender({value:u}){return we(u,X.WF_BUSINESS_STATUS)}},{dataIndex:"startTime",title:"启动时间"},{dataIndex:"endTime",title:"结束时间",ifShow:!1}],Ce=[{field:"name",label:"流程名称",component:"Input"},{field:"key",label:"流程key",component:"Input"}],Se=ue({name:"ProcessInstance",__name:"index",setup(u){const p=v(""),o=me({tree:[],selectId:[]}),h=v(!0);function y(){return m(this,null,function*(){yield l()})}const c=v("running");function b(){return m(this,null,function*(){const a=c.value==="running"?k:se;i({api:a}),_[_.length-1].ifShow=c.value==="finished",F(_),B([]),yield l()})}pe(()=>m(this,null,function*(){const a=yield z();let t=Y(a,{id:"id",pid:"parentId"});t=[{categoryName:"根目录",id:0,children:t}],Z(t,g=>{g.icon="flat-color-icons:folder"}),ee(t,"categoryName"," / "),o.tree=t,h.value=!1}));const[f,{setProps:i,reload:l,selected:N,multipleRemove:E,setColumns:F,setTableData:B}]=J({rowSelection:{type:"checkbox"},title:"流程实例列表",showIndexColumn:!1,api:k,rowKey:"id",useSearchForm:!0,formConfig:{schemas:Ce,baseColProps:{xs:24,sm:24,md:24,lg:6},labelWidth:80,resetFunc:()=>m(this,null,function*(){o.selectId=[],p.value=""})},columns:_,beforeFetch(a){return o.selectId.length===1&&(a.categoryCode=o.selectId[0]),a},actionColumn:{title:"操作",key:"action",fixed:"right"}}),M=te();function $(a){const t=a.wfNodeConfigVo.wfFormManageVo.router;M({path:t,query:{id:a.businessKey,type:"preview"}})}const[A,{openModal:K}]=x();function U(a){const{processDefinitionKey:t,processDefinitionId:g}=a;K(!0,{processDefinitionKey:t,processDefinitionId:g})}const[L,{openModal:W}]=x();function G(a){const{id:t}=a;W(!0,t)}const C=fe(()=>c.value==="running"?oe:ne);function j(a){return m(this,null,function*(){yield C.value([a.id]),yield l()})}return(a,t)=>{const g=ge("a-button");return I(),D(e(q),{dense:""},{default:s(()=>[n(e(re),null,{default:s(()=>[n(e(T),he({xs:24,sm:24,md:24,lg:4},{class:"h-[calc(100vh-80px)]"}),{default:s(()=>[n(e(de),{active:!0,paragraph:{rows:8},loading:h.value},{default:s(()=>[o.tree.length?(I(),D(e(H),{key:0,fieldNames:{title:"categoryName",key:"categoryCode"},"tree-data":o.tree,showLine:{showLeafIcon:!1},search:!0,searchValue:p.value,"onUpdate:searchValue":t[0]||(t[0]=r=>p.value=r),defaultExpandAll:"",onSelect:y,selectedKeys:o.selectId,"onUpdate:selectedKeys":t[1]||(t[1]=r=>o.selectId=r)},null,8,["tree-data","searchValue","selectedKeys"])):P("",!0)]),_:1},8,["loading"])]),_:1},16),n(e(T),ye(_e({xs:24,sm:24,md:24,lg:20})),{default:s(()=>[n(e(O),{onRegister:e(f)},{toolbar:s(()=>[n(g,{class:"<sm:hidden",type:"primary",danger:"",onClick:t[2]||(t[2]=r=>e(E)(C.value)),disabled:!e(N)},{default:s(()=>[w("删除")]),_:1},8,["disabled"]),n(e(ce),{"button-style":"solid",value:c.value,"onUpdate:value":t[3]||(t[3]=r=>c.value=r),onChange:b},{default:s(()=>[n(e(V),{value:"running"},{default:s(()=>[w("运行中")]),_:1}),n(e(V),{value:"finished"},{default:s(()=>[w("已完成")]),_:1})]),_:1},8,["value"])]),bodyCell:s(({column:r,record:d})=>[r&&d&&r.key==="action"?(I(),be(ve,{key:0},[n(e(S),{stopButtonPropagation:"",actions:[{label:"审批记录",icon:e(R).PREVIEW,onClick:$.bind(null,d)},{label:"删除",icon:e(R).DELETE,danger:!0,popConfirm:{placement:"left",title:`是否确认删除流程实例[${d.processDefinitionName}]`,confirm:j.bind(null,d)}}]},null,8,["actions"]),n(e(S),{stopButtonPropagation:"",actions:[{label:"切换版本",icon:"mi:switch",onClick:U.bind(null,d),ifShow:d.isSuspended!==null},{label:"作废",icon:"flat-color-icons:cancel",onClick:G.bind(null,d),ifShow:d.isSuspended!==null}]},null,8,["actions"])],64)):P("",!0)]),_:1},8,["onRegister"]),n(ie,{onRegister:e(A),onReload:e(l)},null,8,["onRegister","onReload"]),n(le,{onRegister:e(L),onReload:e(l)},null,8,["onRegister","onReload"])]),_:1},16)]),_:1})]),_:1})}}}),ot=ae(Se,[["__scopeId","data-v-ea14a2d4"]]);export{ot as default};
