var m=(v,f,o)=>new Promise((_,h)=>{var b=n=>{try{c(o.next(n))}catch(y){h(y)}},d=n=>{try{c(o.throw(n))}catch(y){h(y)}},c=n=>n.done?_(n.value):Promise.resolve(n.value).then(b,d);c((o=o.apply(v,f)).next())});import{P as L}from"./index-C4nZBquz.js";import{_ as z}from"./index-BcLdq1Bd.js";import{d as Z,e as I,g as A,h as G}from"./index-CnJarzSv.js";import{d as U}from"./download-DOz9ltI1.js";import{a as j}from"./index-C0XwB-DV.js";import{u as W,_ as q}from"./useTable-CNbfTOCZ.js";import{_ as $}from"./index-DCvxWw7W.js";import{s as H,c as J,_ as O}from"./ModelModal.vue_vue_type_script_setup_true_lang-D4M3iTsZ.js";import{bw as Q,bj as X,bx as Y,c as ee,I as D,l as te}from"./entry/index-BbJQUQ84-1718268303552.js";import{u as ae}from"./index-BIkrAlj7.js";import{ar as oe,as as R,y as le}from"./antd-DMGzOvrA.js";import{d as ne,f as T,r as se,o as ie,a7 as re,n as de,Z as u,a8 as g,a9 as l,k as r,u as t,ac as me,ab as E,ak as ce,al as pe,m as k,G as x,_ as ue,F as fe}from"./vue-Cw15aJ-2.js";import"./useContentViewHeight-BDi3O9lC.js";import"./useWindowSizeFn-BKs0NEK5.js";import"./onMountedOrActivated-CSHfHTyc.js";import"./useLoading-D1in2ACg.js";import"./useForm-BsovIqMX.js";import"./FormItem.vue_vue_type_script_lang-C67_1cA1.js";import"./componentMap-qA-f8iV4.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-SetVOuUZ.js";import"./copyTextToClipboard-uEEWQikS.js";import"./style-CLEvKZSv.js";import"./helper-CXVLNTBN.js";import"./BasicForm.vue_vue_type_style_index_0_lang-B6-8R5aw.js";import"./sortable.esm-DFFrMEeC.js";import"./useSortable-BTdBE9Oa.js";import"./useRender-D1Q3fAQ3.js";import"./index-Dx0uas1b.js";import"./dict-vVDMuEaq.js";const ye=ne({name:"Model",__name:"index",setup(v){const f=T(""),o=se({tree:[],selectId:[]}),_=T(!0);function h(){return m(this,null,function*(){yield d()})}ie(()=>m(this,null,function*(){const e=yield j();let a=Q(e,{id:"id",pid:"parentId"});a=[{categoryName:"根目录",id:0,children:a}],X(a,s=>{s.icon="flat-color-icons:folder"}),Y(a,"categoryName"," -> "),o.tree=a,_.value=!1}));const[b,{reload:d,selected:c,multipleRemove:n,getSelectRowKeys:y}]=W({rowSelection:{type:"checkbox"},title:"流程模型列表",showIndexColumn:!1,api:Z,rowKey:"id",useSearchForm:!0,formConfig:{schemas:H,baseColProps:{xs:24,sm:24,md:24,lg:6},resetFunc:()=>m(this,null,function*(){o.selectId=[],f.value=""})},columns:J,beforeFetch(e){return o.selectId.length===1&&(e.categoryCode=o.selectId[0]),e},actionColumn:{width:180,title:"操作",key:"action",fixed:"right"}}),[M,{openModal:C}]=ae();function N(){C(!0,{update:!1})}function B(e){const{id:a}=e;C(!0,{update:!0,id:a})}function P(e){return m(this,null,function*(){yield A(e.id),yield d()})}function S(e){return m(this,null,function*(){let a=`模型导出-${new Date().getTime()}.zip`,s=y();e&&(a=`${e.name} - ${e.key}.zip`,s=[e.id]);const w=yield G(s);U(w,a),yield d()})}function F(e){return m(this,null,function*(){yield I([e.id]),yield d()})}const V=ee();function K(e){V(`/workflow/design/${e.id}`)}return(e,a)=>{const s=re("a-button"),w=de("auth");return u(),g(t(L),{dense:""},{default:l(()=>[r(t(oe),null,{default:l(()=>[r(t(R),me({xs:24,sm:24,md:24,lg:4},{class:"h-[calc(100vh-80px)]"}),{default:l(()=>[r(t(le),{active:!0,paragraph:{rows:8},loading:_.value},{default:l(()=>[o.tree.length?(u(),g(t(z),{key:0,fieldNames:{title:"categoryName",key:"categoryCode"},"tree-data":o.tree,showLine:{showLeafIcon:!1},search:!0,searchValue:f.value,"onUpdate:searchValue":a[0]||(a[0]=p=>f.value=p),defaultExpandAll:"",onSelect:h,selectedKeys:o.selectId,"onUpdate:selectedKeys":a[1]||(a[1]=p=>o.selectId=p)},null,8,["tree-data","searchValue","selectedKeys"])):E("",!0)]),_:1},8,["loading"])]),_:1},16),r(t(R),ce(pe({xs:24,sm:24,md:24,lg:20})),{default:l(()=>[r(t(q),{onRegister:t(b)},{toolbar:l(()=>[k((u(),g(s,{onClick:S,disabled:!t(c)},{default:l(()=>[x("导出")]),_:1},8,["disabled"])),[[w,"workflow:model:export"]]),k((u(),g(s,{class:"<sm:hidden",type:"primary",danger:"",onClick:a[2]||(a[2]=p=>t(n)(t(I))),disabled:!t(c)},{default:l(()=>[x("删除")]),_:1},8,["disabled"])),[[w,"workflow:model:remove"]]),k((u(),g(s,{type:"primary",onClick:N},{default:l(()=>[x("新增")]),_:1})),[[w,"workflow:model:add"]])]),bodyCell:l(({column:p,record:i})=>[p.key==="action"?(u(),ue(fe,{key:0},[r(t($),{stopButtonPropagation:"",dropDownBtnDisplay:"",actions:[{label:"设计",icon:"streamline:text-flow-rows",onClick:K.bind(null,i)},{label:"修改",icon:t(D).EDIT,onClick:B.bind(null,i)}]},null,8,["actions"]),r(t($),{stopButtonPropagation:"",actions:[{label:"部署",icon:"clarity:deploy-line",popConfirm:{placement:"left",title:`是否确认部署[${i.name}] - [${i.key}]`,confirm:P.bind(null,i)}},{label:"删除",icon:t(D).DELETE,danger:!0,popConfirm:{placement:"left",title:`是否确认删除[${i.name}] - [${i.key}]`,confirm:F.bind(null,i)}}]},null,8,["actions"])],64)):E("",!0)]),_:1},8,["onRegister"]),r(O,{onRegister:t(M),onReload:t(d)},null,8,["onRegister","onReload"])]),_:1},16)]),_:1})]),_:1})}}}),We=te(ye,[["__scopeId","data-v-e0c9a5bd"]]);export{We as default};
