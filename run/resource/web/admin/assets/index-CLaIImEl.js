var Uy=Object.defineProperty,Wy=Object.defineProperties;var Yy=Object.getOwnPropertyDescriptors;var Ko=Object.getOwnPropertySymbols;var Lp=Object.prototype.hasOwnProperty,Bp=Object.prototype.propertyIsEnumerable;var $p=Math.pow,pc=(e,t,n)=>t in e?Uy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,re=(e,t)=>{for(var n in t||(t={}))Lp.call(t,n)&&pc(e,n,t[n]);if(Ko)for(var n of Ko(t))Bp.call(t,n)&&pc(e,n,t[n]);return e},Re=(e,t)=>Wy(e,Yy(t));var fc=(e,t)=>{var n={};for(var i in e)Lp.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&Ko)for(var i of Ko(e))t.indexOf(i)<0&&Bp.call(e,i)&&(n[i]=e[i]);return n};var qe=(e,t,n)=>(pc(e,typeof t!="symbol"?t+"":t,n),n);var it=(e,t,n)=>new Promise((i,r)=>{var o=c=>{try{s(n.next(c))}catch(l){r(l)}},a=c=>{try{s(n.throw(c))}catch(l){r(l)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(o,a);s((n=n.apply(e,t)).next())});import{j as Ah,b as qy,_ as Xo,i as Ky,h as Xy}from"./entry/index-CMepwc5X-1716790511191.js";import{B as xl,e as q,I as Ih,i as ve,c as Zr,a as K,b as jt,m as Ya,d as N,V as Jr,M as Mh,Z as Dh,f as D,s as un,g as pe,h as _e,j as ct,q as we,k as Ai,l as Z,n as Rt,o as Qr,p as Te,r as wl,O as kh,t as Pt,u as Qi,v as Sn,C as H,w as qa,x as ke,y as ut,z as Zn,A as te,D as se,E as Ka,F as le,G as mt,H as g,J as Na,K as Sl,L as Xa,N as En,P as At,Q as Cl,R as pn,S as be,T as Hr,U as xn,W as dc,X as Zy,Y as Oh,_ as Nh,$ as Jy,a0 as Cn,a1 as Lh,a2 as Qy,a3 as de,a4 as Ae,a5 as ge,a6 as ie,a7 as Lc,a8 as bn,a9 as dt,aa as e_,ab as Qe,ac as Tl,ad as Yn,ae as t_,af as Bh,ag as Bc,ah as fn,ai as Za,aj as $c,ak as n_,al as Pl,am as Ti,an as Ja,ao as z,ap as $h,aq as ht,ar as Xe,as as Ue,at as Se,au as ue,av as Qa,aw as Gr,ax as Br,ay as er,az as qn,aA as yt,aB as ye,aC as eo,aD as zr,aE as Fh,aF as Mi,aG as Xi,aH as Sa,aI as mi,aJ as Fp,aK as i_,aL as r_,aM as o_,aN as a_,aO as s_,aP as jh,aQ as Vn,aR as Fc,aS as c_,aT as Rl,aU as l_,aV as Al,aW as u_,aX as p_,aY as f_,aZ as d_,a_ as jc,a$ as Hh,b0 as h_,b1 as m_,b2 as jp,b3 as Gh,b4 as tr,b5 as v_,b6 as g_,b7 as es,b8 as y_,b9 as __,ba as Il,bb as b_,bc as zh,bd as E_,be as Hc,bf as x_,bg as Vh}from"./index-u_3lW7KD.js";import{V as w_,f as Ee,d as Ct,_ as xe,a8 as Ze,a9 as $,u as O,ac as gt,a0 as lt,$ as Mt,ad as Vr,c as sn,k as L,G as st,aa as cn,r as S_,J as Ht,o as to,a1 as ts,ab as C_,F as T_,D as Gc,w as P_,m as R_,A as A_,aj as I_,a2 as Uh,y as Zo,af as M_,ao as D_}from"./vue-Bw3NQgLF.js";import{a2 as Hp,b as Wh,c as k_,a3 as O_,z as zc,A as Je,o as N_,f as L_,a4 as Yh,a5 as B_,a6 as $_,a7 as dn,Z as Gp,a8 as Le,a9 as F_,aa as zp,ab as no,R as j_,D as Vp,v as Up,ac as Jo,T as vi,ad as qh}from"./antd-BRjMhd0C.js";import{d as Wp}from"./download-CYeVxFqw.js";import{a as Ml,B as Dl,u as Ji}from"./index-CMSTH4sS.js";import{C as H_,M as G_}from"./index-BhefpKLc.js";import{w as z_}from"./index-BIzCyvWB.js";import{c as V_}from"./index-CYdIkwig.js";import Yp from"./index-BMkdtMeE.js";import{u as U_,_ as W_}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{V as Y_}from"./index-C7Pg2pwq.js";import{u as Kh,_ as Xh}from"./useTable-BlleqRm-.js";import{_ as Zh}from"./index-Rv_3g2e8.js";import{f as q_,a as K_}from"./index-Dhs12g34.js";import"./useLoading-iCq4GOHr.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./index-CwwL6bPg.js";import"./index-Cm0AtxlD.js";import"./dictEnum-DeC8h6ZR.js";import"./useRender-C6p2srTi.js";import"./dict-C9gNHjAh.js";import"./FormItem.vue_vue_type_script_lang-DAyz6oLf.js";import"./helper-CfJJkrf5.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./onMountedOrActivated-B2y-oH2N.js";import"./sortable.esm-DFFrMEeC.js";import"./useSortable-CwI952Jx.js";function io(e){xl.call(this,e),this.on("import.parse.complete",function(t){t.error||this._collectIds(t.definitions,t.elementsById)},this),this.on("diagram.destroy",function(){this.get("moddle").ids.clear()},this)}q(io,xl);io.prototype._createModdle=function(e){var t=xl.prototype._createModdle.call(this,e);return t.ids=new Ih([32,36,1]),t};io.prototype._collectIds=function(e,t){var n=e.$model,i=n.ids,r;i.clear();for(r in t)i.claim(r,t[r])};var X_=["c","C"],Z_=["v","V"],J_=["y","Y"],Jh=["z","Z"];function Q_(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey}function It(e){return e.altKey?!1:e.ctrlKey||e.metaKey}function Ke(e,t){return e=ve(e)?e:[e],e.indexOf(t.key)!==-1||e.indexOf(t.code)!==-1}function kl(e){return e.shiftKey}function eb(e){return It(e)&&Ke(X_,e)}function tb(e){return It(e)&&Ke(Z_,e)}function nb(e){return It(e)&&!kl(e)&&Ke(Jh,e)}function ib(e){return It(e)&&(Ke(J_,e)||Ke(Jh,e)&&kl(e))}var ns="keyboard.keydown",rb="keyboard.keyup",qp="input-handle-modified-keys",ob=1e3;function rt(e,t){var n=this;this._config=e||{},this._eventBus=t,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),t.on("diagram.destroy",function(){n._fire("destroy"),n.unbind()}),t.on("diagram.init",function(){n._fire("init")}),t.on("attach",function(){e&&e.bindTo&&n.bind(e.bindTo)}),t.on("detach",function(){n.unbind()})}rt.$inject=["config.keyboard","eventBus"];rt.prototype._keydownHandler=function(e){this._keyHandler(e,ns)};rt.prototype._keyupHandler=function(e){this._keyHandler(e,rb)};rt.prototype._keyHandler=function(e,t){var n;if(!this._isEventIgnored(e)){var i={keyEvent:e};n=this._eventBus.fire(t||ns,i),n&&e.preventDefault()}};rt.prototype._isEventIgnored=function(e){return e.defaultPrevented?!0:(ab(e.target)||sb(e.target)&&Ke([" ","Enter"],e))&&this._isModifiedKeyIgnored(e)};rt.prototype._isModifiedKeyIgnored=function(e){if(!It(e))return!0;var t=this._getAllowedModifiers(e.target);return t.indexOf(e.key)===-1};rt.prototype._getAllowedModifiers=function(e){var t=Zr(e,"["+qp+"]",!0);return!t||this._node&&!this._node.contains(t)?[]:t.getAttribute(qp).split(",")};rt.prototype.bind=function(e){this.unbind(),this._node=e,K.bind(e,"keydown",this._keydownHandler),K.bind(e,"keyup",this._keyupHandler),this._fire("bind")};rt.prototype.getBinding=function(){return this._node};rt.prototype.unbind=function(){var e=this._node;e&&(this._fire("unbind"),K.unbind(e,"keydown",this._keydownHandler),K.unbind(e,"keyup",this._keyupHandler)),this._node=null};rt.prototype._fire=function(e){this._eventBus.fire("keyboard."+e,{node:this._node})};rt.prototype.addListener=function(e,t,n){jt(e)&&(n=t,t=e,e=ob),this._eventBus.on(n||ns,e,t)};rt.prototype.removeListener=function(e,t){this._eventBus.off(t||ns,e)};rt.prototype.hasModifier=Q_;rt.prototype.isCmd=It;rt.prototype.isShift=kl;rt.prototype.isKey=Ke;function ab(e){return e&&(Ya(e,"input, textarea")||e.contentEditable==="true")}function sb(e){return e&&Ya(e,"button, input[type=submit], input[type=button], a[href], [aria-role=button]")}var cb=500;function cr(e,t){var n=this;e.on("editorActions.init",cb,function(i){var r=i.editorActions;n.registerBindings(t,r)})}cr.$inject=["eventBus","keyboard"];cr.prototype.registerBindings=function(e,t){function n(i,r){t.isRegistered(i)&&e.addListener(r)}n("undo",function(i){var r=i.keyEvent;if(nb(r))return t.trigger("undo"),!0}),n("redo",function(i){var r=i.keyEvent;if(ib(r))return t.trigger("redo"),!0}),n("copy",function(i){var r=i.keyEvent;if(eb(r))return t.trigger("copy"),!0}),n("paste",function(i){var r=i.keyEvent;if(tb(r))return t.trigger("paste"),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(Ke(["+","Add","="],r)&&It(r))return t.trigger("stepZoom",{value:1}),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(Ke(["-","Subtract"],r)&&It(r))return t.trigger("stepZoom",{value:-1}),!0}),n("zoom",function(i){var r=i.keyEvent;if(Ke("0",r)&&It(r))return t.trigger("zoom",{value:1}),!0}),n("removeSelection",function(i){var r=i.keyEvent;if(Ke(["Backspace","Delete","Del"],r))return t.trigger("removeSelection"),!0})};const Ol={__init__:["keyboard","keyboardBindings"],keyboard:["type",rt],keyboardBindings:["type",cr]};var lb={moveSpeed:50,moveSpeedAccelerated:200};function Qh(e,t,n){var i=this;this._config=N({},lb,e||{}),t.addListener(r);function r(o){var a=o.keyEvent,s=i._config;if(t.isCmd(a)&&t.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],a)){var c=t.isShift(a)?s.moveSpeedAccelerated:s.moveSpeed,l;switch(a.key){case"ArrowLeft":case"Left":l="left";break;case"ArrowUp":case"Up":l="up";break;case"ArrowRight":case"Right":l="right";break;case"ArrowDown":case"Down":l="down";break}return i.moveCanvas({speed:c,direction:l}),!0}}this.moveCanvas=function(o){var a=0,s=0,c=o.speed,l=c/Math.min(Math.sqrt(n.viewbox().scale),1);switch(o.direction){case"left":a=l;break;case"up":s=l;break;case"right":a=-l;break;case"down":s=-l;break}n.scroll({dx:a,dy:s})}}Qh.$inject=["config.keyboardMove","keyboard","canvas"];const em={__depends__:[Ol],__init__:["keyboardMove"],keyboardMove:["type",Qh]};function Ur(e){Jr.call(this,e)}q(Ur,Jr);Ur.prototype._navigationModules=[em,Mh,Dh];Ur.prototype._modules=[].concat(Jr.prototype._modules,Ur.prototype._navigationModules);function hc(e){return e&&e[e.length-1]}function Kp(e){return e.y}function Xp(e){return e.x}var ub={left:Xp,center:Xp,right:function(e){return e.x+e.width},top:Kp,middle:Kp,bottom:function(e){return e.y+e.height}};function lr(e,t){this._modeling=e,this._rules=t}lr.$inject=["modeling","rules"];lr.prototype._getOrientationDetails=function(e){var t=["top","bottom","middle"],n="x",i="width";return t.indexOf(e)!==-1&&(n="y",i="height"),{axis:n,dimension:i}};lr.prototype._isType=function(e,t){return t.indexOf(e)!==-1};lr.prototype._alignmentPosition=function(e,t){var n=this._getOrientationDetails(e),i=n.axis,r=n.dimension,o={},a={},s=!1,c,l,p;function u(f,d){return Math.round((f[i]+d[i]+d[r])/2)}if(this._isType(e,["left","top"]))o[e]=t[0][i];else if(this._isType(e,["right","bottom"]))p=hc(t),o[e]=p[i]+p[r];else if(this._isType(e,["center","middle"])){if(D(t,function(f){var d=f[i]+Math.round(f[r]/2);a[d]?a[d].elements.push(f):a[d]={elements:[f],center:d}}),c=un(a,function(f){return f.elements.length>1&&(s=!0),f.elements.length}),s)return o[e]=hc(c).center,o;l=t[0],t=un(t,function(f){return f[i]+f[r]}),p=hc(t),o[e]=u(l,p)}return o};lr.prototype.trigger=function(e,t){var n=this._modeling,i,r=pe(e,function(c){return!(c.waypoints||c.host||c.labelTarget)});if(i=this._rules.allowed("elements.align",{elements:r}),ve(i)&&(r=i),!(r.length<2||!i)){var o=ub[t],a=un(r,o),s=this._alignmentPosition(t,a);n.alignElements(a,s)}};const pb={__init__:["alignElements"],alignElements:["type",lr]};var fb="djs-element-hidden",Qo=".entry",db=1e3,Zp=8,hb=300;function ze(e,t,n){this._canvas=e,this._elementRegistry=t,this._eventBus=n,this._current=null,this._init()}ze.$inject=["canvas","elementRegistry","eventBus"];ze.prototype._init=function(){var e=this;this._eventBus.on("selection.changed",function(t){var n=t.newSelection,i=n.length?n.length===1?n[0]:n:null;i?e.open(i,!0):e.close()}),this._eventBus.on("elements.changed",function(t){var n=t.elements,i=e._current;if(i){var{target:r}=i,o=ve(r)?r:[r],a=o.filter(function(c){return tm(n,c)});if(a.length){e.close();var s=o.filter(function(c){return e._elementRegistry.get(c.id)});s.length&&e._updateAndOpen(s.length>1?s:s[0])}}}),this._eventBus.on("canvas.viewbox.changed",()=>{this._updatePosition()}),this._eventBus.on("element.marker.update",function(t){e._updateVisibility()}),this._container=this._createContainer()};ze.prototype._createContainer=function(){const e=_e('<div class="djs-context-pad-parent"></div>');return this._canvas.getContainer().appendChild(e),e};ze.prototype.registerProvider=function(e,t){t||(t=e,e=db),this._eventBus.on("contextPad.getProviders",e,function(n){n.providers.push(t)})};ze.prototype.getEntries=function(e){var t=this._getProviders(),n=ve(e)?"getMultiElementContextPadEntries":"getContextPadEntries",i={};return D(t,function(r){if(jt(r[n])){var o=r[n](e);jt(o)?i=o(i):D(o,function(a,s){i[s]=a})}}),i};ze.prototype.trigger=function(e,t,n){var i,r,o=t.delegateTarget||t.target;if(!o)return t.preventDefault();if(i=ct(o,"data-action"),r=t.originalEvent||t,e==="mouseover"){this._timeout=setTimeout(()=>{this._mouseout=this.triggerEntry(i,"hover",r,n)},hb);return}else if(e==="mouseout"){clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null);return}return this.triggerEntry(i,e,r,n)};ze.prototype.triggerEntry=function(e,t,n,i){if(this.isShown()){var r=this._current.target,o=this._current.entries,a=o[e];if(a){var s=a.action;if(this._eventBus.fire("contextPad.trigger",{entry:a,event:n})!==!1){if(jt(s)){if(t==="click")return s(n,r,i)}else if(s[t])return s[t](n,r,i);n.preventDefault()}}}};ze.prototype.open=function(e,t){!t&&this.isOpen(e)||(this.close(),this._updateAndOpen(e))};ze.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};ze.prototype._updateAndOpen=function(e){var t=this.getEntries(e),n=this._createHtml(e),i;D(t,function(r,o){var a=r.group||"default",s=_e(r.html||'<div class="entry" draggable="true"></div>'),c;ct(s,"data-action",o),c=we("[data-group="+Ai(a)+"]",n),c||(c=_e('<div class="group"></div>'),ct(c,"data-group",a),n.appendChild(c)),c.appendChild(s),r.className&&mb(s,r.className),r.title&&ct(s,"title",r.title),r.imageUrl&&(i=_e("<img>"),ct(i,"src",r.imageUrl),i.style.width="100%",i.style.height="100%",s.appendChild(i))}),Z(n).add("open"),this._current={entries:t,html:n,target:e},this._updatePosition(),this._updateVisibility(),this._eventBus.fire("contextPad.open",{current:this._current})};ze.prototype._createHtml=function(e){var t=this,n=_e('<div class="djs-context-pad"></div>');return Rt.bind(n,Qo,"click",function(i){t.trigger("click",i)}),Rt.bind(n,Qo,"dragstart",function(i){t.trigger("dragstart",i)}),Rt.bind(n,Qo,"mouseover",function(i){t.trigger("mouseover",i)}),Rt.bind(n,Qo,"mouseout",function(i){t.trigger("mouseout",i)}),K.bind(n,"mousedown",function(i){i.stopPropagation()}),this._container.appendChild(n),this._eventBus.fire("contextPad.create",{target:e,pad:n}),n};ze.prototype.getPad=function(e){console.warn(new Error("ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888"));let t;return this.isOpen()&&gb(this._current.target,e)?t=this._current.html:t=this._createHtml(e),{html:t}};ze.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._container.innerHTML="",this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)};ze.prototype.isOpen=function(e){var t=this._current;if(!t)return!1;if(!e)return!0;var n=t.target;return ve(e)!==ve(n)?!1:ve(e)?e.length===n.length&&Qr(e,function(i){return tm(n,i)}):n===e};ze.prototype.isShown=function(){return this.isOpen()&&Z(this._current.html).has("open")};ze.prototype.show=function(){this.isOpen()&&(Z(this._current.html).add("open"),this._updatePosition(),this._eventBus.fire("contextPad.show",{current:this._current}))};ze.prototype.hide=function(){this.isOpen()&&(Z(this._current.html).remove("open"),this._eventBus.fire("contextPad.hide",{current:this._current}))};ze.prototype._getPosition=function(e){if(!ve(e)&&Te(e)){const r=this._canvas.viewbox(),o=vb(e),a=o.x*r.scale-r.x*r.scale,s=o.y*r.scale-r.y*r.scale;return{left:a+Zp*this._canvas.zoom(),top:s}}var t=this._canvas.getContainer(),n=t.getBoundingClientRect(),i=this._getTargetBounds(e);return{left:i.right-n.left+Zp*this._canvas.zoom(),top:i.top-n.top}};ze.prototype._updatePosition=function(){if(this.isOpen()){var e=this._current.html,t=this._getPosition(this._current.target);"x"in t&&"y"in t?(e.style.left=t.x+"px",e.style.top=t.y+"px"):["top","right","bottom","left"].forEach(function(n){n in t&&(e.style[n]=t[n]+"px")})}};ze.prototype._updateVisibility=function(){if(this.isOpen()){var e=this,t=this._current.target,n=ve(t)?t:[t],i=n.some(function(r){return e._canvas.hasMarker(r,fb)});i?e.hide():e.show()}};ze.prototype._getTargetBounds=function(e){var t=ve(e)?e:[e],n=t.map(i=>this._canvas.getGraphics(i));return n.reduce((i,r)=>{const o=r.getBoundingClientRect();return i.top=Math.min(i.top,o.top),i.right=Math.max(i.right,o.right),i.bottom=Math.max(i.bottom,o.bottom),i.left=Math.min(i.left,o.left),i.x=i.left,i.y=i.top,i.width=i.right-i.left,i.height=i.bottom-i.top,i},{top:1/0,right:-1/0,bottom:-1/0,left:1/0})};function mb(e,t){var n=Z(e);t=ve(t)?t:t.split(/\s+/g),t.forEach(function(i){n.add(i)})}function tm(e,t){return e.indexOf(t)!==-1}function vb(e){return e.waypoints[e.waypoints.length-1]}function gb(e,t){return e=ve(e)?e:[e],t=ve(t)?t:[t],e.length===t.length&&Qr(e,function(n){return t.includes(n)})}const nm={__depends__:[wl,kh],contextPad:["type",ze]};var is,Fe,im,wi,Jp,rm,Vc,Nl,Uc,Wc,Wr={},om=[],yb=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ll=Array.isArray;function Un(e,t){for(var n in t)e[n]=t[n];return e}function am(e){var t=e.parentNode;t&&t.removeChild(e)}function sm(e,t,n){var i,r,o,a={};for(o in t)o=="key"?i=t[o]:o=="ref"?r=t[o]:a[o]=t[o];if(arguments.length>2&&(a.children=arguments.length>3?is.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)a[o]===void 0&&(a[o]=e.defaultProps[o]);return Ca(e,a,i,r,null)}function Ca(e,t,n,i,r){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:r==null?++im:r,__i:-1,__u:0};return r==null&&Fe.vnode!=null&&Fe.vnode(o),o}function rs(e){return e.children}function Ta(e,t){this.props=e,this.context=t}function Ii(e,t){if(t==null)return e.__?Ii(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?Ii(e):null}function cm(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return cm(e)}}function Qp(e){(!e.__d&&(e.__d=!0)&&wi.push(e)&&!La.__r++||Jp!==Fe.debounceRendering)&&((Jp=Fe.debounceRendering)||rm)(La)}function La(){var e,t,n,i,r,o,a,s;for(wi.sort(Vc);e=wi.shift();)e.__d&&(t=wi.length,i=void 0,o=(r=(n=e).__v).__e,a=[],s=[],n.__P&&((i=Un({},r)).__v=r.__v+1,Fe.vnode&&Fe.vnode(i),Bl(n.__P,i,r,n.__n,n.__P.namespaceURI,32&r.__u?[o]:null,a,o==null?Ii(r):o,!!(32&r.__u),s),i.__v=r.__v,i.__.__k[i.__i]=i,pm(a,i,s),i.__e!=o&&cm(i)),wi.length>t&&wi.sort(Vc));La.__r=0}function lm(e,t,n,i,r,o,a,s,c,l,p){var u,f,d,h,m,v=i&&i.__k||om,E=t.length;for(n.__d=c,_b(n,t,v),c=n.__d,u=0;u<E;u++)(d=n.__k[u])!=null&&typeof d!="boolean"&&typeof d!="function"&&(f=d.__i===-1?Wr:v[d.__i]||Wr,d.__i=u,Bl(e,d,f,r,o,a,s,c,l,p),h=d.__e,d.ref&&f.ref!=d.ref&&(f.ref&&$l(f.ref,null,d),p.push(d.ref,d.__c||h,d)),m==null&&h!=null&&(m=h),65536&d.__u||f.__k===d.__k?(c&&!c.isConnected&&(c=Ii(f)),c=um(d,c,e)):typeof d.type=="function"&&d.__d!==void 0?c=d.__d:h&&(c=h.nextSibling),d.__d=void 0,d.__u&=-196609);n.__d=c,n.__e=m}function _b(e,t,n){var i,r,o,a,s,c=t.length,l=n.length,p=l,u=0;for(e.__k=[],i=0;i<c;i++)a=i+u,(r=e.__k[i]=(r=t[i])==null||typeof r=="boolean"||typeof r=="function"?null:typeof r=="string"||typeof r=="number"||typeof r=="bigint"||r.constructor==String?Ca(null,r,null,null,null):Ll(r)?Ca(rs,{children:r},null,null,null):r.constructor===void 0&&r.__b>0?Ca(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):r)!=null?(r.__=e,r.__b=e.__b+1,s=bb(r,n,a,p),r.__i=s,o=null,s!==-1&&(p--,(o=n[s])&&(o.__u|=131072)),o==null||o.__v===null?(s==-1&&u--,typeof r.type!="function"&&(r.__u|=65536)):s!==a&&(s===a+1?u++:s>a?p>c-a?u+=s-a:u--:s<a?s==a-1&&(u=s-a):u=0,s!==i+u&&(r.__u|=65536))):(o=n[a])&&o.key==null&&o.__e&&!(131072&o.__u)&&(o.__e==e.__d&&(e.__d=Ii(o)),Yc(o,o,!1),n[a]=null,p--);if(p)for(i=0;i<l;i++)(o=n[i])!=null&&!(131072&o.__u)&&(o.__e==e.__d&&(e.__d=Ii(o)),Yc(o,o))}function um(e,t,n){var i,r;if(typeof e.type=="function"){for(i=e.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=e,t=um(i[r],t,n));return t}e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType===8);return t}function bb(e,t,n,i){var r=e.key,o=e.type,a=n-1,s=n+1,c=t[n];if(c===null||c&&r==c.key&&o===c.type&&!(131072&c.__u))return n;if(i>(c!=null&&!(131072&c.__u)?1:0))for(;a>=0||s<t.length;){if(a>=0){if((c=t[a])&&!(131072&c.__u)&&r==c.key&&o===c.type)return a;a--}if(s<t.length){if((c=t[s])&&!(131072&c.__u)&&r==c.key&&o===c.type)return s;s++}}return-1}function ef(e,t,n){t[0]==="-"?e.setProperty(t,n==null?"":n):e[t]=n==null?"":typeof n!="number"||yb.test(t)?n:n+"px"}function ea(e,t,n,i,r){var o;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||ef(e.style,t,"");if(n)for(t in n)i&&n[t]===i[t]||ef(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")o=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e||t==="onFocusOut"||t==="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=Nl,e.addEventListener(t,o?Wc:Uc,o)):e.removeEventListener(t,o?Wc:Uc,o);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t in e)try{e[t]=n==null?"":n;break e}catch(a){}typeof n=="function"||(n==null||n===!1&&t[4]!=="-"?e.removeAttribute(t):e.setAttribute(t,n))}}function tf(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Nl++;else if(t.t<n.u)return;return n(Fe.event?Fe.event(t):t)}}}function Bl(e,t,n,i,r,o,a,s,c,l){var p,u,f,d,h,m,v,E,w,_,x,P,A,C,I,T=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),o=[s=t.__e=n.__e]),(p=Fe.__b)&&p(t);e:if(typeof T=="function")try{if(E=t.props,w=(p=T.contextType)&&i[p.__c],_=p?w?w.props.value:p.__:i,n.__c?v=(u=t.__c=n.__c).__=u.__E:("prototype"in T&&T.prototype.render?t.__c=u=new T(E,_):(t.__c=u=new Ta(E,_),u.constructor=T,u.render=xb),w&&w.sub(u),u.props=E,u.state||(u.state={}),u.context=_,u.__n=i,f=u.__d=!0,u.__h=[],u._sb=[]),u.__s==null&&(u.__s=u.state),T.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Un({},u.__s)),Un(u.__s,T.getDerivedStateFromProps(E,u.__s))),d=u.props,h=u.state,u.__v=t,f)T.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(T.getDerivedStateFromProps==null&&E!==d&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(E,_),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(E,u.__s,_)===!1||t.__v===n.__v)){for(t.__v!==n.__v&&(u.props=E,u.state=u.__s,u.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(k){k&&(k.__=t)}),x=0;x<u._sb.length;x++)u.__h.push(u._sb[x]);u._sb=[],u.__h.length&&a.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(E,u.__s,_),u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(d,h,m)})}if(u.context=_,u.props=E,u.__P=e,u.__e=!1,P=Fe.__r,A=0,"prototype"in T&&T.prototype.render){for(u.state=u.__s,u.__d=!1,P&&P(t),p=u.render(u.props,u.state,u.context),C=0;C<u._sb.length;C++)u.__h.push(u._sb[C]);u._sb=[]}else do u.__d=!1,P&&P(t),p=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++A<25);u.state=u.__s,u.getChildContext!=null&&(i=Un(Un({},i),u.getChildContext())),f||u.getSnapshotBeforeUpdate==null||(m=u.getSnapshotBeforeUpdate(d,h)),lm(e,Ll(I=p!=null&&p.type===rs&&p.key==null?p.props.children:p)?I:[I],t,n,i,r,o,a,s,c,l),u.base=t.__e,t.__u&=-161,u.__h.length&&a.push(u),v&&(u.__E=u.__=null)}catch(k){t.__v=null,c||o!=null?(t.__e=s,t.__u|=c?160:32,o[o.indexOf(s)]=null):(t.__e=n.__e,t.__k=n.__k),Fe.__e(k,t,n)}else o==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Eb(n.__e,t,n,i,r,o,a,c,l);(p=Fe.diffed)&&p(t)}function pm(e,t,n){t.__d=void 0;for(var i=0;i<n.length;i++)$l(n[i],n[++i],n[++i]);Fe.__c&&Fe.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(o){o.call(r)})}catch(o){Fe.__e(o,r.__v)}})}function Eb(e,t,n,i,r,o,a,s,c){var l,p,u,f,d,h,m,v=n.props,E=t.props,w=t.type;if(w==="svg"?r="http://www.w3.org/2000/svg":w==="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),o!=null){for(l=0;l<o.length;l++)if((d=o[l])&&"setAttribute"in d==!!w&&(w?d.localName===w:d.nodeType===3)){e=d,o[l]=null;break}}if(e==null){if(w===null)return document.createTextNode(E);e=document.createElementNS(r,w,E.is&&E),o=null,s=!1}if(w===null)v===E||s&&e.data===E||(e.data=E);else{if(o=o&&is.call(e.childNodes),v=n.props||Wr,!s&&o!=null)for(v={},l=0;l<e.attributes.length;l++)v[(d=e.attributes[l]).name]=d.value;for(l in v)if(d=v[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=d;else if(l!=="key"&&!(l in E)){if(l=="value"&&"defaultValue"in E||l=="checked"&&"defaultChecked"in E)continue;ea(e,l,null,d,r)}}for(l in E)d=E[l],l=="children"?f=d:l=="dangerouslySetInnerHTML"?p=d:l=="value"?h=d:l=="checked"?m=d:l==="key"||s&&typeof d!="function"||v[l]===d||ea(e,l,d,v[l],r);if(p)s||u&&(p.__html===u.__html||p.__html===e.innerHTML)||(e.innerHTML=p.__html),t.__k=[];else if(u&&(e.innerHTML=""),lm(e,Ll(f)?f:[f],t,n,i,w==="foreignObject"?"http://www.w3.org/1999/xhtml":r,o,a,o?o[0]:n.__k&&Ii(n,0),s,c),o!=null)for(l=o.length;l--;)o[l]!=null&&am(o[l]);s||(l="value",h!==void 0&&(h!==e[l]||w==="progress"&&!h||w==="option"&&h!==v[l])&&ea(e,l,h,v[l],r),l="checked",m!==void 0&&m!==e[l]&&ea(e,l,m,v[l],r))}return e}function $l(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(i){Fe.__e(i,n)}}function Yc(e,t,n){var i,r;if(Fe.unmount&&Fe.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||$l(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){Fe.__e(o,t)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&Yc(i[r],t,n||typeof e.type!="function");n||e.__e==null||am(e.__e),e.__c=e.__=e.__e=e.__d=void 0}function xb(e,t,n){return this.constructor(e,n)}function fm(e,t,n){var i,r,o,a;Fe.__&&Fe.__(e,t),r=(i=typeof n=="function")?null:t.__k,o=[],a=[],Bl(t,e=(!i&&n||t).__k=sm(rs,null,[e]),r||Wr,Wr,t.namespaceURI,!i&&n?[n]:r?null:t.firstChild?is.call(t.childNodes):null,o,!i&&n?n:r?r.__e:t.firstChild,i,a),pm(o,e,a)}is=om.slice,Fe={__e:function(e,t,n,i){for(var r,o,a;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(e)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,i||{}),a=r.__d),a)return r.__E=r}catch(s){e=s}throw e}},im=0,Ta.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Un({},this.state),typeof e=="function"&&(e=e(Un({},n),this.props)),e&&Un(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Qp(this))},Ta.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Qp(this))},Ta.prototype.render=rs,wi=[],rm=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Vc=function(e,t){return e.__v.__b-t.__v.__b},La.__r=0,Nl=0,Uc=tf(!1),Wc=tf(!0);var dm=function(e,t,n,i){var r;t[0]=0;for(var o=1;o<t.length;o++){var a=t[o++],s=t[o]?(t[0]|=a?1:2,n[t[o++]]):t[++o];a===3?i[0]=s:a===4?i[1]=Object.assign(i[1]||{},s):a===5?(i[1]=i[1]||{})[t[++o]]=s:a===6?i[1][t[++o]]+=s+"":a?(r=e.apply(s,dm(e,s,n,["",null])),i.push(r),s[0]?t[0]|=2:(t[o-2]=0,t[o]=r)):i.push(s)}return i},nf=new Map;function wb(e){var t=nf.get(this);return t||(t=new Map,nf.set(this,t)),(t=dm(this,t.get(e)||(t.set(e,t=function(n){for(var i,r,o=1,a="",s="",c=[0],l=function(f){o===1&&(f||(a=a.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?c.push(0,f,a):o===3&&(f||a)?(c.push(3,f,a),o=2):o===2&&a==="..."&&f?c.push(4,f,0):o===2&&a&&!f?c.push(5,0,!0,a):o>=5&&((a||!f&&o===5)&&(c.push(o,0,a,r),o=6),f&&(c.push(o,f,0,r),o=6)),a=""},p=0;p<n.length;p++){p&&(o===1&&l(),l(p));for(var u=0;u<n[p].length;u++)i=n[p][u],o===1?i==="<"?(l(),c=[c],o=3):a+=i:o===4?a==="--"&&i===">"?(o=1,a=""):a=i+a[0]:s?i===s?s="":a+=i:i==='"'||i==="'"?s=i:i===">"?(l(),o=1):o&&(i==="="?(o=5,r=a,a=""):i==="/"&&(o<5||n[p][u+1]===">")?(l(),o===3&&(c=c[0]),o=c,(c=c[0]).push(2,0,o),o=0):i===" "||i==="	"||i===`
`||i==="\r"?(l(),o=2):a+=i),o===3&&a==="!--"&&(o=4,c=c[0])}return l(),c}(e)),t),arguments,[])).length>1?t:t[0]}var $e=wb.bind(sm),nr,je,mc,rf,Yr=0,hm=[],Pa=[],Ve=Fe,of=Ve.__b,af=Ve.__r,sf=Ve.diffed,cf=Ve.__c,lf=Ve.unmount,uf=Ve.__;function os(e,t){Ve.__h&&Ve.__h(je,e,Yr||t),Yr=0;var n=je.__H||(je.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:Pa}),n.__[e]}function vc(e){return Yr=1,Sb(vm,e)}function Sb(e,t,n){var i=os(nr++,2);if(i.t=e,!i.__c&&(i.__=[vm(void 0,t),function(s){var c=i.__N?i.__N[0]:i.__[0],l=i.t(c,s);c!==l&&(i.__N=[l,i.__[1]],i.__c.setState({}))}],i.__c=je,!je.u)){var r=function(s,c,l){if(!i.__c.__H)return!0;var p=i.__c.__H.__.filter(function(f){return!!f.__c});if(p.every(function(f){return!f.__N}))return!o||o.call(this,s,c,l);var u=!1;return p.forEach(function(f){if(f.__N){var d=f.__[0];f.__=f.__N,f.__N=void 0,d!==f.__[0]&&(u=!0)}}),!(!u&&i.__c.props===s)&&(!o||o.call(this,s,c,l))};je.u=!0;var o=je.shouldComponentUpdate,a=je.componentWillUpdate;je.componentWillUpdate=function(s,c,l){if(this.__e){var p=o;o=void 0,r(s,c,l),o=p}a&&a.call(this,s,c,l)},je.shouldComponentUpdate=r}return i.__N||i.__}function qc(e,t){var n=os(nr++,3);!Ve.__s&&Fl(n.__H,t)&&(n.__=e,n.i=t,je.__H.__h.push(n))}function Kc(e,t){var n=os(nr++,4);!Ve.__s&&Fl(n.__H,t)&&(n.__=e,n.i=t,je.__h.push(n))}function mm(e){return Yr=5,ir(function(){return{current:e}},[])}function ir(e,t){var n=os(nr++,7);return Fl(n.__H,t)?(n.__V=e(),n.i=t,n.__h=e,n.__V):n.__}function Tr(e,t){return Yr=8,ir(function(){return e},t)}function Cb(){for(var e;e=hm.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Ra),e.__H.__h.forEach(Xc),e.__H.__h=[]}catch(t){e.__H.__h=[],Ve.__e(t,e.__v)}}Ve.__b=function(e){je=null,of&&of(e)},Ve.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),uf&&uf(e,t)},Ve.__r=function(e){af&&af(e),nr=0;var t=(je=e.__c).__H;t&&(mc===je?(t.__h=[],je.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=Pa,n.__N=n.i=void 0})):(t.__h.forEach(Ra),t.__h.forEach(Xc),t.__h=[],nr=0)),mc=je},Ve.diffed=function(e){sf&&sf(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(hm.push(t)!==1&&rf===Ve.requestAnimationFrame||((rf=Ve.requestAnimationFrame)||Tb)(Cb)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==Pa&&(n.__=n.__V),n.i=void 0,n.__V=Pa})),mc=je=null},Ve.__c=function(e,t){t.some(function(n){try{n.__h.forEach(Ra),n.__h=n.__h.filter(function(i){return!i.__||Xc(i)})}catch(i){t.some(function(r){r.__h&&(r.__h=[])}),t=[],Ve.__e(i,n.__v)}}),cf&&cf(e,t)},Ve.unmount=function(e){lf&&lf(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{Ra(i)}catch(r){t=r}}),n.__H=void 0,t&&Ve.__e(t,n.__v))};var pf=typeof requestAnimationFrame=="function";function Tb(e){var t,n=function(){clearTimeout(i),pf&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,100);pf&&(t=requestAnimationFrame(n))}function Ra(e){var t=je,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),je=t}function Xc(e){var t=je;e.__c=e.__(),je=t}function Fl(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function vm(e,t){return typeof t=="function"?t(e):t}function gm(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=gm(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function Ba(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=gm(e))&&(i&&(i+=" "),i+=t);return i}function Pb(e){const{headerEntries:t,onSelect:n,selectedEntry:i,setSelectedEntry:r,title:o}=e,a=ir(()=>Rb(t),[t]);return $e`
    <div class="djs-popup-header">
      <h3 class="djs-popup-title" title=${o}>${o}</h3>
      ${a.map(s=>$e`
        <ul key=${s.id} class="djs-popup-header-group" data-header-group=${s.id}>

          ${s.entries.map(c=>$e`
            <li key=${c.id}>
              <${c.action?"button":"span"}
                class=${Ab(c,c===i)}
                onClick=${l=>c.action&&n(l,c)}
                title=${c.title||c.label}
                data-id=${c.id}
                onMouseEnter=${()=>c.action&&r(c)}
                onMouseLeave=${()=>c.action&&r(null)}
                onFocus=${()=>c.action&&r(c)}
                onBlur=${()=>c.action&&r(null)}
              >
                ${c.imageUrl&&$e`<img class="djs-popup-entry-icon" src=${c.imageUrl} alt="" />`||c.imageHtml&&$e`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:c.imageHtml}} />`}
                ${c.label?$e`
                  <span class="djs-popup-label">${c.label}</span>
                `:null}
              </${c.action?"button":"span"}>
            </li>
          `)}
        </ul>
      `)}
    </div>
  `}function Rb(e){return e.reduce((t,n)=>{const i=n.group||"default",r=t.find(o=>o.id===i);return r?r.entries.push(n):t.push({id:i,entries:[n]}),t},[])}function Ab(e,t){return Ba("entry",e.className,e.active?"active":"",e.disabled?"disabled":"",t?"selected":"")}function Ib(e){const{entry:t,selected:n,onMouseEnter:i,onMouseLeave:r,onAction:o}=e;return $e`
    <li
      class=${Ba("entry",{selected:n})}
      data-id=${t.id}
      title=${t.title||t.label}
      tabIndex="0"
      onClick=${o}
      onFocus=${i}
      onBlur=${r}
      onMouseEnter=${i}
      onMouseLeave=${r}
      onDragStart=${a=>o(a,t,"dragstart")}
      aria-role="button"
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${Ba("djs-popup-entry-name",t.className)}
        >
          ${t.imageUrl&&$e`<img class="djs-popup-entry-icon" src=${t.imageUrl} alt="" />`||t.imageHtml&&$e`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:t.imageHtml}} />`}

          ${t.label?$e`
            <span class="djs-popup-label">
              ${t.label}
            </span>
          `:null}
        </span>
        ${t.description&&$e`
          <span
            class="djs-popup-entry-description"
            title=${t.description}
          >
            ${t.description}
          </span>
        `}
      </div>
      ${t.documentationRef&&$e`
        <div class="djs-popup-entry-docs">
          <a
            href="${t.documentationRef}"
            onClick=${a=>a.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function Mb(e){const s=e,{selectedEntry:t,setSelectedEntry:n,entries:i}=s,r=fc(s,["selectedEntry","setSelectedEntry","entries"]),o=mm(),a=ir(()=>Db(i),[i]);return Kc(()=>{const c=o.current;if(!c)return;const l=c.querySelector(".selected");l&&kb(l)},[t]),$e`
    <div class="djs-popup-results" ref=${o}>
      ${a.map(c=>$e`
        ${c.name&&$e`
          <div key=${c.id} class="entry-header" title=${c.name}>
            ${c.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${c.id}>
          ${c.entries.map(l=>$e`
            <${Ib}
              key=${l.id}
              entry=${l}
              selected=${l===t}
              onMouseEnter=${()=>n(l)}
              onMouseLeave=${()=>n(null)}
              ...${r}
            />
          `)}
        </ul>
      `)}
    </div>
  `}function Db(e){const t=[],n=o=>t.find(a=>o.id===a.id),i=o=>!!n(o),r=o=>typeof o=="string"?{id:o}:o;return e.forEach(o=>{const a=o.group?r(o.group):{id:"default"};i(a)?n(a).entries.push(o):t.push(Re(re({},a),{entries:[o]}))}),t}function kb(e){typeof e.scrollIntoViewIfNeeded=="function"?e.scrollIntoViewIfNeeded():e.scrollIntoView({scrollMode:"if-needed",block:"nearest"})}function Ob(e){const{onClose:t,onSelect:n,className:i,headerEntries:r,position:o,title:a,width:s,scale:c,search:l,emptyPlaceholder:p,entries:u,onOpened:f,onClosed:d}=e,h=ir(()=>Pt(l)?u.length>5:!1,[l,u]),[m,v]=vc(""),E=Tr((B,X)=>{if(!h)return B;const Q=Ie=>{if(!X)return(Ie.rank||0)>=0;if(Ie.searchable===!1)return!1;const We=[Ie.description||"",Ie.label||"",Ie.search||""].map(Me=>Me.toLowerCase());return X.toLowerCase().split(/\s/g).every(Me=>We.some(U=>U.includes(Me)))};return B.filter(Q)},[h]),[w,_]=vc(E(u,m)),[x,P]=vc(w[0]),A=Tr(B=>{(!x||!B.includes(x))&&P(B[0]),_(B)},[x,_,P]);qc(()=>{A(E(u,m))},[m,u]);const C=Tr(B=>{let Q=w.indexOf(x)+B;Q<0&&(Q=w.length-1),Q>=w.length&&(Q=0),P(w[Q])},[w,x,P]),I=Tr(B=>{if(B.key==="Enter"&&x)return n(B,x);if(B.key==="ArrowUp")return C(-1),B.preventDefault();if(B.key==="ArrowDown")return C(1),B.preventDefault()},[n,x,C]),T=Tr(B=>{Ya(B.target,"input")&&v(()=>B.target.value)},[v]);qc(()=>(f(),()=>{d()}),[]);const k=ir(()=>a||r.length>0,[a,r]);return $e`
    <${ff}
      onClose=${t}
      onKeyup=${T}
      onKeydown=${I}
      className=${i}
      position=${o}
      width=${s}
      scale=${c}
    >
      ${k&&$e`
        <${Pb}
          headerEntries=${r}
          onSelect=${n}
          selectedEntry=${x}
          setSelectedEntry=${P}
          title=${a}
        />
      `}
      ${u.length>0&&$e`
        <div class="djs-popup-body">

          ${h&&$e`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input type="text" aria-label="${a}" />
          </div>
          `}

          <${Mb}
            entries=${w}
            selectedEntry=${x}
            setSelectedEntry=${P}
            onAction=${n}
          />
        </div>
      `}
    ${p&&w.length===0&&$e`
      <div class="djs-popup-no-results">${jt(p)?p(m):p}</div>
    `}
    </${ff}>
  `}function ff(e){const{onClose:t,onKeydown:n,onKeyup:i,className:r,children:o,position:a}=e,s=mm();return Kc(()=>{if(typeof a!="function")return;const c=s.current,l=a(c);c.style.left=`${l.x}px`,c.style.top=`${l.y}px`},[s.current,a]),Kc(()=>{const c=s.current;if(!c)return;(c.querySelector("input")||c).focus()},[]),qc(()=>{const c=p=>{if(p.key==="Escape")return p.preventDefault(),t()},l=p=>{if(!Zr(p.target,".djs-popup",!0))return t()};return document.documentElement.addEventListener("keydown",c),document.body.addEventListener("click",l),()=>{document.documentElement.removeEventListener("keydown",c),document.body.removeEventListener("click",l)}},[]),$e`
    <div
      class=${Ba("djs-popup",r)}
      style=${Nb(e)}
      onKeydown=${n}
      onKeyup=${i}
      ref=${s}
      tabIndex="-1"
    >
      ${o}
    </div>
  `}function Nb(e){return{transform:`scale(${e.scale})`,width:`${e.width}px`,"transform-origin":"top left"}}var Lb="data-id",ym=["contextPad.close","canvas.viewbox.changing","commandStack.changed"],Bb=1e3;function Oe(e,t,n){this._eventBus=t,this._canvas=n,this._current=null;var i=Pt(e&&e.scale)?e.scale:{min:1,max:1};this._config={scale:i},t.on("diagram.destroy",()=>{this.close()}),t.on("element.changed",r=>{const o=this.isOpen()&&this._current.target;r.element===o&&this.refresh()})}Oe.$inject=["config.popupMenu","eventBus","canvas"];Oe.prototype._render=function(){const{position:e,providerId:t,entries:n,headerEntries:i,emptyPlaceholder:r,options:o}=this._current,a=Object.entries(n).map(([f,d])=>re({id:f},d)),s=Object.entries(i).map(([f,d])=>re({id:f},d)),c=e&&(f=>this._ensureVisible(f,e)),l=this._updateScale(this._current.container);fm($e`
      <${Ob}
        onClose=${f=>this.close(f)}
        onSelect=${(f,d,h)=>this.trigger(f,d,h)}
        position=${c}
        className=${t}
        entries=${a}
        headerEntries=${s}
        emptyPlaceholder=${r}
        scale=${l}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${re({},o)}
      />
    `,this._current.container)};Oe.prototype.open=function(e,t,n,i){if(!e)throw new Error("target is missing");if(!t)throw new Error("providers for <"+t+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:r,headerEntries:o,emptyPlaceholder:a}=this._getContext(e,t);this._current={position:n,providerId:t,target:e,entries:r,headerEntries:o,emptyPlaceholder:a,container:this._createContainer({provider:t}),options:i},this._emit("open"),this._bindAutoClose(),this._render()};Oe.prototype.refresh=function(){if(!this.isOpen())return;const{target:e,providerId:t}=this._current,{entries:n,headerEntries:i,emptyPlaceholder:r}=this._getContext(e,t);this._current=Re(re({},this._current),{entries:n,headerEntries:i,emptyPlaceholder:r}),this._emit("refresh"),this._render()};Oe.prototype._getContext=function(e,t){const n=this._getProviders(t);if(!n||!n.length)throw new Error("provider for <"+t+"> not found");const i=this._getEntries(e,n),r=this._getHeaderEntries(e,n),o=this._getEmptyPlaceholder(n);return{entries:i,headerEntries:r,emptyPlaceholder:o,empty:!(Object.keys(i).length||Object.keys(r).length)}};Oe.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._current=null)};Oe.prototype.reset=function(){const e=this._current.container;fm(null,e),Qi(e)};Oe.prototype._emit=function(e,t){this._eventBus.fire(`popupMenu.${e}`,t)};Oe.prototype._onOpened=function(){this._emit("opened")};Oe.prototype._onClosed=function(){this._emit("closed")};Oe.prototype._createContainer=function(e){var t=this._canvas,n=t.getContainer();const i=_e(`<div class="djs-popup-parent djs-scrollable" data-popup=${e.provider}></div>`);return n.appendChild(i),i};Oe.prototype._bindAutoClose=function(){this._eventBus.once(ym,this.close,this)};Oe.prototype._unbindAutoClose=function(){this._eventBus.off(ym,this.close,this)};Oe.prototype._updateScale=function(){var e=this._canvas.zoom(),t=this._config.scale,n,i,r=e;return t!==!0&&(t===!1?(n=1,i=1):(n=t.min,i=t.max),Pt(n)&&e<n&&(r=n),Pt(i)&&e>i&&(r=i)),r};Oe.prototype._ensureVisible=function(e,t){var n=document.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect(),r={},o=t.x,a=t.y;return t.x+i.width>n.width&&(r.x=!0),t.y+i.height>n.height&&(r.y=!0),r.x&&r.y?(o=t.x-i.width,a=t.y-i.height):r.x?(o=t.x-i.width,a=t.y):r.y&&t.y<i.height?(o=t.x,a=10):r.y&&(o=t.x,a=t.y-i.height),t.y<n.top&&(a=t.y+i.height),{x:o,y:a}};Oe.prototype.isEmpty=function(e,t){if(!e)throw new Error("target is missing");if(!t)throw new Error("provider ID is missing");const n=this._getProviders(t);return!n||!n.length?!0:this._getContext(e,t).empty};Oe.prototype.registerProvider=function(e,t,n){n||(n=t,t=Bb),this._eventBus.on("popupMenu.getProviders."+e,t,function(i){i.providers.push(n)})};Oe.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"popupMenu.getProviders."+e,providers:[]});return this._eventBus.fire(t),t.providers};Oe.prototype._getEntries=function(e,t){var n={};return D(t,function(i){if(!i.getPopupMenuEntries){D(i.getEntries(e),function(o){var a=o.id;if(!a)throw new Error("entry ID is missing");n[a]=Sn(o,["id"])});return}var r=i.getPopupMenuEntries(e);jt(r)?n=r(n):D(r,function(o,a){n[a]=o})}),n};Oe.prototype._getHeaderEntries=function(e,t){var n={};return D(t,function(i){if(!i.getPopupMenuHeaderEntries){if(!i.getHeaderEntries)return;D(i.getHeaderEntries(e),function(o){var a=o.id;if(!a)throw new Error("entry ID is missing");n[a]=Sn(o,["id"])});return}var r=i.getPopupMenuHeaderEntries(e);jt(r)?n=r(n):D(r,function(o,a){n[a]=o})}),n};Oe.prototype._getEmptyPlaceholder=function(e){const t=e.find(n=>jt(n.getEmptyPlaceholder));return t&&t.getEmptyPlaceholder()};Oe.prototype.isOpen=function(){return!!this._current};Oe.prototype.trigger=function(e,t,n="click"){if(e.preventDefault(),!t){let r=Zr(e.delegateTarget||e.target,".entry",!0),o=ct(r,Lb);t=re({id:o},this._getEntry(o))}const i=t.action;if(this._emit("trigger",{entry:t,event:e})!==!1){if(jt(i)){if(n==="click")return i(e,t)}else if(i[n])return i[n](e,t)}};Oe.prototype._getEntry=function(e){var t=this._current.entries[e]||this._current.headerEntries[e];if(!t)throw new Error("entry not found");return t};const jl={__init__:["popupMenu"],popupMenu:["type",Oe]};var _m={align:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 2000">
              <line x1="200" y1="150" x2="200" y2="1850" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
              <rect x="500" y="150" width="1300" height="700" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="500" y="1150" width="700" height="700" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,bottom:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="1650" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="350" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="850" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,center:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="900" y1="150" x2="900" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="250" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="500" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,left:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="100" y1="150" x2="100" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="100" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="100" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,right:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="1650" y1="150" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="350" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="850" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,top:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="150" x2="1650" y2="150" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="150" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="150" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,middle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="900" x2="1650" y2="900" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="250" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="500" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`},$b=900;function ur(e,t,n,i){e.registerProvider($b,this),this._contextPad=e,this._popupMenu=t,this._translate=n,this._canvas=i}ur.$inject=["contextPad","popupMenu","translate","canvas"];ur.prototype.getMultiElementContextPadEntries=function(e){var t={};return this._isAllowed(e)&&N(t,this._getEntries(e)),t};ur.prototype._isAllowed=function(e){return!this._popupMenu.isEmpty(e,"align-elements")};ur.prototype._getEntries=function(){var e=this;return{"align-elements":{group:"align-elements",title:e._translate("Align elements"),html:`<div class="entry">${_m.align}</div>`,action:{click:function(t,n){var i=e._getMenuPosition(n);N(i,{cursor:{x:t.x,y:t.y}}),e._popupMenu.open(n,"align-elements",i)}}}}};ur.prototype._getMenuPosition=function(e){var t=5,n=this._contextPad.getPad(e).html,i=n.getBoundingClientRect(),r={x:i.left,y:i.bottom+t};return r};var Fb=["left","center","right","top","middle","bottom"];function ro(e,t,n,i){this._alignElements=t,this._translate=n,this._popupMenu=e,this._rules=i,e.registerProvider("align-elements",this)}ro.$inject=["popupMenu","alignElements","translate","rules"];ro.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&N(t,this._getEntries(e)),t};ro.prototype._isAllowed=function(e){return this._rules.allowed("elements.align",{elements:e})};ro.prototype._getEntries=function(e){var t=this._alignElements,n=this._translate,i=this._popupMenu,r={};return D(Fb,function(o){r["align-elements-"+o]={group:"align",title:n("Align elements "+o),className:"bjs-align-elements-menu-entry",imageHtml:_m[o],action:function(){t.trigger(e,o),i.close()}}}),r};function Gt(e){H.call(this,e),this.init()}Gt.$inject=["eventBus"];q(Gt,H);Gt.prototype.addRule=function(e,t,n){var i=this;typeof e=="string"&&(e=[e]),e.forEach(function(r){i.canExecute(r,t,function(o,a,s){return n(o)},!0)})};Gt.prototype.init=function(){};function as(e){Gt.call(this,e)}as.$inject=["eventBus"];q(as,Gt);as.prototype.init=function(){this.addRule("elements.align",function(e){var t=e.elements,n=pe(t,function(i){return!(i.waypoints||i.host||i.labelTarget)});return n=qa(n),n.length<2?!1:n})};const jb={__depends__:[pb,nm,jl],__init__:["alignElementsContextPadProvider","alignElementsMenuProvider","bpmnAlignElements"],alignElementsContextPadProvider:["type",ur],alignElementsMenuProvider:["type",ro],bpmnAlignElements:["type",as]};var Hb=10,bm=50,Gb=250;function Hl(e,t,n,i){for(var r;r=zb(e,n,t);)n=i(t,n,r);return n}function Gl(e){return function(t,n,i){var r={x:n.x,y:n.y};return["x","y"].forEach(function(o){var a=e[o];if(a){var s=o==="x"?"width":"height",c=a.margin,l=a.minDistance;c<0?r[o]=Math.min(i[o]+c-t[s]/2,n[o]-l+c):r[o]=Math.max(i[o]+i[s]+c+t[s]/2,n[o]+l+c)}}),r}}function zb(e,t,n){var i={x:t.x-n.width/2,y:t.y-n.height/2,width:n.width,height:n.height},r=Ub(e);return ke(r,function(o){if(o===n)return!1;var a=ut(o,i,Hb);return a==="intersect"})}function Vb(e,t){t||(t={});function n(h){return h.source===e?1:-1}var i=t.defaultDistance||bm,r=t.direction||"e",o=t.filter,a=t.getWeight||n,s=t.maxDistance||Gb,c=t.reference||"start";o||(o=qb);function l(h,m){return r==="n"?c==="start"?te(h).top-te(m).bottom:c==="center"?te(h).top-se(m).y:te(h).top-te(m).top:r==="w"?c==="start"?te(h).left-te(m).right:c==="center"?te(h).left-se(m).x:te(h).left-te(m).left:r==="s"?c==="start"?te(m).top-te(h).bottom:c==="center"?se(m).y-te(h).bottom:te(m).bottom-te(h).bottom:c==="start"?te(m).left-te(h).right:c==="center"?se(m).x-te(h).right:te(m).right-te(h).right}var p=e.incoming.filter(o).map(function(h){var m=a(h),v=m<0?l(h.source,e):l(e,h.source);return{id:h.source.id,distance:v,weight:m}}),u=e.outgoing.filter(o).map(function(h){var m=a(h),v=m>0?l(e,h.target):l(h.target,e);return{id:h.target.id,distance:v,weight:m}}),f=p.concat(u).reduce(function(h,m){return h[m.id+"__weight_"+m.weight]=m,h},{}),d=Zn(f,function(h,m){var v=m.distance,E=m.weight;return v<0||v>s||(h[String(v)]||(h[String(v)]=0),h[String(v)]+=1*E,(!h.distance||h[h.distance]<h[String(v)])&&(h.distance=v)),h},{});return d.distance||i}function Ub(e){var t=gc(e);return e.host&&(t=t.concat(gc(e.host))),e.attachers&&(t=t.concat(e.attachers.reduce(function(n,i){return n.concat(gc(i))},[]))),t}function gc(e){return Yb(e).concat(Wb(e))}function Wb(e){return e.incoming.map(function(t){return t.source})}function Yb(e){return e.outgoing.map(function(t){return t.target})}function qb(){return!0}var Kb=100;function Em(e,t,n){e.on("autoPlace",Kb,function(i){var r=i.shape,o=i.source;return Xb(o,r)}),e.on("autoPlace.end",function(i){n.scrollToElement(i.shape)}),this.append=function(i,r,o){e.fire("autoPlace.start",{source:i,shape:r});var a=e.fire("autoPlace",{source:i,shape:r}),s=t.appendShape(i,r,a,i.parent,o);return e.fire("autoPlace.end",{source:i,shape:s}),s}}Em.$inject=["eventBus","modeling","canvas"];function Xb(e,t,n){n||(n={});var i=n.defaultDistance||bm,r=se(e),o=te(e);return{x:o.right+i+t.width/2,y:r.y}}function xm(e,t){e.on("autoPlace.end",500,function(n){t.select(n.shape)})}xm.$inject=["eventBus","selection"];const Zb={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",Em],autoPlaceSelectionBehavior:["type",xm]};function qr(e,t){for(Ka(t)&&(t=[t]);e=e.parent;)if(le(e,t))return e;return null}function ss(e){var t=["bpmn:Participant","bpmn:Lane"],n=qr(e,t);return n?mt(n):le(e,t)?mt(e):!0}function wm(e,t){if(g(t,"bpmn:TextAnnotation"))return Qb(e,t);if(le(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"]))return eE(e,t);if(g(t,"bpmn:FlowNode"))return Jb(e,t)}function Jb(e,t){var n=te(e),i=se(e),r=ss(e),o=r?{directionHint:"e",minDistance:80,baseOrientation:"left",boundaryOrientation:"top",start:"top",end:"bottom"}:{directionHint:"s",minDistance:90,baseOrientation:"top",boundaryOrientation:"left",start:"left",end:"right"},a=Vb(e,{filter:function(d){return g(d,"bpmn:SequenceFlow")},direction:o.directionHint}),s=30,c=o.minDistance,l=o.baseOrientation;g(e,"bpmn:BoundaryEvent")&&(l=ut(e,e.host,-25),l.indexOf(o.boundaryOrientation)!==-1&&(s*=-1));var p=r?{x:n.right+a+t.width/2,y:i.y+df(l,c,o)}:{x:i.x+df(l,c,o),y:n.bottom+a+t.height/2},u={margin:s,minDistance:c},f=r?{y:u}:{x:u};return Hl(e,t,p,Gl(f))}function df(e,t,n){return e.includes(n.start)?-1*t:e.includes(n.end)?t:0}function Qb(e,t){var n=te(e),i=ss(e),r=i?{x:n.right+t.width/2,y:n.top-50-t.height/2}:{x:n.right+50+t.width/2,y:n.bottom+t.height/2};Te(e)&&(r=se(e),i?(r.x+=100,r.y-=50):(r.x+=100,r.y+=50));var o={margin:i?-30:30,minDistance:20},a=i?{y:o}:{x:o};return Hl(e,t,r,Gl(a))}function eE(e,t){var n=te(e),i=ss(e),r=i?{x:n.right-10+t.width/2,y:n.bottom+40+t.width/2}:{x:n.left-40-t.width/2,y:n.bottom-10+t.height/2},o={margin:30,minDistance:30},a=i?{x:o}:{y:o};return Hl(e,t,r,Gl(a))}function Sm(e){e.on("autoPlace",function(t){var n=t.shape,i=t.source;return wm(i,n)})}Sm.$inject=["eventBus"];const zl={__depends__:[Zb],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",Sm]};function Tn(e,t,n,i){H.call(this,e),this._elementRegistry=t,this._modeling=n,this._rules=i;var r=this;this.postExecuted(["shape.create"],function(o){var a=o.context,s=a.hints||{},c=a.shape,l=a.parent||a.newParent;s.autoResize!==!1&&r._expand([c],l)}),this.postExecuted(["elements.move"],function(o){var a=o.context,s=Na(Sl(a.closure.topLevel)),c=a.hints,l=c?c.autoResize:!0;if(l!==!1){var p=Xa(s,function(u){return u.parent.id});D(p,function(u,f){ve(l)&&(u=u.filter(function(d){return ke(l,En({id:d.id}))})),r._expand(u,f)})}}),this.postExecuted(["shape.toggleCollapse"],function(o){var a=o.context,s=a.hints,c=a.shape;s&&s.autoResize===!1||c.collapsed||r._expand(c.children||[],c)}),this.postExecuted(["shape.resize"],function(o){var a=o.context,s=a.hints,c=a.shape,l=c.parent;s&&s.autoResize===!1||l&&r._expand([c],l)})}Tn.$inject=["eventBus","elementRegistry","modeling","rules"];q(Tn,H);Tn.prototype._getOptimalBounds=function(e,t){var n=this.getOffset(t),i=this.getPadding(t),r=te(At(e)),o=te(t),a={};return r.top-o.top<i.top&&(a.top=r.top-n.top),r.left-o.left<i.left&&(a.left=r.left-n.left),o.right-r.right<i.right&&(a.right=r.right+n.right),o.bottom-r.bottom<i.bottom&&(a.bottom=r.bottom+n.bottom),Cl(N({},o,a))};Tn.prototype._expand=function(e,t){typeof t=="string"&&(t=this._elementRegistry.get(t));var n=this._rules.allowed("element.autoResize",{elements:e,target:t});if(n){var i=this._getOptimalBounds(e,t);if(tE(i,t)){var r=nE(pn(t,["x","y","width","height"]),i);this.resize(t,i,{autoResize:r});var o=t.parent;o&&this._expand([t],o)}}};Tn.prototype.getOffset=function(e){return{top:60,bottom:60,left:100,right:100}};Tn.prototype.getPadding=function(e){return{top:2,bottom:2,left:15,right:15}};Tn.prototype.resize=function(e,t,n){this._modeling.resizeShape(e,t,null,n)};function tE(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}function nE(e,t){var n="";return e=te(e),t=te(t),e.top>t.top&&(n=n.concat("n")),e.right<t.right&&(n=n.concat("w")),e.bottom<t.bottom&&(n=n.concat("s")),e.left>t.left&&(n=n.concat("e")),n}function cs(e){e.invoke(Tn,this)}cs.$inject=["injector"];q(cs,Tn);cs.prototype.resize=function(e,t,n){g(e,"bpmn:Participant")?this._modeling.resizeLane(e,t,null,n):this._modeling.resizeShape(e,t,null,n)};function oo(e){Gt.call(this,e);var t=this;this.addRule("element.autoResize",function(n){return t.canResize(n.elements,n.target)})}oo.$inject=["eventBus"];q(oo,Gt);oo.prototype.canResize=function(e,t){return!1};function ls(e,t){oo.call(this,e),this._modeling=t}q(ls,oo);ls.$inject=["eventBus","modeling"];ls.prototype.canResize=function(e,t){if(g(t.di,"bpmndi:BPMNPlane")||!g(t,"bpmn:Participant")&&!g(t,"bpmn:Lane")&&!g(t,"bpmn:SubProcess"))return!1;var n=!0;return D(e,function(i){if(g(i,"bpmn:Lane")||be(i)){n=!1;return}}),n};const iE={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",cs],bpmnAutoResizeProvider:["type",ls]};var hf=1500;function Cm(e,t,n){var i=this,r=n.get("dragging",!1);function o(a){if(!a.hover){var s=a.originalEvent,c=i._findTargetGfx(s),l=c&&e.get(c);c&&l&&(a.stopPropagation(),r.hover({element:l,gfx:c}),r.move(s))}}r&&t.on("drag.start",function(a){t.once("drag.move",hf,function(s){o(s)})}),function(){var a,s;t.on("element.hover",function(c){a=c.gfx,s=c.element}),t.on("element.hover",hf,function(c){s&&t.fire("element.out",{element:s,gfx:a})}),t.on("element.out",function(){a=null,s=null})}(),this._findTargetGfx=function(a){var s,c;if(a instanceof MouseEvent)return s=Hr(a),c=document.elementFromPoint(s.x,s.y),rE(c)}}Cm.$inject=["elementRegistry","eventBus","injector"];function rE(e){return Zr(e,"svg, .djs-element",!0)}const oE={__init__:["hoverFix"],hoverFix:["type",Cm]};var Vi=Math.round,mf="djs-drag-active";function gi(e){e.preventDefault()}function aE(e){return typeof TouchEvent!="undefined"&&e instanceof TouchEvent}function sE(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Tm(e,t,n,i){var r={threshold:5,trapClick:!0},o;function a(_){var x=t.viewbox(),P=t._container.getBoundingClientRect();return{x:x.x+(_.x-P.left)/x.scale,y:x.y+(_.y-P.top)/x.scale}}function s(_,x){x=x||o;var P=e.createEvent(N({},x.payload,x.data,{isTouch:x.isTouch}));return e.fire("drag."+_,P)===!1?!1:e.fire(x.prefix+"."+_,P)}function c(_){var x=_.filter(function(P){return i.get(P.id)});x.length&&n.select(x)}function l(_,x){var P=o.payload,A=o.displacement,C=o.globalStart,I=Hr(_),T=xn(I,C),k=o.localStart,B=a(I),X=xn(B,k);if(!o.active&&(x||sE(T)>o.threshold)){if(N(P,{x:Vi(k.x+A.x),y:Vi(k.y+A.y),dx:0,dy:0},{originalEvent:_}),s("start")===!1)return v();o.active=!0,o.keepSelection||(P.previousSelection=n.get(),n.select(null)),o.cursor&&Nh(o.cursor),t.addMarker(t.getRootElement(),mf)}dc(_),o.active&&(N(P,{x:Vi(B.x+A.x),y:Vi(B.y+A.y),dx:Vi(X.x),dy:Vi(X.y)},{originalEvent:_}),s("move"))}function p(_){var x,P=!0;o.active&&(_&&(o.payload.originalEvent=_,dc(_)),P=s("end")),P===!1&&s("rejected"),x=E(P!==!0),s("ended",x)}function u(_){Ke("Escape",_)&&(gi(_),v())}function f(_){var x;o.active&&(x=Jy(e),setTimeout(x,400),gi(_)),p(_)}function d(_){l(_)}function h(_){var x=o.payload;x.hoverGfx=_.gfx,x.hover=_.element,s("hover")}function m(_){s("out");var x=o.payload;x.hoverGfx=null,x.hover=null}function v(_){var x;if(o){var P=o.active;P&&s("cancel"),x=E(_),P&&s("canceled",x)}}function E(_){var x,P;s("cleanup"),Zy(),o.trapClick?P=f:P=p,K.unbind(document,"mousemove",l),K.unbind(document,"dragstart",gi),K.unbind(document,"selectstart",gi),K.unbind(document,"mousedown",P,!0),K.unbind(document,"mouseup",P,!0),K.unbind(document,"keyup",u),K.unbind(document,"touchstart",d,!0),K.unbind(document,"touchcancel",v,!0),K.unbind(document,"touchmove",l,!0),K.unbind(document,"touchend",p,!0),e.off("element.hover",h),e.off("element.out",m),t.removeMarker(t.getRootElement(),mf);var A=o.payload.previousSelection;return _!==!1&&A&&!n.get().length&&c(A),x=o,o=null,x}function w(_,x,P,A){o&&v(!1),typeof x=="string"&&(A=P,P=x,x=null),A=N({},r,A||{});var C=A.data||{},I,T,k,B,X;A.trapClick?B=f:B=p,_?(I=Oh(_)||_,T=Hr(_),dc(_),I.type==="dragstart"&&gi(I)):(I=null,T={x:0,y:0}),k=a(T),x||(x=k),X=aE(I),o=N({prefix:P,data:C,payload:{},globalStart:T,displacement:xn(x,k),localStart:k,isTouch:X},A),A.manual||(X?(K.bind(document,"touchstart",d,!0),K.bind(document,"touchcancel",v,!0),K.bind(document,"touchmove",l,!0),K.bind(document,"touchend",p,!0)):(K.bind(document,"mousemove",l),K.bind(document,"dragstart",gi),K.bind(document,"selectstart",gi),K.bind(document,"mousedown",B,!0),K.bind(document,"mouseup",B,!0)),K.bind(document,"keyup",u),e.on("element.hover",h),e.on("element.out",m)),s("init"),A.autoActivate&&l(_,!0)}e.on("diagram.destroy",v),this.init=w,this.move=l,this.hover=h,this.out=m,this.end=p,this.cancel=v,this.context=function(){return o},this.setOptions=function(_){N(r,_)}}Tm.$inject=["eventBus","canvas","selection","elementRegistry"];const Pn={__depends__:[oE,Cn],dragging:["type",Tm]};function pr(e,t,n){this._canvas=n,this._opts=N({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},e);var i=this;t.on("drag.move",function(r){var o=i._toBorderPoint(r);i.startScroll(o)}),t.on(["drag.cleanup"],function(){i.stopScroll()})}pr.$inject=["config.autoScroll","eventBus","canvas"];pr.prototype.startScroll=function(e){var t=this._canvas,n=this._opts,i=this,r=t.getContainer().getBoundingClientRect(),o=[e.x,e.y,r.width-e.x,r.height-e.y];this.stopScroll();for(var a=0,s=0,c=0;c<4;c++)cE(o[c],n.scrollThresholdOut[c],n.scrollThresholdIn[c])&&(c===0?a=n.scrollStep:c==1?s=n.scrollStep:c==2?a=-n.scrollStep:c==3&&(s=-n.scrollStep));(a!==0||s!==0)&&(t.scroll({dx:a,dy:s}),this._scrolling=setTimeout(function(){i.startScroll(e)},n.scrollRepeatTimeout))};function cE(e,t,n){return t<e&&e<n}pr.prototype.stopScroll=function(){clearTimeout(this._scrolling)};pr.prototype.setOptions=function(e){this._opts=N({},this._opts,e)};pr.prototype._toBorderPoint=function(e){var t=this._canvas._container.getBoundingClientRect(),n=Hr(e.originalEvent);return{x:n.x-t.left,y:n.y-t.top}};const lE={__depends__:[Pn],__init__:["autoScroll"],autoScroll:["type",pr]};function Vl(e){this._commandStack=e.get("commandStack",!1)}Vl.$inject=["injector"];Vl.prototype.allowed=function(e,t){var n=!0,i=this._commandStack;return i&&(n=i.canExecute(e,t)),n===void 0?!0:n};const hn={__init__:["rules"],rules:["type",Vl]};var ta=Math.round,uE=Math.max;function pE(e,t){var n=e.x,i=e.y;return[["M",n,i],["m",0,-t],["a",t,t,0,1,1,0,2*t],["a",t,t,0,1,1,0,-2*t],["z"]]}function fE(e){var t=[];return e.forEach(function(n,i){t.push([i===0?"M":"L",n.x,n.y])}),t}var Pm=10;function dE(e,t){var n,i;for(n=0;i=e[n];n++)if(Lh(i,t)<=Pm)return{point:e[n],bendpoint:!0,index:n};return null}function hE(e,t){var n=Qy(pE(t,Pm),fE(e)),i=n[0],r=n[n.length-1],o;return i?i!==r?i.segment2!==r.segment2?(o=uE(i.segment2,r.segment2)-1,{point:e[o],bendpoint:!0,index:o}):{point:{x:ta(i.x+r.x)/2,y:ta(i.y+r.y)/2},index:i.segment2}:{point:{x:ta(i.x),y:ta(i.y)},index:i.segment2}:null}function Zc(e,t){return dE(e,t)||hE(e,t)}function Rm(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function vf(e){return Math.atan((e[1].y-e[0].y)/(e[1].x-e[0].x))}function mE(e,t){return t?{x:Math.cos(t)*e.x-Math.sin(t)*e.y,y:Math.sin(t)*e.x+Math.cos(t)*e.y}:e}function vE(e,t,n){var i=[{n:e[0]-n[0],lambda:t[0]},{n:e[1]-n[1],lambda:t[1]}],r=i[0].n*t[0]+i[1].n*t[1],o=i[0].lambda*t[0]+i[1].lambda*t[1];return-r/o}function Ul(e,t){var n=t[0],i=t[1],r={x:i.x-n.x,y:i.y-n.y},o=vE([n.x,n.y],[r.x,r.y],[e.x,e.y]);return{x:n.x+o*r.x,y:n.y+o*r.y}}function Am(e,t){var n=Ul(e,t),i={x:n.x-e.x,y:n.y-e.y};return Rm(i)}function $a(e,t){return Rm({x:e.x-t.x,y:e.y-t.y})}var Im="djs-bendpoint",Mm="djs-segment-dragger";function gE(e,t){var n=Hr(t),i=e._container.getBoundingClientRect(),r;r={x:i.left,y:i.top};var o=e.viewbox();return{x:o.x+(n.x-r.x)/o.scale,y:o.y+(n.y-r.y)/o.scale}}function Jc(e,t,n){var i=gE(e,n),r=Zc(t,i);return r}function Qc(e,t){var n=de("g");Ae(n).add(Im),ge(e,n);var i=de("circle");ie(i,{cx:0,cy:0,r:4}),Ae(i).add("djs-visual"),ge(n,i);var r=de("circle");return ie(r,{cx:0,cy:0,r:10}),Ae(r).add("djs-hit"),ge(n,r),t&&Ae(n).add(t),n}function yE(e,t,n,i){var r=de("g");ge(e,r);var o=18,a=6,s=11,c=bE(t,n,i),l=a+s,p=de("rect");ie(p,{x:-o/2,y:-a/2,width:o,height:a}),Ae(p).add("djs-visual"),ge(r,p);var u=de("rect");return ie(u,{x:-c/2,y:-l/2,width:c,height:l}),Ae(u).add("djs-hit"),ge(r,u),e_(r,i==="v"?90:0),r}function Dm(e,t,n){var i=de("g"),r=Lc(t,n),o=bn(t,n);return ge(e,i),yE(i,t,n,o),Ae(i).add(Mm),Ae(i).add(o==="h"?"horizontal":"vertical"),dt(i,r.x,r.y),i}function el(e){return Math.abs(Math.round(e*2/3))}function _E(e,t){var n=EE(e,t);return Ul(e,n)}function bE(e,t,n){var i=t.x-e.x,r=t.y-e.y;return el(n==="h"?i:r)}function EE(e,t){for(var n=t.waypoints,i=1/0,r,o=0;o<n.length-1;o++){var a=n[o],s=n[o+1],c=Am(e,[a,s]);c<i&&(i=c,r=o)}return[n[r],n[r+1]]}function km(e,t,n,i,r){function o(_,x,P){var A=_.index,C=_.point,I,T,k,B,X,Q;return A<=0||_.bendpoint?!1:(I=x[A-1],T=x[A],k=Lc(I,T),B=bn(I,T),X=Math.abs(C.x-k.x),Q=Math.abs(C.y-k.y),B&&X<=P&&Q<=P)}function a(_,x){var P=_.waypoints,A,C,I,T;return x.index<=0||x.bendpoint||(A={start:P[x.index-1],end:P[x.index]},C=bn(A.start,A.end),!C)?null:(C==="h"?I=A.end.x-A.start.x:I=A.end.y-A.start.y,T=el(I)/2,T)}function s(_,x){var P=x.waypoints,A=Jc(t,P,_),C;if(A)return C=a(x,A),o(A,P,C)?r.start(_,x,A.index):i.start(_,x,A.index,!A.bendpoint),!0}function c(_,x,P){K.bind(_,x,function(A){n.triggerMouseEvent(x,A,P),A.stopPropagation()})}function l(_,x){var P=t.getLayer("overlays"),A=we('.djs-bendpoints[data-element-id="'+Ai(_.id)+'"]',P);return!A&&x&&(A=de("g"),ie(A,{"data-element-id":_.id}),Ae(A).add("djs-bendpoints"),ge(P,A),c(A,"mousedown",_),c(A,"click",_),c(A,"dblclick",_)),A}function p(_,x){return we('.djs-segment-dragger[data-segment-idx="'+_+'"]',x)}function u(_,x){x.waypoints.forEach(function(P,A){var C=Qc(_);ge(_,C),dt(C,P.x,P.y)}),Qc(_,"floating")}function f(_,x){for(var P=x.waypoints,A,C,I,T=1;T<P.length;T++)A=P[T-1],C=P[T],bn(A,C)&&(I=Dm(_,A,C),ie(I,{"data-segment-idx":T}),c(I,"mousemove",x))}function d(_){D(Yn("."+Im,_),function(x){Qe(x)})}function h(_){D(Yn("."+Mm,_),function(x){Qe(x)})}function m(_){var x=l(_);return x||(x=l(_,!0),u(x,_),f(x,_)),x}function v(_){var x=l(_);x&&(h(x),d(x),f(x,_),u(x,_))}function E(_,x){var P=we(".floating",_),A=x.point;P&&dt(P,A.x,A.y)}function w(_,x,P){var A=p(x.index,_),C=P[x.index-1],I=P[x.index],T=x.point,k=Lc(C,I),B=bn(C,I),X,Q;A&&(X=xE(A),Q={x:T.x-k.x,y:T.y-k.y},B==="v"&&(Q={x:Q.y,y:Q.x}),dt(X,Q.x,Q.y))}e.on("connection.changed",function(_){v(_.element)}),e.on("connection.remove",function(_){var x=l(_.element);x&&Qe(x)}),e.on("element.marker.update",function(_){var x=_.element,P;x.waypoints&&(P=m(x),_.add?Ae(P).add(_.marker):Ae(P).remove(_.marker))}),e.on("element.mousemove",function(_){var x=_.element,P=x.waypoints,A,C;if(P){if(A=l(x,!0),C=Jc(t,P,_.originalEvent),!C)return;E(A,C),C.bendpoint||w(A,C,P)}}),e.on("element.mousedown",function(_){if(Tl(_)){var x=_.originalEvent,P=_.element;if(P.waypoints)return s(x,P)}}),e.on("selection.changed",function(_){var x=_.newSelection,P=x[0];P&&P.waypoints&&m(P)}),e.on("element.hover",function(_){var x=_.element;x.waypoints&&(m(x),n.registerEvent(_.gfx,"mousemove","element.mousemove"))}),e.on("element.out",function(_){n.unregisterEvent(_.gfx,"mousemove","element.mousemove")}),e.on("element.updateId",function(_){var x=_.element,P=_.newId;if(x.waypoints){var A=l(x);A&&ie(A,{"data-element-id":P})}}),this.addHandles=m,this.updateHandles=v,this.getBendpointsContainer=l,this.getSegmentDragger=p}km.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];function xE(e){return we(".djs-visual",e)}var gf=Math.round,Ei="reconnectStart",xi="reconnectEnd",Pr="updateWaypoints";function Wl(e,t,n,i,r,o){this._injector=e,this.start=function(a,s,c,l){var p=n.getGraphics(s),u=s.source,f=s.target,d=s.waypoints,h;!l&&c===0?h=Ei:!l&&c===d.length-1?h=xi:h=Pr;var m=h===Pr?"connection.updateWaypoints":"connection.reconnect",v=r.allowed(m,{connection:s,source:u,target:f});v===!1&&(v=r.allowed(m,{connection:s,source:f,target:u})),v!==!1&&i.init(a,"bendpoint.move",{data:{connection:s,connectionGfx:p,context:{allowed:v,bendpointIndex:c,connection:s,source:u,target:f,insert:l,type:h}}})},t.on("bendpoint.move.hover",function(a){var s=a.context,c=s.connection,l=c.source,p=c.target,u=a.hover,f=s.type;s.hover=u;var d;if(u){var h=f===Pr?"connection.updateWaypoints":"connection.reconnect";if(d=s.allowed=r.allowed(h,{connection:c,source:f===Ei?u:l,target:f===xi?u:p}),d){s.source=f===Ei?u:l,s.target=f===xi?u:p;return}d===!1&&(d=s.allowed=r.allowed(h,{connection:c,source:f===xi?u:p,target:f===Ei?u:l})),d&&(s.source=f===xi?u:p,s.target=f===Ei?u:l)}}),t.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(a){var s=a.context,c=s.type;s.hover=null,s.source=null,s.target=null,c!==Pr&&(s.allowed=!1)}),t.on("bendpoint.move.end",function(a){var s=a.context,c=s.allowed,l=s.bendpointIndex,p=s.connection,u=s.insert,f=p.waypoints.slice(),d=s.source,h=s.target,m=s.type,v=s.hints||{},E={x:gf(a.x),y:gf(a.y)};if(!c)return!1;m===Pr?(u?f.splice(l,0,E):f[l]=E,v.bendpointMove={insert:u,bendpointIndex:l},f=this.cropWaypoints(p,f),o.updateWaypoints(p,t_(f),v)):(m===Ei?(v.docking="source",Fa(s)&&(v.docking="target",v.newWaypoints=f.reverse())):m===xi&&(v.docking="target",Fa(s)&&(v.docking="source",v.newWaypoints=f.reverse())),o.reconnect(p,d,h,E,v))},this)}Wl.$inject=["injector","eventBus","canvas","dragging","rules","modeling"];Wl.prototype.cropWaypoints=function(e,t){var n=this._injector.get("connectionDocking",!1);if(!n)return t;var i=e.waypoints;return e.waypoints=t,e.waypoints=n.getCroppedWaypoints(e),t=e.waypoints,e.waypoints=i,t};function Fa(e){var t=e.hover,n=e.source,i=e.target,r=e.type;if(r===Ei)return t&&i&&t===i&&n!==i;if(r===xi)return t&&n&&t===n&&n!==i}var wE="reconnectStart",SE="reconnectEnd",yf="updateWaypoints",Rr="connect-ok",na="connect-not-ok",_f="connect-hover",bf="djs-updating",Ef="djs-dragging",xf=1100;function Om(e,t,n,i){this._injector=t;var r=t.get("connectionPreview",!1);n.on("bendpoint.move.start",function(o){var a=o.context,s=a.bendpointIndex,c=a.connection,l=a.insert,p=c.waypoints,u=p.slice();a.waypoints=p,l&&u.splice(s,0,{x:o.x,y:o.y}),c.waypoints=u;var f=a.draggerGfx=Qc(i.getLayer("overlays"));Ae(f).add("djs-dragging"),i.addMarker(c,Ef),i.addMarker(c,bf)}),n.on("bendpoint.move.hover",function(o){var a=o.context,s=a.allowed,c=a.hover,l=a.type;if(c){if(i.addMarker(c,_f),l===yf)return;s?(i.removeMarker(c,na),i.addMarker(c,Rr)):s===!1&&(i.removeMarker(c,Rr),i.addMarker(c,na))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],xf,function(o){var a=o.context,s=a.hover,c=a.target;s&&(i.removeMarker(s,_f),i.removeMarker(s,c?Rr:na))}),n.on("bendpoint.move.move",function(o){var a=o.context,s=a.allowed,c=a.bendpointIndex,l=a.draggerGfx,p=a.hover,u=a.type,f=a.connection,d=f.source,h=f.target,m=f.waypoints.slice(),v={x:o.x,y:o.y},E=a.hints||{},w={};r&&(E.connectionStart&&(w.connectionStart=E.connectionStart),E.connectionEnd&&(w.connectionEnd=E.connectionEnd),u===wE?Fa(a)?(w.connectionEnd=w.connectionEnd||v,w.source=h,w.target=p||d,m=m.reverse()):(w.connectionStart=w.connectionStart||v,w.source=p||d,w.target=h):u===SE?Fa(a)?(w.connectionStart=w.connectionStart||v,w.source=p||h,w.target=d,m=m.reverse()):(w.connectionEnd=w.connectionEnd||v,w.source=d,w.target=p||h):(w.noCropping=!0,w.noLayout=!0,m[c]=v),u===yf&&(m=e.cropWaypoints(f,m)),w.waypoints=m,r.drawPreview(a,s,w)),dt(l,o.x,o.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],xf,function(o){var a=o.context,s=a.connection,c=a.draggerGfx,l=a.hover,p=a.target,u=a.waypoints;s.waypoints=u,Qe(c),i.removeMarker(s,bf),i.removeMarker(s,Ef),l&&(i.removeMarker(l,Rr),i.removeMarker(l,p?Rr:na)),r&&r.cleanUp(a)})}Om.$inject=["bendpointMove","injector","eventBus","canvas"];var wf="connect-hover",Sf="djs-updating";function Cf(e,t,n){return Yl(e,t,e[t]+n)}function Yl(e,t,n){return{x:t==="x"?n:e.x,y:t==="y"?n:e.y}}function CE(e,t,n,i){var r=Math.max(t[i],n[i]),o=Math.min(t[i],n[i]),a=20,s=Math.min(Math.max(o+a,e[i]),r-a);return Yl(t,i,s)}function Nm(e){return e==="x"?"y":"x"}function Tf(e,t,n){var i,r;return e.original?e.original:(i=se(t),r=Nm(n),Yl(e,r,i[r]))}function Lm(e,t,n,i,r,o){var a=e.get("connectionDocking",!1);this.start=function(u,f,d){var h,m=n.getGraphics(f),v=d-1,E=d,w=f.waypoints,_=w[v],x=w[E],P=Jc(n,w,u),A,C,I;A=bn(_,x),A&&(C=A==="v"?"x":"y",v===0&&(_=Tf(_,f.source,C)),E===w.length-1&&(x=Tf(x,f.target,C)),P?I=P.point:I={x:(_.x+x.x)/2,y:(_.y+x.y)/2},h={connection:f,segmentStartIndex:v,segmentEndIndex:E,segmentStart:_,segmentEnd:x,axis:C,dragPosition:I},i.init(u,I,"connectionSegment.move",{cursor:C==="x"?"resize-ew":"resize-ns",data:{connection:f,connectionGfx:m,context:h}}))};function s(u,f){if(!a)return f;var d=u.waypoints,h;return u.waypoints=f,h=a.getCroppedWaypoints(u),u.waypoints=d,h}function c(u){r.update("connection",u.connection,u.connectionGfx)}function l(u,f,d){var h=u.newWaypoints,m=u.segmentStartIndex+f,v=h[m],E=u.segmentEndIndex+f,w=h[E],_=Nm(u.axis),x=CE(d,v,w,_);dt(u.draggerGfx,x.x,x.y)}function p(u,f){var d=0,h=u.filter(function(m,v){return Bh(u[v-1],u[v+1],m)?(d=v<=f?d-1:d,!1):!0});return{waypoints:h,segmentOffset:d}}t.on("connectionSegment.move.start",function(u){var f=u.context,d=u.connection,h=n.getLayer("overlays");f.originalWaypoints=d.waypoints.slice(),f.draggerGfx=Dm(h,f.segmentStart,f.segmentEnd),Ae(f.draggerGfx).add("djs-dragging"),n.addMarker(d,Sf)}),t.on("connectionSegment.move.move",function(u){var f=u.context,d=f.connection,h=f.segmentStartIndex,m=f.segmentEndIndex,v=f.segmentStart,E=f.segmentEnd,w=f.axis,_=f.originalWaypoints.slice(),x=Cf(v,w,u["d"+w]),P=Cf(E,w,u["d"+w]),A=_.length,C=0;_[h]=x,_[m]=P;var I,T;h<2&&(I=ut(d.source,x),h===1?I==="intersect"&&(_.shift(),_[0]=x,C--):I!=="intersect"&&(_.unshift(v),C++)),m>A-3&&(T=ut(d.target,P),m===A-2?T==="intersect"&&(_.pop(),_[_.length-1]=P):T!=="intersect"&&_.push(E)),f.newWaypoints=d.waypoints=s(d,_),l(f,C,u),f.newSegmentStartIndex=h+C,c(u)}),t.on("connectionSegment.move.hover",function(u){u.context.hover=u.hover,n.addMarker(u.hover,wf)}),t.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(u){var f=u.context.hover;f&&n.removeMarker(f,wf)}),t.on("connectionSegment.move.cleanup",function(u){var f=u.context,d=f.connection;f.draggerGfx&&Qe(f.draggerGfx),n.removeMarker(d,Sf)}),t.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(u){var f=u.context,d=f.connection;d.waypoints=f.originalWaypoints,c(u)}),t.on("connectionSegment.move.end",function(u){var f=u.context,d=f.connection,h=f.newWaypoints,m=f.newSegmentStartIndex;h=h.map(function(P){return{original:P.original,x:Math.round(P.x),y:Math.round(P.y)}});var v=p(h,m),E=v.waypoints,w=s(d,E),_=v.segmentOffset,x={segmentMove:{segmentStartIndex:f.segmentStartIndex,newSegmentStartIndex:m+_}};o.updateWaypoints(d,w,x)})}Lm.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var TE=Math.abs,Pf=Math.round;function PE(e,t,n){n=n===void 0?10:n;var i,r;for(i=0;i<t.length;i++)if(r=t[i],TE(r-e)<=n)return r}function Bm(e){return{x:e.x,y:e.y}}function $m(e){return{x:e.x+e.width,y:e.y+e.height}}function Ft(e,t){return!e||isNaN(e.x)||isNaN(e.y)?t:{x:Pf(e.x+e.width/2),y:Pf(e.y+e.height/2)}}function rr(e,t){var n=e.snapped;return n?typeof t=="string"?n[t]:n.x&&n.y:!1}function He(e,t,n){if(typeof t!="string")throw new Error("axis must be in [x, y]");if(typeof n!="number"&&n!==!1)throw new Error("value must be Number or false");var i,r=e[t],o=e.snapped=e.snapped||{};return n===!1?o[t]=!1:(o[t]=!0,i=n-r,e[t]+=i,e["d"+t]+=i),r}function Fm(e){return e.children||[]}var RE=Math.abs,Rf=Math.round,yc=10;function jm(e){function t(o,a){if(ve(o)){for(var s=o.length;s--;)if(RE(o[s]-a)<=yc)return o[s]}else{o=+o;var c=a%o;if(c<yc)return a-c;if(c>o-yc)return a-c+o}return a}function n(o,a){if(o.waypoints)return _E(a,o);if(o.width)return{x:Rf(o.width/2+o.x),y:Rf(o.height/2+o.y)}}function i(o){var a=o.context,s=a.snapPoints,c=a.connection,l=c.waypoints,p=a.segmentStart,u=a.segmentStartIndex,f=a.segmentEnd,d=a.segmentEndIndex,h=a.axis;if(s)return s;var m=[l[u-1],p,f,l[d+1]];return u<2&&m.unshift(n(c.source,o)),d>l.length-3&&m.unshift(n(c.target,o)),a.snapPoints=s={horizontal:[],vertical:[]},D(m,function(v){v&&(v=v.original||v,h==="y"&&s.horizontal.push(v.y),h==="x"&&s.vertical.push(v.x))}),s}e.on("connectionSegment.move.move",1500,function(o){var a=i(o),s=o.x,c=o.y,l,p;if(a){l=t(a.vertical,s),p=t(a.horizontal,c);var u=s-l,f=c-p;N(o,{dx:o.dx-u,dy:o.dy-f,x:l,y:p}),(u||a.vertical.indexOf(s)!==-1)&&He(o,"x",l),(f||a.horizontal.indexOf(c)!==-1)&&He(o,"y",p)}});function r(o){var a=o.snapPoints,s=o.connection.waypoints,c=o.bendpointIndex;if(a)return a;var l=[s[c-1],s[c+1]];return o.snapPoints=a={horizontal:[],vertical:[]},D(l,function(p){p&&(p=p.original||p,a.horizontal.push(p.y),a.vertical.push(p.x))}),a}e.on(["connect.hover","connect.move","connect.end"],1500,function(o){var a=o.context,s=a.hover,c=s&&n(s,o);!Te(s)||!c||!c.x||!c.y||(He(o,"x",c.x),He(o,"y",c.y))}),e.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(o){var a=o.context,s=r(a),c=a.hover,l=c&&n(c,o),p=o.x,u=o.y,f,d;if(s){f=t(l?s.vertical.concat([l.x]):s.vertical,p),d=t(l?s.horizontal.concat([l.y]):s.horizontal,u);var h=p-f,m=u-d;N(o,{dx:o.dx-h,dy:o.dy-m,x:o.x-h,y:o.y-m}),(h||s.vertical.indexOf(p)!==-1)&&He(o,"x",f),(m||s.horizontal.indexOf(u)!==-1)&&He(o,"y",d)}})}jm.$inject=["eventBus"];const AE={__depends__:[Pn,hn],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",km],bendpointMove:["type",Wl],bendpointMovePreview:["type",Om],connectionSegmentMove:["type",Lm],bendpointSnapping:["type",jm]};function Hm(e,t,n,i){function r(a,s){return i.allowed("connection.create",{source:a,target:s})}function o(a,s){return r(s,a)}e.on("connect.hover",function(a){var s=a.context,c=s.start,l=a.hover,p;if(s.hover=l,p=s.canExecute=r(c,l),!Bc(p)){if(p!==!1){s.source=c,s.target=l;return}p=s.canExecute=o(c,l),!Bc(p)&&p!==!1&&(s.source=l,s.target=c)}}),e.on(["connect.out","connect.cleanup"],function(a){var s=a.context;s.hover=null,s.source=null,s.target=null,s.canExecute=!1}),e.on("connect.end",function(a){var s=a.context,c=s.canExecute,l=s.connectionStart,p={x:a.x,y:a.y},u=s.source,f=s.target;if(!c)return!1;var d=null,h={connectionStart:tl(s)?p:l,connectionEnd:tl(s)?l:p};fn(c)&&(d=c),s.connection=n.connect(u,f,d,h)}),this.start=function(a,s,c,l){fn(c)||(l=c,c=se(s)),t.init(a,"connect",{autoActivate:l,data:{shape:s,context:{start:s,connectionStart:c}}})}}Hm.$inject=["eventBus","dragging","modeling","rules"];function tl(e){var t=e.hover,n=e.source,i=e.target;return t&&n&&t===n&&n!==i}var IE=1100,ME=900,Af="connect-ok",If="connect-not-ok";function Gm(e,t,n){var i=e.get("connectionPreview",!1);i&&t.on("connect.move",function(r){var o=r.context,a=o.canExecute,s=o.hover,c=o.source,l=o.start,p=o.startPosition,u=o.target,f=o.connectionStart||p,d=o.connectionEnd||{x:r.x,y:r.y},h=f,m=d;tl(o)&&(h=d,m=f),i.drawPreview(o,a,{source:c||l,target:u||s,connectionStart:h,connectionEnd:m})}),t.on("connect.hover",ME,function(r){var o=r.context,a=r.hover,s=o.canExecute;s!==null&&n.addMarker(a,s?Af:If)}),t.on(["connect.out","connect.cleanup"],IE,function(r){var o=r.hover;o&&(n.removeMarker(o,Af),n.removeMarker(o,If))}),i&&t.on("connect.cleanup",function(r){i.cleanUp(r.context)})}Gm.$inject=["injector","eventBus","canvas"];const ql={__depends__:[Cn,hn,Pn],__init__:["connectPreview"],connect:["type",Hm],connectPreview:["type",Gm]};var DE="djs-dragger";function Rn(e,t,n,i){this._canvas=t,this._graphicsFactory=n,this._elementFactory=i,this._connectionDocking=e.get("connectionDocking",!1),this._layouter=e.get("layouter",!1)}Rn.$inject=["injector","canvas","graphicsFactory","elementFactory"];Rn.prototype.drawPreview=function(e,t,n){n=n||{};var i=e.connectionPreviewGfx,r=e.getConnection,o=n.source,a=n.target,s=n.waypoints,c=n.connectionStart,l=n.connectionEnd,p=n.noLayout,u=n.noCropping,f=n.noNoop,d,h=this;if(i||(i=e.connectionPreviewGfx=this.createConnectionPreviewGfx()),Za(i),r||(r=e.getConnection=kE(function(m,v,E){return h.getConnection(m,v,E)})),t&&(d=r(t,o,a)),!d){!f&&this.drawNoopPreview(i,n);return}d.waypoints=s||[],this._layouter&&!p&&(d.waypoints=this._layouter.layoutConnection(d,{source:o,target:a,connectionStart:c,connectionEnd:l,waypoints:n.waypoints||d.waypoints})),(!d.waypoints||!d.waypoints.length)&&(d.waypoints=[o?se(o):c,a?se(a):l]),this._connectionDocking&&(o||a)&&!u&&(d.waypoints=this._connectionDocking.getCroppedWaypoints(d,o,a)),this._graphicsFactory.drawConnection(i,d,{stroke:"var(--element-dragger-color)"})};Rn.prototype.drawNoopPreview=function(e,t){var n=t.source,i=t.target,r=t.connectionStart||se(n),o=t.connectionEnd||se(i),a=this.cropWaypoints(r,o,n,i),s=this.createNoopConnection(a[0],a[1]);ge(e,s)};Rn.prototype.cropWaypoints=function(e,t,n,i){var r=this._graphicsFactory,o=n&&r.getShapePath(n),a=i&&r.getShapePath(i),s=r.getConnectionPath({waypoints:[e,t]});return e=n&&$c(o,s,!0)||e,t=i&&$c(a,s,!1)||t,[e,t]};Rn.prototype.cleanUp=function(e){e&&e.connectionPreviewGfx&&Qe(e.connectionPreviewGfx)};Rn.prototype.getConnection=function(e){var t=OE(e);return this._elementFactory.createConnection(t)};Rn.prototype.createConnectionPreviewGfx=function(){var e=de("g");return ie(e,{pointerEvents:"none"}),Ae(e).add(DE),ge(this._canvas.getActiveLayer(),e),e};Rn.prototype.createNoopConnection=function(e,t){return n_([e,t],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};function kE(e){var t={};return function(n){var i=JSON.stringify(n),r=t[i];return r||(r=t[i]=e.apply(null,arguments)),r}}function OE(e){return fn(e)?e:{}}const NE={__init__:["connectionPreview"],connectionPreview:["type",Rn]};var LE=["marker-start","marker-mid","marker-end"],BE=["circle","ellipse","line","path","polygon","polyline","path","rect"];function Jn(e,t,n,i){this._elementRegistry=e,this._canvas=n,this._styles=i,this._clonedMarkers={};var r=this;t.on("drag.cleanup",function(){r.cleanUp()})}Jn.$inject=["elementRegistry","eventBus","canvas","styles"];Jn.prototype.cleanUp=function(){var e=this;D(e._clonedMarkers,function(t){Qe(t)}),e._clonedMarkers={}};Jn.prototype.getGfx=function(e){return this._elementRegistry.getGraphics(e)};Jn.prototype.addDragger=function(e,t,n,i="djs-dragger"){n=n||this.getGfx(e);var r=Pl(n),o=n.getBoundingClientRect();return this._cloneMarkers(Ti(r),i),ie(r,this._styles.cls(i,[],{x:o.top,y:o.left})),ge(t,r),ie(r,"data-preview-support-element-id",e.id),r};Jn.prototype.addFrame=function(e,t){var n=de("rect",{class:"djs-resize-overlay",width:e.width,height:e.height,x:e.x,y:e.y});return ge(t,n),ie(n,"data-preview-support-element-id",e.id),n};Jn.prototype._cloneMarkers=function(e,t="djs-dragger"){var n=this;if(e.childNodes)for(var i=0;i<e.childNodes.length;i++)n._cloneMarkers(e.childNodes[i],t);HE(e)&&LE.forEach(function(r){if(ie(e,r)){var o=$E(e,r,n._canvas.getContainer());n._cloneMarker(e,o,r,t)}})};Jn.prototype._cloneMarker=function(e,t,n,i="djs-dragger"){var r=t.id+"-"+i,o=this._clonedMarkers[r];if(!o){o=Pl(t);var a=r+"-clone";o.id=a,Ae(o).add(i),this._clonedMarkers[r]=o;var s=we("defs",this._canvas._svg);s||(s=de("defs"),ge(this._canvas._svg,s)),ge(s,o)}var c=jE(this._clonedMarkers[r].id);ie(e,n,c)};function $E(e,t,n){var i=FE(ie(e,t));return we("marker#"+i,n||document)}function FE(e){return e.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]}function jE(e){return"url(#"+e+")"}function HE(e){return BE.indexOf(e.nodeName)!==-1}const fr={__init__:["previewSupport"],previewSupport:["type",Jn]},ia="complex-preview";class zm{constructor(t,n,i){this._canvas=t,this._graphicsFactory=n,this._previewSupport=i,this._markers=[]}create(t){this.cleanUp();const{created:n=[],moved:i=[],removed:r=[],resized:o=[]}=t,a=this._canvas.getLayer(ia);n.filter(s=>!GE(s)).forEach(s=>{let c;Te(s)?(c=this._graphicsFactory._createContainer("connection",de("g")),this._graphicsFactory.drawConnection(Ti(c),s)):(c=this._graphicsFactory._createContainer("shape",de("g")),this._graphicsFactory.drawShape(Ti(c),s),dt(c,s.x,s.y)),this._previewSupport.addDragger(s,a,c)}),i.forEach(({element:s,delta:c})=>{this._previewSupport.addDragger(s,a,void 0,"djs-dragging"),this._canvas.addMarker(s,"djs-element-hidden"),this._markers.push([s,"djs-element-hidden"]);const l=this._previewSupport.addDragger(s,a);Te(s)?dt(l,c.x,c.y):dt(l,s.x+c.x,s.y+c.y)}),r.forEach(s=>{this._previewSupport.addDragger(s,a,void 0,"djs-dragging"),this._canvas.addMarker(s,"djs-element-hidden"),this._markers.push([s,"djs-element-hidden"])}),o.forEach(({shape:s,bounds:c})=>{this._canvas.addMarker(s,"djs-hidden"),this._markers.push([s,"djs-hidden"]),this._previewSupport.addDragger(s,a,void 0,"djs-dragging");const l=this._graphicsFactory._createContainer("shape",de("g"));this._graphicsFactory.drawShape(Ti(l),s,{width:c.width,height:c.height}),dt(l,c.x,c.y),this._previewSupport.addDragger(s,a,l)})}cleanUp(){Za(this._canvas.getLayer(ia)),this._markers.forEach(([t,n])=>this._canvas.removeMarker(t,n)),this._markers=[],this._previewSupport.cleanUp()}show(){this._canvas.showLayer(ia)}hide(){this._canvas.hideLayer(ia)}}zm.$inject=["canvas","graphicsFactory","previewSupport"];function GE(e){return e.hidden}const zE={__depends__:[fr],__init__:["complexPreview"],complexPreview:["type",zm]};var Kl=["top","bottom","left","right"],ra=10;function Xl(e,t){H.call(this,e),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],function(r){var o=r.context,a=o.connection,s=a.source,c=a.target,l=o.hints||{};l.createElementsBehavior!==!1&&(n(s),n(c))}),this.postExecuted(["label.create"],function(r){var o=r.context,a=o.shape,s=o.hints||{};s.createElementsBehavior!==!1&&n(a.labelTarget)}),this.postExecuted(["elements.create"],function(r){var o=r.context,a=o.elements,s=o.hints||{};s.createElementsBehavior!==!1&&a.forEach(function(c){n(c)})});function n(r){if(Ja(r)){var o=WE(r);o&&i(r,o)}}function i(r,o){var a=se(r),s=r.label,c=se(s);if(s.parent){var l=te(r),p;switch(o){case"top":p={x:a.x,y:l.top-ra-s.height/2};break;case"left":p={x:l.left-ra-s.width/2,y:a.y};break;case"bottom":p={x:a.x,y:l.bottom+ra+s.height/2};break;case"right":p={x:l.right+ra+s.width/2,y:a.y};break}var u=xn(p,c);t.moveShape(s,u)}}}q(Xl,H);Xl.$inject=["eventBus","modeling"];function VE(e){var t=e.host,n=se(e),i=ut(n,t),r;i.indexOf("-")>=0?r=i.split("-"):r=[i];var o=Kl.filter(function(a){return r.indexOf(a)===-1});return o}function UE(e){var t=se(e),n=[].concat(e.incoming.map(function(i){return i.waypoints[i.waypoints.length-2]}),e.outgoing.map(function(i){return i.waypoints[1]})).map(function(i){return Vm(t,i)});return n}function WE(e){var t=se(e.label),n=se(e),i=Vm(n,t);if(YE(i)){var r=UE(e);if(e.host){var o=VE(e);r=r.concat(o)}var a=Kl.filter(function(s){return r.indexOf(s)===-1});if(a.indexOf(i)===-1)return a[0]}}function Vm(e,t){return ut(t,e,5)}function YE(e){return Kl.indexOf(e)!==-1}function Zl(e){H.call(this,e),this.preExecute("shape.append",function(t){var n=t.source,i=t.shape;t.position||(g(i,"bpmn:TextAnnotation")?t.position={x:n.x+n.width/2+75,y:n.y-50-i.height/2}:t.position={x:n.x+n.width+80+i.width/2,y:n.y+n.height/2})},!0)}q(Zl,H);Zl.$inject=["eventBus"];function Jl(e,t){e.invoke(H,this),this.postExecute("shape.move",function(n){var i=n.newParent,r=n.shape,o=pe(r.incoming.concat(r.outgoing),function(a){return g(a,"bpmn:Association")});D(o,function(a){t.moveConnection(a,{x:0,y:0},i)})},!0)}q(Jl,H);Jl.$inject=["injector","modeling"];var Mf=500;function us(e,t){t.invoke(H,this),this._bpmnReplace=e;var n=this;this.postExecuted("elements.create",Mf,function(i){var r=i.elements;r=r.filter(function(o){var a=o.host;return Df(o,a)}),r.length===1&&r.map(function(o){return r.indexOf(o)}).forEach(function(o){var a=r[o];i.elements[o]=n._replaceShape(r[o],a)})},!0),this.preExecute("elements.move",Mf,function(i){var r=i.shapes,o=i.newHost;if(r.length===1){var a=r[0];Df(a,o)&&(i.shapes=[n._replaceShape(a,o)])}},!0)}us.$inject=["bpmnReplace","injector"];q(us,H);us.prototype._replaceShape=function(e,t){var n=qE(e),i={type:"bpmn:BoundaryEvent",host:t};return n&&(i.eventDefinitionType=n.$type),this._bpmnReplace.replaceElement(e,i,{layoutConnection:!1})};function qE(e){var t=z(e),n=t.eventDefinitions;return n&&n[0]}function Df(e,t){return!be(e)&&le(e,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!t}function Ql(e,t){H.call(this,e);function n(i){return pe(i.attachers,function(r){return g(r,"bpmn:BoundaryEvent")})}this.postExecute("connection.create",function(i){var r=i.context.source,o=i.context.target,a=n(o);g(r,"bpmn:EventBasedGateway")&&g(o,"bpmn:ReceiveTask")&&a.length>0&&t.removeElements(a)}),this.postExecute("connection.reconnect",function(i){var r=i.context.oldSource,o=i.context.newSource;g(r,"bpmn:Gateway")&&g(o,"bpmn:EventBasedGateway")&&D(o.outgoing,function(a){var s=a.target,c=n(s);g(s,"bpmn:ReceiveTask")&&c.length>0&&t.removeElements(c)})})}Ql.$inject=["eventBus","modeling"];q(Ql,H);function eu(e,t,n){H.call(this,e),this.preExecute("shape.replace",s,!0),this.postExecuted("shape.replace",c,!0),this.preExecute("connection.create",r,!0),this.postExecuted("connection.delete",i,!0),this.postExecuted("connection.reconnect",o,!0),this.postExecuted("element.updateProperties",a,!0);function i(v){const E=v.source,w=v.target;Ui(E)&&Ar(w)&&p(w)}function r(v){const E=v.connection,w=v.source,_=v.target;Ui(w)&&oa(_)&&(l(_),f(w,[E]))}function o(v){const E=v.newTarget,w=v.oldSource,_=v.oldTarget;if(_!==E){const x=w;Ar(_)&&p(_),Ui(x)&&oa(E)&&l(E)}}function a(v){const{element:E}=v;Ar(E)?(u(E),d(E)):oa(E)&&h(E)}function s(v){const{newData:E,oldShape:w}=v;if(Ui(v.oldShape)&&E.eventDefinitionType!=="bpmn:CompensateEventDefinition"||E.type!=="bpmn:BoundaryEvent"){const _=w.outgoing.find(({target:x})=>Ar(x));_&&_.target&&(v._connectionTarget=_.target)}else if(!Ui(v.oldShape)&&E.eventDefinitionType==="bpmn:CompensateEventDefinition"&&E.type==="bpmn:BoundaryEvent"){const _=w.outgoing.find(({target:x})=>oa(x));_&&_.target&&(v._connectionTarget=_.target),m(w)}}function c(v){const{_connectionTarget:E,newShape:w}=v;E&&t.connect(w,E)}function l(v){t.updateProperties(v,{isForCompensation:!0})}function p(v){t.updateProperties(v,{isForCompensation:void 0})}function u(v){for(const E of v.incoming)n.canConnect(E.source,v)||t.removeConnection(E);for(const E of v.outgoing)n.canConnect(v,E.target)||t.removeConnection(E)}function f(v,E){v.outgoing.filter(x=>g(x,"bpmn:Association")).filter(x=>Ar(x.target)&&!E.includes(x)).forEach(x=>t.removeConnection(x))}function d(v){const E=v.attachers.slice();E.length&&t.removeElements(E)}function h(v){const E=v.incoming.filter(w=>Ui(w.source));t.removeElements(E)}function m(v){const E=v.outgoing.filter(w=>g(w,"bpmn:SequenceFlow"));t.removeElements(E)}}q(eu,H);eu.$inject=["eventBus","modeling","bpmnRules"];function Ar(e){const t=z(e);return t&&t.get("isForCompensation")}function Ui(e){return e&&g(e,"bpmn:BoundaryEvent")&&$h(e,"bpmn:CompensateEventDefinition")}function oa(e){return e&&g(e,"bpmn:Activity")&&!ht(e)}function tu(e){e.invoke(H,this),this.preExecute("shape.create",1500,function(t){var n=t.context,i=n.parent,r=n.shape;g(i,"bpmn:Lane")&&!g(r,"bpmn:Lane")&&(n.parent=qr(i,"bpmn:Participant"))})}tu.$inject=["injector"];q(tu,H);function nu(e,t){H.call(this,e),this.preExecute("shape.create",function(n){var i=n.context,r=i.shape;if(g(r,"bpmn:DataObjectReference")&&r.type!=="label"){var o=t.create("bpmn:DataObject");r.businessObject.dataObjectRef=o}})}nu.$inject=["eventBus","bpmnFactory"];q(nu,H);var nl=20,il=20,Um=30,aa=2e3;function iu(e,t,n){H.call(this,t),t.on(["create.start","shape.move.start"],aa,function(r){var o=r.context,a=o.shape,s=e.getRootElement();if(!(!g(a,"bpmn:Participant")||!g(s,"bpmn:Process")||!s.children.length)){var c=s.children.filter(function(u){return!g(u,"bpmn:Group")&&!be(u)&&!Te(u)});if(c.length){var l=At(c),p=KE(a,l);N(a,p),o.createConstraints=XE(a,l)}}}),t.on("create.start",aa,function(r){var o=r.context,a=o.shape,s=e.getRootElement(),c=e.getGraphics(s);function l(p){p.element=s,p.gfx=c}g(a,"bpmn:Participant")&&g(s,"bpmn:Process")&&(t.on("element.hover",aa,l),t.once("create.cleanup",function(){t.off("element.hover",l)}))});function i(){var r=e.getRootElement();return g(r,"bpmn:Collaboration")?r:n.makeCollaboration()}this.preExecute("elements.create",aa,function(r){var o=r.elements,a=r.parent,s=ZE(o),c;s&&g(a,"bpmn:Process")&&(r.parent=i(),c=r.hints=r.hints||{},c.participant=s,c.process=a,c.processRef=z(s).get("processRef"))},!0),this.preExecute("shape.create",function(r){var o=r.parent,a=r.shape;g(a,"bpmn:Participant")&&g(o,"bpmn:Process")&&(r.parent=i(),r.process=o,r.processRef=z(a).get("processRef"))},!0),this.execute("shape.create",function(r){var o=r.hints||{},a=r.process||o.process,s=r.shape,c=o.participant;a&&(!c||s===c)&&z(s).set("processRef",z(a))},!0),this.revert("shape.create",function(r){var o=r.hints||{},a=r.process||o.process,s=r.processRef||o.processRef,c=r.shape,l=o.participant;a&&(!l||c===l)&&z(c).set("processRef",s)},!0),this.postExecute("shape.create",function(r){var o=r.hints||{},a=r.process||r.hints.process,s=r.shape,c=o.participant;if(a){var l=a.children.slice();c?s===c&&n.moveElements(l,{x:0,y:0},c):n.moveElements(l,{x:0,y:0},s)}},!0)}iu.$inject=["canvas","eventBus","modeling"];q(iu,H);function KE(e,t){t={width:t.width+nl*2+Um,height:t.height+il*2};var n=Math.max(e.width,t.width),i=Math.max(e.height,t.height);return{x:-n/2,y:-i/2,width:n,height:i}}function XE(e,t){return t=te(t),{bottom:t.top+e.height/2-il,left:t.right-e.width/2+nl,top:t.bottom-e.height/2+il,right:t.left+e.width/2-nl-Um}}function ZE(e){return ke(e,function(t){return g(t,"bpmn:Participant")})}var kf="__targetRef_placeholder";function ru(e,t){H.call(this,e),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],Of(o)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],Of(o));function n(a,s,c){var l=a.get("dataInputAssociations");return ke(l,function(p){return p!==c&&p.targetRef===s})}function i(a,s){var c=a.get("properties"),l=ke(c,function(p){return p.name===kf});return!l&&s&&(l=t.create("bpmn:Property",{name:kf}),Xe(c,l)),l}function r(a,s){var c=i(a);c&&(n(a,c,s)||Ue(a.get("properties"),c))}function o(a){var s=a.context,c=s.connection,l=c.businessObject,p=c.target,u=p&&p.businessObject,f=s.newTarget,d=f&&f.businessObject,h=s.oldTarget||s.target,m=h&&h.businessObject,v=c.businessObject,E;m&&m!==u&&r(m,l),d&&d!==u&&r(d,l),u?(E=i(u,!0),v.targetRef=E):v.targetRef=null}}ru.$inject=["eventBus","bpmnFactory"];q(ru,H);function Of(e){return function(t){var n=t.context,i=n.connection;if(g(i,"bpmn:DataInputAssociation"))return e(t)}}function ps(e){this._bpmnUpdater=e}ps.$inject=["bpmnUpdater"];ps.prototype.execute=function(e){var t=e.dataStoreBo,n=e.dataStoreDi,i=e.newSemanticParent,r=e.newDiParent;return e.oldSemanticParent=t.$parent,e.oldDiParent=n.$parent,this._bpmnUpdater.updateSemanticParent(t,i),this._bpmnUpdater.updateDiParent(n,r),[]};ps.prototype.revert=function(e){var t=e.dataStoreBo,n=e.dataStoreDi,i=e.oldSemanticParent,r=e.oldDiParent;return this._bpmnUpdater.updateSemanticParent(t,i),this._bpmnUpdater.updateDiParent(n,r),[]};function ou(e,t,n,i){H.call(this,i),t.registerHandler("dataStore.updateContainment",ps);function r(){return n.filter(function(s){return g(s,"bpmn:Participant")&&z(s).processRef})[0]}function o(s){return s.children.filter(function(c){return g(c,"bpmn:DataStoreReference")&&!c.labelTarget})}function a(s,c){var l=s.businessObject||s;if(c=c||r(),c){var p=c.businessObject||c;t.execute("dataStore.updateContainment",{dataStoreBo:l,dataStoreDi:Se(s),newSemanticParent:p.processRef||p,newDiParent:Se(c)})}}this.preExecute("shape.create",function(s){var c=s.context,l=c.shape;g(l,"bpmn:DataStoreReference")&&l.type!=="label"&&(c.hints||(c.hints={}),c.hints.autoResize=!1)}),this.preExecute("elements.move",function(s){var c=s.context,l=c.shapes,p=l.filter(function(u){return g(u,"bpmn:DataStoreReference")});p.length&&(c.hints||(c.hints={}),c.hints.autoResize=l.filter(function(u){return!g(u,"bpmn:DataStoreReference")}))}),this.postExecute("shape.create",function(s){var c=s.context,l=c.shape,p=l.parent;g(l,"bpmn:DataStoreReference")&&l.type!=="label"&&g(p,"bpmn:Collaboration")&&a(l)}),this.postExecute("shape.move",function(s){var c=s.context,l=c.shape,p=c.oldParent,u=l.parent;if(!g(p,"bpmn:Collaboration")&&g(l,"bpmn:DataStoreReference")&&l.type!=="label"&&g(u,"bpmn:Collaboration")){var f=g(p,"bpmn:Participant")?p:QE(p,"bpmn:Participant");a(l,f)}}),this.postExecute("shape.delete",function(s){var c=s.context,l=c.shape,p=e.getRootElement();le(l,["bpmn:Participant","bpmn:SubProcess"])&&g(p,"bpmn:Collaboration")&&o(p).filter(function(u){return JE(u,l)}).forEach(function(u){a(u)})}),this.postExecute("canvas.updateRoot",function(s){var c=s.context,l=c.oldRoot,p=c.newRoot,u=o(l);u.forEach(function(f){g(p,"bpmn:Process")&&a(f,p)})})}ou.$inject=["canvas","commandStack","elementRegistry","eventBus"];q(ou,H);function JE(e,t){for(var n=e.businessObject||e,i=t.businessObject||t;n.$parent;){if(n.$parent===i.processRef||i)return!0;n=n.$parent}return!1}function QE(e,t){for(;e.parent;){if(g(e.parent,t))return e.parent;e=e.parent}}var ja=Math.max,Ha=Math.min,ex=20;function Wm(e,t){return{top:e.top-t.top,right:e.right-t.right,bottom:e.bottom-t.bottom,left:e.left-t.left}}function tx(e,t,n){var i=n.x,r=n.y,o={x:e.x,y:e.y,width:e.width,height:e.height};return t.indexOf("n")!==-1?(o.y=e.y+r,o.height=e.height-r):t.indexOf("s")!==-1&&(o.height=e.height+r),t.indexOf("e")!==-1?o.width=e.width+i:t.indexOf("w")!==-1&&(o.x=e.x+i,o.width=e.width-i),o}function nx(e,t){return{x:e.x+(t.left||0),y:e.y+(t.top||0),width:e.width-(t.left||0)+(t.right||0),height:e.height-(t.top||0)+(t.bottom||0)}}function sa(e,t,n){var i=t[e],r=n.min&&n.min[e],o=n.max&&n.max[e];return ue(r)&&(i=(/top|left/.test(e)?Ha:ja)(i,r)),ue(o)&&(i=(/top|left/.test(e)?ja:Ha)(i,o)),i}function ix(e,t){if(!t)return e;var n=te(e);return Cl({top:sa("top",n,t),right:sa("right",n,t),bottom:sa("bottom",n,t),left:sa("left",n,t)})}function rx(e,t,n,i){var r=te(t),o={top:/n/.test(e)?r.bottom-n.height:r.top,left:/w/.test(e)?r.right-n.width:r.left,bottom:/s/.test(e)?r.top+n.height:r.bottom,right:/e/.test(e)?r.left+n.width:r.right},a=i?te(i):o,s={top:Ha(o.top,a.top),left:Ha(o.left,a.left),bottom:ja(o.bottom,a.bottom),right:ja(o.right,a.right)};return Cl(s)}function Ir(e,t){return typeof e!="undefined"?e:ex}function ox(e,t){var n,i,r,o;return typeof t=="object"?(n=Ir(t.left),i=Ir(t.right),r=Ir(t.top),o=Ir(t.bottom)):n=i=r=o=Ir(t),{x:e.x-n,y:e.y-r,width:e.width+n+i,height:e.height+r+o}}function ax(e){return!(e.waypoints||e.type==="label")}function Ym(e,t){var n;if(e.length===void 0?n=pe(e.children,ax):n=e,n.length)return ox(At(n),t)}var Fn=Math.abs;function sx(e,t){return Wm(te(t),te(e))}var cx=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],Bt=30;function fs(e,t){return t=t||[],e.children.filter(function(n){g(n,"bpmn:Lane")&&(fs(n,t),t.push(n))}),t}function Qn(e){return e.children.filter(function(t){return g(t,"bpmn:Lane")})}function $t(e){return qr(e,cx)||e}function lx(e,t){var n=$t(e),i=g(n,"bpmn:Process")?[]:[n],r=fs(n,i),o=te(e),a=te(t),s=sx(e,t),c=[],l=mt(e);return r.forEach(function(p){if(p!==e){var u=l?0:s.top,f=l?s.right:0,d=l?0:s.bottom,h=l?s.left:0,m=te(p);s.top&&(Fn(m.bottom-o.top)<10&&(d=a.top-m.bottom),Fn(m.top-o.top)<5&&(u=a.top-m.top)),s.left&&(Fn(m.right-o.left)<10&&(f=a.left-m.right),Fn(m.left-o.left)<5&&(h=a.left-m.left)),s.bottom&&(Fn(m.top-o.bottom)<10&&(u=a.bottom-m.top),Fn(m.bottom-o.bottom)<5&&(d=a.bottom-m.bottom)),s.right&&(Fn(m.left-o.right)<10&&(h=a.right-m.left),Fn(m.right-o.right)<5&&(f=a.right-m.right)),(u||f||d||h)&&c.push({shape:p,newBounds:nx(p,{top:u,right:f,bottom:d,left:h})})}}),c}var ux=500;function au(e,t){H.call(this,e);function n(i,r){var o=mt(i),a=Qn(r),s=[],c=[],l=[],p=[];if(Qa(a,function(v){return o?v.y>i.y?c.push(v):s.push(v):v.x>i.x?p.push(v):l.push(v),v.children}),!!a.length){var u;o?c.length&&s.length?u=i.height/2:u=i.height:p.length&&l.length?u=i.width/2:u=i.width;var f,d,h,m;s.length&&(f=t.calculateAdjustments(s,"y",u,i.y-10),t.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:u},"s")),c.length&&(d=t.calculateAdjustments(c,"y",-u,i.y+i.height+10),t.makeSpace(d.movingShapes,d.resizingShapes,{x:0,y:-u},"n")),l.length&&(h=t.calculateAdjustments(l,"x",u,i.x-10),t.makeSpace(h.movingShapes,h.resizingShapes,{x:u,y:0},"e")),p.length&&(m=t.calculateAdjustments(p,"x",-u,i.x+i.width+10),t.makeSpace(m.movingShapes,m.resizingShapes,{x:-u,y:0},"w"))}}this.postExecuted("shape.delete",ux,function(i){var r=i.context,o=r.hints,a=r.shape,s=r.oldParent;g(a,"bpmn:Lane")&&(o&&o.nested||n(a,s))})}au.$inject=["eventBus","spaceTool"];q(au,H);var Nf=500;function ds(e,t){t.invoke(H,this),this._bpmnReplace=e;var n=this;this.postExecuted("elements.create",Nf,function(i){var r=i.elements;r.filter(function(o){var a=o.host;return Lf(o,a)}).map(function(o){return r.indexOf(o)}).forEach(function(o){i.elements[o]=n._replaceShape(r[o])})},!0),this.preExecute("elements.move",Nf,function(i){var r=i.shapes,o=i.newHost;r.forEach(function(a,s){var c=a.host;Lf(a,fx(r,c)?c:o)&&(r[s]=n._replaceShape(a))})},!0)}ds.$inject=["bpmnReplace","injector"];q(ds,H);ds.prototype._replaceShape=function(e){var t=px(e),n;return t?n={type:"bpmn:IntermediateCatchEvent",eventDefinitionType:t.$type}:n={type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(e,n,{layoutConnection:!1})};function px(e){var t=z(e),n=t.eventDefinitions;return n&&n[0]}function Lf(e,t){return!be(e)&&g(e,"bpmn:BoundaryEvent")&&!t}function fx(e,t){return e.indexOf(t)!==-1}function su(e,t,n){H.call(this,e);function i(r,o,a){var s=o.waypoints,c,l,p,u,f,d,h,m=r.outgoing.slice(),v=r.incoming.slice(),E;ue(a.width)?E=se(a):E=a;var w=Zc(s,E);if(w){if(c=s.slice(0,w.index),l=s.slice(w.index+(w.bendpoint?1:0)),!c.length||!l.length)return;p=w.bendpoint?s[w.index]:E,(c.length===1||!Bf(r,c[c.length-1]))&&c.push($f(p)),(l.length===1||!Bf(r,l[0]))&&l.unshift($f(p))}u=o.source,f=o.target,t.canConnect(u,r,o)&&(n.reconnectEnd(o,r,c||E),d=o),t.canConnect(r,f,o)&&(d?h=n.connect(r,f,{type:o.type,waypoints:l}):(n.reconnectStart(o,r,l||E),h=o));var _=[].concat(d&&pe(v,function(x){return x.source===d.source})||[],h&&pe(m,function(x){return x.target===h.target})||[]);_.length&&n.removeElements(_)}this.preExecute("elements.move",function(r){var o=r.newParent,a=r.shapes,s=r.delta,c=a[0];if(!(!c||!o)){o&&o.waypoints&&(r.newParent=o=o.parent);var l=se(c),p={x:l.x+s.x,y:l.y+s.y},u=ke(o.children,function(f){var d=t.canInsert(a,f);return d&&Zc(f.waypoints,p)});u&&(r.targetFlow=u,r.position=p)}},!0),this.postExecuted("elements.move",function(r){var o=r.shapes,a=r.targetFlow,s=r.position;a&&i(o[0],a,s)},!0),this.preExecute("shape.create",function(r){var o=r.parent,a=r.shape;t.canInsert(a,o)&&(r.targetFlow=o,r.parent=o.parent)},!0),this.postExecuted("shape.create",function(r){var o=r.shape,a=r.targetFlow,s=r.position;a&&i(o,a,s)},!0)}q(su,H);su.$inject=["eventBus","bpmnRules","modeling"];function Bf(e,t){var n=t.x,i=t.y;return n>=e.x&&n<=e.x+e.width&&i>=e.y&&i<=e.y+e.height}function $f(e){return N({},e)}function cu(e,t){H.call(this,e),this.preExecuted("connection.create",function(n){var i=n.context,r=i.connection,o=i.source,a=i.target,s=i.hints;if(!(s&&s.createElementsBehavior===!1)&&Wi(r)){var c=[];g(o,"bpmn:EventBasedGateway")?c=a.incoming.filter(l=>l!==r&&Wi(l)):c=a.incoming.filter(l=>l!==r&&Wi(l)&&g(l.source,"bpmn:EventBasedGateway")),c.forEach(function(l){t.removeConnection(l)})}}),this.preExecuted("shape.replace",function(n){var i=n.context,r=i.newShape;if(g(r,"bpmn:EventBasedGateway")){var o=r.outgoing.filter(Wi).reduce(function(a,s){return a.includes(s.target)?a:a.concat(s.target)},[]);o.forEach(function(a){a.incoming.filter(Wi).forEach(function(s){const c=a.incoming.filter(Wi).filter(function(l){return l.source===r});(s.source!==r||c.length>1)&&t.removeConnection(s)})})}})}cu.$inject=["eventBus","modeling"];q(cu,H);function Wi(e){return g(e,"bpmn:SequenceFlow")}var ca=1500,Ff=2e3;function qm(e,t,n){t.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],ca,function(i){var r=i.context,o=r.shape||i.shape,a=i.hover;g(a,"bpmn:Lane")&&!le(o,["bpmn:Lane","bpmn:Participant"])&&(i.hover=$t(a),i.hoverGfx=e.getGraphics(i.hover));var s=n.getRootElement();a!==s&&(o.labelTarget||le(o,["bpmn:Group","bpmn:TextAnnotation"]))&&(i.hover=s,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],ca,function(i){var r=i.hover;g(r,"bpmn:Lane")&&(i.hover=$t(r)||r,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["bendpoint.move.hover"],ca,function(i){var r=i.context,o=i.hover,a=r.type;g(o,"bpmn:Lane")&&/reconnect/.test(a)&&(i.hover=$t(o)||o,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["connect.start"],ca,function(i){var r=i.context,o=r.start;g(o,"bpmn:Lane")&&(r.start=$t(o)||o)}),t.on("shape.move.start",Ff,function(i){var r=i.shape;g(r,"bpmn:Lane")&&(i.shape=$t(r)||r)}),t.on("spaceTool.move",Ff,function(i){var r=i.hover;r&&g(r,"bpmn:Lane")&&(i.hover=$t(r))})}qm.$inject=["elementRegistry","eventBus","canvas"];function dx(e){return e.create("bpmn:Category")}function hx(e){return e.create("bpmn:CategoryValue")}function mx(e,t,n){return Xe(t.get("categoryValue"),e),e.$parent=t,Xe(n.get("rootElements"),t),t.$parent=n,e}function vx(e){var t=e.$parent;return t&&(Ue(t.get("categoryValue"),e),e.$parent=null),e}function gx(e){var t=e.$parent;return t&&(Ue(t.get("rootElements"),e),e.$parent=null),e}var jf=770;function lu(e,t,n,i,r,o){r.invoke(H,this);function a(){return n.filter(function(h){return g(h,"bpmn:Group")})}function s(h,m){return h.some(function(v){var E=z(v),w=E.categoryValueRef&&E.categoryValueRef.$parent;return w===m})}function c(h,m){return h.some(function(v){var E=z(v);return E.categoryValueRef===m})}function l(h,m,v){var E=a().filter(function(w){return w.businessObject!==v});m&&!s(E,m)&&gx(m),h&&!c(E,h)&&vx(h)}function p(h,m){return mx(h,m,t.getDefinitions())}function u(h,m){var v=z(h),E=v.categoryValueRef;E||(E=v.categoryValueRef=m.categoryValue=m.categoryValue||hx(e));var w=E.$parent;w||(w=E.$parent=m.category=m.category||dx(e)),p(E,w,t.getDefinitions())}function f(h,m){var v=m.category,E=m.categoryValue,w=z(h);E?(w.categoryValueRef=null,l(E,v,w)):l(null,w.categoryValueRef.$parent,w)}this.execute("label.create",function(h){var m=h.context,v=m.labelTarget;g(v,"bpmn:Group")&&u(v,m)}),this.revert("label.create",function(h){var m=h.context,v=m.labelTarget;g(v,"bpmn:Group")&&f(v,m)}),this.execute("shape.delete",function(h){var m=h.context,v=m.shape,E=z(v);if(!(!g(v,"bpmn:Group")||v.labelTarget)){var w=m.categoryValue=E.categoryValueRef,_;w&&(_=m.category=w.$parent,l(w,_,E),E.categoryValueRef=null)}}),this.reverted("shape.delete",function(h){var m=h.context,v=m.shape;if(!(!g(v,"bpmn:Group")||v.labelTarget)){var E=m.category,w=m.categoryValue,_=z(v);w&&(_.categoryValueRef=w,p(w,E))}}),this.execute("shape.create",function(h){var m=h.context,v=m.shape;!g(v,"bpmn:Group")||v.labelTarget||z(v).categoryValueRef&&u(v,m)}),this.reverted("shape.create",function(h){var m=h.context,v=m.shape;!g(v,"bpmn:Group")||v.labelTarget||z(v).categoryValueRef&&f(v,m)});function d(h,m){var v=e.create(h.$type);return o.copyElement(h,v,null,m)}i.on("copyPaste.copyElement",jf,function(h){var m=h.descriptor,v=h.element;if(!(!g(v,"bpmn:Group")||v.labelTarget)){var E=z(v);if(E.categoryValueRef){var w=E.categoryValueRef;m.categoryValue=d(w,!0),w.$parent&&(m.category=d(w.$parent,!0))}}}),i.on("copyPaste.pasteElement",jf,function(h){var m=h.descriptor,v=m.businessObject,E=m.categoryValue,w=m.category;E&&(E=v.categoryValueRef=d(E)),w&&(E.$parent=d(w)),delete m.category,delete m.categoryValue})}lu.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"];q(lu,H);function rl(e,t,n,i){var r,o,a,s,c;return r=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y),r==0?null:(o=e.y-n.y,a=e.x-n.x,c=(i.x-n.x)*o-(i.y-n.y)*a,s=c/r,{x:Math.round(e.x+s*(t.x-e.x)),y:Math.round(e.y+s*(t.y-e.y))})}function Km(e){function t(i,r,o){var a={x:o.x,y:o.y-50},s={x:o.x-50,y:o.y},c=rl(i,r,o,a),l=rl(i,r,o,s),p;c&&l?Hf(c,o)>Hf(l,o)?p=l:p=c:p=c||l,i.original=p}function n(i){var r=i.waypoints;t(r[0],r[1],se(i.source)),t(r[r.length-1],r[r.length-2],se(i.target))}e.on("bpmnElement.added",function(i){var r=i.element;r.waypoints&&n(r)})}Km.$inject=["eventBus"];function Hf(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function uu(e){H.call(this,e);var t=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],function(n){var i=n.context.shape,r=z(i),o=Se(i);if(le(r,t)){var a=o.get("isHorizontal");a===void 0&&(a=!0),o.set("isHorizontal",a)}})}uu.$inject=["eventBus"];q(uu,H);var Xm=Math.sqrt,Zm=Math.min,yx=Math.max,Gf=Math.abs;function zf(e){return Math.pow(e,2)}function Mr(e,t){return Xm(zf(e.x-t.x)+zf(e.y-t.y))}function _x(e,t){var n=0,i,r,o,a,s,c,l,p,u,f,d;for(n=0;n<t.length-1;n++){if(i=t[n],r=t[n+1],Uf(i,r)?l=[i]:(o=Mr(e,i),a=Mr(e,r),c=Zm(o,a),l=bx(i,r,e,c)),l.length<1)throw new Error("expected between [1, 2] circle -> line intersections");l.length===1&&(p={type:"bendpoint",position:l[0],segmentIndex:n,bendpointIndex:Uf(i,l[0])?n:n+1}),l.length===2&&(s=xx(l[0],l[1]),p={type:"segment",position:s,segmentIndex:n,relativeLocation:Mr(i,s)/Mr(i,r)}),u=Mr(p.position,e),(!d||f>u)&&(d=p,f=u)}return d}function bx(e,t,n,i){var r=t.x-e.x,o=t.y-e.y,a=n.x-e.x,s=n.y-e.y,c=r*r+o*o,l=r*a+o*s,p=a*a+s*s-i*i,u=l/c,f=p/c,d=u*u-f;if(d<0&&d>-1e-6&&(d=0),d<0)return[];var h=Xm(d),m=-u+h,v=-u-h,E={x:e.x-r*m,y:e.y-o*m};if(d===0)return[E];var w={x:e.x-r*v,y:e.y-o*v};return[E,w].filter(function(_){return Ex(_,e,t)})}function Ex(e,t,n){return Vf(e.x,t.x,n.x)&&Vf(e.y,t.y,n.y)}function Vf(e,t,n){return e>=Zm(t,n)-Ga&&e<=yx(t,n)+Ga}function xx(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}var Ga=.1;function Uf(e,t){return Gf(e.x-t.x)<=Ga&&Gf(e.y-t.y)<=Ga}function wx(e,t,n,i){var r=n.segmentIndex,o=t.length-e.length;if(i.segmentMove){var a=i.segmentMove.segmentStartIndex,s=i.segmentMove.newSegmentStartIndex;return r===a?s:r>=s?r+o<s?s:r+o:r}if(i.bendpointMove){var c=i.bendpointMove.insert,l=i.bendpointMove.bendpointIndex,p;if(o===0)return r;if(r>=l&&(p=c?r+1:r-1),r<l&&(p=r,c&&n.type!=="bendpoint"&&l-1===r)){var u=Qm(t,l);u<n.relativeLocation&&p++}return p}return o===0?r:i.connectionStart&&r===0?0:i.connectionEnd&&r===e.length-2?t.length-2:Math.floor((t.length-2)/2)}function Jm(e,t,n,i){var r=0,o=0,a={point:e,delta:{x:0,y:0}},s=_x(e,n),c=s.segmentIndex,l=wx(n,t,s,i);if(l<0||l>t.length-2||l===null)return a;var p=Wf(n,c),u=Wf(t,l),f=s.position,d=Cx(p,f),h=Sx(p,u);if(s.type==="bendpoint"){var m=t.length-n.length,v=s.bendpointIndex,E=n[v];if(t.indexOf(E)!==-1)return a;if(m===0){var w=t[v];return r=w.x-s.position.x,o=w.y-s.position.y,{delta:{x:r,y:o},point:{x:e.x+r,y:e.y+o}}}m<0&&v!==0&&v<n.length-1&&(d=Qm(n,v))}var _={x:(u[1].x-u[0].x)*d+u[0].x,y:(u[1].y-u[0].y)*d+u[0].y},x=mE({x:e.x-f.x,y:e.y-f.y},h);return r=_.x+x.x-e.x,o=_.y+x.y-e.y,{point:Gr(_),delta:Gr({x:r,y:o})}}function Qm(e,t){var n=$a(e[t-1],e[t]),i=$a(e[t],e[t+1]),r=n/(n+i);return r}function Sx(e,t){var n=vf(e),i=vf(t);return i-n}function Wf(e,t){return[e[t],e[t+1]]}function Cx(e,t){var n=$a(e[0],e[1]),i=$a(e[0],t);return n===0?0:i/n}function Tx(e,t,n,i){var r=se(e);return Jm(r,t,n,i).delta}function ao(e,t,n){var i=Br(t),r=Br(n),o=xn(e,i),a={x:o.x*(n.width/t.width),y:o.y*(n.height/t.height)};return Gr({x:r.x+a.x,y:r.y+a.y})}function Yf(e,t,n){var i=Br(e),r=Br(t),o=Br(n),a=xn(e,i),s=xn(i,r),c=Px(i,t,n);if(c)return c;var l={x:s.x*(n.width/t.width),y:s.y*(n.height/t.height)},p={x:o.x+l.x,y:o.y+l.y};return Gr({x:p.x+a.x-e.x,y:p.y+a.y-e.y})}function Px(e,t,n){var i=te(t),r=te(n);if(Rx(i,r))return null;var o=ut(t,e),a,s,c;if(o==="top")a={x:0,y:r.bottom-i.bottom};else if(o==="bottom")a={x:0,y:r.top-i.top};else if(o==="right")a={x:r.left-i.left,y:0};else if(o==="left")a={x:r.right-i.right,y:0};else return null;return s={x:e.x+a.x,y:e.y+a.y},c=ut(n,s),c!==o?null:a}function Rx(e,t){return Ax(e,t)||Ix(e,t)}function Ax(e,t){return e.right!==t.right&&e.left!==t.left}function Ix(e,t){return e.top!==t.top&&e.bottom!==t.bottom}var qf="name",Kf="text";function pu(e,t,n,i){H.call(this,e),this.postExecute("element.updateProperties",r),this.postExecute("element.updateModdleProperties",a=>{z(a.context.element)===a.context.moddleElement&&r(a)});function r(a){var s=a.context,c=s.element,l=s.properties;if(qf in l&&t.updateLabel(c,l[qf]),Kf in l&&g(c,"bpmn:TextAnnotation")){var p=i.getTextAnnotationBounds({x:c.x,y:c.y,width:c.width,height:c.height},l[Kf]||"");t.updateLabel(c,l.text,p)}}this.postExecute(["shape.create","connection.create"],function(a){var s=a.context,c=s.hints||{};if(c.createElementsBehavior!==!1){var l=s.shape||s.connection;be(l)||!er(l)||qn(l)&&t.updateLabel(l,qn(l))}}),this.postExecute("shape.delete",function(a){var s=a.context,c=s.labelTarget,l=s.hints||{};c&&l.unsetLabel!==!1&&t.updateLabel(c,null,null,{removeShape:!1})});function o(a){var s=a.context,c=s.connection,l=c.label,p=N({},s.hints),u=s.newWaypoints||c.waypoints,f=s.oldWaypoints;return typeof p.startChanged=="undefined"&&(p.startChanged=!!p.connectionStart),typeof p.endChanged=="undefined"&&(p.endChanged=!!p.connectionEnd),Tx(l,u,f,p)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(a){var s=a.context,c=s.hints||{};if(c.labelBehavior!==!1){var l=s.connection,p=l.label,u;!p||!p.parent||(u=o(a),t.moveShape(p,u))}}),this.postExecute(["shape.replace"],function(a){var s=a.context,c=s.newShape,l=s.oldShape,p=z(c);p&&er(p)&&l.label&&c.label&&(c.label.x=l.label.x,c.label.y=l.label.y)}),this.postExecute("shape.resize",function(a){var s=a.context,c=s.shape,l=s.newBounds,p=s.oldBounds;if(Ja(c)){var u=c.label,f=se(u),d=kx(p),h=Dx(f,d),m=Mx(h,p,l);t.moveShape(u,m)}})}q(pu,H);pu.$inject=["eventBus","modeling","bpmnFactory","textRenderer"];function Mx(e,t,n){var i=ao(e,t,n);return Gr(xn(i,e))}function Dx(e,t){if(t.length){var n=Ox(e,t);return Ul(e,n)}}function kx(e){return[[{x:e.x,y:e.y},{x:e.x+(e.width||0),y:e.y}],[{x:e.x+(e.width||0),y:e.y},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y+(e.height||0)},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y},{x:e.x,y:e.y+(e.height||0)}]]}function Ox(e,t){var n=t.map(function(r){return{line:r,distance:Am(e,r)}}),i=un(n,"distance");return i[0].line}function Nx(e,t,n,i){return Jm(e,t,n,i).point}function fu(e,t){H.call(this,e);function n(i,r){var o=i.context,a=o.connection,s=N({},o.hints),c=o.newWaypoints||a.waypoints,l=o.oldWaypoints;return typeof s.startChanged=="undefined"&&(s.startChanged=!!s.connectionStart),typeof s.endChanged=="undefined"&&(s.endChanged=!!s.connectionEnd),Nx(r,c,l,s)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(i){var r=i.context,o=r.connection,a=o.outgoing,s=o.incoming;s.forEach(function(c){var l=c.waypoints[c.waypoints.length-1],p=n(i,l),u=[].concat(c.waypoints.slice(0,-1),[p]);t.updateWaypoints(c,u)}),a.forEach(function(c){var l=c.waypoints[0],p=n(i,l),u=[].concat([p],c.waypoints.slice(1));t.updateWaypoints(c,u)})}),this.postExecute(["connection.move"],function(i){var r=i.context,o=r.connection,a=o.outgoing,s=o.incoming,c=r.delta;s.forEach(function(l){var p=l.waypoints[l.waypoints.length-1],u={x:p.x+c.x,y:p.y+c.y},f=[].concat(l.waypoints.slice(0,-1),[u]);t.updateWaypoints(l,f)}),a.forEach(function(l){var p=l.waypoints[0],u={x:p.x+c.x,y:p.y+c.y},f=[].concat([u],l.waypoints.slice(1));t.updateWaypoints(l,f)})})}q(fu,H);fu.$inject=["eventBus","modeling"];function hs(e,t,n){var i=vs(e),r=tv(i,t),o=i[0];return r.length?r[r.length-1]:ao(o.original||o,n,t)}function ms(e,t,n){var i=vs(e),r=tv(i,t),o=i[i.length-1];return r.length?r[0]:ao(o.original||o,n,t)}function du(e,t,n){var i=vs(e),r=ev(t,n),o=i[0];return ao(o.original||o,r,t)}function hu(e,t,n){var i=vs(e),r=ev(t,n),o=i[i.length-1];return ao(o.original||o,r,t)}function ev(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}function vs(e){var t=e.waypoints;if(!t.length)throw new Error("connection#"+e.id+": no waypoints");return t}function tv(e,t){var n=yt(e,Bx);return pe(n,function(i){return Lx(i,t)})}function Lx(e,t){return ut(t,e,1)==="intersect"}function Bx(e){return e.original||e}function mu(e,t){H.call(this,e),this.postExecute("shape.replace",function(n){var i=n.oldShape,r=n.newShape;if($x(i,r)){var o=Fx(i);o.incoming.forEach(function(a){var s=ms(a,r,i);t.reconnectEnd(a,r,s)}),o.outgoing.forEach(function(a){var s=hs(a,r,i);t.reconnectStart(a,r,s)})}},!0)}mu.$inject=["eventBus","modeling"];q(mu,H);function $x(e,t){return g(e,"bpmn:Participant")&&ye(e)&&g(t,"bpmn:Participant")&&!ye(t)}function Fx(e){var t=eo([e],!1),n=[],i=[];return t.forEach(function(r){r!==e&&(r.incoming.forEach(function(o){g(o,"bpmn:MessageFlow")&&n.push(o)}),r.outgoing.forEach(function(o){g(o,"bpmn:MessageFlow")&&i.push(o)}))},[]),{incoming:n,outgoing:i}}const jx=["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:EscalationEventDefinition","bpmn:ConditionalEventDefinition","bpmn:SignalEventDefinition"];function nv(e){const t=z(e);if(!g(t,"bpmn:BoundaryEvent")&&!(g(t,"bpmn:StartEvent")&&ht(t.$parent)))return!1;const n=t.get("eventDefinitions");return!n||!n.length?!1:jx.some(i=>g(n[0],i))}function iv(e){return g(e,"bpmn:BoundaryEvent")?"cancelActivity":"isInterrupting"}function vu(e,t){e.invoke(H,this),this.postExecuted("shape.replace",function(n){const i=n.context.oldShape,r=n.context.newShape,o=n.context.hints;if(!nv(r))return;const a=iv(r);if(o.targetElement&&o.targetElement[a]!==void 0)return;const c=z(i).get(a),l=z(r).get(a);c!==l&&t.updateProperties(r,{[a]:c})})}vu.$inject=["injector","modeling"];q(vu,H);function gu(e,t){H.call(this,e),this.preExecute("shape.resize",function(n){var i=n.shape,r=Se(i),o=r&&r.get("label"),a=o&&o.get("bounds");a&&t.updateModdleProperties(i,o,{bounds:void 0})},!0)}q(gu,H);gu.$inject=["eventBus","modeling"];function yu(e,t,n){H.call(this,e),this.preExecute("shape.delete",function(i){var r=i.context.shape;if(!(r.incoming.length!==1||r.outgoing.length!==1)){var o=r.incoming[0],a=r.outgoing[0];if(!(!g(o,"bpmn:SequenceFlow")||!g(a,"bpmn:SequenceFlow"))&&t.canConnect(o.source,a.target,o)){var s=Hx(o.waypoints,a.waypoints);n.reconnectEnd(o,a.target,s)}}})}q(yu,H);yu.$inject=["eventBus","bpmnRules","modeling"];function Yi(e){return e.original||e}function Hx(e,t){var n=rl(Yi(e[e.length-2]),Yi(e[e.length-1]),Yi(t[1]),Yi(t[0]));return n?[].concat(e.slice(0,e.length-1),[n],t.slice(1)):[Yi(e[0]),Yi(t[t.length-1])]}function _u(e,t){H.call(this,e),this.preExecute("shape.delete",function(n){var i=n.shape,r=i.parent;g(i,"bpmn:Participant")&&(n.collaborationRoot=r)},!0),this.postExecute("shape.delete",function(n){var i=n.collaborationRoot;i&&!i.businessObject.participants.length&&t.makeProcess()},!0)}_u.$inject=["eventBus","modeling"];q(_u,H);function bu(e,t,n,i){H.call(this,e);var r=i.get("dragging",!1);function o(c){var l=c.source,p=c.target,u=c.parent;if(u){var f,d;g(c,"bpmn:SequenceFlow")&&(n.canConnectSequenceFlow(l,p)||(d=!0),n.canConnectMessageFlow(l,p)&&(f="bpmn:MessageFlow")),g(c,"bpmn:MessageFlow")&&(n.canConnectMessageFlow(l,p)||(d=!0),n.canConnectSequenceFlow(l,p)&&(f="bpmn:SequenceFlow")),d&&t.removeConnection(c),f&&t.connect(l,p,{type:f,waypoints:c.waypoints.slice()})}}function a(c){var l=c.context,p=l.connection,u=l.newSource||p.source,f=l.newTarget||p.target,d,h;d=n.canConnect(u,f),!(!d||d.type===p.type)&&(h=t.connect(u,f,{type:d.type,associationDirection:d.associationDirection,waypoints:p.waypoints.slice()}),p.parent&&t.removeConnection(p),l.connection=h,r&&s(p,h))}function s(c,l){var p=r.context(),u=p&&p.payload.previousSelection,f;!u||!u.length||(f=u.indexOf(c),f!==-1&&u.splice(f,1,l))}this.postExecuted("elements.move",function(c){var l=c.closure,p=l.allConnections;D(p,o)},!0),this.preExecute("connection.reconnect",a),this.postExecuted("element.updateProperties",function(c){var l=c.context,p=l.properties,u=l.element,f=u.businessObject,d;p.default&&(d=ke(u.outgoing,En({id:u.businessObject.default.id})),d&&t.updateProperties(d,{conditionExpression:void 0})),p.conditionExpression&&f.sourceRef.default===f&&t.updateProperties(u.source,{default:void 0})})}q(bu,H);bu.$inject=["eventBus","modeling","bpmnRules","injector"];function gs(e,t,n,i,r,o){i.invoke(H,this),this._bpmnReplace=e,this._elementRegistry=n,this._selection=o,this.postExecuted(["elements.create"],500,function(a){var s=a.context,c=s.parent,l=s.elements,p=Zn(l,function(u,f){var d=t.canReplace([f],f.host||f.parent||c);return d?u.concat(d.replacements):u},[]);p.length&&this._replaceElements(l,p)},this),this.postExecuted(["elements.move"],500,function(a){var s=a.context,c=s.newParent,l=s.newHost,p=[];D(s.closure.topLevel,function(f){ht(f)?p=p.concat(f.children):p=p.concat(f)}),p.length===1&&l&&(c=l);var u=t.canReplace(p,c);u&&this._replaceElements(p,u.replacements,l)},this),this.postExecute(["shape.replace"],1500,function(a){var s=a.context,c=s.oldShape,l=s.newShape,p=c.attachers,u;p&&p.length&&(u=t.canReplace(p,l),this._replaceElements(p,u.replacements))},this),this.postExecuted(["shape.replace"],1500,function(a){var s=a.context,c=s.oldShape,l=s.newShape;r.unclaimId(c.businessObject.id,c.businessObject),r.updateProperties(l,{id:c.id})})}q(gs,H);gs.prototype._replaceElements=function(e,t){var n=this._elementRegistry,i=this._bpmnReplace,r=this._selection;D(t,function(o){var a={type:o.newElementType},s=n.get(o.oldElementId),c=e.indexOf(s);e[c]=i.replaceElement(s,a,{select:!1})}),t&&r.select(e)};gs.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var Gx=1500,zx={width:140,height:120},Eu={width:300,height:60},xu={width:60,height:300},Aa={width:300,height:150},Ia={width:150,height:300},rv={width:140,height:120},ov={width:50,height:30};function av(e){e.on("resize.start",Gx,function(t){var n=t.context,i=n.shape,r=n.direction,o=n.balanced;(g(i,"bpmn:Lane")||g(i,"bpmn:Participant"))&&(n.resizeConstraints=qx(i,r,o)),g(i,"bpmn:SubProcess")&&ye(i)&&(n.minDimensions=rv),g(i,"bpmn:TextAnnotation")&&(n.minDimensions=ov)})}av.$inject=["eventBus"];var jn=Math.abs,Vx=Math.min,Ux=Math.max;function sv(e,t,n,i){var r=e[t];e[t]=r===void 0?n:i(n,r)}function qi(e,t,n){return sv(e,t,n,Vx)}function Ki(e,t,n){return sv(e,t,n,Ux)}var Wx={top:20,left:50,right:20,bottom:20},Yx={top:50,left:20,right:20,bottom:20};function qx(e,t,n){var i=$t(e),r=!0,o=!0,a=fs(i,[i]),s=te(e),c={},l={},p=mt(e),u=p?Eu:xu;/n/.test(t)?l.top=s.bottom-u.height:/e/.test(t)?l.right=s.left+u.width:/s/.test(t)?l.bottom=s.top+u.height:/w/.test(t)&&(l.left=s.right-u.width),a.forEach(function(h){var m=te(h);/n/.test(t)&&(p&&m.top<s.top-10&&(r=!1),n&&jn(s.top-m.bottom)<10&&Ki(c,"top",m.top+u.height),jn(s.top-m.top)<5&&qi(l,"top",m.bottom-u.height)),/e/.test(t)&&(!p&&m.right>s.right+10&&(o=!1),n&&jn(s.right-m.left)<10&&qi(c,"right",m.right-u.width),jn(s.right-m.right)<5&&Ki(l,"right",m.left+u.width)),/s/.test(t)&&(p&&m.bottom>s.bottom+10&&(o=!1),n&&jn(s.bottom-m.top)<10&&qi(c,"bottom",m.bottom-u.height),jn(s.bottom-m.bottom)<5&&Ki(l,"bottom",m.top+u.height)),/w/.test(t)&&(!p&&m.left<s.left-10&&(r=!1),n&&jn(s.left-m.right)<10&&Ki(c,"left",m.left+u.width),jn(s.left-m.left)<5&&qi(l,"left",m.right-u.width))});var f=i.children.filter(function(h){return!h.hidden&&!h.waypoints&&(g(h,"bpmn:FlowElement")||g(h,"bpmn:Artifact"))}),d=p?Wx:Yx;return f.forEach(function(h){var m=te(h);r&&/n/.test(t)&&qi(l,"top",m.top-d.top),o&&/e/.test(t)&&Ki(l,"right",m.right+d.right),o&&/s/.test(t)&&Ki(l,"bottom",m.bottom+d.bottom),r&&/w/.test(t)&&qi(l,"left",m.left-d.left)}),{min:l,max:c}}var Xf=1001;function cv(e,t){e.on("resize.start",Xf+500,function(n){var i=n.context,r=i.shape;(g(r,"bpmn:Lane")||g(r,"bpmn:Participant"))&&(i.balanced=!zr(n))}),e.on("resize.end",Xf,function(n){var i=n.context,r=i.shape,o=i.canExecute,a=i.newBounds;if(g(r,"bpmn:Lane")||g(r,"bpmn:Participant"))return o&&(a=Fh(a),t.resizeLane(r,a,i.balanced)),!1})}cv.$inject=["eventBus","modeling"];var Kx=500;function wu(e,t,n,i,r){n.invoke(H,this);function o(p){return le(p,["bpmn:ReceiveTask","bpmn:SendTask"])||Xx(p,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function a(p){var u=e.getDefinitions(),f=u.get("rootElements");return!!ke(f,En({id:p.id}))}function s(p){if(g(p,"bpmn:ErrorEventDefinition"))return"errorRef";if(g(p,"bpmn:EscalationEventDefinition"))return"escalationRef";if(g(p,"bpmn:MessageEventDefinition"))return"messageRef";if(g(p,"bpmn:SignalEventDefinition"))return"signalRef"}function c(p){if(le(p,["bpmn:ReceiveTask","bpmn:SendTask"]))return p.get("messageRef");var u=p.get("eventDefinitions"),f=u[0];return f.get(s(f))}function l(p,u){if(le(p,["bpmn:ReceiveTask","bpmn:SendTask"]))return p.set("messageRef",u);var f=p.get("eventDefinitions"),d=f[0];return d.set(s(d),u)}this.executed(["shape.create","element.updateProperties","element.updateModdleProperties"],function(p){var u=p.shape||p.element;if(o(u)){var f=z(u),d=c(f),h;d&&!a(d)&&(h=e.getDefinitions().get("rootElements"),Xe(h,d),p.addedRootElement=d)}},!0),this.reverted(["shape.create","element.updateProperties","element.updateModdleProperties"],function(p){var u=p.addedRootElement;if(u){var f=e.getDefinitions().get("rootElements");Ue(f,u)}},!0),t.on("copyPaste.copyElement",function(p){var u=p.descriptor,f=p.element;if(!(f.labelTarget||!o(f))){var d=z(f),h=c(d);h&&(u.referencedRootElement=h)}}),t.on("copyPaste.pasteElement",Kx,function(p){var u=p.descriptor,f=u.businessObject,d=u.referencedRootElement;d&&(a(d)||(d=i.copyElement(d,r.create(d.$type))),l(f,d),delete u.referencedRootElement)})}wu.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"];q(wu,H);function Xx(e,t){return ve(t)||(t=[t]),Mi(t,function(n){return $h(e,n)})}var lv=Math.max;function uv(e){e.on("spaceTool.getMinDimensions",function(t){var n=t.shapes,i=t.axis,r=t.start,o={};return D(n,function(a){var s=a.id;g(a,"bpmn:Participant")&&(o[s]=Jx(a,i,r)),g(a,"bpmn:Lane")&&(o[s]=mt(a)?Eu:xu),g(a,"bpmn:SubProcess")&&ye(a)&&(o[s]=rv),g(a,"bpmn:TextAnnotation")&&(o[s]=ov),g(a,"bpmn:Group")&&(o[s]=zx)}),o})}uv.$inject=["eventBus"];function Zx(e){return e==="x"}function Jx(e,t,n){var i=mt(e);if(!tw(e))return i?Aa:Ia;var r=Zx(t),o={};return r?i?o=Aa:o={width:ew(e,n,r),height:Ia.height}:i?o={width:Aa.width,height:Qx(e,n,r)}:o=Ia,o}function Qx(e,t,n){var i;return i=nw(e,t,n),lv(Aa.height,i)}function ew(e,t,n){var i;return i=iw(e,t,n),lv(Ia.width,i)}function tw(e){return!!Qn(e).length}function nw(e,t,n){var i=Qn(e),r;return r=Su(i,t,n),e.height-r.height+Eu.height}function iw(e,t,n){var i=Qn(e),r;return r=Su(i,t,n),e.width-r.width+xu.width}function Su(e,t,n){var i,r,o;for(i=0;i<e.length;i++)if(r=e[i],!n&&t>=r.y&&t<=r.y+r.height||n&&t>=r.x&&t<=r.x+r.width)return o=Qn(r),o.length?Su(o,t,n):r}var Zf=400,rw=600,Jf={x:180,y:160};function ei(e,t,n,i,r,o,a){H.call(this,t),this._canvas=e,this._eventBus=t,this._modeling=n,this._elementFactory=i,this._bpmnFactory=r,this._bpmnjs=o,this._elementRegistry=a;var s=this;function c(u){return g(u,"bpmn:SubProcess")&&!ye(u)}function l(u){var f=u.shape,d=u.newRootElement,h=z(f);d=s._addDiagram(d||h),u.newRootElement=e.addRootElement(d)}function p(u){var f=u.shape,d=z(f);s._removeDiagram(d);var h=u.newRootElement=a.get(Xi(d));e.removeRootElement(h)}this.executed("shape.create",function(u){var f=u.shape;c(f)&&l(u)},!0),this.postExecuted("shape.create",function(u){var f=u.shape,d=u.newRootElement;!d||!f.children||(s._showRecursively(f.children),s._moveChildrenToShape(f,d))},!0),this.reverted("shape.create",function(u){var f=u.shape;c(f)&&p(u)},!0),this.preExecuted("shape.delete",function(u){var f=u.shape;if(c(f)){var d=a.get(Xi(f));d&&n.removeElements(d.children.slice())}},!0),this.executed("shape.delete",function(u){var f=u.shape;c(f)&&p(u)},!0),this.reverted("shape.delete",function(u){var f=u.shape;c(f)&&l(u)},!0),this.preExecuted("shape.replace",function(u){var f=u.oldShape,d=u.newShape;!c(f)||!c(d)||(u.oldRoot=e.removeRootElement(Xi(f)))},!0),this.postExecuted("shape.replace",function(u){var f=u.newShape,d=u.oldRoot,h=e.findRoot(Xi(f));if(!(!d||!h)){var m=d.children;n.moveElements(m,{x:0,y:0},h)}},!0),this.executed("element.updateProperties",function(u){var f=u.element;if(g(f,"bpmn:SubProcess")){var d=u.properties,h=u.oldProperties,m=h.id,v=d.id;if(m!==v){if(Sa(f)){a.updateId(f,mi(v)),a.updateId(m,v);return}var E=a.get(mi(m));E&&a.updateId(mi(m),mi(v))}}},!0),this.reverted("element.updateProperties",function(u){var f=u.element;if(g(f,"bpmn:SubProcess")){var d=u.properties,h=u.oldProperties,m=h.id,v=d.id;if(m!==v){if(Sa(f)){a.updateId(f,mi(m)),a.updateId(v,m);return}var E=a.get(mi(v));E&&a.updateId(E,mi(m))}}},!0),t.on("element.changed",function(u){var f=u.element;if(Sa(f)){var d=f,h=a.get(Fp(d));!h||h===d||t.fire("element.changed",{element:h})}}),this.executed("shape.toggleCollapse",Zf,function(u){var f=u.shape;g(f,"bpmn:SubProcess")&&(ye(f)?p(u):(l(u),s._showRecursively(f.children)))},!0),this.reverted("shape.toggleCollapse",Zf,function(u){var f=u.shape;g(f,"bpmn:SubProcess")&&(ye(f)?p(u):(l(u),s._showRecursively(f.children)))},!0),this.postExecuted("shape.toggleCollapse",rw,function(u){var f=u.shape;if(g(f,"bpmn:SubProcess")){var d=u.newRootElement;d&&(ye(f)?s._moveChildrenToShape(d,f):s._moveChildrenToShape(f,d))}},!0),t.on("copyPaste.createTree",function(u){var f=u.element,d=u.children;if(c(f)){var h=Xi(f),m=a.get(h);m&&d.push.apply(d,m.children)}}),t.on("copyPaste.copyElement",function(u){var f=u.descriptor,d=u.element,h=u.elements,m=d.parent,v=g(Se(m),"bpmndi:BPMNPlane");if(v){var E=Fp(m),w=ke(h,function(_){return _.id===E});w&&(f.parent=w.id)}}),t.on("copyPaste.pasteElement",function(u){var f=u.descriptor;f.parent&&(c(f.parent)||f.parent.hidden)&&(f.hidden=!0)})}q(ei,H);ei.prototype._moveChildrenToShape=function(e,t){var n=this._modeling,i=e.children,r;if(i){i=i.concat(i.reduce(function(l,p){return p.label&&p.label.parent!==e?l.concat(p.label):l},[]));var o=i.filter(function(l){return!l.hidden});if(!o.length){n.moveElements(i,{x:0,y:0},t,{autoResize:!1});return}var a=At(o);if(!t.x)r={x:Jf.x-a.x,y:Jf.y-a.y};else{var s=se(t),c=se(a);r={x:s.x-c.x,y:s.y-c.y}}n.moveElements(i,r,t,{autoResize:!1})}};ei.prototype._showRecursively=function(e,t){var n=this,i=[];return e.forEach(function(r){r.hidden=!!t,i=i.concat(r),r.children&&(i=i.concat(n._showRecursively(r.children,r.collapsed||t)))}),i};ei.prototype._addDiagram=function(e){var t=this._bpmnjs,n=t.getDefinitions().diagrams;return e.businessObject||(e=this._createNewDiagram(e)),n.push(e.di.$parent),e};ei.prototype._createNewDiagram=function(e){var t=this._bpmnFactory,n=this._elementFactory,i=t.create("bpmndi:BPMNPlane",{bpmnElement:e}),r=t.create("bpmndi:BPMNDiagram",{plane:i});i.$parent=r;var o=n.createRoot({id:Xi(e),type:e.$type,di:i,businessObject:e,collapsed:!0});return o};ei.prototype._removeDiagram=function(e){var t=this._bpmnjs,n=t.getDefinitions().diagrams,i=ke(n,function(r){return r.plane.bpmnElement.id===e.id});return n.splice(n.indexOf(i),1),i};ei.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"];function Cu(e,t){e.invoke(H,this),this.postExecuted("shape.replace",function(n){var i=n.context.oldShape,r=n.context.newShape;if(!(!g(r,"bpmn:SubProcess")||!(g(i,"bpmn:Task")||g(i,"bpmn:CallActivity"))||!ye(r))){var o=ow(r);t.createShape({type:"bpmn:StartEvent"},o,r)}})}Cu.$inject=["injector","modeling"];q(Cu,H);function ow(e){return{x:e.x+e.width/6,y:e.y+e.height/2}}function Tu(e){H.call(this,e),this.preExecute("connection.create",function(t){const{target:n}=t;g(n,"bpmn:TextAnnotation")&&(t.parent=n.parent)},!0),this.preExecute(["shape.create","shape.resize","elements.move"],function(t){const n=t.shapes||[t.shape];n.length===1&&g(n[0],"bpmn:TextAnnotation")&&(t.hints=t.hints||{},t.hints.autoResize=!1)},!0)}q(Tu,H);Tu.$inject=["eventBus"];function Pu(e,t){H.call(this,e),this.postExecuted("shape.toggleCollapse",1500,function(n){var i=n.shape;if(ye(i))return;var r=eo(i);r.forEach(function(a){var s=a.incoming.slice(),c=a.outgoing.slice();D(s,function(l){o(l,!0)}),D(c,function(l){o(l,!1)})});function o(a,s){r.indexOf(a.source)!==-1&&r.indexOf(a.target)!==-1||(s?t.reconnectEnd(a,i,se(i)):t.reconnectStart(a,i,se(i)))}},!0)}q(Pu,H);Pu.$inject=["eventBus","modeling"];var _c=500;function Ru(e,t,n){H.call(this,e);function i(a){a.length&&a.forEach(function(s){s.type==="label"&&!s.businessObject.name&&(s.hidden=!0)})}function r(a,s){var c=a.children,l=s,p,u;return p=aw(c).concat([a]),u=Ym(p),u?(l.width=Math.max(u.width,l.width),l.height=Math.max(u.height,l.height),l.x=u.x+(u.width-l.width)/2,l.y=u.y+(u.height-l.height)/2):(l.x=a.x+(a.width-l.width)/2,l.y=a.y+(a.height-l.height)/2),l}function o(a,s){return{x:a.x+(a.width-s.width)/2,y:a.y+(a.height-s.height)/2,width:s.width,height:s.height}}this.executed(["shape.toggleCollapse"],_c,function(a){var s=a.context,c=s.shape;g(c,"bpmn:SubProcess")&&(c.collapsed?Se(c).isExpanded=!1:(i(c.children),Se(c).isExpanded=!0))}),this.reverted(["shape.toggleCollapse"],_c,function(a){var s=a.context,c=s.shape;c.collapsed?Se(c).isExpanded=!1:Se(c).isExpanded=!0}),this.postExecuted(["shape.toggleCollapse"],_c,function(a){var s=a.context.shape,c=t.getDefaultSize(s),l;s.collapsed?l=o(s,c):l=r(s,c),n.resizeShape(s,l,null,{autoResize:s.collapsed?!1:"nwse"})})}q(Ru,H);Ru.$inject=["eventBus","elementFactory","modeling"];function aw(e){return e.filter(function(t){return!t.hidden})}function Au(e,t,n,i){t.invoke(H,this),this.preExecute("shape.delete",function(r){var o=r.context,a=o.shape,s=a.businessObject;be(a)||(g(a,"bpmn:Participant")&&ye(a)&&n.ids.unclaim(s.processRef.id),i.unclaimId(s.id,s))}),this.preExecute("connection.delete",function(r){var o=r.context,a=o.connection,s=a.businessObject;i.unclaimId(s.id,s)}),this.preExecute("canvas.updateRoot",function(){var r=e.getRootElement(),o=r.businessObject;g(r,"bpmn:Collaboration")&&n.ids.unclaim(o.id)})}q(Au,H);Au.$inject=["canvas","injector","moddle","modeling"];function Iu(e,t){H.call(this,e),this.preExecute("connection.delete",function(n){var i=n.context,r=i.connection,o=r.source;sw(r,o)&&t.updateProperties(o,{default:null})})}q(Iu,H);Iu.$inject=["eventBus","modeling"];function sw(e,t){if(!g(e,"bpmn:SequenceFlow"))return!1;var n=z(t),i=z(e);return n.get("default")===i}var cw=500,lw=5e3;function Mu(e,t){H.call(this,e);var n;function i(){return n=n||new uw,n.enter(),n}function r(){if(!n)throw new Error("out of bounds release");return n}function o(){if(!n)throw new Error("out of bounds release");var s=n.leave();return s&&(t.updateLaneRefs(n.flowNodes,n.lanes),n=null),s}var a=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(a,lw,function(s){i()}),this.postExecuted(a,cw,function(s){o()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(s){var c=s.context,l=c.shape,p=r();l.labelTarget||(g(l,"bpmn:Lane")&&p.addLane(l),g(l,"bpmn:FlowNode")&&p.addFlowNode(l))})}Mu.$inject=["eventBus","modeling"];q(Mu,H);function uw(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}const pw={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","compensateBoundaryEventBehaviour","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","layoutConnectionBehavior","messageFlowBehavior","nonInterruptingBehavior","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","textAnnotationBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior"],adaptiveLabelPositioningBehavior:["type",Xl],appendBehavior:["type",Zl],associationBehavior:["type",Jl],attachEventBehavior:["type",us],boundaryEventBehavior:["type",Ql],compensateBoundaryEventBehaviour:["type",eu],createBehavior:["type",tu],createDataObjectBehavior:["type",nu],createParticipantBehavior:["type",iu],dataInputAssociationBehavior:["type",ru],dataStoreBehavior:["type",ou],deleteLaneBehavior:["type",au],detachEventBehavior:["type",ds],dropOnFlowBehavior:["type",su],eventBasedGatewayBehavior:["type",cu],fixHoverBehavior:["type",qm],groupBehavior:["type",lu],importDockingFix:["type",Km],isHorizontalFix:["type",uu],labelBehavior:["type",pu],layoutConnectionBehavior:["type",fu],messageFlowBehavior:["type",mu],nonInterruptingBehavior:["type",vu],removeElementBehavior:["type",yu],removeEmbeddedLabelBoundsBehavior:["type",gu],removeParticipantBehavior:["type",_u],replaceConnectionBehavior:["type",bu],replaceElementBehaviour:["type",gs],resizeBehavior:["type",av],resizeLaneBehavior:["type",cv],rootElementReferenceBehavior:["type",wu],spaceToolBehavior:["type",uv],subProcessPlaneBehavior:["type",ei],subProcessStartEventBehavior:["type",Cu],textAnnotationBehavior:["type",Tu],toggleCollapseConnectionBehaviour:["type",Pu],toggleElementCollapseBehaviour:["type",Ru],unclaimIdBehavior:["type",Au],unsetDefaultFlowBehavior:["type",Iu],updateFlowNodeRefsBehavior:["type",Mu]};function pv(e,t){var n=ut(e,t,-15);return n!=="intersect"?n:null}function ot(e){Gt.call(this,e)}q(ot,Gt);ot.$inject=["eventBus"];ot.prototype.init=function(){this.addRule("connection.start",function(e){var t=e.source;return fw(t)}),this.addRule("connection.create",function(e){var t=e.source,n=e.target,i=e.hints||{},r=i.targetParent,o=i.targetAttach;if(o)return!1;r&&(n.parent=r);try{return Ma(t,n)}finally{r&&(n.parent=null)}}),this.addRule("connection.reconnect",function(e){var t=e.connection,n=e.source,i=e.target;return Ma(n,i,t)}),this.addRule("connection.updateWaypoints",function(e){return{type:e.connection.type}}),this.addRule("shape.resize",function(e){var t=e.shape,n=e.newBounds;return bv(t,n)}),this.addRule("elements.create",function(e){var t=e.elements,n=e.position,i=e.target;return Te(i)&&!za(t,i)?!1:Qr(t,function(r){return Te(r)?Ma(r.source,r.target,r):r.host?$r(r,r.host,null,n):cl(r,i,null)})}),this.addRule("elements.move",function(e){var t=e.target,n=e.shapes,i=e.position;return $r(n,t,null,i)||yv(n,t,i)||_v(n,t)||za(n,t)}),this.addRule("shape.create",function(e){return cl(e.shape,e.target,e.source,e.position)}),this.addRule("shape.attach",function(e){return $r(e.shape,e.target,null,e.position)}),this.addRule("element.copy",function(e){var t=e.element,n=e.elements;return Cv(n,t)})};ot.prototype.canConnectMessageFlow=wv;ot.prototype.canConnectSequenceFlow=Sv;ot.prototype.canConnectDataAssociation=ku;ot.prototype.canConnectAssociation=Ev;ot.prototype.canConnectCompensationAssociation=xv;ot.prototype.canMove=_v;ot.prototype.canAttach=$r;ot.prototype.canReplace=yv;ot.prototype.canDrop=or;ot.prototype.canInsert=za;ot.prototype.canCreate=cl;ot.prototype.canConnect=Ma;ot.prototype.canResize=bv;ot.prototype.canCopy=Cv;function fw(e){return ol(e)?null:le(e,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"])}function ol(e){return!e||be(e)}function dw(e,t){return e===t}function Qf(e){do{if(g(e,"bpmn:Process"))return z(e);if(g(e,"bpmn:Participant"))return z(e).processRef||z(e)}while(e=e.parent)}function al(e){return g(e,"bpmn:TextAnnotation")}function Du(e){return g(e,"bpmn:Group")&&!e.labelTarget}function fv(e){return g(e,"bpmn:BoundaryEvent")&&an(e,"bpmn:CompensateEventDefinition")}function ys(e){return z(e).isForCompensation}function hw(e,t){var n=Qf(e),i=Qf(t);return n===i}function mw(e){return g(e,"bpmn:InteractionNode")&&!g(e,"bpmn:BoundaryEvent")&&(!g(e,"bpmn:Event")||g(e,"bpmn:ThrowEvent")&&hv(e,"bpmn:MessageEventDefinition"))}function vw(e){return g(e,"bpmn:InteractionNode")&&!ys(e)&&(!g(e,"bpmn:Event")||g(e,"bpmn:CatchEvent")&&hv(e,"bpmn:MessageEventDefinition"))&&!(g(e,"bpmn:BoundaryEvent")&&!an(e,"bpmn:MessageEventDefinition"))}function ed(e){for(var t=e;t=t.parent;){if(g(t,"bpmn:FlowElementsContainer"))return z(t);if(g(t,"bpmn:Participant"))return z(t).processRef}return null}function dv(e,t){var n=ed(e),i=ed(t);return n===i}function an(e,t){var n=z(e);return!!ke(n.eventDefinitions||[],function(i){return g(i,t)})}function hv(e,t){var n=z(e);return(n.eventDefinitions||[]).every(function(i){return g(i,t)})}function gw(e){return g(e,"bpmn:FlowNode")&&!g(e,"bpmn:EndEvent")&&!ht(e)&&!(g(e,"bpmn:IntermediateThrowEvent")&&an(e,"bpmn:LinkEventDefinition"))&&!fv(e)&&!ys(e)}function yw(e){return g(e,"bpmn:FlowNode")&&!g(e,"bpmn:StartEvent")&&!g(e,"bpmn:BoundaryEvent")&&!ht(e)&&!(g(e,"bpmn:IntermediateCatchEvent")&&an(e,"bpmn:LinkEventDefinition"))&&!ys(e)}function _w(e){return g(e,"bpmn:ReceiveTask")||g(e,"bpmn:IntermediateCatchEvent")&&(an(e,"bpmn:MessageEventDefinition")||an(e,"bpmn:TimerEventDefinition")||an(e,"bpmn:ConditionalEventDefinition")||an(e,"bpmn:SignalEventDefinition"))}function bw(e){for(var t=[];e;)e=e.parent,e&&t.push(e);return t}function sl(e,t){var n=bw(t);return n.indexOf(e)!==-1}function Ma(e,t,n){if(ol(e)||ol(t))return null;if(!g(n,"bpmn:DataAssociation")){if(wv(e,t))return{type:"bpmn:MessageFlow"};if(Sv(e,t))return{type:"bpmn:SequenceFlow"}}var i=ku(e,t);return i||(xv(e,t)?{type:"bpmn:Association",associationDirection:"One"}:Ev(e,t)?{type:"bpmn:Association",associationDirection:"None"}:!1)}function or(e,t){return be(e)||Du(e)?!0:g(t,"bpmn:Participant")&&!ye(t)?!1:g(e,"bpmn:Participant")?g(t,"bpmn:Process")||g(t,"bpmn:Collaboration"):le(e,["bpmn:DataInput","bpmn:DataOutput"])&&e.parent?t===e.parent:g(e,"bpmn:Lane")?g(t,"bpmn:Participant")||g(t,"bpmn:Lane"):g(e,"bpmn:BoundaryEvent")&&!Ew(e)?!1:g(e,"bpmn:FlowElement")&&!g(e,"bpmn:DataStoreReference")?g(t,"bpmn:FlowElementsContainer")?ye(t):le(t,["bpmn:Participant","bpmn:Lane"]):g(e,"bpmn:DataStoreReference")&&g(t,"bpmn:Collaboration")?Mi(z(t).get("participants"),function(n){return!!n.get("processRef")}):le(e,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?le(t,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):g(e,"bpmn:MessageFlow")?g(t,"bpmn:Collaboration")||e.source.parent==t||e.target.parent==t:!1}function Ew(e){return z(e).cancelActivity&&(mv(e)||vv(e))}function xw(e){return!be(e)&&g(e,"bpmn:BoundaryEvent")}function ww(e){return g(e,"bpmn:Lane")}function Sw(e){return xw(e)||g(e,"bpmn:IntermediateThrowEvent")&&mv(e)?!0:g(e,"bpmn:IntermediateCatchEvent")&&vv(e)}function mv(e){var t=z(e);return t&&!(t.eventDefinitions&&t.eventDefinitions.length)}function vv(e){return gv(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function gv(e,t){return t.some(function(n){return an(e,n)})}function Cw(e){return g(e,"bpmn:ReceiveTask")&&ke(e.incoming,function(t){return g(t.source,"bpmn:EventBasedGateway")})}function $r(e,t,n,i){if(Array.isArray(e)||(e=[e]),e.length!==1)return!1;var r=e[0];return be(r)||!Sw(r)||ht(t)||!g(t,"bpmn:Activity")||ys(t)||i&&!pv(i,t)||Cw(t)?!1:"attach"}function yv(e,t,n){if(!t)return!1;var i={replacements:[]};return D(e,function(r){ht(t)||g(r,"bpmn:StartEvent")&&r.type!=="label"&&or(r,t)&&(i_(r)||i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"}),(r_(r)||o_(r)||a_(r))&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"}),gv(r,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&g(t,"bpmn:SubProcess")&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"})),g(t,"bpmn:Transaction")||an(r,"bpmn:CancelEventDefinition")&&r.type!=="label"&&(g(r,"bpmn:EndEvent")&&or(r,t)&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:EndEvent"}),g(r,"bpmn:BoundaryEvent")&&$r(r,t,null,n)&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:BoundaryEvent"}))}),i.replacements.length?i:!1}function _v(e,t){return Mi(e,ww)?!1:t?e.every(function(n){return or(n,t)}):!0}function cl(e,t,n,i){return t?be(e)||Du(e)?!0:dw(n,t)||n&&sl(n,t)?!1:or(e,t)||za(e,t):!1}function bv(e,t){return g(e,"bpmn:SubProcess")?ye(e)&&(!t||t.width>=100&&t.height>=80):!!(g(e,"bpmn:Lane")||g(e,"bpmn:Participant")||al(e)||Du(e))}function Tw(e,t){var n=al(e),i=al(t);return(n||i)&&n!==i}function Ev(e,t){return sl(t,e)||sl(e,t)?!1:Tw(e,t)?!0:!!ku(e,t)}function xv(e,t){return dv(e,t)&&fv(e)&&g(t,"bpmn:Activity")&&!Rw(t,e)&&!ht(t)}function wv(e,t){return td(e)&&!td(t)?!1:mw(e)&&vw(t)&&!hw(e,t)}function Sv(e,t){return gw(e)&&yw(t)&&dv(e,t)&&!(g(e,"bpmn:EventBasedGateway")&&!_w(t))}function ku(e,t){return le(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&le(t,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:le(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&le(e,["bpmn:Activity","bpmn:CatchEvent"])?{type:"bpmn:DataOutputAssociation"}:!1}function za(e,t,n){if(!t)return!1;if(Array.isArray(e)){if(e.length!==1)return!1;e=e[0]}return t.source===e||t.target===e?!1:le(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!be(t)&&g(e,"bpmn:FlowNode")&&!g(e,"bpmn:BoundaryEvent")&&or(e,t.parent)}function Pw(e,t){return e&&t&&e.indexOf(t)!==-1}function Cv(e,t){return be(t)?!0:!(g(t,"bpmn:Lane")&&!Pw(e,t.parent))}function td(e){return qr(e,"bpmn:Process")||qr(e,"bpmn:Collaboration")}function Rw(e,t){return e.attachers.includes(t)}const Aw={__depends__:[hn],__init__:["bpmnRules"],bpmnRules:["type",ot]};var Iw=2e3;function Tv(e,t){e.on("saveXML.start",Iw,n);function n(){var i=t.getRootElements();D(i,function(r){var o=Se(r),a,s;a=eo([r],!1),a=pe(a,function(c){return c!==r&&!c.labelTarget}),s=yt(a,Se),o.set("planeElement",s)})}}Tv.$inject=["eventBus","canvas"];const Mw={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",Tv]};function _s(e){H.call(this,e);var t=this;this.preExecute(["shape.create","connection.create"],function(n){var i=n.context,r=i.shape||i.connection,o=i.parent,a=t.getOrdering(r,o);a&&(a.parent!==void 0&&(i.parent=a.parent),i.parentIndex=a.index)}),this.preExecute(["shape.move","connection.move"],function(n){var i=n.context,r=i.shape||i.connection,o=i.newParent||r.parent,a=t.getOrdering(r,o);a&&(a.parent!==void 0&&(i.newParent=a.parent),i.newParentIndex=a.index)})}_s.prototype.getOrdering=function(e,t){return null};q(_s,H);function Ou(e,t){_s.call(this,e);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:9,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:TextAnnotation",order:{level:9}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function i(a){if(a.labelTarget)return{level:10};var s=ke(n,function(c){return le(a,[c.type])});return s&&s.order||{level:1}}function r(a){var s=a.order;if(s||(a.order=s=i(a)),!s)throw new Error("no order for <"+a.id+">");return s}function o(a,s,c){for(var l=s;l&&!le(l,c);)l=l.parent;if(!l)throw new Error("no parent for <"+a.id+"> in <"+(s&&s.id)+">");return l}this.getOrdering=function(a,s){if(a.labelTarget||g(a,"bpmn:TextAnnotation"))return{parent:t.findRoot(s)||t.getRootElement(),index:-1};var c=r(a);c.containers&&(s=o(a,s,c.containers));var l=s.children.indexOf(a),p=s_(s.children,function(u){return!a.labelTarget&&u.labelTarget?!1:c.level<r(u).level});return p!==-1&&l!==-1&&l<p&&(p-=1),{index:p,parent:s}}}Ou.$inject=["eventBus","canvas"];q(Ou,_s);const Dw={__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",Ou]};function so(){}so.prototype.get=function(){return this._data};so.prototype.set=function(e){this._data=e};so.prototype.clear=function(){var e=this._data;return delete this._data,e};so.prototype.isEmpty=function(){return!this._data};const kw={clipboard:["type",so]};var Ow="drop-ok",nd="drop-not-ok",id="attach-ok",rd="new-parent",od="create",Nw=2e3;function Pv(e,t,n,i,r){function o(c,l,p,u,f){if(!l)return!1;c=pe(c,function(w){var _=w.labelTarget;return!w.parent&&!(be(w)&&c.indexOf(_)!==-1)});var d=ke(c,function(w){return!Te(w)}),h=!1,m=!1,v=!1;sd(c)&&(h=r.allowed("shape.attach",{position:p,shape:d,target:l})),h||(sd(c)?v=r.allowed("shape.create",{position:p,shape:d,source:u,target:l}):v=r.allowed("elements.create",{elements:c,position:p,target:l}));var E=f.connectionTarget;return v||h?(d&&u&&(m=r.allowed("connection.create",{source:E===u?d:u,target:E===u?u:d,hints:{targetParent:l,targetAttach:h}})),{attach:h,connect:m}):v===null||h===null?null:!1}function a(c,l){[id,Ow,nd,rd].forEach(function(p){p===l?e.addMarker(c,p):e.removeMarker(c,p)})}n.on(["create.move","create.hover"],function(c){var l=c.context,p=l.elements,u=c.hover,f=l.source,d=l.hints||{};if(!u){l.canExecute=!1,l.target=null;return}ad(c);var h={x:c.x,y:c.y},m=l.canExecute=u&&o(p,u,h,f,d);u&&m!==null&&(l.target=u,m&&m.attach?a(u,id):a(u,m?rd:nd))}),n.on(["create.end","create.out","create.cleanup"],function(c){var l=c.hover;l&&a(l,null)}),n.on("create.end",function(c){var l=c.context,p=l.source,u=l.shape,f=l.elements,d=l.target,h=l.canExecute,m=h&&h.attach,v=h&&h.connect,E=l.hints||{};if(h===!1||!d)return!1;ad(c);var w={x:c.x,y:c.y};v?u=i.appendShape(p,u,w,d,{attach:m,connection:v===!0?{}:v,connectionTarget:E.connectionTarget}):(f=i.createElements(f,w,d,N({},E,{attach:m})),u=ke(f,function(_){return!Te(_)})),N(l,{elements:f,shape:u}),N(c,{elements:f,shape:u})});function s(){var c=t.context();c&&c.prefix===od&&t.cancel()}n.on("create.init",function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],Nw,function(){n.off("elements.changed",s)})}),this.start=function(c,l,p){ve(l)||(l=[l]);var u=ke(l,function(h){return!Te(h)});if(u){p=N({elements:l,hints:{},shape:u},p||{}),D(l,function(h){ue(h.x)||(h.x=0),ue(h.y)||(h.y=0)});var f=pe(l,function(h){return!h.hidden}),d=At(f);D(l,function(h){Te(h)&&(h.waypoints=yt(h.waypoints,function(m){return{x:m.x-d.x-d.width/2,y:m.y-d.y-d.height/2}})),N(h,{x:h.x-d.x-d.width/2,y:h.y-d.y-d.height/2})}),t.init(c,od,{cursor:"grabbing",autoActivate:!0,data:{shape:u,elements:l,context:p}})}}}Pv.$inject=["canvas","dragging","eventBus","modeling","rules"];function ad(e){var t=e.context,n=t.createConstraints;n&&(n.left&&(e.x=Math.max(e.x,n.left)),n.right&&(e.x=Math.min(e.x,n.right)),n.top&&(e.y=Math.max(e.y,n.top)),n.bottom&&(e.y=Math.min(e.y,n.bottom)))}function sd(e){return e&&e.length===1&&!Te(e[0])}var Lw=750;function Rv(e,t,n,i,r){function o(a){var s=de("g");ie(s,r.cls("djs-drag-group",["no-events"]));var c=de("g");return a.forEach(function(l){var p;l.hidden||(l.waypoints?(p=n._createContainer("connection",c),n.drawConnection(Ti(p),l)):(p=n._createContainer("shape",c),n.drawShape(Ti(p),l),dt(p,l.x,l.y)),i.addDragger(l,s,p))}),s}t.on("create.move",Lw,function(a){var s=a.hover,c=a.context,l=c.elements,p=c.dragGroup;p||(p=c.dragGroup=o(l));var u;s?(p.parentNode||(u=e.getActiveLayer(),ge(u,p)),dt(p,a.x,a.y)):Qe(p)}),t.on("create.cleanup",function(a){var s=a.context,c=s.dragGroup;c&&Qe(c)})}Rv.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const bs={__depends__:[Pn,fr,hn,Cn],__init__:["create","createPreview"],create:["type",Pv],createPreview:["type",Rv]};function Nu(e){var t=this;this._lastMoveEvent=null;function n(i){t._lastMoveEvent=i}e.on("canvas.init",function(i){var r=t._svg=i.svg;r.addEventListener("mousemove",n)}),e.on("canvas.destroy",function(){t._lastMouseEvent=null,t._svg.removeEventListener("mousemove",n)})}Nu.$inject=["eventBus"];Nu.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||Bw(0,0)};function Bw(e,t){var n=document.createEvent("MouseEvent"),i=e,r=t,o=e,a=t;return n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,i,r,o,a,!1,!1,!1,!1,0,null),n}const co={__init__:["mouse"],mouse:["type",Nu]};function Xt(e,t,n,i,r,o,a,s){this._canvas=e,this._create=t,this._clipboard=n,this._elementFactory=i,this._eventBus=r,this._modeling=o,this._mouse=a,this._rules=s,r.on("copyPaste.copyElement",function(c){var l=c.descriptor,p=c.element,u=c.elements;l.priority=1,l.id=p.id;var f=ke(u,function(d){return d===p.parent});f&&(l.parent=p.parent.id),$w(p)&&(l.priority=2,l.host=p.host.id),Te(p)&&(l.priority=3,l.source=p.source.id,l.target=p.target.id,l.waypoints=Fw(p)),be(p)&&(l.priority=4,l.labelTarget=p.labelTarget.id),D(["x","y","width","height"],function(d){ue(p[d])&&(l[d]=p[d])}),l.hidden=p.hidden,l.collapsed=p.collapsed}),r.on("copyPaste.pasteElements",function(c){var l=c.hints;N(l,{createElementsBehavior:!1})})}Xt.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"];Xt.prototype.copy=function(e){var t,n;return ve(e)||(e=e?[e]:[]),t=this._eventBus.fire("copyPaste.canCopyElements",{elements:e}),t===!1?n={}:n=this.createTree(ve(t)?t:e),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:e,tree:n}),n};Xt.prototype.paste=function(e){var t=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=e&&e.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var i=this._createElements(t);if(e&&e.element&&e.point)return this._paste(i,e.element,e.point,n);this._create.start(this._mouse.getLastMoveEvent(),i,{hints:n||{}})}};Xt.prototype._paste=function(e,t,n,i){D(e,function(o){ue(o.x)||(o.x=0),ue(o.y)||(o.y=0)});var r=At(e);return D(e,function(o){Te(o)&&(o.waypoints=yt(o.waypoints,function(a){return{x:a.x-r.x-r.width/2,y:a.y-r.y-r.height/2}})),N(o,{x:o.x-r.x-r.width/2,y:o.y-r.y-r.height/2})}),this._modeling.createElements(e,n,t,N({},i))};Xt.prototype._createElements=function(e){var t=this,n=this._eventBus,i={},r=[];return D(e,function(o,a){o=un(o,"priority"),D(o,function(s){var c=N({},Sn(s,["priority"]));i[s.parent]?c.parent=i[s.parent]:delete c.parent,n.fire("copyPaste.pasteElement",{cache:i,descriptor:c});var l;if(Te(c)){c.source=i[s.source],c.target=i[s.target],l=i[s.id]=t.createConnection(c),r.push(l);return}if(be(c)){c.labelTarget=i[c.labelTarget],l=i[s.id]=t.createLabel(c),r.push(l);return}c.host&&(c.host=i[c.host]),l=i[s.id]=t.createShape(c),r.push(l)})}),r};Xt.prototype.createConnection=function(e){var t=this._elementFactory.createConnection(Sn(e,["id"]));return t};Xt.prototype.createLabel=function(e){var t=this._elementFactory.createLabel(Sn(e,["id"]));return t};Xt.prototype.createShape=function(e){var t=this._elementFactory.createShape(Sn(e,["id"]));return t};Xt.prototype.hasRelations=function(e,t){var n,i,r;return!(Te(e)&&(i=ke(t,En({id:e.source.id})),r=ke(t,En({id:e.target.id})),!i||!r)||be(e)&&(n=ke(t,En({id:e.labelTarget.id})),!n))};Xt.prototype.createTree=function(e){var t=this._rules,n=this,i={},r=[],o=qa(e);function a(l,p){return t.allowed("element.copy",{element:l,elements:p})}function s(l,p){var u=ke(r,function(f){return l===f.element});if(!u){r.push({element:l,depth:p});return}u.depth<p&&(r=c(u,r),r.push({element:u.element,depth:p}))}function c(l,p){var u=p.indexOf(l);return u!==-1&&p.splice(u,1),p}return Qa(o,function(l,p,u){if(be(l))return;D(l.labels,function(h){s(h,u)});function f(h){h&&h.length&&D(h,function(m){D(m.labels,function(v){s(v,u)}),s(m,u)})}D([l.attachers,l.incoming,l.outgoing],f),s(l,u);var d=[];return l.children&&(d=l.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:l,children:d}),d}),e=yt(r,function(l){return l.element}),r=yt(r,function(l){return l.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:l.descriptor,element:l.element,elements:e}),l}),r=un(r,function(l){return l.descriptor.priority}),e=yt(r,function(l){return l.element}),D(r,function(l){var p=l.depth;if(!n.hasRelations(l.element,e)){ld(l.element,e);return}if(!a(l.element,e)){ld(l.element,e);return}i[p]||(i[p]=[]),i[p].push(l.descriptor)}),i};function $w(e){return!!e.host}function Fw(e){return yt(e.waypoints,function(t){return t=cd(t),t.original&&(t.original=cd(t.original)),t})}function cd(e){return N({},e)}function ld(e,t){var n=t.indexOf(e);return n===-1?t:t.splice(n,1)}const jw={__depends__:[kw,bs,co,hn],__init__:["copyPaste"],copyPaste:["type",Xt]};function bc(e,t,n){ve(n)||(n=[n]),D(n,function(i){jh(e[i])||(t[i]=e[i])})}var Ec=750;function Av(e,t,n){function i(c,l){var p=e.create(c.$type);return n.copyElement(c,p,null,l)}t.on("copyPaste.copyElement",Ec,function(c){var l=c.descriptor,p=c.element,u=z(p);if(be(p))return l;var f=l.businessObject=i(u,!0),d=l.di=i(Se(p),!0);d.bpmnElement=f,bc(f,l,"name"),bc(d,l,"isExpanded"),u.default&&(l.default=u.default.id)});var r="-bpmn-js-refs";function o(c){return c[r]=c[r]||{}}function a(c,l){c[r]=l}function s(c,l,p){var u=z(c);return c.default&&(p[c.default]={element:u,property:"default"}),c.host&&(z(c).attachedToRef=z(l[c.host])),Sn(p,Zn(p,function(f,d,h){var m=d.element,v=d.property;return h===c.id&&(m.set(v,u),f.push(c.id)),f},[]))}t.on("copyPaste.pasteElement",function(c){var l=c.cache,p=c.descriptor,u=p.businessObject,f=p.di;if(be(p)){p.businessObject=z(l[p.labelTarget]),p.di=Se(l[p.labelTarget]);return}u=p.businessObject=i(u),f=p.di=i(f),f.bpmnElement=u,bc(p,u,["isExpanded","name"]),p.type=u.$type}),t.on("copyPaste.copyElement",Ec,function(c){var l=c.descriptor,p=c.element;if(g(p,"bpmn:Participant")){var u=z(p);u.processRef&&(l.processRef=i(u.processRef,!0))}}),t.on("copyPaste.pasteElement",function(c){var l=c.descriptor,p=l.processRef;p&&(l.processRef=i(p))}),t.on("copyPaste.pasteElement",Ec,function(c){var l=c.cache,p=c.descriptor;a(l,s(p,l,o(l)))})}Av.$inject=["bpmnFactory","eventBus","moddleCopy"];var Hw=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing","categoryValue"];function lo(e,t,n){this._bpmnFactory=t,this._eventBus=e,this._moddle=n,e.on("moddleCopy.canCopyProperties",function(i){var r=i.propertyNames;if(!(!r||!r.length))return un(r,function(o){return o==="extensionElements"})}),e.on("moddleCopy.canCopyProperty",function(i){var r=i.parent,o=fn(r)&&r.$descriptor,a=i.propertyName;if(a&&Hw.indexOf(a)!==-1||a&&o&&!ke(o.properties,En({name:a})))return!1}),e.on("moddleCopy.canSetCopiedProperty",function(i){var r=i.property;if(Gw(r,"bpmn:ExtensionElements")&&(!r.values||!r.values.length))return!1})}lo.$inject=["eventBus","bpmnFactory","moddle"];lo.prototype.copyElement=function(e,t,n,i=!1){var r=this;n&&!ve(n)&&(n=[n]),n=n||ll(e.$descriptor);var o=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:n,sourceElement:e,targetElement:t,clone:i});return o===!1||(ve(o)&&(n=o),D(n,function(a){var s;Vn(e,a)&&(s=e.get(a));var c=r.copyProperty(s,t,a,i);if(Pt(c)){var l=r._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:t,property:c,propertyName:a});l!==!1&&t.set(a,c)}})),t};lo.prototype.copyProperty=function(e,t,n,i=!1){var r=this,o=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:t,property:e,propertyName:n,clone:i});if(o!==!1){if(o)return fn(o)&&o.$type&&!o.$parent&&(o.$parent=t),o;var a=this._moddle.getPropertyDescriptor(t,n);if(!a.isReference)return a.isId?e&&this._copyId(e,t,i):ve(e)?Zn(e,function(s,c){return o=r.copyProperty(c,t,n,i),o?s.concat(o):s},[]):fn(e)&&e.$type?this._moddle.getElementDescriptor(e).isGeneric?void 0:(o=r._bpmnFactory.create(e.$type),o.$parent=t,o=r.copyElement(e,o,null,i),o):e}};lo.prototype._copyId=function(e,t,n=!1){if(n)return e;if(!this._moddle.ids.assigned(e))return this._moddle.ids.claim(e,t),e};function ll(e,t){return Zn(e.properties,function(n,i){return t&&i.default?n:n.concat(i.name)},[])}function Gw(e,t){return e&&jt(e.$instanceOf)&&e.$instanceOf(t)}const Iv={__depends__:[jw],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",Av],moddleCopy:["type",lo]};var ud=Math.round;function Lu(e,t){this._modeling=e,this._eventBus=t}Lu.$inject=["modeling","eventBus"];Lu.prototype.replaceElement=function(e,t,n){if(e.waypoints)return null;var i=this._modeling,r=this._eventBus;r.fire("replace.start",{element:e,attrs:t,hints:n});var o=t.width||e.width,a=t.height||e.height,s=t.x||e.x,c=t.y||e.y,l=ud(s+o/2),p=ud(c+a/2),u=i.replaceShape(e,N({},t,{x:l,y:p,width:o,height:a}),n);return r.fire("replace.end",{element:e,newElement:u,hints:n}),u};function Mv(e,t){t.on("replace.end",500,function(n){const{newElement:i,hints:r={}}=n;r.select!==!1&&e.select(i)})}Mv.$inject=["selection","eventBus"];const zw={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",Mv],replace:["type",Lu]};function Vw(e,t,n){ve(n)||(n=[n]),D(n,function(i){jh(e[i])||(t[i]=e[i])})}var Uw=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function Ww(e,t){var n=e&&Vn(e,"collapsed")?e.collapsed:!ye(e),i;return t&&(Vn(t,"collapsed")||Vn(t,"isExpanded"))?i=Vn(t,"collapsed")?t.collapsed:!t.isExpanded:i=n,n!==i}function Dv(e,t,n,i,r,o){function a(s,c,l){l=l||{};var p=c.type,u=s.businessObject;if(la(u)&&p==="bpmn:SubProcess"&&Ww(s,c))return i.toggleCollapse(s),s;var f=e.create(p),d={type:p,businessObject:f};d.di={},p==="bpmn:ExclusiveGateway"&&(d.di.isMarkerVisible=!0),Vw(s.di,d.di,["fill","stroke","background-color","border-color","color"]);var h=ll(u.$descriptor),m=ll(f.$descriptor,!0),v=Yw(h,m);N(f,pn(c,Uw));var E=pe(v,function(_){return _==="eventDefinitions"?pd(s,c.eventDefinitionType):_==="loopCharacteristics"?!ht(f):Vn(f,_)||_==="processRef"&&c.isExpanded===!1||_==="triggeredByEvent"?!1:_==="isForCompensation"?!ht(f):!0});if(f=n.copyElement(u,f,E),c.eventDefinitionType&&(pd(f,c.eventDefinitionType)||(d.eventDefinitionType=c.eventDefinitionType,d.eventDefinitionAttrs=c.eventDefinitionAttrs)),g(u,"bpmn:Activity")){if(la(u))d.isExpanded=ye(s);else if(c&&Vn(c,"isExpanded")){d.isExpanded=c.isExpanded;var w=t.getDefaultSize(f,{isExpanded:d.isExpanded});d.width=w.width,d.height=w.height,d.x=s.x-(d.width-s.width)/2,d.y=s.y-(d.height-s.height)/2}ye(s)&&!g(u,"bpmn:Task")&&d.isExpanded&&(d.width=s.width,d.height=s.height)}return la(u)&&!la(f)&&(l.moveChildren=!1),g(u,"bpmn:Participant")&&(c.isExpanded===!0?f.processRef=e.create("bpmn:Process"):l.moveChildren=!1,d.width=s.width,d.height=t.getDefaultSize(d).height),o.allowed("shape.resize",{shape:f})||(d.height=t.getDefaultSize(d).height,d.width=t.getDefaultSize(d).width),f.name=u.name,le(u,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&le(f,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(f.default=u.default),c.host&&!g(u,"bpmn:BoundaryEvent")&&g(f,"bpmn:BoundaryEvent")&&(d.host=c.host),(d.type==="bpmn:DataStoreReference"||d.type==="bpmn:DataObjectReference")&&(d.x=s.x+(s.width-d.width)/2),r.replaceElement(s,d,Re(re({},l),{targetElement:c}))}this.replaceElement=a}Dv.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules"];function la(e){return g(e,"bpmn:SubProcess")}function pd(e,t){var n=z(e);return t&&n.get("eventDefinitions").some(function(i){return g(i,t)})}function Yw(e,t){return e.filter(function(n){return t.includes(n)})}const kv={__depends__:[Iv,zw,Cn],bpmnReplace:["type",Dv]};var qw=250;function Di(e){this._eventBus=e,this._tools=[],this._active=null}Di.$inject=["eventBus"];Di.prototype.registerTool=function(e,t){var n=this._tools;if(!t)throw new Error(`A tool has to be registered with it's "events"`);n.push(e),this.bindEvents(e,t)};Di.prototype.isActive=function(e){return e&&this._active===e};Di.prototype.length=function(e){return this._tools.length};Di.prototype.setActive=function(e){var t=this._eventBus;this._active!==e&&(this._active=e,t.fire("tool-manager.update",{tool:e}))};Di.prototype.bindEvents=function(e,t){var n=this._eventBus,i=[];n.on(t.tool+".init",function(r){var o=r.context;if(!o.reactivate&&this.isActive(e)){this.setActive(null);return}this.setActive(e)},this),D(t,function(r){i.push(r+".ended"),i.push(r+".canceled")}),n.on(i,qw,function(r){this._active&&(Kw(r)||this.setActive(null))},this)};function Kw(e){var t=e.originalEvent&&e.originalEvent.target;return t&&Zr(t,'.group[data-group="tools"]')}const Es={__depends__:[Pn],__init__:["toolManager"],toolManager:["type",Di]};function Xw(e,t){if(e==="x"){if(t>0)return"e";if(t<0)return"w"}if(e==="y"){if(t>0)return"s";if(t<0)return"n"}return null}function Zw(e,t){var n=[];return D(e.concat(t),function(i){var r=i.incoming,o=i.outgoing;D(r.concat(o),function(a){var s=a.source,c=a.target;(Dr(e,s)||Dr(e,c)||Dr(t,s)||Dr(t,c))&&(Dr(n,a)||n.push(a))})}),n}function Dr(e,t){return e.indexOf(t)!==-1}function Jw(e,t,n){var i=e.x,r=e.y,o=e.width,a=e.height,s=n.x,c=n.y;switch(t){case"n":return{x:i,y:r+c,width:o,height:a-c};case"s":return{x:i,y:r,width:o,height:a+c};case"w":return{x:i+s,y:r,width:o-s,height:a};case"e":return{x:i,y:r,width:o+s,height:a};default:throw new Error("unknown direction: "+t)}}var xc=Math.abs,Qw=Math.round,_n={x:"width",y:"height"},Ov="crosshair",Hn={n:"top",w:"left",s:"bottom",e:"right"},e0=1500,ua={n:"s",w:"e",s:"n",e:"w"},pa=20;function zt(e,t,n,i,r,o,a){this._canvas=e,this._dragging=t,this._eventBus=n,this._modeling=i,this._rules=r,this._toolManager=o,this._mouse=a;var s=this;o.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",function(c){n.once("spaceTool.selection.ended",function(){s.activateMakeSpace(c.originalEvent)})}),n.on("spaceTool.move",e0,function(c){var l=c.context,p=l.initialized;p||(p=l.initialized=s.init(c,l)),p&&dd(c)}),n.on("spaceTool.end",function(c){var l=c.context,p=l.axis,u=l.direction,f=l.movingShapes,d=l.resizingShapes,h=l.start;if(l.initialized){dd(c);var m={x:0,y:0};m[p]=Qw(c["d"+p]),s.makeSpace(f,d,m,u,h),n.once("spaceTool.ended",function(v){s.activateSelection(v.originalEvent,!0,!0)})}})}zt.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"];zt.prototype.activateSelection=function(e,t,n){this._dragging.init(e,"spaceTool.selection",{autoActivate:t,cursor:Ov,data:{context:{reactivate:n}},trapClick:!1})};zt.prototype.activateMakeSpace=function(e){this._dragging.init(e,"spaceTool",{autoActivate:!0,cursor:Ov,data:{context:{}}})};zt.prototype.makeSpace=function(e,t,n,i,r){return this._modeling.createSpace(e,t,n,i,r)};zt.prototype.init=function(e,t){var n=xc(e.dx)>xc(e.dy)?"x":"y",i=e["d"+n],r=e[n]-i;if(xc(i)<5)return!1;i<0&&(i*=-1),zr(e)&&(i*=-1);var o=Xw(n,i),a=this._canvas.getRootElement();!Fc(e)&&e.hover&&(a=e.hover);var s=[...eo(a,!0),...a.attachers||[]],c=this.calculateAdjustments(s,n,i,r),l=this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:o,shapes:c.resizingShapes,start:r}),p=t0(c,n,o,r,l);return N(t,c,{axis:n,direction:o,spaceToolConstraints:p,start:r}),Nh("resize-"+(n==="x"?"ew":"ns")),!0};zt.prototype.calculateAdjustments=function(e,t,n,i){var r=this._rules,o=[],a=[],s=[],c=[];function l(f){o.includes(f)||o.push(f);var d=f.label;d&&!o.includes(d)&&o.push(d)}function p(f){a.includes(f)||a.push(f)}D(e,function(f){if(!(!f.parent||be(f))){if(Te(f)){c.push(f);return}var d=f[t],h=d+f[_n[t]];if(n0(f)&&(n>0&&se(f)[t]>i||n<0&&se(f)[t]<i)){s.push(f);return}if(n>0&&d>i||n<0&&h<i){l(f);return}if(d<i&&h>i&&r.allowed("shape.resize",{shape:f})){p(f);return}}}),D(o,function(f){var d=f.attachers;d&&D(d,function(h){l(h)})});var u=o.concat(a);return D(s,function(f){var d=f.host;Si(u,d)&&l(f)}),u=o.concat(a),D(c,function(f){var d=f.source,h=f.target,m=f.label;Si(u,d)&&Si(u,h)&&m&&l(m)}),{movingShapes:o,resizingShapes:a}};zt.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)};zt.prototype.isActive=function(){var e=this._dragging.context();return e?/^spaceTool/.test(e.prefix):!1};function fd(e){return{top:e.top-pa,right:e.right+pa,bottom:e.bottom+pa,left:e.left-pa}}function dd(e){var t=e.context,n=t.spaceToolConstraints;if(n){var i,r;ue(n.left)&&(i=Math.max(e.x,n.left),e.dx=e.dx+i-e.x,e.x=i),ue(n.right)&&(i=Math.min(e.x,n.right),e.dx=e.dx+i-e.x,e.x=i),ue(n.top)&&(r=Math.max(e.y,n.top),e.dy=e.dy+r-e.y,e.y=r),ue(n.bottom)&&(r=Math.min(e.y,n.bottom),e.dy=e.dy+r-e.y,e.y=r)}}function t0(e,t,n,i,r){var o=e.movingShapes,a=e.resizingShapes;if(a.length){var s={},c,l;return D(a,function(p){var u=p.attachers,f=p.children,d=te(p),h=pe(f,function(k){return!Te(k)&&!be(k)&&!Si(o,k)&&!Si(a,k)}),m=pe(f,function(k){return!Te(k)&&!be(k)&&Si(o,k)}),v,E,w,_=[],x=[],P,A,C,I;h.length&&(E=fd(te(At(h))),v=i-d[Hn[n]]+E[Hn[n]],n==="n"?s.bottom=l=ue(l)?Math.min(l,v):v:n==="w"?s.right=l=ue(l)?Math.min(l,v):v:n==="s"?s.top=c=ue(c)?Math.max(c,v):v:n==="e"&&(s.left=c=ue(c)?Math.max(c,v):v)),m.length&&(w=fd(te(At(m))),v=i-w[Hn[ua[n]]]+d[Hn[ua[n]]],n==="n"?s.bottom=l=ue(l)?Math.min(l,v):v:n==="w"?s.right=l=ue(l)?Math.min(l,v):v:n==="s"?s.top=c=ue(c)?Math.max(c,v):v:n==="e"&&(s.left=c=ue(c)?Math.max(c,v):v)),u&&u.length&&(u.forEach(function(k){Si(o,k)?_.push(k):x.push(k)}),_.length&&(P=te(At(_.map(se))),A=d[Hn[ua[n]]]-(P[Hn[ua[n]]]-i)),x.length&&(C=te(At(x.map(se))),I=C[Hn[n]]-(d[Hn[n]]-i)),n==="n"?(v=Math.min(A||1/0,I||1/0),s.bottom=l=ue(l)?Math.min(l,v):v):n==="w"?(v=Math.min(A||1/0,I||1/0),s.right=l=ue(l)?Math.min(l,v):v):n==="s"?(v=Math.max(A||-1/0,I||-1/0),s.top=c=ue(c)?Math.max(c,v):v):n==="e"&&(v=Math.max(A||-1/0,I||-1/0),s.left=c=ue(c)?Math.max(c,v):v));var T=r&&r[p.id];T&&(n==="n"?(v=i+p[_n[t]]-T[_n[t]],s.bottom=l=ue(l)?Math.min(l,v):v):n==="w"?(v=i+p[_n[t]]-T[_n[t]],s.right=l=ue(l)?Math.min(l,v):v):n==="s"?(v=i-p[_n[t]]+T[_n[t]],s.top=c=ue(c)?Math.max(c,v):v):n==="e"&&(v=i-p[_n[t]]+T[_n[t]],s.left=c=ue(c)?Math.max(c,v):v))}),s}}function Si(e,t){return e.indexOf(t)!==-1}function n0(e){return!!e.host}var wc="djs-dragging",hd="djs-resizing",i0=250,fa=Math.max;function Nv(e,t,n,i,r){function o(a,s){D(a,function(c){r.addDragger(c,s),n.addMarker(c,wc)})}e.on("spaceTool.selection.start",function(a){var s=n.getLayer("space"),c=a.context,l={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},p=de("g");ie(p,i.cls("djs-crosshair-group",["no-events"])),ge(s,p);var u=de("path");ie(u,"d",l.x),Ae(u).add("djs-crosshair"),ge(p,u);var f=de("path");ie(f,"d",l.y),Ae(f).add("djs-crosshair"),ge(p,f),c.crosshairGroup=p}),e.on("spaceTool.selection.move",function(a){var s=a.context.crosshairGroup;dt(s,a.x,a.y)}),e.on("spaceTool.selection.cleanup",function(a){var s=a.context,c=s.crosshairGroup;c&&Qe(c)}),e.on("spaceTool.move",i0,function(a){var s=a.context,c=s.line,l=s.axis,p=s.movingShapes,u=s.resizingShapes;if(s.initialized){if(!s.dragGroup){var f=n.getLayer("space");c=de("path"),ie(c,"d","M0,0 L0,0"),Ae(c).add("djs-crosshair"),ge(f,c),s.line=c;var d=de("g");ie(d,i.cls("djs-drag-group",["no-events"])),ge(n.getActiveLayer(),d),o(p,d);var h=s.movingConnections=t.filter(function(x){var P=!1;D(p,function(T){D(T.outgoing,function(k){x===k&&(P=!0)})});var A=!1;D(p,function(T){D(T.incoming,function(k){x===k&&(A=!0)})});var C=!1;D(u,function(T){D(T.outgoing,function(k){x===k&&(C=!0)})});var I=!1;return D(u,function(T){D(T.incoming,function(k){x===k&&(I=!0)})}),Te(x)&&(P||C)&&(A||I)});o(h,d),s.dragGroup=d}if(!s.frameGroup){var m=de("g");ie(m,i.cls("djs-frame-group",["no-events"])),ge(n.getActiveLayer(),m);var v=[];D(u,function(x){var P=r.addFrame(x,m),A=P.getBBox();v.push({element:P,initialBounds:A}),n.addMarker(x,hd)}),s.frameGroup=m,s.frames=v}var E={x:"M"+a.x+", -10000 L"+a.x+", 10000",y:"M -10000, "+a.y+" L 10000, "+a.y};ie(c,{d:E[l]});var w={x:"y",y:"x"},_={x:a.dx,y:a.dy};_[w[s.axis]]=0,dt(s.dragGroup,_.x,_.y),D(s.frames,function(x){var P=x.element,A=x.initialBounds,C,I;s.direction==="e"?ie(P,{width:fa(A.width+_.x,5)}):(C=fa(A.width-_.x,5),ie(P,{width:C,x:A.x+A.width-C})),s.direction==="s"?ie(P,{height:fa(A.height+_.y,5)}):(I=fa(A.height-_.y,5),ie(P,{height:I,y:A.y+A.height-I}))})}}),e.on("spaceTool.cleanup",function(a){var s=a.context,c=s.movingShapes,l=s.movingConnections,p=s.resizingShapes,u=s.line,f=s.dragGroup,d=s.frameGroup;D(c,function(h){n.removeMarker(h,wc)}),D(l,function(h){n.removeMarker(h,wc)}),f&&(Qe(u),Qe(f)),D(p,function(h){n.removeMarker(h,hd)}),d&&Qe(d)})}Nv.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const r0={__init__:["spaceToolPreview"],__depends__:[Pn,hn,Es,fr,co],spaceTool:["type",zt],spaceToolPreview:["type",Nv]};function xs(e){e.invoke(zt,this)}xs.$inject=["injector"];q(xs,zt);xs.prototype.calculateAdjustments=function(e,t,n,i){var r=zt.prototype.calculateAdjustments.call(this,e,t,n,i);return r.resizingShapes=r.resizingShapes.filter(function(o){return!(g(o,"bpmn:TextAnnotation")||o0(o)&&(t==="y"&&mt(o)||t==="x"&&!mt(o)))}),r};function o0(e){return g(e,"bpmn:Participant")&&!z(e).processRef}const Lv={__depends__:[r0],spaceTool:["type",xs]};function Ne(e,t){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=t,this._eventBus=e,this._uid=1,e.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}Ne.$inject=["eventBus","injector"];Ne.prototype.execute=function(e,t){if(!e)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:e,context:t};this._pushAction(n),this._internalExecute(n),this._popAction()};Ne.prototype.canExecute=function(e,t){const n={command:e,context:t},i=this._getHandler(e);let r=this._fire(e,"canExecute",n);if(r===void 0){if(!i)return!1;i.canExecute&&(r=i.canExecute(t))}return r};Ne.prototype.clear=function(e){this._stack.length=0,this._stackIdx=-1,e!==!1&&this._fire("changed",{trigger:"clear"})};Ne.prototype.undo=function(){let e=this._getUndoAction(),t;if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),!(!t||t.id!==e.id));)e=t;this._popAction()}};Ne.prototype.redo=function(){let e=this._getRedoAction(),t;if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),!(!t||t.id!==e.id));)e=t;this._popAction()}};Ne.prototype.register=function(e,t){this._setHandler(e,t)};Ne.prototype.registerHandler=function(e,t){if(!e||!t)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(t);this.register(e,n)};Ne.prototype.canUndo=function(){return!!this._getUndoAction()};Ne.prototype.canRedo=function(){return!!this._getRedoAction()};Ne.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};Ne.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};Ne.prototype._internalUndo=function(e){const t=e.command,n=e.context,i=this._getHandler(t);this._atomicDo(()=>{this._fire(t,"revert",e),i.revert&&this._markDirty(i.revert(n)),this._revertedAction(e),this._fire(t,"reverted",e)})};Ne.prototype._fire=function(e,t,n){arguments.length<3&&(n=t,t=null);const i=t?[e+"."+t,t]:[e];let r;n=this._eventBus.createEvent(n);for(const o of i)if(r=this._eventBus.fire("commandStack."+o,n),n.cancelBubble)break;return r};Ne.prototype._createId=function(){return this._uid++};Ne.prototype._atomicDo=function(e){const t=this._currentExecution;t.atomic=!0;try{e()}finally{t.atomic=!1}};Ne.prototype._internalExecute=function(e,t){const n=e.command,i=e.context,r=this._getHandler(n);if(!r)throw new Error("no command handler registered for <"+n+">");this._pushAction(e),t||(this._fire(n,"preExecute",e),r.preExecute&&r.preExecute(i),this._fire(n,"preExecuted",e)),this._atomicDo(()=>{this._fire(n,"execute",e),r.execute&&this._markDirty(r.execute(i)),this._executedAction(e,t),this._fire(n,"executed",e)}),t||(this._fire(n,"postExecute",e),r.postExecute&&r.postExecute(i),this._fire(n,"postExecuted",e)),this._popAction()};Ne.prototype._pushAction=function(e){const t=this._currentExecution,n=t.actions,i=n[0];if(t.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+e.command+")");e.id||(e.id=i&&i.id||this._createId()),n.push(e)};Ne.prototype._popAction=function(){const e=this._currentExecution,t=e.trigger,n=e.actions,i=e.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:c_("id",i.reverse())}),i.length=0,this._fire("changed",{trigger:t}),e.trigger=null)};Ne.prototype._markDirty=function(e){const t=this._currentExecution;e&&(e=ve(e)?e:[e],t.dirty=t.dirty.concat(e))};Ne.prototype._executedAction=function(e,t){const n=++this._stackIdx;t||this._stack.splice(n,this._stack.length,e)};Ne.prototype._revertedAction=function(e){this._stackIdx--};Ne.prototype._getHandler=function(e){return this._handlerMap[e]};Ne.prototype._setHandler=function(e,t){if(!e||!t)throw new Error("command and handler required");if(this._handlerMap[e])throw new Error("overriding handler for command <"+e+">");this._handlerMap[e]=t};const a0={commandStack:["type",Ne]};function Wn(e,t){if(typeof t!="function")throw new Error("removeFn iterator must be a function");if(e){for(var n;n=e[0];)t(n);return e}}var s0=250,md=1400;function Bu(e,t,n){H.call(this,t);var i=e.get("movePreview",!1);t.on("shape.move.start",md,function(r){var o=r.context,a=o.shapes,s=o.validatedShapes;o.shapes=vd(a),o.validatedShapes=vd(s)}),i&&t.on("shape.move.start",s0,function(r){var o=r.context,a=o.shapes,s=[];D(a,function(c){D(c.labels,function(l){!l.hidden&&o.shapes.indexOf(l)===-1&&s.push(l),c.labelTarget&&s.push(c)})}),D(s,function(c){i.makeDraggable(o,c,!0)})}),this.preExecuted("elements.move",md,function(r){var o=r.context,a=o.closure,s=a.enclosedElements,c=[];D(s,function(l){D(l.labels,function(p){s[p.id]||c.push(p)})}),a.addAll(c)}),this.preExecute(["connection.delete","shape.delete"],function(r){var o=r.context,a=o.connection||o.shape;Wn(a.labels,function(s){n.removeShape(s,{nested:!0})})}),this.execute("shape.delete",function(r){var o=r.context,a=o.shape,s=a.labelTarget;s&&(o.labelTargetIndex=Rl(s.labels,a),o.labelTarget=s,a.labelTarget=null)}),this.revert("shape.delete",function(r){var o=r.context,a=o.shape,s=o.labelTarget,c=o.labelTargetIndex;s&&(Xe(s.labels,a,c),a.labelTarget=s)})}q(Bu,H);Bu.$inject=["injector","eventBus","modeling"];function vd(e){return pe(e,function(t){return e.indexOf(t.labelTarget)===-1})}const c0={__init__:["labelSupport"],labelSupport:["type",Bu]};var l0=251,gd=1401,yd="attach-ok";function $u(e,t,n,i,r){H.call(this,t);var o=e.get("movePreview",!1);t.on("shape.move.start",gd,function(a){var s=a.context,c=s.shapes,l=s.validatedShapes;s.shapes=u0(c),s.validatedShapes=p0(l)}),o&&t.on("shape.move.start",l0,function(a){var s=a.context,c=s.shapes,l=ul(c);D(l,function(p){o.makeDraggable(s,p,!0),D(p.labels,function(u){o.makeDraggable(s,u,!0)})})}),o&&t.on("shape.move.start",function(a){var s=a.context,c=s.shapes;if(c.length===1){var l=c[0],p=l.host;p&&(n.addMarker(p,yd),t.once(["shape.move.out","shape.move.cleanup"],function(){n.removeMarker(p,yd)}))}}),this.preExecuted("elements.move",gd,function(a){var s=a.context,c=s.closure,l=s.shapes,p=ul(l);D(p,function(u){c.add(u,c.topLevel[u.host.id])})}),this.postExecuted("elements.move",function(a){var s=a.context,c=s.shapes,l=s.newHost,p;l&&c.length!==1||(l?p=c:p=pe(c,function(u){var f=u.host;return f0(u)&&!d0(c,f)}),D(p,function(u){r.updateAttachment(u,l)}))}),this.postExecuted("elements.move",function(a){var s=a.context.shapes;D(s,function(c){D(c.attachers,function(l){D(l.outgoing.slice(),function(p){var u=i.allowed("connection.reconnect",{connection:p,source:p.source,target:p.target});u||r.removeConnection(p)}),D(l.incoming.slice(),function(p){var u=i.allowed("connection.reconnect",{connection:p,source:p.source,target:p.target});u||r.removeConnection(p)})})})}),this.postExecute("shape.create",function(a){var s=a.context,c=s.shape,l=s.host;l&&r.updateAttachment(c,l)}),this.postExecute("shape.replace",function(a){var s=a.context,c=s.oldShape,l=s.newShape;Wn(c.attachers,function(p){var u=i.allowed("elements.move",{target:l,shapes:[p]});u==="attach"?r.updateAttachment(p,l):r.removeShape(p)}),l.attachers.length&&D(l.attachers,function(p){var u=Yf(p,c,l);r.moveShape(p,u,p.parent)})}),this.postExecute("shape.resize",function(a){var s=a.context,c=s.shape,l=s.oldBounds,p=s.newBounds,u=c.attachers,f=s.hints||{};f.attachSupport!==!1&&D(u,function(d){var h=Yf(d,l,p);r.moveShape(d,h,d.parent),D(d.labels,function(m){r.moveShape(m,h,m.parent)})})}),this.preExecute("shape.delete",function(a){var s=a.context.shape;Wn(s.attachers,function(c){r.removeShape(c)}),s.host&&r.updateAttachment(s,null)})}q($u,H);$u.$inject=["injector","eventBus","canvas","rules","modeling"];function ul(e){return Na(yt(e,function(t){return t.attachers||[]}))}function u0(e){var t=ul(e);return l_("id",e,t)}function p0(e){var t=Xa(e,"id");return pe(e,function(n){for(;n;){if(n.host&&t[n.host.id])return!1;n=n.parent}return!0})}function f0(e){return!!e.host}function d0(e,t){return e.indexOf(t)!==-1}const h0={__depends__:[hn],__init__:["attachSupport"],attachSupport:["type",$u]};function Vt(e){this._model=e}Vt.$inject=["moddle"];Vt.prototype._needsId=function(e){return le(e,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])};Vt.prototype._ensureId=function(e){if(e.id){this._model.ids.claim(e.id,e);return}var t;g(e,"bpmn:Activity")?t="Activity":g(e,"bpmn:Event")?t="Event":g(e,"bpmn:Gateway")?t="Gateway":le(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])?t="Flow":t=(e.$type||"").replace(/^[^:]*:/g,""),t+="_",!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(t,e))};Vt.prototype.create=function(e,t){var n=this._model.create(e,t||{});return this._ensureId(n),n};Vt.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})};Vt.prototype.createDiShape=function(e,t){return this.create("bpmndi:BPMNShape",N({bpmnElement:e,bounds:this.createDiBounds()},t))};Vt.prototype.createDiBounds=function(e){return this.create("dc:Bounds",e)};Vt.prototype.createDiWaypoints=function(e){var t=this;return yt(e,function(n){return t.createDiWaypoint(n)})};Vt.prototype.createDiWaypoint=function(e){return this.create("dc:Point",pn(e,["x","y"]))};Vt.prototype.createDiEdge=function(e,t){return this.create("bpmndi:BPMNEdge",N({bpmnElement:e,waypoint:this.createDiWaypoints([])},t))};Vt.prototype.createDiPlane=function(e,t){return this.create("bpmndi:BPMNPlane",N({bpmnElement:e},t))};function Tt(e,t,n){H.call(this,e),this._bpmnFactory=t;var i=this;function r(d){var h=d.context,m=h.hints||{},v;!h.cropped&&m.createElementsBehavior!==!1&&(v=h.connection,v.waypoints=n.getCroppedWaypoints(v),h.cropped=!0)}this.executed(["connection.layout","connection.create"],r),this.reverted(["connection.layout"],function(d){delete d.context.cropped});function o(d){var h=d.context;i.updateParent(h.shape||h.connection,h.oldParent)}function a(d){var h=d.context,m=h.shape||h.connection,v=h.parent||h.newParent;i.updateParent(m,v)}this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],St(o)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],St(a));function s(d){var h=d.context,m=h.oldRoot,v=m.children;D(v,function(E){g(E,"bpmn:BaseElement")&&i.updateParent(E)})}this.executed(["canvas.updateRoot"],s),this.reverted(["canvas.updateRoot"],s);function c(d){var h=d.context.shape;g(h,"bpmn:BaseElement")&&i.updateBounds(h)}this.executed(["shape.move","shape.create","shape.resize"],St(function(d){d.context.shape.type!=="label"&&c(d)})),this.reverted(["shape.move","shape.create","shape.resize"],St(function(d){d.context.shape.type!=="label"&&c(d)})),e.on("shape.changed",function(d){d.element.type==="label"&&c({context:{shape:d.element}})});function l(d){i.updateConnection(d.context)}this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],St(l)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],St(l));function p(d){i.updateConnectionWaypoints(d.context.connection)}this.executed(["connection.layout","connection.move","connection.updateWaypoints"],St(p)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],St(p)),this.executed("connection.reconnect",St(function(d){var h=d.context,m=h.connection,v=h.oldSource,E=h.newSource,w=z(m),_=z(v),x=z(E);w.conditionExpression&&!le(x,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(h.oldConditionExpression=w.conditionExpression,delete w.conditionExpression),v!==E&&_.default===w&&(h.oldDefault=_.default,delete _.default)})),this.reverted("connection.reconnect",St(function(d){var h=d.context,m=h.connection,v=h.oldSource,E=h.newSource,w=z(m),_=z(v),x=z(E);h.oldConditionExpression&&(w.conditionExpression=h.oldConditionExpression),h.oldDefault&&(_.default=h.oldDefault,delete x.default)}));function u(d){i.updateAttachment(d.context)}this.executed(["element.updateAttachment"],St(u)),this.reverted(["element.updateAttachment"],St(u)),this.executed("element.updateLabel",St(f)),this.reverted("element.updateLabel",St(f));function f(d){const{element:h}=d.context,m=qn(h),v=Se(h),E=v&&v.get("label");er(h)||Sa(h)||(m&&!E?v.set("label",t.create("bpmndi:BPMNLabel")):!m&&E&&v.set("label",void 0))}}q(Tt,H);Tt.$inject=["eventBus","bpmnFactory","connectionDocking"];Tt.prototype.updateAttachment=function(e){var t=e.shape,n=t.businessObject,i=t.host;n.attachedToRef=i&&i.businessObject};Tt.prototype.updateParent=function(e,t){if(!be(e)&&!(g(e,"bpmn:DataStoreReference")&&e.parent&&g(e.parent,"bpmn:Collaboration"))){var n=e.parent,i=e.businessObject,r=Se(e),o=n&&n.businessObject,a=Se(n);g(e,"bpmn:FlowNode")&&this.updateFlowNodeRefs(i,o,t&&t.businessObject),g(e,"bpmn:DataOutputAssociation")&&(e.source?o=e.source.businessObject:o=null),g(e,"bpmn:DataInputAssociation")&&(e.target?o=e.target.businessObject:o=null),this.updateSemanticParent(i,o),g(e,"bpmn:DataObjectReference")&&i.dataObjectRef&&this.updateSemanticParent(i.dataObjectRef,o),this.updateDiParent(r,a)}};Tt.prototype.updateBounds=function(e){var t=Se(e),n=v0(e);if(n){var i=xn(n,t.get("bounds"));N(n,{x:e.x+i.x,y:e.y+i.y})}var r=be(e)?this._getLabel(t):t,o=r.bounds;o||(o=this._bpmnFactory.createDiBounds(),r.set("bounds",o)),N(o,{x:e.x,y:e.y,width:e.width,height:e.height})};Tt.prototype.updateFlowNodeRefs=function(e,t,n){if(n!==t){var i,r;g(n,"bpmn:Lane")&&(i=n.get("flowNodeRef"),Ue(i,e)),g(t,"bpmn:Lane")&&(r=t.get("flowNodeRef"),Xe(r,e))}};Tt.prototype.updateDiConnection=function(e,t,n){var i=Se(e),r=Se(t),o=Se(n);i.sourceElement&&i.sourceElement.bpmnElement!==z(t)&&(i.sourceElement=t&&r),i.targetElement&&i.targetElement.bpmnElement!==z(n)&&(i.targetElement=n&&o)};Tt.prototype.updateDiParent=function(e,t){if(t&&!g(t,"bpmndi:BPMNPlane")&&(t=t.$parent),e.$parent!==t){var n=(t||e.$parent).get("planeElement");t?(n.push(e),e.$parent=t):(Ue(n,e),e.$parent=null)}};function m0(e){for(;e&&!g(e,"bpmn:Definitions");)e=e.$parent;return e}Tt.prototype.getLaneSet=function(e){var t,n;return g(e,"bpmn:Lane")?(t=e.childLaneSet,t||(t=this._bpmnFactory.create("bpmn:LaneSet"),e.childLaneSet=t,t.$parent=e),t):(g(e,"bpmn:Participant")&&(e=e.processRef),n=e.get("laneSets"),t=n[0],t||(t=this._bpmnFactory.create("bpmn:LaneSet"),t.$parent=e,n.push(t)),t)};Tt.prototype.updateSemanticParent=function(e,t,n){var i;if(e.$parent!==t&&!((g(e,"bpmn:DataInput")||g(e,"bpmn:DataOutput"))&&(g(t,"bpmn:Participant")&&"processRef"in t&&(t=t.processRef),"ioSpecification"in t&&t.ioSpecification===e.$parent))){if(g(e,"bpmn:Lane"))t&&(t=this.getLaneSet(t)),i="lanes";else if(g(e,"bpmn:FlowElement")){if(t){if(g(t,"bpmn:Participant"))t=t.processRef;else if(g(t,"bpmn:Lane"))do t=t.$parent.$parent;while(g(t,"bpmn:Lane"))}i="flowElements"}else if(g(e,"bpmn:Artifact")){for(;t&&!g(t,"bpmn:Process")&&!g(t,"bpmn:SubProcess")&&!g(t,"bpmn:Collaboration");)if(g(t,"bpmn:Participant")){t=t.processRef;break}else t=t.$parent;i="artifacts"}else if(g(e,"bpmn:MessageFlow"))i="messageFlows";else if(g(e,"bpmn:Participant")){i="participants";var r=e.processRef,o;r&&(o=m0(e.$parent||t),e.$parent&&(Ue(o.get("rootElements"),r),r.$parent=null),t&&(Xe(o.get("rootElements"),r),r.$parent=o))}else g(e,"bpmn:DataOutputAssociation")?i="dataOutputAssociations":g(e,"bpmn:DataInputAssociation")&&(i="dataInputAssociations");if(!i)throw new Error(`no parent for <${e.id}> in <${t.id}>`);var a;if(e.$parent&&(a=e.$parent.get(i),Ue(a,e)),t?(a=t.get(i),a.push(e),e.$parent=t):e.$parent=null,n){var s=n.get(i);Ue(a,e),t&&(s||(s=[],t.set(i,s)),s.push(e))}}};Tt.prototype.updateConnectionWaypoints=function(e){var t=Se(e);t.set("waypoint",this._bpmnFactory.createDiWaypoints(e.waypoints))};Tt.prototype.updateConnection=function(e){var t=e.connection,n=z(t),i=t.source,r=z(i),o=t.target,a=z(t.target),s;if(g(n,"bpmn:DataAssociation"))g(n,"bpmn:DataInputAssociation")?(n.get("sourceRef")[0]=r,s=e.parent||e.newParent||a,this.updateSemanticParent(n,a,s)):g(n,"bpmn:DataOutputAssociation")&&(s=e.parent||e.newParent||r,this.updateSemanticParent(n,r,s),n.targetRef=a);else{var c=g(n,"bpmn:SequenceFlow");n.sourceRef!==r&&(c&&(Ue(n.sourceRef&&n.sourceRef.get("outgoing"),n),r&&r.get("outgoing")&&r.get("outgoing").push(n)),n.sourceRef=r),n.targetRef!==a&&(c&&(Ue(n.targetRef&&n.targetRef.get("incoming"),n),a&&a.get("incoming")&&a.get("incoming").push(n)),n.targetRef=a)}this.updateConnectionWaypoints(t),this.updateDiConnection(t,i,o)};Tt.prototype._getLabel=function(e){return e.label||(e.label=this._bpmnFactory.createDiLabel()),e.label};function St(e){return function(t){var n=t.context,i=n.shape||n.connection||n.element;g(i,"bpmn:BaseElement")&&e(t)}}function v0(e){if(g(e,"bpmn:Activity")){var t=Se(e);if(t){var n=t.get("label");if(n)return n.get("bounds")}}}function ti(e,t){Al.call(this),this._bpmnFactory=e,this._moddle=t}q(ti,Al);ti.$inject=["bpmnFactory","moddle"];ti.prototype._baseCreate=Al.prototype.create;ti.prototype.create=function(e,t){if(e==="label"){var n=t.di||this._bpmnFactory.createDiLabel();return this._baseCreate(e,N({type:"label",di:n},u_,t))}return this.createElement(e,t)};ti.prototype.createElement=function(e,t){t=N({},t||{});var n,i=t.businessObject,r=t.di;if(!i){if(!t.type)throw new Error("no shape type specified");i=this._bpmnFactory.create(t.type),p_(i)}if(!y0(r)){var o=N({},r||{},{id:i.id+"_di"});e==="root"?r=this._bpmnFactory.createDiPlane(i,o):e==="connection"?r=this._bpmnFactory.createDiEdge(i,o):r=this._bpmnFactory.createDiShape(i,o)}g(i,"bpmn:Group")&&(t=N({isFrame:!0},t)),t=g0(i,t,["processRef","isInterrupting","associationDirection","isForCompensation"]),t.isExpanded&&(t=pl(r,t,"isExpanded")),le(i,["bpmn:Lane","bpmn:Participant"])&&(t=pl(r,t,"isHorizontal")),g(i,"bpmn:SubProcess")&&(t.collapsed=!ye(i,r)),g(i,"bpmn:ExclusiveGateway")&&(Vn(r,"isMarkerVisible")?r.isMarkerVisible===void 0&&(r.isMarkerVisible=!1):r.isMarkerVisible=!0),Pt(t.triggeredByEvent)&&(i.triggeredByEvent=t.triggeredByEvent,delete t.triggeredByEvent),Pt(t.cancelActivity)&&(i.cancelActivity=t.cancelActivity,delete t.cancelActivity);var a,s;return t.eventDefinitionType&&(a=i.get("eventDefinitions")||[],s=this._bpmnFactory.create(t.eventDefinitionType,t.eventDefinitionAttrs),t.eventDefinitionType==="bpmn:ConditionalEventDefinition"&&(s.condition=this._bpmnFactory.create("bpmn:FormalExpression")),a.push(s),s.$parent=i,i.eventDefinitions=a,delete t.eventDefinitionType),n=this.getDefaultSize(i,r),t=N({id:i.id},n,t,{businessObject:i,di:r}),this._baseCreate(e,t)};ti.prototype.getDefaultSize=function(e,t){var n=z(e);return t=t||Se(e),g(n,"bpmn:SubProcess")?ye(n,t)?{width:350,height:200}:{width:100,height:80}:g(n,"bpmn:Task")?{width:100,height:80}:g(n,"bpmn:Gateway")?{width:50,height:50}:g(n,"bpmn:Event")?{width:36,height:36}:g(n,"bpmn:Participant")?ye(n,t)?{width:600,height:250}:{width:400,height:60}:g(n,"bpmn:Lane")?{width:400,height:100}:g(n,"bpmn:DataObjectReference")?{width:36,height:50}:g(n,"bpmn:DataStoreReference")?{width:50,height:50}:g(n,"bpmn:TextAnnotation")?{width:100,height:30}:g(n,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}};ti.prototype.createParticipantShape=function(e){return fn(e)||(e={isExpanded:e}),e=N({type:"bpmn:Participant"},e||{}),e.isExpanded!==!1&&(e.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(e)};function g0(e,t,n){return D(n,function(i){t=pl(e,t,i)}),t}function pl(e,t,n){return t[n]===void 0?t:(e[n]=t[n],Sn(t,[n]))}function y0(e){return le(e,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])}function ws(e,t){this._modeling=e,this._canvas=t}ws.$inject=["modeling","canvas"];ws.prototype.preExecute=function(e){var t=this._modeling,n=e.elements,i=e.alignment;D(n,function(r){var o={x:0,y:0};Pt(i.left)?o.x=i.left-r.x:Pt(i.right)?o.x=i.right-r.width-r.x:Pt(i.center)?o.x=i.center-Math.round(r.width/2)-r.x:Pt(i.top)?o.y=i.top-r.y:Pt(i.bottom)?o.y=i.bottom-r.height-r.y:Pt(i.middle)&&(o.y=i.middle-Math.round(r.height/2)-r.y),t.moveElements([r],o,r.parent)})};ws.prototype.postExecute=function(e){};function Ss(e){this._modeling=e}Ss.$inject=["modeling"];Ss.prototype.preExecute=function(e){var t=e.source;if(!t)throw new Error("source required");var n=e.target||t.parent,i=e.shape,r=e.hints||{};i=e.shape=this._modeling.createShape(i,e.position,n,{attach:r.attach}),e.shape=i};Ss.prototype.postExecute=function(e){var t=e.hints||{};_0(e.source,e.shape)||(t.connectionTarget===e.source?this._modeling.connect(e.shape,e.source,e.connection):this._modeling.connect(e.source,e.shape,e.connection))};function _0(e,t){return Mi(e.outgoing,function(n){return n.target===t})}function Cs(e,t){this._canvas=e,this._layouter=t}Cs.$inject=["canvas","layouter"];Cs.prototype.execute=function(e){var t=e.connection,n=e.source,i=e.target,r=e.parent,o=e.parentIndex,a=e.hints;if(!n||!i)throw new Error("source and target required");if(!r)throw new Error("parent required");return t.source=n,t.target=i,t.waypoints||(t.waypoints=this._layouter.layoutConnection(t,a)),this._canvas.addConnection(t,r,o),t};Cs.prototype.revert=function(e){var t=e.connection;return this._canvas.removeConnection(t),t.source=null,t.target=null,t};var da=Math.round;function Fu(e){this._modeling=e}Fu.$inject=["modeling"];Fu.prototype.preExecute=function(e){var t=e.elements,n=e.parent,i=e.parentIndex,r=e.position,o=e.hints,a=this._modeling;D(t,function(u){ue(u.x)||(u.x=0),ue(u.y)||(u.y=0)});var s=pe(t,function(u){return!u.hidden}),c=At(s);D(t,function(u){Te(u)&&(u.waypoints=yt(u.waypoints,function(f){return{x:da(f.x-c.x-c.width/2+r.x),y:da(f.y-c.y-c.height/2+r.y)}})),N(u,{x:da(u.x-c.x-c.width/2+r.x),y:da(u.y-c.y-c.height/2+r.y)})});var l=qa(t),p={};D(t,function(u){if(Te(u)){p[u.id]=ue(i)?a.createConnection(p[u.source.id],p[u.target.id],i,u,u.parent||n,o):a.createConnection(p[u.source.id],p[u.target.id],u,u.parent||n,o);return}var f=N({},o);l.indexOf(u)===-1&&(f.autoResize=!1),be(u)&&(f=Sn(f,["attach"])),p[u.id]=ue(i)?a.createShape(u,pn(u,["x","y","width","height"]),u.parent||n,i,f):a.createShape(u,pn(u,["x","y","width","height"]),u.parent||n,f)}),e.elements=Sl(p)};var _d=Math.round;function ni(e){this._canvas=e}ni.$inject=["canvas"];ni.prototype.execute=function(e){var t=e.shape,n=e.position,i=e.parent,r=e.parentIndex;if(!i)throw new Error("parent required");if(!n)throw new Error("position required");return n.width!==void 0?N(t,n):N(t,{x:n.x-_d(t.width/2),y:n.y-_d(t.height/2)}),this._canvas.addShape(t,i,r),t};ni.prototype.revert=function(e){var t=e.shape;return this._canvas.removeShape(t),t};function uo(e){ni.call(this,e)}q(uo,ni);uo.$inject=["canvas"];var b0=ni.prototype.execute;uo.prototype.execute=function(e){var t=e.shape;return x0(t),t.labelTarget=e.labelTarget,b0.call(this,e)};var E0=ni.prototype.revert;uo.prototype.revert=function(e){return e.shape.labelTarget=null,E0.call(this,e)};function x0(e){["width","height"].forEach(function(t){typeof e[t]=="undefined"&&(e[t]=0)})}function po(e,t){this._canvas=e,this._modeling=t}po.$inject=["canvas","modeling"];po.prototype.preExecute=function(e){var t=this._modeling,n=e.connection;Wn(n.incoming,function(i){t.removeConnection(i,{nested:!0})}),Wn(n.outgoing,function(i){t.removeConnection(i,{nested:!0})})};po.prototype.execute=function(e){var t=e.connection,n=t.parent;return e.parent=n,e.parentIndex=Rl(n.children,t),e.source=t.source,e.target=t.target,this._canvas.removeConnection(t),t.source=null,t.target=null,t};po.prototype.revert=function(e){var t=e.connection,n=e.parent,i=e.parentIndex;return t.source=e.source,t.target=e.target,Xe(n.children,t,i),this._canvas.addConnection(t,n),t};function ju(e,t){this._modeling=e,this._elementRegistry=t}ju.$inject=["modeling","elementRegistry"];ju.prototype.postExecute=function(e){var t=this._modeling,n=this._elementRegistry,i=e.elements;D(i,function(r){n.get(r.id)&&(r.waypoints?t.removeConnection(r):t.removeShape(r))})};function fo(e,t){this._canvas=e,this._modeling=t}fo.$inject=["canvas","modeling"];fo.prototype.preExecute=function(e){var t=this._modeling,n=e.shape;Wn(n.incoming,function(i){t.removeConnection(i,{nested:!0})}),Wn(n.outgoing,function(i){t.removeConnection(i,{nested:!0})}),Wn(n.children,function(i){Te(i)?t.removeConnection(i,{nested:!0}):t.removeShape(i,{nested:!0})})};fo.prototype.execute=function(e){var t=this._canvas,n=e.shape,i=n.parent;return e.oldParent=i,e.oldParentIndex=Rl(i.children,n),t.removeShape(n),n};fo.prototype.revert=function(e){var t=this._canvas,n=e.shape,i=e.oldParent,r=e.oldParentIndex;return Xe(i.children,n,r),t.addShape(n,i),n};function Ts(e){this._modeling=e}Ts.$inject=["modeling"];var bd={x:"y",y:"x"};Ts.prototype.preExecute=function(e){var t=this._modeling,n=e.groups,i=e.axis,r=e.dimension;function o(v,E){v.range.min=Math.min(E[i],v.range.min),v.range.max=Math.max(E[i]+E[r],v.range.max)}function a(v){return v[i]+v[r]/2}function s(v){return v.length-1}function c(v){return v.max-v.min}function l(v,E){var w={y:0};w[i]=v-a(E),w[i]&&(w[bd[i]]=0,t.moveElements([E],w,E.parent))}var p=n[0],u=s(n),f=n[u],d,h,m=0;D(n,function(v,E){var w,_,x;if(v.elements.length<2){E&&E!==n.length-1&&(o(v,v.elements[0]),m+=c(v.range));return}w=un(v.elements,i),_=w[0],E===u&&(_=w[s(w)]),x=a(_),v.range=null,D(w,function(P){if(l(x,P),v.range===null){v.range={min:P[i],max:P[i]+P[r]};return}o(v,P)}),E&&E!==n.length-1&&(m+=c(v.range))}),h=Math.abs(f.range.min-p.range.max),d=Math.round((h-m)/(n.length-1)),!(d<n.length-1)&&D(n,function(v,E){var w={},_;v===p||v===f||(_=n[E-1],v.range.max=0,D(v.elements,function(x,P){w[bd[i]]=0,w[i]=_.range.max-x[i]+d,v.range.min!==x[i]&&(w[i]+=x[i]-v.range.min),w[i]&&t.moveElements([x],w,x.parent),v.range.max=Math.max(x[i]+x[r],P?v.range.max:0)}))})};Ts.prototype.postExecute=function(e){};function Ps(e,t){this._layouter=e,this._canvas=t}Ps.$inject=["layouter","canvas"];Ps.prototype.execute=function(e){var t=e.connection,n=t.waypoints;return N(e,{oldWaypoints:n}),t.waypoints=this._layouter.layoutConnection(t,e.hints),t};Ps.prototype.revert=function(e){var t=e.connection;return t.waypoints=e.oldWaypoints,t};function Hu(){}Hu.prototype.execute=function(e){var t=e.connection,n=e.delta,i=e.newParent||t.parent,r=e.newParentIndex,o=t.parent;return e.oldParent=o,e.oldParentIndex=Ue(o.children,t),Xe(i.children,t,r),t.parent=i,D(t.waypoints,function(a){a.x+=n.x,a.y+=n.y,a.original&&(a.original.x+=n.x,a.original.y+=n.y)}),t};Hu.prototype.revert=function(e){var t=e.connection,n=t.parent,i=e.oldParent,r=e.oldParentIndex,o=e.delta;return Ue(n.children,t),Xe(i.children,t,r),t.parent=i,D(t.waypoints,function(a){a.x-=o.x,a.y-=o.y,a.original&&(a.original.x-=o.x,a.original.y-=o.y)}),t};function Gu(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}Gu.prototype.add=function(e,t){return this.addAll([e],t)};Gu.prototype.addAll=function(e,t){var n=f_(e,!!t,this);return N(this,n),this};function ho(e){this._modeling=e}ho.prototype.moveRecursive=function(e,t,n){return e?this.moveClosure(this.getClosure(e),t,n):[]};ho.prototype.moveClosure=function(e,t,n,i,r){var o=this._modeling,a=e.allShapes,s=e.allConnections,c=e.enclosedConnections,l=e.topLevel,p=!1;r&&r.parent===n&&(p=!0),D(a,function(u){o.moveShape(u,t,l[u.id]&&!p&&n,{recurse:!1,layout:!1})}),D(s,function(u){var f=!!a[u.source.id],d=!!a[u.target.id];c[u.id]&&f&&d?o.moveConnection(u,t,l[u.id]&&!p&&n):o.layoutConnection(u,{connectionStart:f&&du(u,u.source,t),connectionEnd:d&&hu(u,u.target,t)})})};ho.prototype.getClosure=function(e){return new Gu().addAll(e,!0)};function Rs(e){this._helper=new ho(e)}Rs.$inject=["modeling"];Rs.prototype.preExecute=function(e){e.closure=this._helper.getClosure(e.shapes)};Rs.prototype.postExecute=function(e){var t=e.hints,n;t&&t.primaryShape&&(n=t.primaryShape,t.oldParent=n.parent),this._helper.moveClosure(e.closure,e.delta,e.newParent,e.newHost,n)};function ki(e){this._modeling=e,this._helper=new ho(e)}ki.$inject=["modeling"];ki.prototype.execute=function(e){var t=e.shape,n=e.delta,i=e.newParent||t.parent,r=e.newParentIndex,o=t.parent;return e.oldBounds=pn(t,["x","y","width","height"]),e.oldParent=o,e.oldParentIndex=Ue(o.children,t),Xe(i.children,t,r),N(t,{parent:i,x:t.x+n.x,y:t.y+n.y}),t};ki.prototype.postExecute=function(e){var t=e.shape,n=e.delta,i=e.hints,r=this._modeling;i.layout!==!1&&(D(t.incoming,function(o){r.layoutConnection(o,{connectionEnd:hu(o,t,n)})}),D(t.outgoing,function(o){r.layoutConnection(o,{connectionStart:du(o,t,n)})})),i.recurse!==!1&&this.moveChildren(e)};ki.prototype.revert=function(e){var t=e.shape,n=e.oldParent,i=e.oldParentIndex,r=e.delta;return Xe(n.children,t,i),N(t,{parent:n,x:t.x-r.x,y:t.y-r.y}),t};ki.prototype.moveChildren=function(e){var t=e.delta,n=e.shape;this._helper.moveRecursive(n.children,t,null)};ki.prototype.getNewParent=function(e){return e.newParent||e.shape.parent};function mo(e){this._modeling=e}mo.$inject=["modeling"];mo.prototype.execute=function(e){var t=e.newSource,n=e.newTarget,i=e.connection,r=e.dockingOrPoints;if(!t&&!n)throw new Error("newSource or newTarget required");return ve(r)&&(e.oldWaypoints=i.waypoints,i.waypoints=r),t&&(e.oldSource=i.source,i.source=t),n&&(e.oldTarget=i.target,i.target=n),i};mo.prototype.postExecute=function(e){var t=e.connection,n=e.newSource,i=e.newTarget,r=e.dockingOrPoints,o=e.hints||{},a={};o.connectionStart&&(a.connectionStart=o.connectionStart),o.connectionEnd&&(a.connectionEnd=o.connectionEnd),o.layoutConnection!==!1&&(n&&(!i||o.docking==="source")&&(a.connectionStart=a.connectionStart||Ed(ve(r)?r[0]:r)),i&&(!n||o.docking==="target")&&(a.connectionEnd=a.connectionEnd||Ed(ve(r)?r[r.length-1]:r)),o.newWaypoints&&(a.waypoints=o.newWaypoints),this._modeling.layoutConnection(t,a))};mo.prototype.revert=function(e){var t=e.oldSource,n=e.oldTarget,i=e.oldWaypoints,r=e.connection;return t&&(r.source=t),n&&(r.target=n),i&&(r.waypoints=i),r};function Ed(e){return e.original||e}function An(e,t){this._modeling=e,this._rules=t}An.$inject=["modeling","rules"];An.prototype.preExecute=function(e){var t=this,n=this._modeling,i=this._rules,r=e.oldShape,o=e.newData,a=e.hints||{},s;function c(h,m,v){return i.allowed("connection.reconnect",{connection:v,source:h,target:m})}var l={x:o.x,y:o.y},p={x:r.x,y:r.y,width:r.width,height:r.height};s=e.newShape=e.newShape||t.createShape(o,l,r.parent,a),r.host&&n.updateAttachment(s,r.host);var u;a.moveChildren!==!1&&(u=r.children.slice(),n.moveElements(u,{x:0,y:0},s,a));var f=r.incoming.slice(),d=r.outgoing.slice();D(f,function(h){var m=h.source,v=c(m,s,h);v&&t.reconnectEnd(h,s,ms(h,s,p),a)}),D(d,function(h){var m=h.target,v=c(s,m,h);v&&t.reconnectStart(h,s,hs(h,s,p),a)})};An.prototype.postExecute=function(e){var t=e.oldShape;this._modeling.removeShape(t)};An.prototype.execute=function(e){};An.prototype.revert=function(e){};An.prototype.createShape=function(e,t,n,i){return this._modeling.createShape(e,t,n,i)};An.prototype.reconnectStart=function(e,t,n,i){this._modeling.reconnectStart(e,t,n,i)};An.prototype.reconnectEnd=function(e,t,n,i){this._modeling.reconnectEnd(e,t,n,i)};function vo(e){this._modeling=e}vo.$inject=["modeling"];vo.prototype.execute=function(e){var t=e.shape,n=e.newBounds,i=e.minBounds;if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error("newBounds must have {x, y, width, height} properties");if(i&&(n.width<i.width||n.height<i.height))throw new Error("width and height cannot be less than minimum height and width");if(!i&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return e.oldBounds={width:t.width,height:t.height,x:t.x,y:t.y},N(t,{width:n.width,height:n.height,x:n.x,y:n.y}),t};vo.prototype.postExecute=function(e){var t=this._modeling,n=e.shape,i=e.oldBounds,r=e.hints||{};r.layout!==!1&&(D(n.incoming,function(o){t.layoutConnection(o,{connectionEnd:ms(o,n,i)})}),D(n.outgoing,function(o){t.layoutConnection(o,{connectionStart:hs(o,n,i)})}))};vo.prototype.revert=function(e){var t=e.shape,n=e.oldBounds;return N(t,{width:n.width,height:n.height,x:n.x,y:n.y}),t};function ii(e){this._modeling=e}ii.$inject=["modeling"];ii.prototype.preExecute=function(e){var t=e.delta,n=e.direction,i=e.movingShapes,r=e.resizingShapes,o=e.start,a={};this.moveShapes(i,t),D(r,function(s){a[s.id]=S0(s)}),this.resizeShapes(r,t,n),this.updateConnectionWaypoints(Zw(i,r),t,n,o,i,r,a)};ii.prototype.execute=function(){};ii.prototype.revert=function(){};ii.prototype.moveShapes=function(e,t){var n=this;D(e,function(i){n._modeling.moveShape(i,t,null,{autoResize:!1,layout:!1,recurse:!1})})};ii.prototype.resizeShapes=function(e,t,n){var i=this;D(e,function(r){var o=Jw(r,n,t);i._modeling.resizeShape(r,o,null,{attachSupport:!1,autoResize:!1,layout:!1})})};ii.prototype.updateConnectionWaypoints=function(e,t,n,i,r,o,a){var s=this,c=r.concat(o);D(e,function(l){var p=l.source,u=l.target,f=w0(l),d=Bv(n),h={};Gn(c,p)&&Gn(c,u)?(f=yt(f,function(m){return wd(m,i,n)&&(m[d]=m[d]+t[d]),m.original&&wd(m.original,i,n)&&(m.original[d]=m.original[d]+t[d]),m}),s._modeling.updateWaypoints(l,f,{labelBehavior:!1})):(Gn(c,p)||Gn(c,u))&&(Gn(r,p)?h.connectionStart=du(l,p,t):Gn(r,u)?h.connectionEnd=hu(l,u,t):Gn(o,p)?h.connectionStart=hs(l,p,a[p.id]):Gn(o,u)&&(h.connectionEnd=ms(l,u,a[u.id])),s._modeling.layoutConnection(l,h))})};function xd(e){return N({},e)}function w0(e){return yt(e.waypoints,function(t){return t=xd(t),t.original&&(t.original=xd(t.original)),t})}function Bv(e){switch(e){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function wd(e,t,n){var i=Bv(n);if(/e|s/.test(n))return e[i]>t;if(/n|w/.test(n))return e[i]<t}function Gn(e,t){return e.indexOf(t)!==-1}function S0(e){return{x:e.x,y:e.y,height:e.height,width:e.width}}function As(e){this._modeling=e}As.$inject=["modeling"];As.prototype.execute=function(e){var t=e.shape,n=t.children;e.oldChildrenVisibility=$v(n),t.collapsed=!t.collapsed;var i=Fv(n,t.collapsed);return[t].concat(i)};As.prototype.revert=function(e){var t=e.shape,n=e.oldChildrenVisibility,i=t.children,r=jv(i,n);return t.collapsed=!t.collapsed,[t].concat(r)};function $v(e){var t={};return D(e,function(n){t[n.id]=n.hidden,n.children&&(t=N({},t,$v(n.children)))}),t}function Fv(e,t){var n=[];return D(e,function(i){i.hidden=t,n=n.concat(i),i.children&&(n=n.concat(Fv(i.children,i.collapsed||t)))}),n}function jv(e,t){var n=[];return D(e,function(i){i.hidden=t[i.id],n=n.concat(i),i.children&&(n=n.concat(jv(i.children,t)))}),n}function Is(e){this._modeling=e}Is.$inject=["modeling"];Is.prototype.execute=function(e){var t=e.shape,n=e.newHost,i=t.host;return e.oldHost=i,e.attacherIdx=Hv(i,t),Gv(n,t),t.host=n,t};Is.prototype.revert=function(e){var t=e.shape,n=e.newHost,i=e.oldHost,r=e.attacherIdx;return t.host=i,Hv(n,t),Gv(i,t,r),t};function Hv(e,t){return Ue(e&&e.attachers,t)}function Gv(e,t,n){if(e){var i=e.attachers;i||(e.attachers=i=[]),Xe(i,t,n)}}function zu(){}zu.prototype.execute=function(e){var t=e.connection,n=e.newWaypoints;return e.oldWaypoints=t.waypoints,t.waypoints=n,t};zu.prototype.revert=function(e){var t=e.connection,n=e.oldWaypoints;return t.waypoints=n,t};function Ce(e,t,n){this._eventBus=e,this._elementFactory=t,this._commandStack=n;var i=this;e.on("diagram.init",function(){i.registerHandlers(n)})}Ce.$inject=["eventBus","elementFactory","commandStack"];Ce.prototype.getHandlers=function(){return{"shape.append":Ss,"shape.create":ni,"shape.delete":fo,"shape.move":ki,"shape.resize":vo,"shape.replace":An,"shape.toggleCollapse":As,spaceTool:ii,"label.create":uo,"connection.create":Cs,"connection.delete":po,"connection.move":Hu,"connection.layout":Ps,"connection.updateWaypoints":zu,"connection.reconnect":mo,"elements.create":Fu,"elements.move":Rs,"elements.delete":ju,"elements.distribute":Ts,"elements.align":ws,"element.updateAttachment":Is}};Ce.prototype.registerHandlers=function(e){D(this.getHandlers(),function(t,n){e.registerHandler(n,t)})};Ce.prototype.moveShape=function(e,t,n,i,r){typeof i=="object"&&(r=i,i=null);var o={shape:e,delta:t,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("shape.move",o)};Ce.prototype.updateAttachment=function(e,t){var n={shape:e,newHost:t};this._commandStack.execute("element.updateAttachment",n)};Ce.prototype.moveElements=function(e,t,n,i){i=i||{};var r=i.attach,o=n,a;r===!0?(a=n,o=n.parent):r===!1&&(a=null);var s={shapes:e,delta:t,newParent:o,newHost:a,hints:i};this._commandStack.execute("elements.move",s)};Ce.prototype.moveConnection=function(e,t,n,i,r){typeof i=="object"&&(r=i,i=void 0);var o={connection:e,delta:t,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("connection.move",o)};Ce.prototype.layoutConnection=function(e,t){var n={connection:e,hints:t||{}};this._commandStack.execute("connection.layout",n)};Ce.prototype.createConnection=function(e,t,n,i,r,o){typeof n=="object"&&(o=r,r=i,i=n,n=void 0),i=this._create("connection",i);var a={source:e,target:t,parent:r,parentIndex:n,connection:i,hints:o};return this._commandStack.execute("connection.create",a),a.connection};Ce.prototype.createShape=function(e,t,n,i,r){typeof i!="number"&&(r=i,i=void 0),r=r||{};var o=r.attach,a,s;e=this._create("shape",e),o?(a=n.parent,s=n):a=n;var c={position:t,shape:e,parent:a,parentIndex:i,host:s,hints:r};return this._commandStack.execute("shape.create",c),c.shape};Ce.prototype.createElements=function(e,t,n,i,r){ve(e)||(e=[e]),typeof i!="number"&&(r=i,i=void 0),r=r||{};var o={position:t,elements:e,parent:n,parentIndex:i,hints:r};return this._commandStack.execute("elements.create",o),o.elements};Ce.prototype.createLabel=function(e,t,n,i){n=this._create("label",n);var r={labelTarget:e,position:t,parent:i||e.parent,shape:n};return this._commandStack.execute("label.create",r),r.shape};Ce.prototype.appendShape=function(e,t,n,i,r){r=r||{},t=this._create("shape",t);var o={source:e,position:n,target:i,shape:t,connection:r.connection,connectionParent:r.connectionParent,hints:r};return this._commandStack.execute("shape.append",o),o.shape};Ce.prototype.removeElements=function(e){var t={elements:e};this._commandStack.execute("elements.delete",t)};Ce.prototype.distributeElements=function(e,t,n){var i={groups:e,axis:t,dimension:n};this._commandStack.execute("elements.distribute",i)};Ce.prototype.removeShape=function(e,t){var n={shape:e,hints:t||{}};this._commandStack.execute("shape.delete",n)};Ce.prototype.removeConnection=function(e,t){var n={connection:e,hints:t||{}};this._commandStack.execute("connection.delete",n)};Ce.prototype.replaceShape=function(e,t,n){var i={oldShape:e,newData:t,hints:n||{}};return this._commandStack.execute("shape.replace",i),i.newShape};Ce.prototype.alignElements=function(e,t){var n={elements:e,alignment:t};this._commandStack.execute("elements.align",n)};Ce.prototype.resizeShape=function(e,t,n,i){var r={shape:e,newBounds:t,minBounds:n,hints:i};this._commandStack.execute("shape.resize",r)};Ce.prototype.createSpace=function(e,t,n,i,r){var o={delta:n,direction:i,movingShapes:e,resizingShapes:t,start:r};this._commandStack.execute("spaceTool",o)};Ce.prototype.updateWaypoints=function(e,t,n){var i={connection:e,newWaypoints:t,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",i)};Ce.prototype.reconnect=function(e,t,n,i,r){var o={connection:e,newSource:t,newTarget:n,dockingOrPoints:i,hints:r||{}};this._commandStack.execute("connection.reconnect",o)};Ce.prototype.reconnectStart=function(e,t,n,i){i||(i={}),this.reconnect(e,t,e.target,n,N(i,{docking:"source"}))};Ce.prototype.reconnectEnd=function(e,t,n,i){i||(i={}),this.reconnect(e,e.source,t,n,N(i,{docking:"target"}))};Ce.prototype.connect=function(e,t,n,i){return this.createConnection(e,t,n||{},e.parent,i)};Ce.prototype._create=function(e,t){return d_(t)?t:this._elementFactory.create(e,t)};Ce.prototype.toggleCollapse=function(e,t){var n={shape:e,hints:t||{}};this._commandStack.execute("shape.toggleCollapse",n)};function go(e){this._elementRegistry=e}go.$inject=["elementRegistry"];go.prototype.execute=function(e){var t=e.element,n=e.moddleElement,i=e.properties;if(!n)throw new Error("<moddleElement> required");var r=e.changed||this._getVisualReferences(n).concat(t),o=e.oldProperties||C0(n,jc(i));return zv(n,i),e.oldProperties=o,e.changed=r,r};go.prototype.revert=function(e){var t=e.oldProperties,n=e.moddleElement,i=e.changed;return zv(n,t),i};go.prototype._getVisualReferences=function(e){var t=this._elementRegistry;return g(e,"bpmn:DataObject")?T0(e,t):[]};function C0(e,t){return Zn(t,function(n,i){return n[i]=e.get(i),n},{})}function zv(e,t){D(t,function(n,i){e.set(i,n)})}function T0(e,t){return t.filter(function(n){return g(n,"bpmn:DataObjectReference")&&z(n).dataObjectRef===e})}var kr="default",wn="id",Vv="di",P0={width:0,height:0};function yo(e,t,n,i){this._elementRegistry=e,this._moddle=t,this._modeling=n,this._textRenderer=i}yo.$inject=["elementRegistry","moddle","modeling","textRenderer"];yo.prototype.execute=function(e){var t=e.element,n=[t];if(!t)throw new Error("element required");var i=this._elementRegistry,r=this._moddle.ids,o=t.businessObject,a=D0(e.properties),s=e.oldProperties||R0(t,a);return Uv(a,o)&&(r.unclaim(o[wn]),i.updateId(t,a[wn]),r.claim(a[wn],o)),kr in a&&(a[kr]&&n.push(i.get(a[kr].id)),o[kr]&&n.push(i.get(o[kr].id))),Wv(t,a),e.oldProperties=s,e.changed=n,n};yo.prototype.postExecute=function(e){var t=e.element,n=t.label,i=n&&z(n).name;if(i){var r=this._textRenderer.getExternalLabelBounds(n,i);this._modeling.resizeShape(n,r,P0)}};yo.prototype.revert=function(e){var t=e.element,n=e.properties,i=e.oldProperties,r=t.businessObject,o=this._elementRegistry,a=this._moddle.ids;return Wv(t,i),Uv(n,r)&&(a.unclaim(n[wn]),o.updateId(t,i[wn]),a.claim(i[wn],r)),e.changed};function Uv(e,t){return wn in e&&e[wn]!==t[wn]}function R0(e,t){var n=jc(t),i=e.businessObject,r=Se(e);return Zn(n,function(o,a){return a!==Vv?o[a]=i.get(a):o[a]=A0(r,jc(t.di)),o},{})}function A0(e,t){return Zn(t,function(n,i){return n[i]=e&&e.get(i),n},{})}function Wv(e,t){var n=e.businessObject,i=Se(e);D(t,function(r,o){o!==Vv?n.set(o,r):i&&I0(i,r)})}function I0(e,t){D(t,function(n,i){e.set(i,n)})}var M0=["default"];function D0(e){var t=N({},e);return M0.forEach(function(n){n in e&&(t[n]=z(t[n]))}),t}function Ms(e,t){this._canvas=e,this._modeling=t}Ms.$inject=["canvas","modeling"];Ms.prototype.execute=function(e){var t=this._canvas,n=e.newRoot,i=n.businessObject,r=t.getRootElement(),o=r.businessObject,a=o.$parent,s=Se(r);return t.setRootElement(n),t.removeRootElement(r),Xe(a.rootElements,i),i.$parent=a,Ue(a.rootElements,o),o.$parent=null,r.di=null,s.bpmnElement=i,n.di=s,e.oldRoot=r,[]};Ms.prototype.revert=function(e){var t=this._canvas,n=e.newRoot,i=n.businessObject,r=e.oldRoot,o=r.businessObject,a=i.$parent,s=Se(n);return t.setRootElement(r),t.removeRootElement(n),Ue(a.rootElements,i),i.$parent=null,Xe(a.rootElements,o),o.$parent=a,n.di=null,s.bpmnElement=o,r.di=s,[]};function Vu(e,t){this._modeling=e,this._spaceTool=t}Vu.$inject=["modeling","spaceTool"];Vu.prototype.preExecute=function(e){var t=this._spaceTool,n=this._modeling,i=e.shape,r=e.location,o=$t(i),a=o===i,s=a?i:i.parent,c=Qn(s),l=mt(i);if(l?r==="left"?r="top":r==="right"&&(r="bottom"):r==="top"?r="left":r==="bottom"&&(r="right"),!c.length){var p=l?{x:i.x+Bt,y:i.y,width:i.width-Bt,height:i.height}:{x:i.x,y:i.y+Bt,width:i.width,height:i.height-Bt};n.createShape({type:"bpmn:Lane",isHorizontal:l},p,s)}var u=[];Qa(o,function(x){return u.push(x),x.label&&u.push(x.label),x===i?[]:pe(x.children,function(P){return P!==i})});var f,d,h,m,v;r==="top"?(f=-120,d=i.y,h=d+10,m="n",v="y"):r==="left"?(f=-120,d=i.x,h=d+10,m="w",v="x"):r==="bottom"?(f=120,d=i.y+i.height,h=d-10,m="s",v="y"):r==="right"&&(f=120,d=i.x+i.width,h=d-10,m="e",v="x");var E=t.calculateAdjustments(u,v,f,h),w=l?{x:0,y:f}:{x:f,y:0};t.makeSpace(E.movingShapes,E.resizingShapes,w,m,h);var _=l?{x:i.x+(a?Bt:0),y:d-(r==="top"?120:0),width:i.width-(a?Bt:0),height:120}:{x:d-(r==="left"?120:0),y:i.y+(a?Bt:0),width:120,height:i.height-(a?Bt:0)};e.newLane=n.createShape({type:"bpmn:Lane",isHorizontal:l},_,s)};function Uu(e){this._modeling=e}Uu.$inject=["modeling"];Uu.prototype.preExecute=function(e){var t=this._modeling,n=e.shape,i=e.count,r=Qn(n),o=r.length;if(o>i)throw new Error(`more than <${i}> child lanes`);var a=mt(n),s=a?n.height:n.width,c=Math.round(s/i),l,p,u,f;for(f=0;f<i;f++)f===i-1?l=s-c*f:l=c,p=a?{x:n.x+Bt,y:n.y+f*c,width:n.width-Bt,height:l}:{x:n.x+f*c,y:n.y+Bt,width:l,height:n.height-Bt},f<o?t.resizeShape(r[f],p):(u={type:"bpmn:Lane",isHorizontal:a},t.createShape(u,p,n))};function _o(e,t){this._modeling=e,this._spaceTool=t}_o.$inject=["modeling","spaceTool"];_o.prototype.preExecute=function(e){var t=e.shape,n=e.newBounds,i=e.balanced;i!==!1?this.resizeBalanced(t,n):this.resizeSpace(t,n)};_o.prototype.resizeBalanced=function(e,t){var n=this._modeling,i=lx(e,t);n.resizeShape(e,t),i.forEach(function(r){n.resizeShape(r.shape,r.newBounds)})};_o.prototype.resizeSpace=function(e,t){var n=this._spaceTool,i=te(e),r=te(t),o=Wm(r,i),a=$t(e),s=[],c=[];Qa(a,function(h){return s.push(h),(g(h,"bpmn:Lane")||g(h,"bpmn:Participant"))&&c.push(h),h.children});var l,p,u,f,d;(o.bottom||o.top)&&(l=o.bottom||o.top,p=e.y+(o.bottom?e.height:0)+(o.bottom?-10:10),u=o.bottom?"s":"n",f=o.top>0||o.bottom<0?-l:l,d=n.calculateAdjustments(s,"y",f,p),n.makeSpace(d.movingShapes,d.resizingShapes,{x:0,y:l},u)),(o.left||o.right)&&(l=o.right||o.left,p=e.x+(o.right?e.width:0)+(o.right?-10:100),u=o.right?"e":"w",f=o.left>0||o.right<0?-l:l,d=n.calculateAdjustments(c,"x",f,p),n.makeSpace(d.movingShapes,d.resizingShapes,{x:l,y:0},u))};var Kr="flowNodeRef",Wu="lanes";function bo(e){this._elementRegistry=e}bo.$inject=["elementRegistry"];bo.prototype._computeUpdates=function(e,t){var n=[],i=[],r={},o=[];function a(p,u){var f=te(u),d={x:p.x+p.width/2,y:p.y+p.height/2};return d.x>f.left&&d.x<f.right&&d.y>f.top&&d.y<f.bottom}function s(p){n.indexOf(p)===-1&&(o.push(p),n.push(p))}function c(p){var u=$t(p);return r[u.id]||(r[u.id]=fs(u)),r[u.id]}function l(p){if(!p.parent)return[];var u=c(p);return u.filter(function(f){return a(p,f)}).map(function(f){return f.businessObject})}return t.forEach(function(p){var u=$t(p);if(!(!u||n.indexOf(u)!==-1)){var f=u.children.filter(function(d){return g(d,"bpmn:FlowNode")});f.forEach(s),n.push(u)}}),e.forEach(s),o.forEach(function(p){var u=p.businessObject,f=u.get(Wu),d=f.slice(),h=l(p);i.push({flowNode:u,remove:d,add:h})}),t.forEach(function(p){var u=p.businessObject;p.parent||u.get(Kr).forEach(function(f){i.push({flowNode:f,remove:[u],add:[]})})}),i};bo.prototype.execute=function(e){var t=e.updates;return t||(t=e.updates=this._computeUpdates(e.flowNodeShapes,e.laneShapes)),t.forEach(function(n){var i=n.flowNode,r=i.get(Wu);n.remove.forEach(function(o){Ue(r,o),Ue(o.get(Kr),i)}),n.add.forEach(function(o){Xe(r,o),Xe(o.get(Kr),i)})}),[]};bo.prototype.revert=function(e){var t=e.updates;return t.forEach(function(n){var i=n.flowNode,r=i.get(Wu);n.add.forEach(function(o){Ue(r,o),Ue(o.get(Kr),i)}),n.remove.forEach(function(o){Xe(r,o),Xe(o.get(Kr),i)})}),[]};function Ds(e){this._moddle=e}Ds.$inject=["moddle"];Ds.prototype.execute=function(e){var t=this._moddle.ids,n=e.id,i=e.element,r=e.claiming;return r?t.claim(n,i):t.unclaim(n),[]};Ds.prototype.revert=function(e){var t=this._moddle.ids,n=e.id,i=e.element,r=e.claiming;return r?t.unclaim(n):t.claim(n,i),[]};var k0={fill:void 0,stroke:void 0};function Yu(e){this._commandStack=e,this._normalizeColor=function(t){if(t){if(Ka(t)){var n=O0(t);if(n)return n}throw new Error("invalid color value: "+t)}}}Yu.$inject=["commandStack"];Yu.prototype.postExecute=function(e){var t=e.elements,n=e.colors||k0,i=this,r={};"fill"in n&&N(r,{"background-color":this._normalizeColor(n.fill)}),"stroke"in n&&N(r,{"border-color":this._normalizeColor(n.stroke)}),D(t,function(o){var a=Te(o)?pn(r,["border-color"]):r,s=Se(o);if(N0(a),be(o))i._commandStack.execute("element.updateModdleProperties",{element:o,moddleElement:s.label,properties:{color:r["border-color"]}});else{if(!le(s,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return;i._commandStack.execute("element.updateProperties",{element:o,properties:{di:a}})}})};function O0(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="transparent",t.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(t.fillStyle)?t.fillStyle:null}function N0(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}var L0={width:0,height:0};function Yv(e,t,n){function i(c,l){var p=c.label||c,u=c.labelTarget||c;return h_(p,l),[p,u]}function r(c){var l=c.element,p=l.businessObject,u=c.newLabel;if(!be(l)&&er(l)&&!Ja(l)&&!Sd(u)){var f=7,d=Hh(l);d={x:d.x,y:d.y+f},e.createLabel(l,d,{id:p.id+"_label",businessObject:p,di:l.di})}}function o(c){return c.oldLabel=qn(c.element),i(c.element,c.newLabel)}function a(c){return i(c.element,c.oldLabel)}function s(c){var l=c.element,p=l.label||l,u=c.newLabel,f=c.newBounds,d=c.hints||{};if(!(!be(p)&&!g(p,"bpmn:TextAnnotation"))){if(be(p)&&Sd(u)){d.removeShape!==!1&&e.removeShape(p,{unsetLabel:!1});return}var h=qn(l);typeof f=="undefined"&&(f=t.getExternalLabelBounds(p,h)),f&&e.resizeShape(p,f,L0)}}this.preExecute=r,this.execute=o,this.revert=a,this.postExecute=s}Yv.$inject=["modeling","textRenderer","bpmnFactory"];function Sd(e){return!e||!e.trim()}function pt(e,t,n,i){Ce.call(this,e,t,n),this._bpmnRules=i}q(pt,Ce);pt.$inject=["eventBus","elementFactory","commandStack","bpmnRules"];pt.prototype.getHandlers=function(){var e=Ce.prototype.getHandlers.call(this);return e["element.updateModdleProperties"]=go,e["element.updateProperties"]=yo,e["canvas.updateRoot"]=Ms,e["lane.add"]=Vu,e["lane.resize"]=_o,e["lane.split"]=Uu,e["lane.updateRefs"]=bo,e["id.updateClaim"]=Ds,e["element.setColor"]=Yu,e["element.updateLabel"]=Yv,e};pt.prototype.updateLabel=function(e,t,n,i){this._commandStack.execute("element.updateLabel",{element:e,newLabel:t,newBounds:n,hints:i||{}})};pt.prototype.connect=function(e,t,n,i){var r=this._bpmnRules;if(n||(n=r.canConnect(e,t)),!!n)return this.createConnection(e,t,n,e.parent,i)};pt.prototype.updateModdleProperties=function(e,t,n){this._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:t,properties:n})};pt.prototype.updateProperties=function(e,t){this._commandStack.execute("element.updateProperties",{element:e,properties:t})};pt.prototype.resizeLane=function(e,t,n){this._commandStack.execute("lane.resize",{shape:e,newBounds:t,balanced:n})};pt.prototype.addLane=function(e,t){var n={shape:e,location:t};return this._commandStack.execute("lane.add",n),n.newLane};pt.prototype.splitLane=function(e,t){this._commandStack.execute("lane.split",{shape:e,count:t})};pt.prototype.makeCollaboration=function(){var e=this._create("root",{type:"bpmn:Collaboration"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e};pt.prototype.makeProcess=function(){var e=this._create("root",{type:"bpmn:Process"}),t={newRoot:e};this._commandStack.execute("canvas.updateRoot",t)};pt.prototype.updateLaneRefs=function(e,t){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:e,laneShapes:t})};pt.prototype.claimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t,claiming:!0})};pt.prototype.unclaimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t})};pt.prototype.setColor=function(e,t){e.length||(e=[e]),this._commandStack.execute("element.setColor",{elements:e,colors:t})};function qv(){}qv.prototype.layoutConnection=function(e,t){return t=t||{},[t.connectionStart||se(t.source||e.source),t.connectionEnd||se(t.target||e.target)]};var ha=20,B0=5,Va=Math.round,Cd=20,$0={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function F0(e,t){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[t].test(e)}function j0(e,t){return{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[e].test(t)}function Kv(e,t,n){var i=ut(t,e,B0),r=n.split(":")[0],o=Va((t.x-e.x)/2+e.x),a=Va((t.y-e.y)/2+e.y),s,c,l=j0(r,i),p=/h|r|l/.test(r),u=!1,f=!1;return l?(s=p?{x:o,y:e.y}:{x:e.x,y:a},c=p?"h:h":"v:v"):(u=F0(i,r),c=p?"h:v":"v:h",u?p?(f=a===e.y,s={x:e.x+ha*(/l/.test(r)?-1:1),y:f?a+ha:a}):(f=o===e.x,s={x:f?o+ha:o,y:e.y+ha*(/t/.test(r)?-1:1)}):s={x:o,y:a}),{waypoints:qu(e,s,c).concat(s),directions:c,turnNextDirections:f}}function H0(e,t,n){return Kv(e,t,n)}function G0(e,t,n){var i=Kv(t,e,Td(n));return{waypoints:i.waypoints.slice().reverse(),directions:Td(i.directions),turnNextDirections:i.turnNextDirections}}function z0(e,t){var n=e.directions.split(":")[1],i=t.directions.split(":")[0];e.turnNextDirections&&(n=n=="h"?"v":"h"),t.turnNextDirections&&(i=i=="h"?"v":"h");var r=n+":"+i,o=qu(e.waypoints[e.waypoints.length-1],t.waypoints[0],r);return{waypoints:o,directions:r}}function Td(e){return e.split(":").reverse().join(":")}function V0(e,t,n){var i=Va((t.x-e.x)/2+e.x),r=Va((t.y-e.y)/2+e.y);if(n==="h:v")return[{x:t.x,y:e.y}];if(n==="v:h")return[{x:e.x,y:t.y}];if(n==="h:h")return[{x:i,y:e.y},{x:i,y:t.y}];if(n==="v:v")return[{x:e.x,y:r},{x:t.x,y:r}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}function qu(e,t,n){if(n=n||"h:h",!Q0(n))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(Xv(n)){var i=H0(e,t,n),r=G0(e,t,n),o=z0(i,r);return[].concat(i.waypoints,o.waypoints,r.waypoints)}return V0(e,t,n)}function U0(e,t,n){var i=qu(e,t,n);return i.unshift(e),i.push(t),Zv(i)}function W0(e,t,n,i,r){var o=r&&r.preferredLayouts||[],a=m_(o,"straight")[0]||"h:h",s=$0[a]||0,c=ut(e,t,s),l=J0(c,a);n=n||se(e),i=i||se(t);var p=l.split(":"),u=Rd(n,e,p[0],eS(c)),f=Rd(i,t,p[1],c);return U0(u,f,l)}function Y0(e,t,n,i,r,o){ve(n)&&(r=n,o=i,n=se(e),i=se(t)),o=N({preferredLayouts:[]},o),r=r||[];var a=o.preferredLayouts,s=a.indexOf("straight")!==-1,c;return c=s&&K0(e,t,n,i,o),c||(c=o.connectionEnd&&Z0(t,e,i,r),c)||(c=o.connectionStart&&X0(e,t,n,r),c)?c:!o.connectionStart&&!o.connectionEnd&&r&&r.length?r:W0(e,t,n,i,o)}function q0(e,t,n){return e>=t&&e<=n}function Pd(e,t,n){var i={x:"width",y:"height"};return q0(t[e],n[e],n[e]+n[i[e]])}function K0(e,t,n,i,r){var o={},a,s;return s=ut(e,t),/^(top|bottom|left|right)$/.test(s)?(/top|bottom/.test(s)&&(a="x"),/left|right/.test(s)&&(a="y"),r.preserveDocking==="target"?Pd(a,i,e)?(o[a]=i[a],[{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y,original:{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y}},{x:i.x,y:i.y}]):null:Pd(a,n,t)?(o[a]=n[a],[{x:n.x,y:n.y},{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y,original:{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y}}]):null):null}function X0(e,t,n,i){return Ku(e,t,n,i)}function Z0(e,t,n,i){var r=i.slice().reverse();return r=Ku(e,t,n,r),r?r.reverse():null}function Ku(e,t,n,i){function r(p){return p.length<3?!0:p.length>4?!1:!!ke(p,function(u,f){var d=p[f-1];return d&&Lh(u,d)<3})}function o(p,u,f){var d=bn(u,p);switch(d){case"v":return{x:f.x,y:p.y};case"h":return{x:p.x,y:f.y}}return{x:p.x,y:p.y}}function a(p,u,f){var d;for(d=p.length-2;d!==0;d--)if(jp(p[d],u,Cd)||jp(p[d],f,Cd))return p.slice(d);return p}if(r(i))return null;var s=i[0],c=i.slice(),l;return c[0]=n,c[1]=o(c[1],s,n),l=a(c,e,t),l!==c&&(c=Ku(e,t,n,l)),c&&bn(c)?null:c}function J0(e,t){if(Xv(t))return t;switch(e){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return t}}function Q0(e){return e&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(e)}function Xv(e){return e&&/t|r|b|l/.test(e)}function eS(e){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[e]}function Rd(e,t,n,i){if(n==="h"&&(n=/left/.test(i)?"l":"r"),n==="v"&&(n=/top/.test(i)?"t":"b"),n==="t")return{original:e,x:e.x,y:t.y};if(n==="r")return{original:e,x:t.x+t.width,y:e.y};if(n==="b")return{original:e,x:e.x,y:t.y+t.height};if(n==="l")return{original:e,x:t.x,y:e.y};throw new Error("unexpected dockingDirection: <"+n+">")}function Zv(e){return e.reduce(function(t,n,i){var r=t[t.length-1],o=e[i+1];return Bh(r,o,n,0)||t.push(n),t},[])}var tS=-10,nS=40,iS={default:["h:h"],fromGateway:["v:h"],toGateway:["h:v"],loop:{fromTop:["t:r"],fromRight:["r:b"],fromLeft:["l:t"],fromBottom:["b:l"]},boundaryLoop:{alternateHorizontalSide:"b",alternateVerticalSide:"l",default:"v"},messageFlow:["straight","v:v"],subProcess:["straight","h:h"],isHorizontal:!0},rS={default:["v:v"],fromGateway:["h:v"],toGateway:["v:h"],loop:{fromTop:["t:l"],fromRight:["r:t"],fromLeft:["l:b"],fromBottom:["b:r"]},boundaryLoop:{alternateHorizontalSide:"t",alternateVerticalSide:"r",default:"h"},messageFlow:["straight","h:h"],subProcess:["straight","v:v"],isHorizontal:!1},Xu={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},Nr={top:"t",right:"r",bottom:"b",left:"l"};function Zu(){}q(Zu,qv);Zu.prototype.layoutConnection=function(e,t){t||(t={});var n=t.source||e.source,i=t.target||e.target,r=t.waypoints||e.waypoints,o=t.connectionStart,a=t.connectionEnd,s,c;if(o||(o=Ad(r&&r[0],n)),a||(a=Ad(r&&r[r.length-1],i)),(g(e,"bpmn:Association")||g(e,"bpmn:DataAssociation"))&&r&&!Id(n,i))return[].concat([o],r.slice(1,-1),[a]);var l=ss(n)?iS:rS;return g(e,"bpmn:MessageFlow")?s=aS(n,i,l):(g(e,"bpmn:SequenceFlow")||Id(n,i))&&(n===i?s={preferredLayouts:fS(n,e,l)}:g(n,"bpmn:BoundaryEvent")?s={preferredLayouts:dS(n,i,a,l)}:Xr(n)||Xr(i)?s={preferredLayouts:l.subProcess,preserveDocking:cS(n)}:g(n,"bpmn:Gateway")?s={preferredLayouts:l.fromGateway}:g(i,"bpmn:Gateway")?s={preferredLayouts:l.toGateway}:s={preferredLayouts:l.default}),s&&(s=N(s,t),c=Zv(Y0(n,i,o,a,r,s))),c||[o,a]};function oS(e){var t=e.host;return ut(se(e),t,tS)}function aS(e,t,n){return{preferredLayouts:n.messageFlow,preserveDocking:sS(e,t)}}function sS(e,t){return g(t,"bpmn:Participant")?"source":g(e,"bpmn:Participant")?"target":Xr(t)?"source":Xr(e)||g(t,"bpmn:Event")?"target":g(e,"bpmn:Event")?"source":null}function cS(e){return Xr(e)?"target":"source"}function Ad(e,t){return e?e.original||e:se(t)}function Id(e,t){return g(t,"bpmn:Activity")&&g(e,"bpmn:BoundaryEvent")&&t.businessObject.isForCompensation}function Xr(e){return g(e,"bpmn:SubProcess")&&ye(e)}function Ci(e,t){return e===t}function lS(e,t){return t.indexOf(e)!==-1}function ar(e){var t=/right|left/.exec(e);return t&&t[0]}function sr(e){var t=/top|bottom/.exec(e);return t&&t[0]}function Md(e,t){return Xu[e]===t}function uS(e,t){var n=ar(e),i=Xu[n];return t.indexOf(i)!==-1}function pS(e,t){var n=sr(e),i=Xu[n];return t.indexOf(i)!==-1}function Jv(e){return e==="right"||e==="left"}function fS(e,t,n){var i=t.waypoints,r=i&&i.length&&ut(i[0],e);return r==="top"?n.loop.fromTop:r==="right"?n.loop.fromRight:r==="left"?n.loop.fromLeft:n.loop.fromBottom}function dS(e,t,n,i){var r=se(e),o=se(t),a=oS(e),s,c,l=Ci(e.host,t),p=lS(a,["top","right","bottom","left"]),u=ut(o,r,{x:e.width/2+t.width/2,y:e.height/2+t.height/2});return l?hS(a,p,e,t,n,i):(s=mS(a,u,p,i.isHorizontal),c=vS(a,u,p,i.isHorizontal),[s+":"+c])}function hS(e,t,n,i,r,o){var a=t?e:o.isHorizontal?sr(e):ar(e),s=Nr[a],c;return t?Jv(e)?c=Dd("y",n,i,r)?"h":o.boundaryLoop.alternateHorizontalSide:c=Dd("x",n,i,r)?"v":o.boundaryLoop.alternateVerticalSide:c=o.boundaryLoop.default,[s+":"+c]}function Dd(e,t,n,i){var r=nS;return!(Sc(e,i,n,r)||Sc(e,i,{x:n.x+n.width,y:n.y+n.height},r)||Sc(e,i,se(t),r))}function Sc(e,t,n,i){return Math.abs(t[e]-n[e])<i}function mS(e,t,n,i){if(n)return Nr[e];var r=sr(e),o=ar(e),a=sr(t),s=ar(t);if(i){if(Ci(r,a)||Md(o,s))return Nr[r]}else if(Ci(o,s)||Md(r,a))return Nr[o];return Nr[i?o:r]}function vS(e,t,n,i){return n?Jv(e)?uS(e,t)||Ci(e,t)?"h":"v":pS(e,t)||Ci(e,t)?"v":"h":i?Ci(sr(e),sr(t))?"h":"v":Ci(ar(e),ar(t))?"v":"h"}function kd(e){return N({original:e.point.original||e.point},e.actual)}function ri(e,t){this._elementRegistry=e,this._graphicsFactory=t}ri.$inject=["elementRegistry","graphicsFactory"];ri.prototype.getCroppedWaypoints=function(e,t,n){t=t||e.source,n=n||e.target;var i=this.getDockingPoint(e,t,!0),r=this.getDockingPoint(e,n),o=e.waypoints.slice(i.idx+1,r.idx);return o.unshift(kd(i)),o.push(kd(r)),o};ri.prototype.getDockingPoint=function(e,t,n){var i=e.waypoints,r,o,a;return r=n?0:i.length-1,o=i[r],a=this._getIntersection(t,e,n),{point:o,actual:a||o,idx:r}};ri.prototype._getIntersection=function(e,t,n){var i=this._getShapePath(e),r=this._getConnectionPath(t);return $c(i,r,n)};ri.prototype._getConnectionPath=function(e){return this._graphicsFactory.getConnectionPath(e)};ri.prototype._getShapePath=function(e){return this._graphicsFactory.getShapePath(e)};ri.prototype._getGfx=function(e){return this._elementRegistry.getGraphics(e)};const Qv={__init__:["modeling","bpmnUpdater"],__depends__:[pw,Aw,Mw,Dw,kv,a0,c0,h0,Cn,Gh,Lv],bpmnFactory:["type",Vt],bpmnUpdater:["type",Tt],elementFactory:["type",ti],modeling:["type",pt],layouter:["type",Zu],connectionDocking:["type",ri]},Od=Math.round;function ks(e,t,n,i,r,o){this._complexPreview=e,this._connectionDocking=t,this._elementFactory=n,this._eventBus=i,this._layouter=r,this._rules=o}ks.prototype.create=function(e,t,n){const i=this._complexPreview,r=this._connectionDocking,o=this._elementFactory,a=this._eventBus,s=this._layouter,c=this._rules,l=o.createShape(N({type:t},n)),p=a.fire("autoPlace",{source:e,shape:l});if(!p)return;N(l,{x:p.x-Od(l.width/2),y:p.y-Od(l.height/2)});const u=c.allowed("connection.create",{source:e,target:l,hints:{targetParent:e.parent}});let f=null;u&&(f=o.createConnection(u),f.waypoints=s.layoutConnection(f,{source:e,target:l}),f.waypoints=r.getCroppedWaypoints(f,e,l)),i.create({created:[l,f].filter(d=>!Bc(d))})};ks.prototype.cleanUp=function(){this._complexPreview.cleanUp()};ks.$inject=["complexPreview","connectionDocking","elementFactory","eventBus","layouter","rules"];const gS={__depends__:[zl,zE,Qv],__init__:["appendPreview"],appendPreview:["type",ks]};var Nd=Math.min,Ld=Math.max;function Cc(e){e.preventDefault()}function Fr(e){e.stopPropagation()}function yS(e){return e.nodeType===Node.TEXT_NODE}function _S(e){return[].slice.call(e)}function Zt(e){this.container=e.container,this.parent=_e('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=we("[contenteditable]",this.parent),this.keyHandler=e.keyHandler||function(){},this.resizeHandler=e.resizeHandler||function(){},this.autoResize=tr(this.autoResize,this),this.handlePaste=tr(this.handlePaste,this)}Zt.prototype.create=function(e,t,n,i){var r=this,o=this.parent,a=this.content,s=this.container;i=this.options=i||{},t=this.style=t||{};var c=pn(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);N(o.style,{width:e.width+"px",height:e.height+"px",maxWidth:e.maxWidth+"px",maxHeight:e.maxHeight+"px",minWidth:e.minWidth+"px",minHeight:e.minHeight+"px",left:e.x+"px",top:e.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var l=pn(t,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return N(a.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},l),i.centerVertically&&N(a.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},l),a.innerText=n,K.bind(a,"keydown",this.keyHandler),K.bind(a,"mousedown",Fr),K.bind(a,"paste",r.handlePaste),i.autoResize&&K.bind(a,"input",this.autoResize),i.resizable&&this.resizable(t),s.appendChild(o),this.setSelection(a.lastChild,a.lastChild&&a.lastChild.length),o};Zt.prototype.handlePaste=function(e){var t=this.options,n=this.style;e.preventDefault();var i;if(e.clipboardData?i=e.clipboardData.getData("text/plain"):i=window.clipboardData.getData("Text"),this.insertText(i),t.autoResize){var r=this.autoResize(n);r&&this.resizeHandler(r)}};Zt.prototype.insertText=function(e){e=bS(e);var t=document.execCommand("insertText",!1,e);t||this._insertTextIE(e)};Zt.prototype._insertTextIE=function(e){var t=this.getSelection(),n=t.startContainer,i=t.endContainer,r=t.startOffset,o=t.endOffset,a=t.commonAncestorContainer,s=_S(a.childNodes),c,l;if(yS(a)){var p=n.textContent;n.textContent=p.substring(0,r)+e+p.substring(o),c=n,l=r+e.length}else if(n===this.content&&i===this.content){var u=document.createTextNode(e);this.content.insertBefore(u,s[r]),c=u,l=u.textContent.length}else{var f=s.indexOf(n),d=s.indexOf(i);s.forEach(function(h,m){m===f?h.textContent=n.textContent.substring(0,r)+e+i.textContent.substring(o):m>f&&m<=d&&Qi(h)}),c=n,l=r+e.length}c&&l!==void 0&&setTimeout(function(){self.setSelection(c,l)})};Zt.prototype.autoResize=function(){var e=this.parent,t=this.content,n=parseInt(this.style.fontSize)||12;if(t.scrollHeight>e.offsetHeight||t.scrollHeight<e.offsetHeight-n){var i=e.getBoundingClientRect(),r=t.scrollHeight;e.style.height=r+"px",this.resizeHandler({width:i.width,height:i.height,dx:0,dy:r-i.height})}};Zt.prototype.resizable=function(){var e=this,t=this.parent,n=this.resizeHandle,i=parseInt(this.style.minWidth)||0,r=parseInt(this.style.minHeight)||0,o=parseInt(this.style.maxWidth)||1/0,a=parseInt(this.style.maxHeight)||1/0;if(!n){n=this.resizeHandle=_e('<div class="djs-direct-editing-resize-handle"></div>');var s,c,l,p,u=function(h){Cc(h),Fr(h),s=h.clientX,c=h.clientY;var m=t.getBoundingClientRect();l=m.width,p=m.height,K.bind(document,"mousemove",f),K.bind(document,"mouseup",d)},f=function(h){Cc(h),Fr(h);var m=Nd(Ld(l+h.clientX-s,i),o),v=Nd(Ld(p+h.clientY-c,r),a);t.style.width=m+"px",t.style.height=v+"px",e.resizeHandler({width:l,height:p,dx:h.clientX-s,dy:h.clientY-c})},d=function(h){Cc(h),Fr(h),K.unbind(document,"mousemove",f,!1),K.unbind(document,"mouseup",d,!1)};K.bind(n,"mousedown",u)}N(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),t.appendChild(n)};Zt.prototype.destroy=function(){var e=this.parent,t=this.content,n=this.resizeHandle;t.innerText="",e.removeAttribute("style"),t.removeAttribute("style"),K.unbind(t,"keydown",this.keyHandler),K.unbind(t,"mousedown",Fr),K.unbind(t,"input",this.autoResize),K.unbind(t,"paste",this.handlePaste),n&&(n.removeAttribute("style"),Qi(n)),Qi(e)};Zt.prototype.getValue=function(){return this.content.innerText.trim()};Zt.prototype.getSelection=function(){var e=window.getSelection(),t=e.getRangeAt(0);return t};Zt.prototype.setSelection=function(e,t){var n=document.createRange();e===null?n.selectNodeContents(this.content):(n.setStart(e,t),n.setEnd(e,t));var i=window.getSelection();i.removeAllRanges(),i.addRange(n)};function bS(e){return e.replace(/\r\n|\r|\n/g,`
`)}function Ut(e,t){this._eventBus=e,this._providers=[],this._textbox=new Zt({container:t.getContainer(),keyHandler:tr(this._handleKey,this),resizeHandler:tr(this._handleResize,this)})}Ut.$inject=["eventBus","canvas"];Ut.prototype.registerProvider=function(e){this._providers.push(e)};Ut.prototype.isActive=function(e){return!!(this._active&&(!e||this._active.element===e))};Ut.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())};Ut.prototype._fire=function(e,t){this._eventBus.fire("directEditing."+e,t||{active:this._active})};Ut.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0};Ut.prototype.complete=function(){var e=this._active;if(e){var t,n=e.context.bounds,i=this.$textbox.getBoundingClientRect(),r=this.getValue(),o=e.context.text;(r!==o||i.height!==n.height||i.width!==n.width)&&(t=this._textbox.container.getBoundingClientRect(),e.provider.update(e.element,r,e.context.text,{x:i.left-t.left,y:i.top-t.top,width:i.width,height:i.height})),this._fire("complete"),this.close()}};Ut.prototype.getValue=function(){return this._textbox.getValue()};Ut.prototype._handleKey=function(e){e.stopPropagation();var t=e.keyCode||e.charCode;if(t===27)return e.preventDefault(),this.cancel();if(t===13&&!e.shiftKey)return e.preventDefault(),this.complete()};Ut.prototype._handleResize=function(e){this._fire("resize",e)};Ut.prototype.activate=function(e){this.isActive()&&this.cancel();var t,n=ke(this._providers,function(i){return(t=i.activate(e))?i:null});return t&&(this.$textbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this._active={element:e,context:t,provider:n},t.options&&t.options.resizable&&(this.resizable=!0),this._fire("activate")),!!t};const eg={__depends__:[wl],__init__:["directEditing"],directEditing:["type",Ut]};function Bd(e){return function(t){var n=t.target,i=z(e),r=i.eventDefinitions&&i.eventDefinitions[0],o=i.$type===n.type,a=(r&&r.$type)===n.eventDefinitionType,s=!!n.triggeredByEvent==!!i.triggeredByEvent,c=n.isExpanded===void 0||n.isExpanded===ye(e);return!o||!a||!s||!c}}var ES=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],xS=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],wS=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message intermediate catch event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate throw event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer intermediate catch event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation intermediate throw event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional intermediate catch event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link intermediate catch event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link intermediate throw event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation intermediate throw event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal intermediate catch event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate throw event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],SS=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message end event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation end event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error end event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel end event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation end event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal end event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate end event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],CS=[{label:"Exclusive gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event-based gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],TS=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],tg=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Sub-process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],PS=tg,$d=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"User task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Service task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Send task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"Manual task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business rule task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Script task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub-process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],RS=[{label:"Data store reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],AS=[{label:"Data object reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],IS=[{label:"Message boundary event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!0}},{label:"Timer boundary event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!0}},{label:"Escalation boundary event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!0}},{label:"Conditional boundary event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!0}},{label:"Error boundary event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",cancelActivity:!0}},{label:"Cancel boundary event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition",cancelActivity:!0}},{label:"Signal boundary event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!0}},{label:"Compensation boundary event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",cancelActivity:!0}},{label:"Message boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],MS=[{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!0}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!0}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!0}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!0}},{label:"Error start event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",isInterrupting:!0}},{label:"Escalation start event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!0}},{label:"Compensation start event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",isInterrupting:!0}},{label:"Message start event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer start event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional start event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal start event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation start event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],DS=[{label:"Sequence flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],kS=[{label:"Expanded pool/participant",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(e){var t="Empty pool/participant";return e.children&&e.children.length&&(t+=" (removes content)"),t},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}];const Fd={"start-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
    <g transform="translate(0 995.64)">
      <path d="m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z" fill="none" stroke="currentColor" stroke-dasharray="418.310422, 361.2328165" stroke-linecap="round" stroke-width="100"/>
    </g>
  </svg>`,"intermediate-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
     <g transform="translate(0 995.64)" fill="none" stroke="currentColor" stroke-linecap="round">
        <circle cx="1024" cy="28.357" r="875" stroke-dasharray="418.310422, 361.2328165" stroke-width="100"/>
        <circle cx="1024" cy="28.357" r="685" stroke-dasharray="348.31044857,261.23283643" stroke-dashoffset="500" stroke-width="100"/>
     </g>
  </svg>`};function Dt(e,t,n,i,r,o,a,s){this._bpmnFactory=e,this._popupMenu=t,this._modeling=n,this._moddle=i,this._bpmnReplace=r,this._rules=o,this._translate=a,this._moddleCopy=s,this._register()}Dt.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate","moddleCopy"];Dt.prototype._register=function(){this._popupMenu.registerProvider("bpmn-replace",this)};Dt.prototype.getPopupMenuEntries=function(e){var t=e.businessObject,n=this._rules,i=[];if(ve(e)||!n.allowed("shape.replace",{element:e}))return{};var r=Bd(e);return g(t,"bpmn:DataObjectReference")?this._createEntries(e,RS):g(t,"bpmn:DataStoreReference")&&!g(e.parent,"bpmn:Collaboration")?this._createEntries(e,AS):g(t,"bpmn:StartEvent")&&!g(t.$parent,"bpmn:SubProcess")?(i=pe(ES,r),this._createEntries(e,i)):g(t,"bpmn:Participant")?(i=pe(kS,function(o){return ye(e)!==o.target.isExpanded}),this._createEntries(e,i)):g(t,"bpmn:StartEvent")&&ht(t.$parent)?(i=pe(MS,function(o){var a=o.target,s=a.isInterrupting!==!1,c=t.isInterrupting===s;return r(o)||!r(o)&&!c}),this._createEntries(e,i)):g(t,"bpmn:StartEvent")&&!ht(t.$parent)&&g(t.$parent,"bpmn:SubProcess")?(i=pe(xS,r),this._createEntries(e,i)):g(t,"bpmn:EndEvent")?(i=pe(SS,function(o){var a=o.target;return a.eventDefinitionType=="bpmn:CancelEventDefinition"&&!g(t.$parent,"bpmn:Transaction")?!1:r(o)}),this._createEntries(e,i)):g(t,"bpmn:BoundaryEvent")?(i=pe(IS,function(o){var a=o.target;if(a.eventDefinitionType=="bpmn:CancelEventDefinition"&&!g(t.attachedToRef,"bpmn:Transaction"))return!1;var s=a.cancelActivity!==!1,c=t.cancelActivity==s;return r(o)||!r(o)&&!c}),this._createEntries(e,i)):g(t,"bpmn:IntermediateCatchEvent")||g(t,"bpmn:IntermediateThrowEvent")?(i=pe(wS,r),this._createEntries(e,i)):g(t,"bpmn:Gateway")?(i=pe(CS,r),this._createEntries(e,i)):g(t,"bpmn:Transaction")?(i=pe(tg,r),this._createEntries(e,i)):ht(t)&&ye(e)?(i=pe(PS,r),this._createEntries(e,i)):g(t,"bpmn:SubProcess")&&ye(e)?(i=pe(TS,r),this._createEntries(e,i)):g(t,"bpmn:AdHocSubProcess")&&!ye(e)?(i=pe($d,function(o){var a=o.target,s=a.type==="bpmn:SubProcess",c=a.isExpanded===!0;return Bd(a)&&(!s||c)}),this._createEntries(e,i)):g(t,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,DS):g(t,"bpmn:FlowNode")?(i=pe($d,r),g(t,"bpmn:SubProcess")&&!ye(e)&&(i=pe(i,function(o){return o.label!=="Sub-process (collapsed)"})),this._createEntries(e,i)):{}};Dt.prototype.getPopupMenuHeaderEntries=function(e){var t={};return g(e,"bpmn:Activity")&&!ht(e)&&(t=re(re({},t),this._getLoopCharacteristicsHeaderEntries(e))),g(e,"bpmn:DataObjectReference")&&(t=re(re({},t),this._getCollectionHeaderEntries(e))),g(e,"bpmn:Participant")&&(t=re(re({},t),this._getParticipantMultiplicityHeaderEntries(e))),g(e,"bpmn:SubProcess")&&!g(e,"bpmn:Transaction")&&!ht(e)&&(t=re(re({},t),this._getAdHocHeaderEntries(e))),nv(e)&&(t=re(re({},t),this._getNonInterruptingHeaderEntries(e))),t};Dt.prototype._createEntries=function(e,t){var n={},i=this;return D(t,function(r){n[r.actionName]=i._createEntry(r,e)}),n};Dt.prototype._createSequenceFlowEntries=function(e,t){var n=z(e),i={},r=this._modeling,o=this._moddle,a=this;return D(t,function(s){switch(s.actionName){case"replace-with-default-flow":n.sourceRef.default!==n&&(g(n.sourceRef,"bpmn:ExclusiveGateway")||g(n.sourceRef,"bpmn:InclusiveGateway")||g(n.sourceRef,"bpmn:ComplexGateway")||g(n.sourceRef,"bpmn:Activity"))&&(i=Re(re({},i),{[s.actionName]:a._createEntry(s,e,function(){r.updateProperties(e.source,{default:n})})}));break;case"replace-with-conditional-flow":!n.conditionExpression&&g(n.sourceRef,"bpmn:Activity")&&(i=Re(re({},i),{[s.actionName]:a._createEntry(s,e,function(){var c=o.create("bpmn:FormalExpression",{body:""});r.updateProperties(e,{conditionExpression:c})})}));break;default:g(n.sourceRef,"bpmn:Activity")&&n.conditionExpression&&(i=Re(re({},i),{[s.actionName]:a._createEntry(s,e,function(){r.updateProperties(e,{conditionExpression:void 0})})})),(g(n.sourceRef,"bpmn:ExclusiveGateway")||g(n.sourceRef,"bpmn:InclusiveGateway")||g(n.sourceRef,"bpmn:ComplexGateway")||g(n.sourceRef,"bpmn:Activity"))&&n.sourceRef.default===n&&(i=Re(re({},i),{[s.actionName]:a._createEntry(s,e,function(){r.updateProperties(e.source,{default:void 0})})}))}}),i};Dt.prototype._createEntry=function(e,t,n){var i=this._translate,r=this._bpmnReplace.replaceElement,o=function(){return r(t,e.target)},a=e.label;return a&&typeof a=="function"&&(a=a(t)),n=n||o,{label:i(a),className:e.className,action:n}};Dt.prototype._getLoopCharacteristicsHeaderEntries=function(e){var t=this,n=this._translate;function i(l,p){if(p.active){t._modeling.updateProperties(e,{loopCharacteristics:void 0});return}const u=e.businessObject.get("loopCharacteristics"),f=t._moddle.create(p.options.loopCharacteristics);u&&t._moddleCopy.copyElement(u,f),f.set("isSequential",p.options.isSequential),t._modeling.updateProperties(e,{loopCharacteristics:f})}var r=z(e),o=r.loopCharacteristics,a,s,c;return o&&(a=o.isSequential,s=o.isSequential===void 0,c=o.isSequential!==void 0&&!o.isSequential),{"toggle-parallel-mi":{className:"bpmn-icon-parallel-mi-marker",title:n("Parallel multi-instance"),active:c,action:i,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},"toggle-sequential-mi":{className:"bpmn-icon-sequential-mi-marker",title:n("Sequential multi-instance"),active:a,action:i,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},"toggle-loop":{className:"bpmn-icon-loop-marker",title:n("Loop"),active:s,action:i,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}}};Dt.prototype._getCollectionHeaderEntries=function(e){var t=this,n=this._translate,i=e.businessObject.dataObjectRef;if(!i)return{};function r(a,s){t._modeling.updateModdleProperties(e,i,{isCollection:!s.active})}var o=i.isCollection;return{"toggle-is-collection":{className:"bpmn-icon-parallel-mi-marker",title:n("Collection"),active:o,action:r}}};Dt.prototype._getParticipantMultiplicityHeaderEntries=function(e){var t=this,n=this._bpmnFactory,i=this._translate;function r(a,s){var c=s.active,l;c||(l=n.create("bpmn:ParticipantMultiplicity")),t._modeling.updateProperties(e,{participantMultiplicity:l})}var o=e.businessObject.participantMultiplicity;return{"toggle-participant-multiplicity":{className:"bpmn-icon-parallel-mi-marker",title:i("Participant multiplicity"),active:!!o,action:r}}};Dt.prototype._getAdHocHeaderEntries=function(e){var t=this._translate,n=z(e),i=g(n,"bpmn:AdHocSubProcess"),r=this._bpmnReplace.replaceElement;return{"toggle-adhoc":{className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:i,action:function(o,a){return i?r(e,{type:"bpmn:SubProcess"},{autoResize:!1,layoutConnection:!1}):r(e,{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}}}};Dt.prototype._getNonInterruptingHeaderEntries=function(e){const t=this._translate,n=z(e),i=this,r=iv(e),o=g(e,"bpmn:BoundaryEvent")?Fd["intermediate-event-non-interrupting"]:Fd["start-event-non-interrupting"],a=!n[r];return{"toggle-non-interrupting":{imageHtml:o,title:t("Toggle non-interrupting"),active:a,action:function(){i._modeling.updateProperties(e,{[r]:!!a})}}}};const OS={__depends__:[jl,kv,zl],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",Dt]};function dr(e,t,n,i,r,o,a,s,c,l,p,u,f){e=e||{},i.registerProvider(this),this._contextPad=i,this._modeling=r,this._elementFactory=o,this._connect=a,this._create=s,this._popupMenu=c,this._canvas=l,this._rules=p,this._translate=u,this._eventBus=n,this._appendPreview=f,e.autoPlace!==!1&&(this._autoPlace=t.get("autoPlace",!1)),n.on("create.end",250,function(d){var h=d.context,m=h.shape;if(!(!zr(d)||!i.isOpen(m))){var v=i.getEntries(m);v.replace&&v.replace.action.click(d,m)}})}dr.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","appendPreview"];dr.prototype.getMultiElementContextPadEntries=function(e){var t=this._modeling,n={};return this._isDeleteAllowed(e)&&N(n,{delete:{group:"edit",className:"bpmn-icon-trash",title:this._translate("Delete"),action:{click:function(i,r){t.removeElements(r.slice())}}}}),n};dr.prototype._isDeleteAllowed=function(e){var t=this._rules.allowed("elements.delete",{elements:e});return ve(t)?Qr(t,function(n){return NS(t,n)}):t};dr.prototype.getContextPadEntries=function(e){var t=this._contextPad,n=this._modeling,i=this._elementFactory,r=this._connect,o=this._create,a=this._popupMenu,s=this._rules,c=this._autoPlace,l=this._translate,p=this._appendPreview,u={};if(e.type==="label")return u;var f=e.businessObject;function d(x,P){r.start(x,P)}function h(x,P){n.removeElements([P])}function m(x){var P=5,A=t.getPad(x).html,C=A.getBoundingClientRect(),I={x:C.left,y:C.bottom+P};return I}function v(x,P,A,C){function I(B,X){var Q=i.createShape(N({type:x},C));o.start(B,Q,{source:X}),p.cleanUp()}var T=c?function(B,X){var Q=i.createShape(N({type:x},C));c.append(X,Q),p.cleanUp()}:I,k=c?function(B,X){return p.create(X,x,C),()=>{p.cleanUp()}}:null;return{group:"model",className:P,title:A,action:{dragstart:I,click:T,hover:k}}}function E(x){return function(P,A){n.splitLane(A,x),t.open(A,!0)}}if(le(f,["bpmn:Lane","bpmn:Participant"])&&ye(e)){var w=Qn(e);N(u,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:l("Add lane above"),action:{click:function(x,P){n.addLane(P,"top")}}}}),w.length<2&&((mt(e)?e.height>=120:e.width>=120)&&N(u,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:l("Divide into two lanes"),action:{click:E(2)}}}),(mt(e)?e.height>=180:e.width>=180)&&N(u,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:l("Divide into three lanes"),action:{click:E(3)}}})),N(u,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:l("Add lane below"),action:{click:function(x,P){n.addLane(P,"bottom")}}}})}g(f,"bpmn:FlowNode")&&(g(f,"bpmn:EventBasedGateway")?N(u,{"append.receive-task":v("bpmn:ReceiveTask","bpmn-icon-receive-task",l("Append receive task")),"append.message-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",l("Append message intermediate catch event"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",l("Append timer intermediate catch event"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",l("Append conditional intermediate catch event"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",l("Append signal intermediate catch event"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):jd(f,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?N(u,{"append.compensation-activity":v("bpmn:Task","bpmn-icon-task",l("Append compensation activity"),{isForCompensation:!0})}):!g(f,"bpmn:EndEvent")&&!f.isForCompensation&&!jd(f,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!ht(f)&&N(u,{"append.end-event":v("bpmn:EndEvent","bpmn-icon-end-event-none",l("Append end event")),"append.gateway":v("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",l("Append gateway")),"append.append-task":v("bpmn:Task","bpmn-icon-task",l("Append task")),"append.intermediate-event":v("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",l("Append intermediate/boundary event"))})),a.isEmpty(e,"bpmn-replace")||N(u,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:l("Change element"),action:{click:function(x,P){var A=N(m(P),{cursor:{x:x.x,y:x.y}});a.open(P,"bpmn-replace",A,{title:l("Change element"),width:300,search:!0})}}}}),g(f,"bpmn:SequenceFlow")&&N(u,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation"))}),le(f,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&N(u,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation")),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:l("Connect to other element"),action:{click:d,dragstart:d}}}),g(f,"bpmn:TextAnnotation")&&N(u,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:l("Connect using association"),action:{click:d,dragstart:d}}}),le(f,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&N(u,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:l("Connect using data input association"),action:{click:d,dragstart:d}}}),g(f,"bpmn:Group")&&N(u,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation"))});var _=s.allowed("elements.delete",{elements:[e]});return ve(_)&&(_=_[0]===e),_&&N(u,{delete:{group:"edit",className:"bpmn-icon-trash",title:l("Delete"),action:{click:h}}}),u};function jd(e,t,n){var i=e.$instanceOf(t),r=!1,o=e.eventDefinitions||[];return D(o,function(a){a.$type===n&&(r=!0)}),i&&r}function NS(e,t){return e.indexOf(t)!==-1}const LS={__depends__:[gS,eg,nm,Cn,ql,bs,OS],__init__:["contextPadProvider"],contextPadProvider:["type",dr]};var BS={horizontal:["x","width"],vertical:["y","height"]},Hd=5;function In(e,t){this._modeling=e,this._filters=[],this.registerFilter(function(n){var i=t.allowed("elements.distribute",{elements:n});return ve(i)?i:i?n:[]})}In.$inject=["modeling","rules"];In.prototype.registerFilter=function(e){if(typeof e!="function")throw new Error("the filter has to be a function");this._filters.push(e)};In.prototype.trigger=function(e,t){var n=this._modeling,i,r;if(!(e.length<3)&&(this._setOrientation(t),r=this._filterElements(e),i=this._createGroups(r),!(i.length<=2)))return n.distributeElements(i,this._axis,this._dimension),i};In.prototype._filterElements=function(e){var t=this._filters,n=this._axis,i=this._dimension,r=[].concat(e);return t.length?(D(t,function(o){r=o(r,n,i)}),r):e};In.prototype._createGroups=function(e){var t=[],n=this,i=this._axis,r=this._dimension;if(!i)throw new Error('must have a defined "axis" and "dimension"');var o=un(e,i);return D(o,function(a,s){var c=n._findRange(a,i,r),l,p=t[t.length-1];p&&n._hasIntersection(p.range,c)?t[t.length-1].elements.push(a):(l={range:c,elements:[a]},t.push(l))}),t};In.prototype._setOrientation=function(e){var t=BS[e];this._axis=t[0],this._dimension=t[1]};In.prototype._hasIntersection=function(e,t){return Math.max(e.min,e.max)>=Math.min(t.min,t.max)&&Math.min(e.min,e.max)<=Math.max(t.min,t.max)};In.prototype._findRange=function(e){var t=e[this._axis],n=e[this._dimension];return{min:t+Hd,max:t+n-Hd}};const $S={__init__:["distributeElements"],distributeElements:["type",In]};function Os(e){Gt.call(this,e)}Os.$inject=["eventBus"];q(Os,Gt);Os.prototype.init=function(){this.addRule("elements.distribute",function(e){var t=e.elements;return t=pe(t,function(n){var i=le(n,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(n.labelTarget||i)}),t=qa(t),t.length<3?!1:t})};var Gd={horizontal:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
                <polyline points="450 400 450 150 1350 150 1350 400" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
                <rect x="150" y="450" width="600" height="1200" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
                <rect x="1050" y="450" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
              </svg>`,vertical:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
              <polyline points="400 1350 150 1350 150 450 400 450" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
              <rect x="450" y="150" width="1200" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="450" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
            </svg>`},FS=900;function Eo(e,t,n,i){this._distributeElements=t,this._translate=n,this._popupMenu=e,this._rules=i,e.registerProvider("align-elements",FS,this)}Eo.$inject=["popupMenu","distributeElements","translate","rules"];Eo.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&N(t,this._getEntries(e)),t};Eo.prototype._isAllowed=function(e){return this._rules.allowed("elements.distribute",{elements:e})};Eo.prototype._getEntries=function(e){var t=this._distributeElements,n=this._translate,i=this._popupMenu,r={"distribute-elements-horizontal":{group:"distribute",title:n("Distribute elements horizontally"),className:"bjs-align-elements-menu-entry",imageHtml:Gd.horizontal,action:function(o,a){t.trigger(e,"horizontal"),i.close()}},"distribute-elements-vertical":{group:"distribute",title:n("Distribute elements vertically"),imageHtml:Gd.vertical,action:function(o,a){t.trigger(e,"vertical"),i.close()}}};return r};const jS={__depends__:[jl,$S],__init__:["bpmnDistributeElements","distributeElementsMenuProvider"],bpmnDistributeElements:["type",Os],distributeElementsMenuProvider:["type",Eo]};var ng="is not a registered action",HS="is already registered";function Wt(e,t){this._actions={};var n=this;e.on("diagram.init",function(){n._registerDefaultActions(t),e.fire("editorActions.init",{editorActions:n})})}Wt.$inject=["eventBus","injector"];Wt.prototype._registerDefaultActions=function(e){var t=e.get("commandStack",!1),n=e.get("modeling",!1),i=e.get("selection",!1),r=e.get("zoomScroll",!1),o=e.get("copyPaste",!1),a=e.get("canvas",!1),s=e.get("rules",!1),c=e.get("keyboardMove",!1),l=e.get("keyboardMoveSelection",!1);t&&(this.register("undo",function(){t.undo()}),this.register("redo",function(){t.redo()})),o&&i&&this.register("copy",function(){var p=i.get();if(p.length)return o.copy(p)}),o&&this.register("paste",function(){o.paste()}),r&&this.register("stepZoom",function(p){r.stepZoom(p.value)}),a&&this.register("zoom",function(p){a.zoom(p.value)}),n&&i&&s&&this.register("removeSelection",function(){var p=i.get();if(p.length){var u=s.allowed("elements.delete",{elements:p}),f;u!==!1&&(ve(u)?f=u:f=p,f.length&&n.removeElements(f.slice()))}}),c&&this.register("moveCanvas",function(p){c.moveCanvas(p)}),l&&this.register("moveSelection",function(p){l.moveSelection(p.direction,p.accelerated)})};Wt.prototype.trigger=function(e,t){if(!this._actions[e])throw Ju(e,ng);return this._actions[e](t)};Wt.prototype.register=function(e,t){var n=this;if(typeof e=="string")return this._registerAction(e,t);D(e,function(i,r){n._registerAction(r,i)})};Wt.prototype._registerAction=function(e,t){if(this.isRegistered(e))throw Ju(e,HS);this._actions[e]=t};Wt.prototype.unregister=function(e){if(!this.isRegistered(e))throw Ju(e,ng);this._actions[e]=void 0};Wt.prototype.getActions=function(){return Object.keys(this._actions)};Wt.prototype.isRegistered=function(e){return!!this._actions[e]};function Ju(e,t){return new Error(e+" "+t)}const GS={__init__:["editorActions"],editorActions:["type",Wt]};function Ns(e){e.invoke(Wt,this)}q(Ns,Wt);Ns.$inject=["injector"];Ns.prototype._registerDefaultActions=function(e){Wt.prototype._registerDefaultActions.call(this,e);var t=e.get("canvas",!1),n=e.get("elementRegistry",!1),i=e.get("selection",!1),r=e.get("spaceTool",!1),o=e.get("lassoTool",!1),a=e.get("handTool",!1),s=e.get("globalConnect",!1),c=e.get("distributeElements",!1),l=e.get("alignElements",!1),p=e.get("directEditing",!1),u=e.get("searchPad",!1),f=e.get("modeling",!1),d=e.get("contextPad",!1);t&&n&&i&&this._registerAction("selectElements",function(){var h=t.getRootElement(),m=n.filter(function(v){return v!==h});return i.select(m),m}),r&&this._registerAction("spaceTool",function(){r.toggle()}),o&&this._registerAction("lassoTool",function(){o.toggle()}),a&&this._registerAction("handTool",function(){a.toggle()}),s&&this._registerAction("globalConnectTool",function(){s.toggle()}),i&&c&&this._registerAction("distributeElements",function(h){var m=i.get(),v=h.type;m.length&&c.trigger(m,v)}),i&&l&&this._registerAction("alignElements",function(h){var m=i.get(),v=[],E=h.type;m.length&&(v=pe(m,function(w){return!g(w,"bpmn:Lane")}),l.trigger(v,E))}),i&&f&&this._registerAction("setColor",function(h){var m=i.get();m.length&&f.setColor(m,h)}),i&&p&&this._registerAction("directEditing",function(){var h=i.get();h.length&&p.activate(h[0])}),u&&this._registerAction("find",function(){u.toggle()}),t&&f&&this._registerAction("moveToOrigin",function(){var h=t.getRootElement(),m,v;g(h,"bpmn:Collaboration")?v=n.filter(function(E){return g(E.parent,"bpmn:Collaboration")}):v=n.filter(function(E){return E!==h&&!g(E.parent,"bpmn:SubProcess")}),m=At(v),f.moveElements(v,{x:-m.x,y:-m.y},h)}),i&&d&&this._registerAction("replaceElement",function(h){d.triggerEntry("replace","click",h)})};const zS={__depends__:[GS],editorActions:["type",Ns]};function ig(e){e.on(["create.init","shape.move.init"],function(t){var n=t.context,i=t.shape;le(i,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(n.gridSnappingContext||(n.gridSnappingContext={}),n.gridSnappingContext.snapLocation="top-left")})}ig.$inject=["eventBus"];var Da=10;function Tc(e,t,n){return n||(n="round"),Math[n](e/t)*t}var VS=1200,US=800;function oi(e,t,n){var i=!n||n.active!==!1;this._eventBus=t;var r=this;t.on("diagram.init",US,function(){r.setActive(i)}),t.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],VS,function(o){var a=o.originalEvent;if(!(!r.active||a&&It(a))){var s=o.context,c=s.gridSnappingContext;c||(c=s.gridSnappingContext={}),["x","y"].forEach(function(l){var p={},u=YS(o,l,e);u&&(p.offset=u);var f=WS(o,l);f&&N(p,f),rr(o,l)||r.snapEvent(o,l,p)})}})}oi.prototype.snapEvent=function(e,t,n){var i=this.snapValue(e[t],n);He(e,t,i)};oi.prototype.getGridSpacing=function(){return Da};oi.prototype.snapValue=function(e,t){var n=0;t&&t.offset&&(n=t.offset),e+=n,e=Tc(e,Da);var i,r;return t&&t.min&&(i=t.min,ue(i)&&(i=Tc(i+n,Da,"ceil"),e=Math.max(e,i))),t&&t.max&&(r=t.max,ue(r)&&(r=Tc(r+n,Da,"floor"),e=Math.min(e,r))),e-=n,e};oi.prototype.isActive=function(){return this.active};oi.prototype.setActive=function(e){this.active=e,this._eventBus.fire("gridSnapping.toggle",{active:e})};oi.prototype.toggleActive=function(){this.setActive(!this.active)};oi.$inject=["elementRegistry","eventBus","config.gridSnapping"];function WS(e,t){var n=e.context,i=n.createConstraints,r=n.resizeConstraints||{},o=n.gridSnappingContext,a=o.snapConstraints;if(a&&a[t])return a[t];a||(a=o.snapConstraints={}),a[t]||(a[t]={});var s=n.direction;i&&(ka(t)?(a.x.min=i.left,a.x.max=i.right):(a.y.min=i.top,a.y.max=i.bottom));var c=r.min,l=r.max;return c&&(ka(t)?Vd(s)?a.x.max=c.left:a.x.min=c.right:zd(s)?a.y.max=c.top:a.y.min=c.bottom),l&&(ka(t)?Vd(s)?a.x.min=l.left:a.x.max=l.right:zd(s)?a.y.min=l.top:a.y.max=l.bottom),a[t]}function YS(e,t,n){var i=e.context,r=e.shape,o=i.gridSnappingContext,a=o.snapLocation,s=o.snapOffset;return s&&ue(s[t])||(s||(s=o.snapOffset={}),ue(s[t])||(s[t]=0),!r)||(n.get(r.id)||(ka(t)?s[t]+=r[t]+r.width/2:s[t]+=r[t]+r.height/2),!a)||(t==="x"?/left/.test(a)?s[t]-=r.width/2:/right/.test(a)&&(s[t]+=r.width/2):/top/.test(a)?s[t]-=r.height/2:/bottom/.test(a)&&(s[t]+=r.height/2)),s[t]}function ka(e){return e==="x"}function zd(e){return e.indexOf("n")!==-1}function Vd(e){return e.indexOf("w")!==-1}function Oi(e,t){H.call(this,e),this._gridSnapping=t;var n=this;this.preExecute("shape.resize",function(i){var r=i.context,o=r.hints||{},a=o.autoResize;if(a){var s=r.shape,c=r.newBounds;Ka(a)?r.newBounds=n.snapComplex(c,a):r.newBounds=n.snapSimple(s,c)}})}Oi.$inject=["eventBus","gridSnapping","modeling"];q(Oi,H);Oi.prototype.snapSimple=function(e,t){var n=this._gridSnapping;return t.width=n.snapValue(t.width,{min:t.width}),t.height=n.snapValue(t.height,{min:t.height}),t.x=e.x+e.width/2-t.width/2,t.y=e.y+e.height/2-t.height/2,t};Oi.prototype.snapComplex=function(e,t){return/w|e/.test(t)&&(e=this.snapHorizontally(e,t)),/n|s/.test(t)&&(e=this.snapVertically(e,t)),e};Oi.prototype.snapHorizontally=function(e,t){var n=this._gridSnapping,i=/w/.test(t),r=/e/.test(t),o={};return o.width=n.snapValue(e.width,{min:e.width}),r&&(i?(o.x=n.snapValue(e.x,{max:e.x}),o.width+=n.snapValue(e.x-o.x,{min:e.x-o.x})):e.x=e.x+e.width-o.width),N(e,o),e};Oi.prototype.snapVertically=function(e,t){var n=this._gridSnapping,i=/n/.test(t),r=/s/.test(t),o={};return o.height=n.snapValue(e.height,{min:e.height}),i&&(r?(o.y=n.snapValue(e.y,{max:e.y}),o.height+=n.snapValue(e.y-o.y,{min:e.y-o.y})):e.y=e.y+e.height-o.height),N(e,o),e};var qS=2e3;function rg(e,t){e.on(["spaceTool.move","spaceTool.end"],qS,function(n){var i=n.context;if(i.initialized){var r=i.axis,o;r==="x"?(o=t.snapValue(n.dx),n.x=n.x+o-n.dx,n.dx=o):(o=t.snapValue(n.dy),n.y=n.y+o-n.dy,n.dy=o)}})}rg.$inject=["eventBus","gridSnapping"];const KS={__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",Oi],gridSnappingSpaceToolBehavior:["type",rg]},XS={__depends__:[KS],__init__:["gridSnapping"],gridSnapping:["type",oi]};var ZS=2e3;function og(e,t){e.on("autoPlace",ZS,function(n){var i=n.source,r=se(i),o=n.shape,a=wm(i,o);return["x","y"].forEach(function(s){var c={};a[s]!==r[s]&&(a[s]>r[s]?c.min=a[s]:c.max=a[s],g(o,"bpmn:TextAnnotation")&&(JS(s)?c.offset=-o.width/2:c.offset=-o.height/2),a[s]=t.snapValue(a[s],c))}),a})}og.$inject=["eventBus","gridSnapping"];function JS(e){return e==="x"}var QS=1750;function ag(e,t,n){t.on(["create.start","shape.move.start"],QS,function(i){var r=i.context,o=r.shape,a=e.getRootElement();if(!(!g(o,"bpmn:Participant")||!g(a,"bpmn:Process")||!a.children.length)){var s=r.createConstraints;s&&(o.width=n.snapValue(o.width,{min:o.width}),o.height=n.snapValue(o.height,{min:o.height}))}})}ag.$inject=["canvas","eventBus","gridSnapping"];var e1=3e3;function Ls(e,t,n){H.call(this,e),this._gridSnapping=t;var i=this;this.postExecuted(["connection.create","connection.layout"],e1,function(r){var o=r.context,a=o.connection,s=o.hints||{},c=a.waypoints;s.connectionStart||s.connectionEnd||s.createElementsBehavior===!1||t1(c)&&n.updateWaypoints(a,i.snapMiddleSegments(c))})}Ls.$inject=["eventBus","gridSnapping","modeling"];q(Ls,H);Ls.prototype.snapMiddleSegments=function(e){var t=this._gridSnapping,n;e=e.slice();for(var i=1;i<e.length-2;i++)n=r1(t,e[i],e[i+1]),e[i]=n[0],e[i+1]=n[1];return e};function t1(e){return e.length>3}function n1(e){return e==="h"}function i1(e){return e==="v"}function r1(e,t,n){var i=bn(t,n),r={};return n1(i)&&(r.y=e.snapValue(t.y)),i1(i)&&(r.x=e.snapValue(t.x)),("x"in r||"y"in r)&&(t=N({},t,r),n=N({},n,r)),[t,n]}const o1={__init__:["gridSnappingAutoPlaceBehavior","gridSnappingParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",og],gridSnappingParticipantBehavior:["type",ag],gridSnappingLayoutConnectionBehavior:["type",Ls]},a1={__depends__:[XS,o1],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",ig]};var s1=30,sg=30;function xo(e,t){this._interactionEvents=t;var n=this;e.on(["interactionEvents.createHit","interactionEvents.updateHit"],function(i){var r=i.element,o=i.gfx;if(g(r,"bpmn:Lane"))return n._createParticipantHit(r,o);if(g(r,"bpmn:Participant"))return ye(r)?n._createParticipantHit(r,o):n._createDefaultHit(r,o);if(g(r,"bpmn:SubProcess"))return ye(r)?n._createSubProcessHit(r,o):n._createDefaultHit(r,o)})}xo.$inject=["eventBus","interactionEvents"];xo.prototype._createDefaultHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createDefaultHit(e,t),!0};xo.prototype._createParticipantHit=function(e,t){this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height});var n=mt(e)?{width:s1,height:e.height}:{width:e.width,height:sg};return this._interactionEvents.createBoxHit(t,"all",n),!0};xo.prototype._createSubProcessHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:e.width,height:sg}),!0};const c1={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",xo]};function Bs(e){e.invoke(cr,this)}q(Bs,cr);Bs.$inject=["injector"];Bs.prototype.registerBindings=function(e,t){cr.prototype.registerBindings.call(this,e,t);function n(i,r){t.isRegistered(i)&&e.addListener(r)}n("selectElements",function(i){var r=i.keyEvent;if(e.isKey(["a","A"],r)&&e.isCmd(r))return t.trigger("selectElements"),!0}),n("find",function(i){var r=i.keyEvent;if(e.isKey(["f","F"],r)&&e.isCmd(r))return t.trigger("find"),!0}),n("spaceTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["s","S"],r))return t.trigger("spaceTool"),!0}),n("lassoTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["l","L"],r))return t.trigger("lassoTool"),!0}),n("handTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["h","H"],r))return t.trigger("handTool"),!0}),n("globalConnectTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["c","C"],r))return t.trigger("globalConnectTool"),!0}),n("directEditing",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["e","E"],r))return t.trigger("directEditing"),!0}),n("replaceElement",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["r","R"],r))return t.trigger("replaceElement",r),!0})};const l1={__depends__:[Ol],__init__:["keyboardBindings"],keyboardBindings:["type",Bs]};var u1={moveSpeed:1,moveSpeedAccelerated:10},p1=1500,Ud="left",Wd="up",Yd="right",qd="down",f1={ArrowLeft:Ud,Left:Ud,ArrowUp:Wd,Up:Wd,ArrowRight:Yd,Right:Yd,ArrowDown:qd,Down:qd},d1={left:function(e){return{x:-e,y:0}},up:function(e){return{x:0,y:-e}},right:function(e){return{x:e,y:0}},down:function(e){return{x:0,y:e}}};function cg(e,t,n,i,r){var o=this;this._config=N({},u1,e||{}),t.addListener(p1,function(a){var s=a.keyEvent,c=f1[s.key];if(c&&!t.isCmd(s)){var l=t.isShift(s);return o.moveSelection(c,l),!0}}),this.moveSelection=function(a,s){var c=r.get();if(c.length){var l=this._config[s?"moveSpeedAccelerated":"moveSpeed"],p=d1[a](l),u=i.allowed("elements.move",{shapes:c});u&&n.moveElements(c,p)}}}cg.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const h1={__depends__:[Ol,Cn],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",cg]};var Kd=10;function wo(e,t,n,i){this._dragging=i,this._rules=t;var r=this;function o(c,l){var p=c.shape,u=c.direction,f=c.resizeConstraints,d;c.delta=l,d=tx(p,u,l),c.newBounds=ix(d,f),c.canExecute=r.canResize(c)}function a(c){var l=c.resizeConstraints,p=c.minBounds;l===void 0&&(p===void 0&&(p=r.computeMinResizeBox(c)),c.resizeConstraints={min:te(p)})}function s(c){var l=c.shape,p=c.canExecute,u=c.newBounds;if(p){if(u=Fh(u),!m1(l,u))return;n.resizeShape(l,u)}}e.on("resize.start",function(c){a(c.context)}),e.on("resize.move",function(c){var l={x:c.dx,y:c.dy};o(c.context,l)}),e.on("resize.end",function(c){s(c.context)})}wo.prototype.canResize=function(e){var t=this._rules,n=pn(e,["newBounds","shape","delta","direction"]);return t.allowed("shape.resize",n)};wo.prototype.activate=function(e,t,n){var i=this._dragging,r,o;if(typeof n=="string"&&(n={direction:n}),r=N({shape:t},n),o=r.direction,!o)throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");i.init(e,lg(t,o),"resize",{autoActivate:!0,cursor:v1(o),data:{shape:t,context:r}})};wo.prototype.computeMinResizeBox=function(e){var t=e.shape,n=e.direction,i,r;return i=e.minDimensions||{width:Kd,height:Kd},r=Ym(t,e.childrenBoxPadding),rx(n,t,i,r)};wo.$inject=["eventBus","rules","modeling","dragging"];function m1(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}function lg(e,t){var n=se(e),i=te(e),r={x:n.x,y:n.y};return t.indexOf("n")!==-1?r.y=i.top:t.indexOf("s")!==-1&&(r.y=i.bottom),t.indexOf("e")!==-1?r.x=i.right:t.indexOf("w")!==-1&&(r.x=i.left),r}function v1(e){var t="resize-";return e==="n"||e==="s"?t+"ns":e==="e"||e==="w"?t+"ew":e==="nw"||e==="se"?t+"nwse":t+"nesw"}var Xd="djs-resizing",Zd="resize-not-ok",g1=500;function ug(e,t,n){function i(o){var a=o.shape,s=o.newBounds,c=o.frame;c||(c=o.frame=n.addFrame(a,t.getActiveLayer()),t.addMarker(a,Xd)),s.width>5&&ie(c,{x:s.x,width:s.width}),s.height>5&&ie(c,{y:s.y,height:s.height}),o.canExecute?Ae(c).remove(Zd):Ae(c).add(Zd)}function r(o){var a=o.shape,s=o.frame;s&&Qe(o.frame),t.removeMarker(a,Xd)}e.on("resize.move",g1,function(o){i(o.context)}),e.on("resize.cleanup",function(o){r(o.context)})}ug.$inject=["eventBus","canvas","previewSupport"];var ma=-6,va=8,ga=20,Or="djs-resizer",y1=["n","w","s","e","nw","ne","se","sw"];function ai(e,t,n,i){this._resize=i,this._canvas=t;var r=this;e.on("selection.changed",function(o){var a=o.newSelection;r.removeResizers(),a.length===1&&D(a,tr(r.addResizer,r))}),e.on("shape.changed",function(o){var a=o.element;n.isSelected(a)&&(r.removeResizers(),r.addResizer(a))})}ai.prototype.makeDraggable=function(e,t,n){var i=this._resize;function r(o){Tl(o)&&i.activate(o,e,n)}K.bind(t,"mousedown",r),K.bind(t,"touchstart",r)};ai.prototype._createResizer=function(e,t,n,i){var r=this._getResizersParent(),o=_1(i),a=de("g");Ae(a).add(Or),Ae(a).add(Or+"-"+e.id),Ae(a).add(Or+"-"+i),ge(r,a);var s=de("rect");ie(s,{x:-va/2+o.x,y:-va/2+o.y,width:va,height:va}),Ae(s).add(Or+"-visual"),ge(a,s);var c=de("rect");return ie(c,{x:-ga/2+o.x,y:-ga/2+o.y,width:ga,height:ga}),Ae(c).add(Or+"-hit"),ge(a,c),v_(a,t,n),a};ai.prototype.createResizer=function(e,t){var n=lg(e,t),i=this._createResizer(e,n.x,n.y,t);this.makeDraggable(e,i,t)};ai.prototype.addResizer=function(e){var t=this;Te(e)||!this._resize.canResize({shape:e})||D(y1,function(n){t.createResizer(e,n)})};ai.prototype.removeResizers=function(){var e=this._getResizersParent();Za(e)};ai.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")};ai.$inject=["eventBus","canvas","selection","resize"];function _1(e){var t={x:0,y:0};return e.indexOf("e")!==-1?t.x=-ma:e.indexOf("w")!==-1&&(t.x=ma),e.indexOf("s")!==-1?t.y=-ma:e.indexOf("n")!==-1&&(t.y=ma),t}const pg={__depends__:[hn,Pn,fr],__init__:["resize","resizePreview","resizeHandles"],resize:["type",wo],resizePreview:["type",ug],resizeHandles:["type",ai]};var b1=2e3;function So(e,t,n,i,r,o,a){this._bpmnFactory=t,this._canvas=n,this._modeling=r,this._textRenderer=a,i.registerProvider(this),e.on("element.dblclick",function(c){s(c.element,!0)}),e.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set","selection.changed"],function(){i.isActive()&&i.complete()}),e.on(["shape.remove","connection.remove"],b1,function(c){i.isActive(c.element)&&i.cancel()}),e.on(["commandStack.changed"],function(c){i.isActive()&&i.cancel()}),e.on("directEditing.activate",function(c){o.removeResizers()}),e.on("create.end",500,function(c){var l=c.context,p=l.shape,u=c.context.canExecute,f=c.isTouch;f||u&&(l.hints&&l.hints.createElementsBehavior===!1||s(p))}),e.on("autoPlace.end",500,function(c){s(c.shape)});function s(c,l){(l||le(c,["bpmn:Task","bpmn:TextAnnotation","bpmn:Participant"])||Qu(c))&&i.activate(c)}}So.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"];So.prototype.activate=function(e){var t=qn(e);if(t!==void 0){var n={text:t},i=this.getEditingBBox(e);N(n,i);var r={},o=n.style||{};return N(o,{backgroundColor:null,border:null}),(le(e,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||Qu(e))&&N(r,{centerVertically:!0}),er(e)&&(N(r,{autoResize:!0}),N(o,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),g(e,"bpmn:TextAnnotation")&&(N(r,{resizable:!0,autoResize:!0}),N(o,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),N(n,{options:r,style:o}),n}};So.prototype.getEditingBBox=function(e){var t=this._canvas,n=e.label||e,i=t.getAbsoluteBBox(n),r={x:i.x+i.width/2,y:i.y+i.height/2},o={x:i.x,y:i.y},a=t.zoom(),s=this._textRenderer.getDefaultStyle(),c=this._textRenderer.getExternalStyle(),l=c.fontSize*a,p=c.lineHeight,u=s.fontSize*a,f=s.lineHeight,d={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};if(g(e,"bpmn:Lane")||w1(e)){var h=mt(e),m=h?{width:i.height,height:30*a,x:i.x-i.height/2+15*a,y:r.y-30*a/2}:{width:i.width,height:30*a};N(o,m),N(d,{fontSize:u+"px",lineHeight:f,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px",transform:h?"rotate(-90deg)":null})}if(x1(e)){var v=mt(e),E=v?{width:i.width,height:i.height}:{width:i.height,height:i.width,x:r.x-i.height/2,y:r.y-i.width/2};N(o,E),N(d,{fontSize:u+"px",lineHeight:f,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px",transform:v?null:"rotate(-90deg)"})}(le(e,["bpmn:Task","bpmn:CallActivity"])||Qu(e))&&(N(o,{width:i.width,height:i.height}),N(d,{fontSize:u+"px",lineHeight:f,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px"})),E1(e)&&(N(o,{width:i.width,x:i.x}),N(d,{fontSize:u+"px",lineHeight:f,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px"}));var w=90*a,_=7*a,x=4*a;if(n.labelTarget&&(N(o,{width:w,height:i.height+_+x,x:r.x-w/2,y:i.y-_}),N(d,{fontSize:l+"px",lineHeight:p,paddingTop:_+"px",paddingBottom:x+"px"})),er(n)&&!Ja(n)&&!be(n)){var P=Hh(e),A=t.getAbsoluteBBox({x:P.x,y:P.y,width:0,height:0}),C=l+_+x;N(o,{width:w,height:C,x:A.x-w/2,y:A.y-C/2}),N(d,{fontSize:l+"px",lineHeight:p,paddingTop:_+"px",paddingBottom:x+"px"})}return g(e,"bpmn:TextAnnotation")&&(N(o,{width:i.width,height:i.height,minWidth:30*a,minHeight:10*a}),N(d,{textAlign:"left",paddingTop:5*a+"px",paddingBottom:7*a+"px",paddingLeft:7*a+"px",paddingRight:5*a+"px",fontSize:u+"px",lineHeight:f})),{bounds:o,style:d}};So.prototype.update=function(e,t,n,i){var r,o;g(e,"bpmn:TextAnnotation")&&(o=this._canvas.getAbsoluteBBox(e),r={x:e.x,y:e.y,width:e.width/o.width*i.width,height:e.height/o.height*i.height}),S1(t)&&(t=null),this._modeling.updateLabel(e,t,r)};function Qu(e){return g(e,"bpmn:SubProcess")&&!ye(e)}function E1(e){return g(e,"bpmn:SubProcess")&&ye(e)}function x1(e){return g(e,"bpmn:Participant")&&!ye(e)}function w1(e){return g(e,"bpmn:Participant")&&ye(e)}function S1(e){return!e||!e.trim()}var Jd="djs-element-hidden",Qd="djs-label-hidden";function fg(e,t,n){var i=this,r=t.getDefaultLayer(),o,a,s;e.on("directEditing.activate",function(c){var l=c.active;if(o=l.element.label||l.element,g(o,"bpmn:TextAnnotation")){a=t.getAbsoluteBBox(o),s=de("g");var p=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:o.height,position:{mx:0,my:0}}),u=i.path=de("path");ie(u,{d:p,strokeWidth:2,stroke:C1(o)}),ge(s,u),ge(r,s),dt(s,o.x,o.y)}g(o,"bpmn:TextAnnotation")||o.labelTarget?t.addMarker(o,Jd):(g(o,"bpmn:Task")||g(o,"bpmn:CallActivity")||g(o,"bpmn:SubProcess")||g(o,"bpmn:Participant"))&&t.addMarker(o,Qd)}),e.on("directEditing.resize",function(c){if(g(o,"bpmn:TextAnnotation")){var l=c.height,p=c.dy,u=Math.max(o.height/a.height*(l+p),0),f=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:u,position:{mx:0,my:0}});ie(i.path,{d:f})}}),e.on(["directEditing.complete","directEditing.cancel"],function(c){var l=c.active;l&&(t.removeMarker(l.element.label||l.element,Jd),t.removeMarker(o,Qd)),o=void 0,a=void 0,s&&(Qe(s),s=void 0)})}fg.$inject=["eventBus","canvas","pathMap"];function C1(e,t){var n=Se(e);return n.get("stroke")||t||"black"}const T1={__depends__:[Gh,pg,eg],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",So],labelEditingPreview:["type",fg]};var P1=new g_("tt");function R1(e){var t=_e('<div class="djs-tooltip-container" />');return es(t,{position:"absolute",width:"0",height:"0"}),e.insertBefore(t,e.firstChild),t}function A1(e,t,n){es(e,{left:t+"px",top:n+"px"})}function ep(e,t){e.style.display=t===!1?"none":""}var dg="djs-tooltip",Pc="."+dg;function _t(e,t){this._eventBus=e,this._canvas=t,this._ids=P1,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=R1(t.getContainer());var n=this;Rt.bind(this._tooltipRoot,Pc,"mousedown",function(i){i.stopPropagation()}),Rt.bind(this._tooltipRoot,Pc,"mouseover",function(i){n.trigger("mouseover",i)}),Rt.bind(this._tooltipRoot,Pc,"mouseout",function(i){n.trigger("mouseout",i)}),this._init()}_t.$inject=["eventBus","canvas"];_t.prototype.add=function(e){if(!e.position)throw new Error("must specifiy tooltip position");if(!e.html)throw new Error("must specifiy tooltip html");var t=this._ids.next();return e=N({},this._tooltipDefaults,e,{id:t}),this._addTooltip(e),e.timeout&&this.setTimeout(e),t};_t.prototype.trigger=function(e,t){var n=t.delegateTarget||t.target,i=this.get(ct(n,"data-tooltip-id"));i&&(e==="mouseover"&&i.timeout&&this.clearTimeout(i),e==="mouseout"&&i.timeout&&(i.timeout=1e3,this.setTimeout(i)))};_t.prototype.get=function(e){return typeof e!="string"&&(e=e.id),this._tooltips[e]};_t.prototype.clearTimeout=function(e){if(e=this.get(e),!!e){var t=e.removeTimer;t&&(clearTimeout(t),e.removeTimer=null)}};_t.prototype.setTimeout=function(e){if(e=this.get(e),!!e){this.clearTimeout(e);var t=this;e.removeTimer=setTimeout(function(){t.remove(e)},e.timeout)}};_t.prototype.remove=function(e){var t=this.get(e);t&&(Qi(t.html),Qi(t.htmlContainer),delete t.htmlContainer,delete this._tooltips[t.id])};_t.prototype.show=function(){ep(this._tooltipRoot)};_t.prototype.hide=function(){ep(this._tooltipRoot,!1)};_t.prototype._updateRoot=function(e){var t=e.scale||1,n=e.scale||1,i="matrix("+t+",0,0,"+n+","+-1*e.x*t+","+-1*e.y*n+")";this._tooltipRoot.style.transform=i,this._tooltipRoot.style["-ms-transform"]=i};_t.prototype._addTooltip=function(e){var t=e.id,n=e.html,i,r=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),Ka(n)&&(n=_e(n)),i=_e('<div data-tooltip-id="'+t+'" class="'+dg+'">'),es(i,{position:"absolute"}),i.appendChild(n),e.type&&Z(i).add("djs-tooltip-"+e.type),e.className&&Z(i).add(e.className),e.htmlContainer=i,r.appendChild(i),this._tooltips[t]=e,this._updateTooltip(e)};_t.prototype._updateTooltip=function(e){var t=e.position,n=e.htmlContainer;A1(n,t.x,t.y)};_t.prototype._updateTooltipVisibilty=function(e){D(this._tooltips,function(t){var n=t.show,i=t.htmlContainer,r=!0;n&&((n.minZoom>e.scale||n.maxZoom<e.scale)&&(r=!1),ep(i,r))})};_t.prototype._init=function(){var e=this;function t(n){e._updateRoot(n),e._updateTooltipVisibilty(n),e.show()}this._eventBus.on("canvas.viewbox.changing",function(n){e.hide()}),this._eventBus.on("canvas.viewbox.changed",function(n){t(n.viewbox)})};const I1={__init__:["tooltips"],tooltips:["type",_t]};var M1="flow elements must be children of pools/participants";function hg(e,t,n){function i(r,o,a){t.add({position:{x:r.x+5,y:r.y+5},type:"error",timeout:2e3,html:"<div>"+o+"</div>"})}e.on(["shape.move.rejected","create.rejected"],function(r){var o=r.context,a=o.shape,s=o.target;g(s,"bpmn:Collaboration")&&g(a,"bpmn:FlowNode")&&i(r,n(M1))})}hg.$inject=["eventBus","tooltips","translate"];const D1={__depends__:[I1],__init__:["modelingFeedback"],modelingFeedback:["type",hg]};var k1=500,O1=1250,N1=1500,Ua=Math.round;function L1(e){return{x:e.x+Ua(e.width/2),y:e.y+Ua(e.height/2)}}function mg(e,t,n,i,r){function o(s,c,l,p){return r.allowed("elements.move",{shapes:s,delta:c,position:l,target:p})}e.on("shape.move.start",N1,function(s){var c=s.context,l=s.shape,p=i.get().slice();p.indexOf(l)===-1&&(p=[l]),p=B1(p),N(c,{shapes:p,validatedShapes:p,shape:l})}),e.on("shape.move.start",O1,function(s){var c=s.context,l=c.validatedShapes,p;if(p=c.canExecute=o(l),!p)return!1}),e.on("shape.move.move",k1,function(s){var c=s.context,l=c.validatedShapes,p=s.hover,u={x:s.dx,y:s.dy},f={x:s.x,y:s.y},d;if(d=o(l,u,f,p),c.delta=u,c.canExecute=d,d===null){c.target=null;return}c.target=p}),e.on("shape.move.end",function(s){var c=s.context,l=c.delta,p=c.canExecute,u=p==="attach",f=c.shapes;if(p===!1)return!1;l.x=Ua(l.x),l.y=Ua(l.y),!(l.x===0&&l.y===0)&&n.moveElements(f,l,c.target,{primaryShape:c.shape,attach:u})}),e.on("element.mousedown",function(s){if(Tl(s)){var c=Oh(s);if(!c)throw new Error("must supply DOM mousedown event");return a(c,s.element)}});function a(s,c,l,p){if(fn(l)&&(p=l,l=!1),!(c.waypoints||!c.parent)&&!Ae(s.target).has("djs-hit-no-move")){var u=L1(c);return t.init(s,u,"shape.move",{cursor:"grabbing",autoActivate:l,data:{shape:c,context:p||{}}}),!0}}this.start=a}mg.$inject=["eventBus","dragging","modeling","selection","rules"];function B1(e){var t=Xa(e,"id");return pe(e,function(n){for(;n=n.parent;)if(t[n.id])return!1;return!0})}var eh=499,Rc="djs-dragging",th="drop-ok",nh="drop-not-ok",ih="new-parent",rh="attach-ok";function vg(e,t,n,i){function r(c){var l=o(c),p=$1(l);return p}function o(c){var l=eo(c,!0),p=yt(l,function(u){return(u.incoming||[]).concat(u.outgoing||[])});return Na(l.concat(p))}function a(c,l){[rh,th,nh,ih].forEach(function(p){p===l?t.addMarker(c,p):t.removeMarker(c,p)})}function s(c,l,p){i.addDragger(l,c.dragGroup),p&&t.addMarker(l,Rc),c.allDraggedElements?c.allDraggedElements.push(l):c.allDraggedElements=[l]}e.on("shape.move.start",eh,function(c){var l=c.context,p=l.shapes,u=l.allDraggedElements,f=r(p);if(!l.dragGroup){var d=de("g");ie(d,n.cls("djs-drag-group",["no-events"]));var h=t.getActiveLayer();ge(h,d),l.dragGroup=d}f.forEach(function(m){i.addDragger(m,l.dragGroup)}),u?u=Na([u,o(p)]):u=o(p),D(u,function(m){t.addMarker(m,Rc)}),l.allDraggedElements=u,l.differentParents=F1(p)}),e.on("shape.move.move",eh,function(c){var l=c.context,p=l.dragGroup,u=l.target,f=l.shape.parent,d=l.canExecute;u&&(d==="attach"?a(u,rh):l.canExecute&&f&&u.id!==f.id?a(u,ih):a(u,l.canExecute?th:nh)),dt(p,c.dx,c.dy)}),e.on(["shape.move.out","shape.move.cleanup"],function(c){var l=c.context,p=l.target;p&&a(p,null)}),e.on("shape.move.cleanup",function(c){var l=c.context,p=l.allDraggedElements,u=l.dragGroup;D(p,function(f){t.removeMarker(f,Rc)}),u&&Qe(u)}),this.makeDraggable=s}vg.$inject=["eventBus","canvas","styles","previewSupport"];function $1(e){var t=pe(e,function(n){return Te(n)?ke(e,En({id:n.source.id}))&&ke(e,En({id:n.target.id})):!0});return t}function F1(e){return y_(Xa(e,function(t){return t.parent&&t.parent.id}))!==1}const j1={__depends__:[wl,Cn,__,hn,Pn,fr],__init__:["move","movePreview"],move:["type",mg],movePreview:["type",vg]};var gg=".djs-palette-toggle",yg=".entry",H1=gg+", "+yg,fl="djs-palette-",G1="shown",dl="open",oh="two-column",z1=1e3;function Ge(e,t){this._eventBus=e,this._canvas=t;var n=this;e.on("tool-manager.update",function(i){var r=i.tool;n.updateToolHighlight(r)}),e.on("i18n.changed",function(){n._update()}),e.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}Ge.$inject=["eventBus","canvas"];Ge.prototype.registerProvider=function(e,t){t||(t=e,e=z1),this._eventBus.on("palette.getProviders",e,function(n){n.providers.push(t)}),this._rebuild()};Ge.prototype.getEntries=function(){var e=this._getProviders();return e.reduce(U1,{})};Ge.prototype._rebuild=function(){if(this._diagramInitialized){var e=this._getProviders();e.length&&(this._container||this._init(),this._update())}};Ge.prototype._init=function(){var e=this,t=this._eventBus,n=this._getParentContainer(),i=this._container=_e(Ge.HTML_MARKUP);n.appendChild(i),Z(n).add(fl+G1),Rt.bind(i,H1,"click",function(r){var o=r.delegateTarget;if(Ya(o,gg))return e.toggle();e.trigger("click",r)}),K.bind(i,"mousedown",function(r){r.stopPropagation()}),Rt.bind(i,yg,"dragstart",function(r){e.trigger("dragstart",r)}),t.on("canvas.resized",this._layoutChanged,this),t.fire("palette.create",{container:i})};Ge.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};Ge.prototype._toggleState=function(e){e=e||{};var t=this._getParentContainer(),n=this._container,i=this._eventBus,r,o=Z(n),a=Z(t);"twoColumn"in e?r=e.twoColumn:r=this._needsCollapse(t.clientHeight,this._entries||{}),o.toggle(oh,r),a.toggle(fl+oh,r),"open"in e&&(o.toggle(dl,e.open),a.toggle(fl+dl,e.open)),i.fire("palette.changed",{twoColumn:r,open:this.isOpen()})};Ge.prototype._update=function(){var e=we(".djs-palette-entries",this._container),t=this._entries=this.getEntries();Il(e),D(t,function(n,i){var r=n.group||"default",o=we("[data-group="+Ai(r)+"]",e);o||(o=_e('<div class="group"></div>'),ct(o,"data-group",r),e.appendChild(o));var a=n.html||(n.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),s=_e(a);if(o.appendChild(s),!n.separator&&(ct(s,"data-action",i),n.title&&ct(s,"title",n.title),n.className&&V1(s,n.className),n.imageUrl)){var c=_e("<img>");ct(c,"src",n.imageUrl),s.appendChild(c)}}),this.open()};Ge.prototype.trigger=function(e,t,n){var i,r,o=t.delegateTarget||t.target;return o?(i=ct(o,"data-action"),r=t.originalEvent||t,this.triggerEntry(i,e,r,n)):t.preventDefault()};Ge.prototype.triggerEntry=function(e,t,n,i){var r=this._entries,o,a;if(o=r[e],!!o&&(a=o.action,this._eventBus.fire("palette.trigger",{entry:o,event:n})!==!1)){if(jt(a)){if(t==="click")return a(n,i)}else if(a[t])return a[t](n,i);n.preventDefault()}};Ge.prototype._layoutChanged=function(){this._toggleState({})};Ge.prototype._needsCollapse=function(e,t){var n=50,i=Object.keys(t).length*46;return e<i+n};Ge.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})};Ge.prototype.open=function(){this._toggleState({open:!0})};Ge.prototype.toggle=function(){this.isOpen()?this.close():this.open()};Ge.prototype.isActiveTool=function(e){return e&&this._activeTool===e};Ge.prototype.updateToolHighlight=function(e){var t,n;this._toolsContainer||(t=we(".djs-palette-entries",this._container),this._toolsContainer=we("[data-group=tools]",t)),n=this._toolsContainer,D(n.children,function(i){var r=i.getAttribute("data-action");if(r){var o=Z(i);r=r.replace("-tool",""),o.contains("entry")&&r===e?o.add("highlighted-entry"):o.remove("highlighted-entry")}})};Ge.prototype.isOpen=function(){return Z(this._container).has(dl)};Ge.prototype._getParentContainer=function(){return this._canvas.getContainer()};Ge.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';function V1(e,t){var n=Z(e),i=ve(t)?t:t.split(/\s+/g);i.forEach(function(r){n.add(r)})}function U1(e,t){var n=t.getPaletteEntries();return jt(n)?n(e):(D(n,function(i,r){e[r]=i}),e)}const W1={__init__:["palette"],palette:["type",Ge]};var _g="crosshair";function Ni(e,t,n,i,r,o,a){this._selection=r,this._dragging=n,this._mouse=a;var s=this,c={create:function(l){var p=t.getActiveLayer(),u;u=l.frame=de("rect"),ie(u,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),ge(p,u)},update:function(l){var p=l.frame,u=l.bbox;ie(p,{x:u.x,y:u.y,width:u.width,height:u.height})},remove:function(l){l.frame&&Qe(l.frame)}};o.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),e.on("lasso.selection.end",function(l){var p=l.originalEvent.target;!l.hover&&!(p instanceof SVGElement)||e.once("lasso.selection.ended",function(){s.activateLasso(l.originalEvent,!0)})}),e.on("lasso.end",0,function(l){var p=l.context,u=Ac(l),f=i.filter(function(h){return h}),d=Fc(l);s.select(f,u,d?p.selection:[])}),e.on("lasso.start",function(l){var p=l.context;p.bbox=Ac(l),c.create(p),p.selection=r.get()}),e.on("lasso.move",function(l){var p=l.context;p.bbox=Ac(l),c.update(p)}),e.on("lasso.cleanup",function(l){var p=l.context;c.remove(p)}),e.on("element.mousedown",1500,function(l){if(Fc(l))return s.activateLasso(l.originalEvent),!0})}Ni.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"];Ni.prototype.activateLasso=function(e,t){this._dragging.init(e,"lasso",{autoActivate:t,cursor:_g,data:{context:{}}})};Ni.prototype.activateSelection=function(e,t){this._dragging.init(e,"lasso.selection",{trapClick:!1,autoActivate:t,cursor:_g,data:{context:{}},keepSelection:!0})};Ni.prototype.select=function(e,t,n=[]){var i=b_(e,t);this._selection.select([...n,...Sl(i)])};Ni.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)};Ni.prototype.isActive=function(){var e=this._dragging.context();return e&&/^lasso/.test(e.prefix)};function Ac(e){var t={x:e.x-e.dx,y:e.y-e.dy},n={x:e.x,y:e.y},i;return t.x<=n.x&&t.y<n.y||t.x<n.x&&t.y<=n.y?i={x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y}:t.x>=n.x&&t.y<n.y||t.x>n.x&&t.y<=n.y?i={x:n.x,y:t.y,width:t.x-n.x,height:n.y-t.y}:t.x<=n.x&&t.y>n.y||t.x<n.x&&t.y>=n.y?i={x:t.x,y:n.y,width:n.x-t.x,height:t.y-n.y}:t.x>=n.x&&t.y>n.y||t.x>n.x&&t.y>=n.y?i={x:n.x,y:n.y,width:t.x-n.x,height:t.y-n.y}:i={x:n.x,y:n.y,width:0,height:0},i}const Y1={__depends__:[Es,co],__init__:["lassoTool"],lassoTool:["type",Ni]};var Ic=1500,bg="grab";function hr(e,t,n,i,r,o){this._dragging=n,this._mouse=o;var a=this,s=i.get("keyboard",!1);r.registerTool("hand",{tool:"hand",dragging:"hand.move"}),e.on("element.mousedown",Ic,function(c){if(zr(c))return a.activateMove(c.originalEvent,!0),!1}),s&&s.addListener(Ic,function(c){if(!(!ah(c.keyEvent)||a.isActive())){var l=a._mouse.getLastMoveEvent();a.activateMove(l,!!l)}},"keyboard.keydown"),s&&s.addListener(Ic,function(c){!ah(c.keyEvent)||!a.isActive()||a.toggle()},"keyboard.keyup"),e.on("hand.end",function(c){var l=c.originalEvent.target;if(!c.hover&&!(l instanceof SVGElement))return!1;e.once("hand.ended",function(){a.activateMove(c.originalEvent,{reactivate:!0})})}),e.on("hand.move.move",function(c){var l=t.viewbox().scale;t.scroll({dx:c.dx*l,dy:c.dy*l})}),e.on("hand.move.end",function(c){var l=c.context,p=l.reactivate;return!zr(c)&&p&&e.once("hand.move.ended",function(u){a.activateHand(u.originalEvent,!0,!0)}),!1})}hr.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"];hr.prototype.activateMove=function(e,t,n){typeof t=="object"&&(n=t,t=!1),this._dragging.init(e,"hand.move",{autoActivate:t,cursor:bg,data:{context:n||{}}})};hr.prototype.activateHand=function(e,t,n){this._dragging.init(e,"hand",{trapClick:!1,autoActivate:t,cursor:bg,data:{context:{reactivate:n}}})};hr.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateHand(e,!!e)};hr.prototype.isActive=function(){var e=this._dragging.context();return e?/^(hand|hand\.move)$/.test(e.prefix):!1};function ah(e){return Ke("Space",e)}const q1={__depends__:[Es,co],__init__:["handTool"],handTool:["type",hr]};var sh="connect-ok",ch="connect-not-ok";function mr(e,t,n,i,r,o,a){var s=this;this._dragging=t,this._rules=o,this._mouse=a,r.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),e.on("global-connect.hover",function(c){var l=c.context,p=c.hover,u=l.canStartConnect=s.canStartConnect(p);u!==null&&(l.startTarget=p,i.addMarker(p,u?sh:ch))}),e.on(["global-connect.out","global-connect.cleanup"],function(c){var l=c.context.startTarget,p=c.context.canStartConnect;l&&i.removeMarker(l,p?sh:ch)}),e.on(["global-connect.ended"],function(c){var l=c.context,p=l.startTarget,u={x:c.x,y:c.y},f=s.canStartConnect(p);if(f)return e.once("element.out",function(){e.once(["connect.ended","connect.canceled"],function(){e.fire("global-connect.drag.ended")}),n.start(null,p,u)}),!1})}mr.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"];mr.prototype.start=function(e,t){this._dragging.init(e,"global-connect",{autoActivate:t,trapClick:!1,data:{context:{}}})};mr.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();return this.start(e,!!e)};mr.prototype.isActive=function(){var e=this._dragging.context();return e&&/^global-connect/.test(e.prefix)};mr.prototype.canStartConnect=function(e){return this._rules.allowed("connection.start",{source:e})};const K1={__depends__:[ql,hn,Pn,Es,co],globalConnect:["type",mr]};function $s(e,t,n,i,r,o,a,s){this._palette=e,this._create=t,this._elementFactory=n,this._spaceTool=i,this._lassoTool=r,this._handTool=o,this._globalConnect=a,this._translate=s,e.registerProvider(this)}$s.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];$s.prototype.getPaletteEntries=function(){var e={},t=this._create,n=this._elementFactory,i=this._spaceTool,r=this._lassoTool,o=this._handTool,a=this._globalConnect,s=this._translate;function c(u,f,d,h,m){function v(E){var w=n.createShape(N({type:u},m));t.start(E,w)}return{group:f,className:d,title:h,action:{dragstart:v,click:v}}}function l(u){var f=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),d=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:f});t.start(u,[f,d],{hints:{autoSelect:[f]}})}function p(u){t.start(u,n.createParticipantShape())}return N(e,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:s("Activate hand tool"),action:{click:function(u){o.activateHand(u)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:s("Activate lasso tool"),action:{click:function(u){r.activateSelection(u)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:s("Activate create/remove space tool"),action:{click:function(u){i.activateSelection(u)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:s("Activate global connect tool"),action:{click:function(u){a.start(u)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":c("bpmn:StartEvent","event","bpmn-icon-start-event-none",s("Create start event")),"create.intermediate-event":c("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",s("Create intermediate/boundary event")),"create.end-event":c("bpmn:EndEvent","event","bpmn-icon-end-event-none",s("Create end event")),"create.exclusive-gateway":c("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",s("Create gateway")),"create.task":c("bpmn:Task","activity","bpmn-icon-task",s("Create task")),"create.data-object":c("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",s("Create data object reference")),"create.data-store":c("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",s("Create data store reference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:s("Create expanded sub-process"),action:{dragstart:l,click:l}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:s("Create pool/participant"),action:{dragstart:p,click:p}},"create.group":c("bpmn:Group","artifact","bpmn-icon-group",s("Create group"))}),e};const X1={__depends__:[W1,bs,Lv,Y1,q1,K1,zh],__init__:["paletteProvider"],paletteProvider:["type",$s]};var Z1=250;function tp(e,t,n,i,r){H.call(this,e);function o(s){var c=s.canExecute.replacements;D(c,function(l){var p=l.oldElementId,u={type:l.newElementType};if(!s.visualReplacements[p]){var f=t.get(p);N(u,{x:f.x,y:f.y});var d=n.createShape(u);i.addShape(d,f.parent);var h=we('[data-element-id="'+Ai(f.id)+'"]',s.dragGroup);h&&ie(h,{display:"none"});var m=r.addDragger(d,s.dragGroup);s.visualReplacements[p]=m,i.removeShape(d)}})}function a(s){var c=s.visualReplacements;D(c,function(l,p){var u=we('[data-element-id="'+Ai(p)+'"]',s.dragGroup);u&&ie(u,{display:"inline"}),l.remove(),c[p]&&delete c[p]})}e.on("shape.move.move",Z1,function(s){var c=s.context,l=c.canExecute;c.visualReplacements||(c.visualReplacements={}),l&&l.replacements?o(c):a(c)})}tp.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"];q(tp,H);const J1={__depends__:[fr],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",tp]};var Q1=1250,Mc=40,eC=20,tC=10,lh=20,Eg=["x","y"],nC=Math.abs;function xg(e){e.on(["connect.hover","connect.move","connect.end"],Q1,function(t){var n=t.context,i=n.canExecute,r=n.start,o=n.hover,a=n.source,s=n.target;t.originalEvent&&It(t.originalEvent)||(n.initialConnectionStart||(n.initialConnectionStart=n.connectionStart),i&&o&&iC(t,o,sC(o)),o&&aC(i,["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"])?(n.connectionStart=Ft(r),le(o,["bpmn:Event","bpmn:Gateway"])&&uh(t,Ft(o)),le(o,["bpmn:Task","bpmn:SubProcess"])&&rC(t,o),g(a,"bpmn:BoundaryEvent")&&s===a.host&&oC(t)):wg(i,"bpmn:MessageFlow")?(g(r,"bpmn:Event")&&(n.connectionStart=Ft(r)),g(o,"bpmn:Event")&&uh(t,Ft(o))):n.connectionStart=n.initialConnectionStart)})}xg.$inject=["eventBus"];function iC(e,t,n){Eg.forEach(function(i){var r=Sg(i,t);e[i]<t[i]+n?He(e,i,t[i]+n):e[i]>t[i]+r-n&&He(e,i,t[i]+r-n)})}function rC(e,t){var n=Ft(t);Eg.forEach(function(i){cC(e,t,i)&&He(e,i,n[i])})}function oC(e){var t=e.context,n=t.source,i=t.target;if(!lC(t)){var r=Ft(n),o=ut(r,i,-10),a=[];/top|bottom/.test(o)&&a.push("x"),/left|right/.test(o)&&a.push("y"),a.forEach(function(s){var c=e[s],l;nC(c-r[s])<Mc&&(c>r[s]?l=r[s]+Mc:l=r[s]-Mc,He(e,s,l))})}}function uh(e,t){He(e,"x",t.x),He(e,"y",t.y)}function wg(e,t){return e&&e.type===t}function aC(e,t){return Mi(t,function(n){return wg(e,n)})}function Sg(e,t){return e==="x"?t.width:t.height}function sC(e){return g(e,"bpmn:Task")?tC:eC}function cC(e,t,n){return e[n]>t[n]+lh&&e[n]<t[n]+Sg(n,t)-lh}function lC(e){var t=e.hover,n=e.source;return t&&n&&t===n}function si(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}si.prototype.getSnapOrigin=function(e){return this._snapOrigins[e]};si.prototype.setSnapOrigin=function(e,t){this._snapOrigins[e]=t,this._snapLocations.indexOf(e)===-1&&this._snapLocations.push(e)};si.prototype.addDefaultSnap=function(e,t){var n=this._defaultSnaps[e];n||(n=this._defaultSnaps[e]=[]),n.push(t)};si.prototype.getSnapLocations=function(){return this._snapLocations};si.prototype.setSnapLocations=function(e){this._snapLocations=e};si.prototype.pointsForTarget=function(e){var t=e.id||e,n=this._targets[t];return n||(n=this._targets[t]=new Fs,n.initDefaults(this._defaultSnaps)),n};function Fs(){this._snapValues={}}Fs.prototype.add=function(e,t){var n=this._snapValues[e];n||(n=this._snapValues[e]={x:[],y:[]}),n.x.indexOf(t.x)===-1&&n.x.push(t.x),n.y.indexOf(t.y)===-1&&n.y.push(t.y)};Fs.prototype.snap=function(e,t,n,i){var r=this._snapValues[t];return r&&PE(e[n],r[n],i)};Fs.prototype.initDefaults=function(e){var t=this;D(e||{},function(n,i){D(n,function(r){t.add(i,r)})})};var uC=1250;function mn(e,t,n){var i=this;this._elementRegistry=e,t.on(["create.start","shape.move.start"],function(r){i.initSnap(r)}),t.on(["create.move","create.end","shape.move.move","shape.move.end"],uC,function(r){var o=r.context,a=o.shape,s=o.snapContext,c=o.target;if(!(r.originalEvent&&It(r.originalEvent))&&!(rr(r)||!c)){var l=s.pointsForTarget(c);l.initialized||(l=i.addSnapTargetPoints(l,a,c),l.initialized=!0),n.snap(r,l)}}),t.on(["create.cleanup","shape.move.cleanup"],function(){n.hide()})}mn.$inject=["elementRegistry","eventBus","snapping"];mn.prototype.initSnap=function(e){var t=this._elementRegistry,n=e.context,i=n.shape,r=n.snapContext;r||(r=n.snapContext=new si);var o;t.get(i.id)?o=Ft(i,e):o={x:e.x+Ft(i).x,y:e.y+Ft(i).y};var a={x:o.x-i.width/2,y:o.y-i.height/2},s={x:o.x+i.width/2,y:o.y+i.height/2};return r.setSnapOrigin("mid",{x:o.x-e.x,y:o.y-e.y}),be(i)||(r.setSnapOrigin("top-left",{x:a.x-e.x,y:a.y-e.y}),r.setSnapOrigin("bottom-right",{x:s.x-e.x,y:s.y-e.y})),r};mn.prototype.addSnapTargetPoints=function(e,t,n){var i=this.getSnapTargets(t,n);return D(i,function(r){if(be(r)){be(t)&&e.add("mid",Ft(r));return}if(Te(r)){if(r.waypoints.length<3)return;var o=r.waypoints.slice(1,-1);D(o,function(a){e.add("mid",a)});return}e.add("mid",Ft(r))}),!ue(t.x)||!ue(t.y)||this._elementRegistry.get(t.id)&&e.add("mid",Ft(t)),e};mn.prototype.getSnapTargets=function(e,t){return Fm(t).filter(function(n){return!pC(n)})};function pC(e){return!!e.hidden}var ph=1500;function vr(e,t){t.invoke(mn,this),e.on(["create.move","create.end"],ph,mC),e.on(["create.move","create.end","shape.move.move","shape.move.end"],ph,function(n){var i=n.context,r=i.canExecute,o=i.target,a=r&&(r==="attach"||r.attach);a&&!rr(n)&&fC(n,o)})}q(vr,mn);vr.$inject=["eventBus","injector"];vr.prototype.initSnap=function(e){var t=mn.prototype.initSnap.call(this,e),n=e.shape,i=!!this._elementRegistry.get(n.id);return D(n.outgoing,function(r){var o=r.waypoints[0];o=o.original||o,t.setSnapOrigin(r.id+"-docking",dh(o,i,e))}),D(n.incoming,function(r){var o=r.waypoints[r.waypoints.length-1];o=o.original||o,t.setSnapOrigin(r.id+"-docking",dh(o,i,e))}),g(n,"bpmn:Participant")&&t.setSnapLocations(["top-left","bottom-right","mid"]),t};vr.prototype.addSnapTargetPoints=function(e,t,n){mn.prototype.addSnapTargetPoints.call(this,e,t,n);var i=this.getSnapTargets(t,n);D(i,function(o){(hC(o)||dC([t,o],"bpmn:TextAnnotation"))&&(e.add("top-left",Bm(o)),e.add("bottom-right",$m(o)))});var r=this._elementRegistry;return D(t.incoming,function(o){if(r.get(t.id)){fh(i,o.source)||e.add("mid",se(o.source));var a=o.waypoints[0];e.add(o.id+"-docking",a.original||a)}}),D(t.outgoing,function(o){if(r.get(t.id)){fh(i,o.target)||e.add("mid",se(o.target));var a=o.waypoints[o.waypoints.length-1];e.add(o.id+"-docking",a.original||a)}}),g(n,"bpmn:SequenceFlow")&&(e=this.addSnapTargetPoints(e,t,n.parent)),e};vr.prototype.getSnapTargets=function(e,t){return mn.prototype.getSnapTargets.call(this,e,t).filter(function(n){return!g(n,"bpmn:Lane")})};function fC(e,t){var n=te(t),i=pv(e,t),r=e.context,o=r.shape,a;o.parent?a={x:0,y:0}:a=se(o),/top/.test(i)?He(e,"y",n.top-a.y):/bottom/.test(i)&&He(e,"y",n.bottom-a.y),/left/.test(i)?He(e,"x",n.left-a.x):/right/.test(i)&&He(e,"x",n.right-a.x)}function dC(e,t){return e.every(function(n){return g(n,t)})}function hC(e){return g(e,"bpmn:SubProcess")&&ye(e)?!0:g(e,"bpmn:Participant")}function mC(e){var t=e.context,n=t.createConstraints;if(n){var i=n.top,r=n.right,o=n.bottom,a=n.left;(a&&a>=e.x||r&&r<=e.x)&&He(e,"x",e.x),(i&&i>=e.y||o&&o<=e.y)&&He(e,"y",e.y)}}function fh(e,t){return e.indexOf(t)!==-1}function dh(e,t,n){return t?{x:e.x-n.x,y:e.y-n.y}:{x:e.x,y:e.y}}var vC=1250;function Co(e,t){var n=this;e.on(["resize.start"],function(i){n.initSnap(i)}),e.on(["resize.move","resize.end"],vC,function(i){var r=i.context,o=r.shape,a=o.parent,s=r.direction,c=r.snapContext;if(!(i.originalEvent&&It(i.originalEvent))&&!rr(i)){var l=c.pointsForTarget(a);l.initialized||(l=n.addSnapTargetPoints(l,o,a,s),l.initialized=!0),_C(s)&&He(i,"x",i.x),bC(s)&&He(i,"y",i.y),t.snap(i,l)}}),e.on(["resize.cleanup"],function(){t.hide()})}Co.prototype.initSnap=function(e){var t=e.context,n=t.shape,i=t.direction,r=t.snapContext;r||(r=t.snapContext=new si);var o=Cg(n,i);return r.setSnapOrigin("corner",{x:o.x-e.x,y:o.y-e.y}),r};Co.prototype.addSnapTargetPoints=function(e,t,n,i){var r=this.getSnapTargets(t,n);return D(r,function(o){e.add("corner",$m(o)),e.add("corner",Bm(o))}),e.add("corner",Cg(t,i)),e};Co.$inject=["eventBus","snapping"];Co.prototype.getSnapTargets=function(e,t){return Fm(t).filter(function(n){return!gC(n,e)&&!Te(n)&&!yC(n)&&!be(n)})};function Cg(e,t){var n=se(e),i=te(e),r={x:n.x,y:n.y};return t.indexOf("n")!==-1?r.y=i.top:t.indexOf("s")!==-1&&(r.y=i.bottom),t.indexOf("e")!==-1?r.x=i.right:t.indexOf("w")!==-1&&(r.x=i.left),r}function gC(e,t){return e.host===t}function yC(e){return!!e.hidden}function _C(e){return e==="n"||e==="s"}function bC(e){return e==="e"||e==="w"}var EC=7,xC=1e3;function ci(e){this._canvas=e,this._asyncHide=E_(tr(this.hide,this),xC)}ci.$inject=["canvas"];ci.prototype.snap=function(e,t){var n=e.context,i=n.snapContext,r=i.getSnapLocations(),o={x:rr(e,"x"),y:rr(e,"y")};D(r,function(a){var s=i.getSnapOrigin(a),c={x:e.x+s.x,y:e.y+s.y};if(D(["x","y"],function(l){var p;o[l]||(p=t.snap(c,a,l,EC),p!==void 0&&(o[l]={value:p,originValue:p-s[l]}))}),o.x&&o.y)return!1}),this.showSnapLine("vertical",o.x&&o.x.value),this.showSnapLine("horizontal",o.y&&o.y.value),D(["x","y"],function(a){var s=o[a];fn(s)&&He(e,a,s.originValue)})};ci.prototype._createLine=function(e){var t=this._canvas.getLayer("snap"),n=de("path");return ie(n,{d:"M0,0 L0,0"}),Ae(n).add("djs-snap-line"),ge(t,n),{update:function(i){ue(i)?e==="horizontal"?ie(n,{d:"M-100000,"+i+" L+100000,"+i,display:""}):ie(n,{d:"M "+i+",-100000 L "+i+", +100000",display:""}):ie(n,{display:"none"})}}};ci.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}};ci.prototype.showSnapLine=function(e,t){var n=this.getSnapLine(e);n&&n.update(t),this._asyncHide()};ci.prototype.getSnapLine=function(e){return this._snapLines||this._createSnapLines(),this._snapLines[e]};ci.prototype.hide=function(){D(this._snapLines,function(e){e.update()})};const wC={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",mn],resizeSnapping:["type",Co],snapping:["type",ci]},SC={__depends__:[wC],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",xg],createMoveSnapping:["type",vr]};function ne(e,t,n,i,r){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=e,this._eventBus=t,this._overlays=n,this._selection=i,this._translate=r,this._container=this._getBoxHtml(),this._searchInput=we(ne.INPUT_SELECTOR,this._container),this._resultsContainer=we(ne.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),t.on(["canvas.destroy","diagram.destroy"],this.close,this)}ne.$inject=["canvas","eventBus","overlays","selection","translate"];ne.prototype._bindEvents=function(){var e=this;function t(n,i,r,o){e._eventMaps.push({el:n,type:r,listener:Rt.bind(n,i,r,o)})}t(document,"html","click",function(n){e.close()}),t(this._container,ne.INPUT_SELECTOR,"click",function(n){n.stopPropagation(),n.delegateTarget.focus()}),t(this._container,ne.RESULT_SELECTOR,"mouseover",function(n){n.stopPropagation(),e._scrollToNode(n.delegateTarget),e._preselect(n.delegateTarget)}),t(this._container,ne.RESULT_SELECTOR,"click",function(n){n.stopPropagation(),e._select(n.delegateTarget)}),t(this._container,ne.INPUT_SELECTOR,"keydown",function(n){Ke("ArrowUp",n)&&n.preventDefault(),Ke("ArrowDown",n)&&n.preventDefault()}),t(this._container,ne.INPUT_SELECTOR,"keyup",function(n){if(Ke("Escape",n))return e.close();if(Ke("Enter",n)){var i=e._getCurrentResult();return i?e._select(i):e.close()}if(Ke("ArrowUp",n))return e._scrollToDirection(!0);if(Ke("ArrowDown",n))return e._scrollToDirection();Ke(["ArrowLeft","ArrowRight"],n)||e._search(n.delegateTarget.value)})};ne.prototype._unbindEvents=function(){this._eventMaps.forEach(function(e){Rt.unbind(e.el,e.type,e.listener)})};ne.prototype._search=function(e){var t=this;if(this._clearResults(),!(!e||e==="")){var n=this._searchProvider.find(e);if(n.length){n.forEach(function(r){var o=r.element.id,a=t._createResultNode(r,o);t._results[o]={element:r.element,node:a}});var i=we(ne.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(i),this._preselect(i)}}};ne.prototype._scrollToDirection=function(e){var t=this._getCurrentResult();if(t){var n=e?t.previousElementSibling:t.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}};ne.prototype._scrollToNode=function(e){if(!(!e||e===this._getCurrentResult())){var t=e.offsetTop,n=this._resultsContainer.scrollTop,i=t-this._resultsContainer.clientHeight+e.clientHeight;t<n?this._resultsContainer.scrollTop=t:n<i&&(this._resultsContainer.scrollTop=i)}};ne.prototype._clearResults=function(){Il(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")};ne.prototype._getCurrentResult=function(){return we(ne.RESULT_SELECTED_SELECTOR,this._resultsContainer)};ne.prototype._createResultNode=function(e,t){var n=_e(ne.RESULT_HTML);return e.primaryTokens.length>0&&hh(n,e.primaryTokens,ne.RESULT_PRIMARY_HTML),hh(n,e.secondaryTokens,ne.RESULT_SECONDARY_HTML),ct(n,ne.RESULT_ID_ATTRIBUTE,t),this._resultsContainer.appendChild(n),n};ne.prototype.registerProvider=function(e){this._searchProvider=e};ne.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,Z(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))};ne.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,Z(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))};ne.prototype.toggle=function(){this.isOpen()?this.close():this.open()};ne.prototype.isOpen=function(){return this._open};ne.prototype._preselect=function(e){var t=this._getCurrentResult();if(e!==t){t&&Z(t).remove(ne.RESULT_SELECTED_CLASS);var n=ct(e,ne.RESULT_ID_ATTRIBUTE),i=this._results[n].element;Z(e).add(ne.RESULT_SELECTED_CLASS),this._resetOverlay(i),this._canvas.scrollToElement(i,{top:400}),this._selection.select(i),this._eventBus.fire("searchPad.preselected",i)}};ne.prototype._select=function(e){var t=ct(e,ne.RESULT_ID_ATTRIBUTE),n=this._results[t].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)};ne.prototype._resetOverlay=function(e){if(this._overlayId&&this._overlays.remove(this._overlayId),e){var t=At(e),n=CC(t);this._overlayId=this._overlays.add(e,n)}};ne.prototype._getBoxHtml=function(){const e=_e(ne.BOX_HTML),t=we(ne.INPUT_SELECTOR,e);return t&&t.setAttribute("aria-label",this._translate("Search in diagram")),e};function CC(e){var t=6,n=e.width+t*2,i=e.height+t*2,r={width:n+"px",height:i+"px"},o=_e('<div class="'+ne.OVERLAY_CLASS+'"></div>');return es(o,r),{position:{bottom:i-t,right:n-t},show:!0,html:o}}function hh(e,t,n){var i=TC(t),r=_e(n);r.innerHTML=i,e.appendChild(r)}function TC(e){var t="";return e.forEach(function(n){n.matched?t+='<strong class="'+ne.RESULT_HIGHLIGHT_CLASS+'">'+Hc(n.matched)+"</strong>":t+=Hc(n.normal)}),t!==""?t:null}ne.CONTAINER_SELECTOR=".djs-search-container";ne.INPUT_SELECTOR=".djs-search-input input";ne.RESULTS_CONTAINER_SELECTOR=".djs-search-results";ne.RESULT_SELECTOR=".djs-search-result";ne.RESULT_SELECTED_CLASS="djs-search-result-selected";ne.RESULT_SELECTED_SELECTOR="."+ne.RESULT_SELECTED_CLASS;ne.RESULT_ID_ATTRIBUTE="data-result-id";ne.RESULT_HIGHLIGHT_CLASS="djs-search-highlight";ne.OVERLAY_CLASS="djs-search-overlay";ne.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>';ne.RESULT_HTML='<div class="djs-search-result"></div>';ne.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';ne.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const PC={__depends__:[zh,kh,Cn],searchPad:["type",ne]};function np(e,t,n){this._elementRegistry=e,this._canvas=n,t.registerProvider(this)}np.$inject=["elementRegistry","searchPad","canvas"];np.prototype.find=function(e){var t=this._canvas.getRootElement(),n=this._elementRegistry.filter(function(i){return!i.labelTarget});return n=pe(n,function(i){return i!==t}),n=yt(n,function(i){return{primaryTokens:vh(qn(i),e),secondaryTokens:vh(i.id,e),element:i}}),n=pe(n,function(i){return mh(i.primaryTokens)||mh(i.secondaryTokens)}),n=un(n,function(i){return qn(i.element)+i.element.id}),n};function mh(e){var t=pe(e,function(n){return!!n.matched});return t.length>0}function vh(e,t){var n=[],i=e;if(!e)return n;e=e.toLowerCase(),t=t.toLowerCase();var r=e.indexOf(t);return r>-1?(r!==0&&n.push({normal:i.substr(0,r)}),n.push({matched:i.substr(r,t.length)}),t.length+r<e.length&&n.push({normal:i.substr(t.length+r,e.length)})):n.push({normal:i}),n}const RC={__depends__:[PC],__init__:["bpmnSearch"],bpmnSearch:["type",np]};var AC='<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>';function ln(e){io.call(this,e)}q(ln,io);ln.Viewer=Jr;ln.NavigatedViewer=Ur;ln.prototype.createDiagram=function(){return this.importXML(AC)};ln.prototype._interactionModules=[em,Mh,Dh];ln.prototype._modelingModules=[jb,zl,lE,iE,AE,ql,NE,LS,Iv,bs,jS,zS,a1,c1,l1,h1,T1,Qv,D1,j1,X1,J1,pg,SC,RC];ln.prototype._modules=[].concat(Jr.prototype._modules,ln.prototype._interactionModules,ln.prototype._modelingModules);const IC={"bpmn:Process":"流程","bpmn:StartEvent":"开始事件","bpmn:IntermediateThrowEvent":"中间事件","bpmn:Task":"任务","bpmn:SendTask":"发送任务","bpmn:ReceiveTask":"接收任务","bpmn:UserTask":"用户任务","bpmn:ManualTask":"手工任务","bpmn:BusinessRuleTask":"业务规则任务","bpmn:ServiceTask":"服务任务","bpmn:ScriptTask":"脚本任务","bpmn:EndEvent":"结束事件","bpmn:SequenceFlow":"流程线","bpmn:ExclusiveGateway":"互斥网关","bpmn:ParallelGateway":"并行网关","bpmn:InclusiveGateway":"相容网关","bpmn:ComplexGateway":"复杂网关","bpmn:EventBasedGateway":"事件网关"},MC={"Activate hand tool":"启动手动工具","Activate lasso tool":"启动 Lasso 工具","Activate create/remove space tool":"启动创建/删除空间工具","Activate global connect tool":"启动全局连接工具","Ad-hoc":"Ad-hoc","Add lane above":"在上方添加泳道","Add lane below":"在下方添加泳道","Business rule task":"规则任务","Call activity":"引用流程","Compensation end event":"结束补偿事件","Compensation intermediate throw event":"中间补偿抛出事件","Complex gateway":"复杂网关","Conditional intermediate catch event":"中间条件捕获事件","Conditional start event (non-interrupting)":"条件启动事件 (非中断)","Conditional start event":"条件启动事件","Connect using association":"文本关联","Connect using sequence/message flow or association":"消息关联","Change element":"更改元素","Change type":"更改类型","Create data object reference":"创建数据对象引用","Create data store reference":"创建数据存储引用","Create expanded sub-process":"创建可折叠子流程","Create pool/participant":"创建池/参与者",Collection:"集合","Connect using data input association":"数据输入关联","Data store reference":"数据存储引用","Data object reference":"数据对象引用","Divide into two lanes":"分成两个泳道","Divide into three lanes":"分成三个泳道","End event":"结束事件","Error end event":"结束错误事件","Escalation end event":"结束升级事件","Escalation intermediate throw event":"中间升级抛出事件","Event sub-process":"事件子流程","Event-based gateway":"事件网关","Exclusive gateway":"互斥网关","Empty pool/participant (removes content)":"清空池/参与者 (删除内容)","Inclusive gateway":"相容网关","Intermediate throw event":"中间抛出事件",Loop:"循环","Link intermediate catch event":"中间链接捕获事件","Link intermediate throw event":"中间链接抛出事件","Manual task":"手动任务","Message end event":"结束消息事件","Message intermediate catch event":"中间消息捕获事件","Message intermediate throw event":"中间消息抛出事件","Message start event":"消息启动事件","Parallel gateway":"并行网关","Parallel multi-instance":"并行多实例","Participant multiplicity":"参与者多重性","Receive task":"接受任务",Remove:"移除","Script task":"脚本任务","Send task":"发送任务","Sequential multi-instance":"串行多实例","Service task":"服务任务","Signal end event":"结束信号事件","Signal intermediate catch event":"中间信号捕获事件","Signal intermediate throw event":"中间信号抛出事件","Signal start event (non-interrupting)":"信号启动事件 (非中断)","Signal start event":"信号启动事件","Start event":"开始事件","Sub-process (collapsed)":"可折叠子流程","Sub-process (expanded)":"可展开子流程","Sub rocess":"子流程",Task:"任务",Transaction:"事务","Terminate end event":"终止边界事件","Timer intermediate catch event":"中间定时捕获事件","Timer start event (non-interrupting)":"定时启动事件 (非中断)","Timer start event":"定时启动事件","User task":"用户任务","Create start event":"创建开始事件","Create gateway":"创建网关","Create intermediate/boundary event":"创建中间/边界事件","Create end event":"创建结束事件","Create group":"创建组","Create startEvent":"开始节点","Create endEvent":"结束节点","Create exclusiveGateway":"互斥网关","Create parallelGateway":"并行网关","Create task":"任务节点","Create userTask":"用户任务节点","Condition type":"条件类型","Append end event":"追加结束事件节点","Append gateway":"追加网关节点","Append task":"追加任务","Append user task":"追加用户任务节点","Append text annotation":"追加文本注释","Append intermediate/boundary event":"追加中间或边界事件","Append receive task":"追加接收任务节点","Append message intermediate catch event":"追加中间消息捕获事件","Append timer intermediate catch event":"追加中间定时捕获事件","Append conditional intermediate catch event":"追加中间条件捕获事件","Append signal intermediate catch event":"追加中间信号捕获事件","Open minimap":"打开小地图","Close minimap":"关闭小地图","Token Simulation ":"模拟"};function DC(e,t){return t=t||{},e=MC[e]||e,e.replace(/{([^}]+)}/g,function(n,i){return t[i]||"{"+i+"}"})}const kC={translate:["value",DC]},zn={modeler:void 0,moddle:void 0,modeling:void 0,canvas:void 0,elementRegistry:void 0,bpmnFactory:void 0,procDefId:void 0,procDefName:void 0},OC=w_("modeler",()=>{let e=zn.modeler,t=zn.moddle,n=zn.modeling,i=zn.canvas,r=zn.elementRegistry,o=zn.bpmnFactory;const a=Ee(zn.procDefId),s=Ee(zn.procDefName);return{getModeler:()=>e,getModdle:()=>t,getModeling:()=>n,getCanvas:()=>i,getElRegistry:()=>r,getBpmnFactory:()=>o,getProcDefId:()=>a.value,getProcDefName:()=>s.value,setModeler:w=>{w?(e=w,n=w.get("modeling"),t=w.get("moddle"),i=w.get("canvas"),o=w.get("bpmnFactory"),r=w.get("elementRegistry")):n=t=i=r=o=void 0},setProcDef:w=>{a.value=w==null?void 0:w.get("canvas").getRootElement().businessObject.get("id"),s.value=w==null?void 0:w.get("canvas").getRootElement().businessObject.get("name")}}}),Kn=OC;class Tg extends $s{constructor(n,i,r,o,a,s,c,l){super(n,i,r,o,a,s,c,l);qe(this,"_palette");qe(this,"_create");qe(this,"_elementFactory");qe(this,"_spaceTool");qe(this,"_lassoTool");qe(this,"_handTool");qe(this,"_globalConnect");qe(this,"_translate");this._palette=n,this._create=i,this._elementFactory=r,this._spaceTool=o,this._lassoTool=a,this._handTool=s,this._globalConnect=c,this._translate=l}getPaletteEntries(){const n={},i=this._create,r=this._elementFactory,o=this._translate;function a(c,l,p,u,f){function d(m){const v=r.createShape(Hp({type:c},f));i.start(m,v,null)}const h=c.replace(/^bpmn:/,"");return{group:l,className:p,title:u||o("Create {type}",{type:h}),action:{dragstart:d,click:d}}}function s(c){const l=Kn().getBpmnFactory(),p=l==null?void 0:l.create("bpmn:UserTask",{isForCompensation:!1});p.loopCharacteristics=l==null?void 0:l.create("bpmn:MultiInstanceLoopCharacteristics");const u=r.createShape({type:"bpmn:UserTask",businessObject:p});i.start(c,u,{})}return Hp(n,{"create.parallel-gateway":a("bpmn:ParallelGateway","gateway","bpmn-icon-gateway-parallel","并行网关"),"create.event-base-gateway":a("bpmn:EventBasedGateway","gateway","bpmn-icon-gateway-eventbased","事件网关"),"gateway-separator":{group:"gateway",separator:!0},"create.user-task":a("bpmn:UserTask","activity","bpmn-icon-user-task","创建用户任务"),"create.multi-instance-user-task":{group:"activity",type:"bpmn:UserTask",className:"bpmn-icon-user task-multi-instance",title:"创建多实例用户任务",action:{click:s,dragstart:s}},"task-separator":{group:"activity",separator:!0}}),n}}Tg.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];const NC=1500;class Pg extends x_{constructor(n,i,r){super(n,NC);qe(this,"bpmnRenderer");qe(this,"modeling");this.bpmnRenderer=i,this.modeling=r}canRender(n){return!n.labelTarget}drawShape(n,i){const r=this.bpmnRenderer.drawShape(n,i),{type:o}=i;return o==="bpmn:StartEvent"?(ie(r,{fill:"#77DF6D"}),r):o==="bpmn:EndEvent"?(ie(r,{fill:"#EE7B77"}),r):(o==="bpmn:UserTask"&&ie(r,{fill:"#A9C4F8"}),r)}getShapePath(n){return this.bpmnRenderer.getShapePath(n)}}Pg.$inject=["eventBus","bpmnRenderer"];class LC extends dr{constructor(n,i,r,o,a,s,c,l,p,u,f,d){super(n,i,r,o,a,s,c,l,p,u,f,d);qe(this,"_contextPad");qe(this,"_modeling");qe(this,"_elementFactory");qe(this,"_autoPlace");qe(this,"_connect");qe(this,"_create");qe(this,"_popupMenu");qe(this,"_canvas");qe(this,"_rules");this._contextPad=o,this._modeling=a,this._elementFactory=s,this._connect=c,this._create=l,this._popupMenu=p,this._canvas=u,this._rules=f,this._autoPlace=i.get("autoPlace",!1)}getContextPadEntries(n){const i={},r=(c,l)=>{const p=this._elementFactory.createShape({type:"bpmn:UserTask"});this._create.start(c,p,{source:l})},o=(c,l)=>{var h;const u=(h=Kn().getModeler())==null?void 0:h.get("bpmnFactory"),f=u.create("bpmn:UserTask",{isForCompensation:!1});f.loopCharacteristics=u.create("bpmn:MultiInstanceLoopCharacteristics");const d=this._elementFactory.createShape({type:"bpmn:UserTask",businessObject:f});this._create.start(c,d,{source:l})},a=this._autoPlace?(c,l)=>{var d;const p=(d=Kn().getModeler())==null?void 0:d.get("bpmnFactory"),u=p==null?void 0:p.create("bpmn:UserTask",{isForCompensation:!1});u.loopCharacteristics=p==null?void 0:p.create("bpmn:MultiInstanceLoopCharacteristics");const f=this._elementFactory.createShape({type:"bpmn:UserTask",businessObject:u});this._autoPlace.append(l,f)}:o,s=this._autoPlace?(c,l)=>{const p=this._elementFactory.createShape({type:"bpmn:UserTask"});this._autoPlace.append(l,p)}:r;return i["append.append-user-task"]={group:"model",className:"bpmn-icon-user-task",title:"用户任务",action:{dragstart:r,click:s}},i["append.append-multi-instance-user-task"]={group:"model",className:"bpmn-icon-user",title:"多实例用户任务",action:{dragstart:o,click:a}},i}}const ip=1,Rg=2,Ag=4,Ig=8,BC=16,$C=32,FC=64,jC=128,HC=256,GC=512,zC=ip|Rg|Ag,VC=ip|Ig,he=Object.freeze({ACTIVATED:ip,RUNNING:Rg,ENDING:Ag,ENDED:Ig,DESTROYED:BC,FAILED:$C,TERMINATED:FC,CANCELED:jC,COMPLETED:HC,COMPENSABLE:GC,ACTIVE:zC,NOT_DEAD:VC}),gr={};function yi(e,t){throw new Error(`illegal transition: ${e.name} -> ${t}`)}function _i(e,t){return e===gr?t:e}class kt{constructor(t,n,{start:i,cancel:r,complete:o,destroy:a,fail:s,terminate:c,compensable:l}={}){this.name=t,this.traits=n,this._start=_i(i,this),this._compensable=_i(l,this),this._cancel=_i(r,this),this._complete=_i(o,this),this._destroy=_i(a,this),this._fail=_i(s,this),this._terminate=_i(c,this)}hasTrait(t){return(this.traits&t)!==0}complete(){return this._complete||yi(this,"complete")}destroy(){return this._destroy||yi(this,"destroy")}cancel(){return this._cancel||yi(this,"cancel")}fail(){return this._fail||yi(this,"fail")}terminate(){return this._terminate||yi(this,"terminate")}compensable(){return this._compensable||yi(this,"compensable")}start(){return this._start||yi(this,"start")}}const js=new kt("failed",he.DESTROYED|he.FAILED),Hs=new kt("terminated",he.DESTROYED|he.TERMINATED),rp=new kt("completed",he.DESTROYED|he.COMPLETED),li=new kt("terminating",he.ENDING|he.TERMINATED,{destroy:Hs}),yr=new kt("canceling",he.ENDING|he.FAILED|he.CANCELED,{destroy:js,complete:gr,terminate:li}),op=new kt("completing",he.ENDING|he.COMPLETED,{destroy:rp,cancel:yr,terminate:li}),ap=new kt("failing",he.ENDING|he.FAILED,{cancel:yr,complete:op,destroy:js,terminate:li}),UC=new kt("compensable:failing",he.ENDING|he.FAILED,{complete:gr,terminate:li,destroy:js}),Mg=new kt("compensable:completed",he.ENDED|he.COMPLETED,{cancel:yr,fail:UC,destroy:rp,compensable:gr}),WC=new kt("compensable:completing",he.ENDING|he.COMPLETED,{destroy:Mg,terminate:li,compensable:gr}),YC=new kt("compensable:running",he.RUNNING|he.COMPENSABLE,{cancel:yr,complete:WC,compensable:gr,destroy:Mg,fail:ap,terminate:li}),Dg=new kt("running",he.RUNNING,{cancel:yr,complete:op,compensable:YC,destroy:Hs,fail:ap,terminate:li}),qC=new kt("activated",he.ACTIVATED,{start:Dg,destroy:Hs}),KC=Object.freeze({ACTIVATED:qC,RUNNING:Dg,CANCELING:yr,COMPLETING:op,COMPLETED:rp,FAILING:ap,FAILED:js,TERMINATING:li,TERMINATED:Hs});class XC{constructor(t,n,i=null,r=null){this.id=t,this.element=n,this.parent=i,this.initiator=r,this.subscriptions=new Set,this.children=[],this.state=KC.ACTIVATED}get running(){return this.hasTrait(he.RUNNING)}get destroyed(){return this.hasTrait(he.DESTROYED)}get completed(){return this.hasTrait(he.COMPLETED)}get canceled(){return this.hasTrait(he.CANCELED)}get failed(){return this.hasTrait(he.FAILED)}hasTrait(t){return this.state.hasTrait(t)}start(){return this.state=this.state.start(),this}compensable(){return this.state=this.state.compensable(),this}fail(t){return this.failed||(this.state=this.state.fail(),this.failInitiator=t),this}cancel(t){return this.canceled||(this.state=this.state.cancel(),this.cancelInitiator=t),this}terminate(t){return this.state=this.state.terminate(),this.terminateInitiator=t,this}complete(){return this.state=this.state.complete(),this}destroy(t){return this.state=this.state.destroy(),this.destroyInitiator=t,this}getTokens(){return this.children.filter(t=>!t.destroyed).length}getTokensByElement(t){return this.children.filter(n=>!n.destroyed&&n.element===t).length}}function Lr(e,t){const n=[];for(const i of e)t(i)&&n.push(i);return n}function gh(e,t){for(const n of e)if(t(n))return n;return null}function hl(e,t){return["type","name","ref","iref"].every(n=>!(n in e)||e[n]===t[n])}function Gs(e){return e.filter(t=>g(t,"bpmn:SequenceFlow"))}function ml(e){return g(e,"bpmn:MessageFlow")}function ui(e){return g(e,"bpmn:SequenceFlow")}function kg(e){return sp(e)&&lp(e,"bpmn:LinkEventDefinition")}function Wa(e){return sp(e)&&lp(e,"bpmn:CompensateEventDefinition")}function Og(e){return g(e,"bpmn:Activity")&&e.businessObject.isForCompensation}function sp(e){return(g(e,"bpmn:CatchEvent")||g(e,"bpmn:ReceiveTask"))&&!zs(e)}function Oa(e){return g(e,"bpmn:BoundaryEvent")&&!zs(e)}function Ng(e){return Pi(e)&&!lp(e)}function cp(e){return!(zs(e)||!To(e,["bpmn:Activity","bpmn:IntermediateCatchEvent","bpmn:IntermediateThrowEvent","bpmn:Gateway","bpmn:EndEvent"])||kg(e)||e.incoming.find(ui)||Og(e)||Xn(e))}function Pi(e){return g(e,"bpmn:StartEvent")&&!zs(e)}function zs(e){return!!e.labelTarget}function Xn(e){return z(e).triggeredByEvent}function Lg(e){return g(e,"bpmn:StartEvent")&&z(e).isInterrupting||g(e,"bpmn:BoundaryEvent")&&z(e).cancelActivity}function To(e,t){return t.some(n=>g(e,n))}function lp(e,t){return Mi(z(e).eventDefinitions,n=>t?g(n,t):!0)}function Bg(e,t,n){const i=e.get("scopeIds",!1)||new Ih([32,36]),r={},o={},a=new ZC,s=new Set,c=[],l=new Set,p=new Set;fe("tick",function(){for(const R of s)ae("elementChanged",{element:R});s.clear()});function u(R,G){if(c.push([G,R]),c.length!==1)return;let V;for(;V=c[0];){const[ce,J]=V;J.destroyed||ce(),c.shift()}ae("tick")}function f(R){return o[R.type]||a}function d(R){const{element:G,parentScope:V,initiator:ce=null,scope:J=vn({element:G,parent:V,initiator:ce})}=R;return u(J,function(){J.running||J.start(),We("signal",Re(re({},R),{scope:J})),f(G).signal(Re(re({},R),{scope:J})),J.parent&&U(J.parent)}),J}function h(R){const{element:G,scope:V,initiator:ce=V}=R,J=vn({element:G,parent:V,initiator:ce});return u(J,function(){J.running||J.start(),We("enter",R),f(G).enter(Re(re({},R),{initiator:ce,scope:J})),J.parent&&U(J.parent)}),J}function m(R){const{element:G,scope:V,initiator:ce=V}=R;u(V,function(){We("exit",R),f(G).exit(Re(re({},R),{initiator:ce})),V.running&&V.complete(),Ie(V,ce),V.parent&&U(V.parent)})}function v(R){const{event:G,initiator:V,scope:ce}=R,J=P(G),ee=ce.subscriptions,Pe=Lr(ee,Ye=>hl(J,Ye.event)),Be=Pe.filter(Ye=>!Ye.event.interrupting),ft=Pe.filter(Ye=>Ye.event.interrupting);if(!ft.length)return Be.map(Ye=>Ye.triggerFn(V)).flat();const en=ft.find(Ye=>!Ye.event.boundary)||ft[0],Fo=Lr(ee,Ye=>Ye.event.persistent||JC(Ye.event,en.event));return ee.forEach(Ye=>{Fo.includes(Ye)||Ye.remove()}),[en.triggerFn(V)].flat().filter(Ye=>Ye)}function E(R,G,V){G=P(G);const ce=G.element,J={scope:R,event:G,element:ce,triggerFn:V,remove(){w(J)}};return p.add(J),R.subscriptions.add(J),ce&&Me(ce),J}function w(R){const{scope:G,event:V}=R;p.delete(R),G.subscriptions.delete(R),V.element&&Me(V.element)}function _(R){return g(R,"bpmn:StartEvent")||g(R,"bpmn:IntermediateCatchEvent")||g(R,"bpmn:ReceiveTask")||eT(R)?z(R).name||R.id:null}function x(R){return{element:R,interrupting:!1,boundary:!1,iref:R.id,type:"none"}}function P(R){if(!R.businessObject)return R;const G=Lg(R),V=Oa(R),ce=_(R),J=re({element:R,interrupting:G,boundary:V},ce?{iref:ce}:{}),ee=$g(R)[0];if(!ee)return Re(re({},J),{type:QC(R)?"message":"none"});if(g(ee,"bpmn:LinkEventDefinition"))return Re(re({},J),{type:"link",name:ee.name});if(g(ee,"bpmn:SignalEventDefinition"))return Re(re({},J),{type:"signal",ref:ee.signalRef});if(g(ee,"bpmn:TimerEventDefinition"))return Re(re({},J),{type:"timer"});if(g(ee,"bpmn:ConditionalEventDefinition"))return Re(re({},J),{type:"condition"});if(g(ee,"bpmn:EscalationEventDefinition"))return Re(re({},J),{type:"escalation",ref:ee.escalationRef});if(g(ee,"bpmn:CancelEventDefinition"))return Re(re({},J),{type:"cancel"});if(g(ee,"bpmn:ErrorEventDefinition"))return Re(re({},J),{type:"error",ref:ee.errorRef});if(g(ee,"bpmn:MessageEventDefinition"))return Re(re({},J),{type:"message",ref:ee.messageRef});if(g(ee,"bpmn:CompensateEventDefinition")){let Pe=ee.activityRef&&n.get(ee.activityRef.id);return Pe||(Pi(R)&&Xn(R.parent)?Pe=R.parent.parent:Oa(R)?Pe=R.host:Pe=R.parent),Re(re({},J),{type:"compensate",ref:Pe,persistent:!0})}throw new Error("unknown event definition",ee)}function A(R,G=!0){const{element:V,parent:ce,initiator:J}=R;G&&We("createScope",{element:V,scope:ce});const ee=new XC(i.next(),V,ce,J);return ce&&ce.children.push(ee),l.add(ee),G&&ae("createScope",{scope:ee}),Me(V),ce&&Me(ce.element),ee}function C(R){if(typeof R=="function")return R;const{event:G,element:V,scope:ce}=R,J=R.elements||V&&[V],ee=G&&P(G);return Pe=>(!ee||hl(ee,Pe.event))&&(!J||J.includes(Pe.element))&&(!ce||ce===Pe.scope)}function I(R){const G=R==="function"?R:C(R);return V=>Array.from(V.subscriptions).some(G)}function T(R){if(typeof R=="function")return R;const{element:G,waitsOnElement:V,parent:ce,trait:J=he.RUNNING,subscribedTo:ee}=R,Pe=ee?I(ee):()=>!0;return Be=>(!G||Be.element===G)&&(!ce||Be.parent===ce)&&(!V||Be.getTokensByElement(V)>0)&&Be.hasTrait(J)&&Pe(Be)}function k(R){return Lr(p,C(R))}function B(R){return gh(p,C(R))}function X(R){return Lr(l,T(R))}function Q(R){return gh(l,T(R))}function Ie(R,G=null){if(!R.destroyed){R.destroy(G);for(const V of R.subscriptions){const ce=V.event.traits||he.ACTIVE;R.hasTrait(ce)||w(V)}if(R.destroyed){for(const V of R.children)V.destroyed||Ie(V,G);We("destroyScope",{element:R.element,scope:R}),l.delete(R),ae("destroyScope",{scope:R})}Me(R.element),R.parent&&Me(R.parent.element)}}function We(R,G){ae("trace",Re(re({},G),{action:R}))}function Me(R){s.add(R),c.length||ae("tick")}function U(R){ae("scopeChanged",{scope:R})}function ae(R,G={}){return t.fire(`tokenSimulation.simulator.${R}`,G)}function fe(R,G){t.on("tokenSimulation.simulator."+R,G)}function tt(R,G){t.off("tokenSimulation.simulator."+R,G)}function xt(R,G){const V=Ln(R);r[R.id||R]=re(re({},V),G),Me(R)}function wt(){const R=[];return n.forEach(G=>{if(!To(G,["bpmn:Process","bpmn:Participant"]))return;const V=A({element:G},!1);R.push(V);const ce=G.children.filter(Pi),J=G.children.filter(cp);for(const ee of ce){const Pe=Re(re({},P(ee)),{interrupting:!1});E(V,Pe,Be=>d({element:G,startEvent:ee,initiator:Be}))}if(!ce.length)for(const ee of J){const Pe=x(ee);E(V,Pe,Be=>d({element:G,initiator:Be}))}}),R}function vn(R){const{element:G}=R,V=A(R),{children:ce=[],attachers:J=[]}=G;for(const ee of ce)if(Xn(ee)){const Pe=ee.children.filter(Be=>Pi(Be)&&!Wa(Be));for(const Be of Pe)E(V,Be,ft=>d({element:ee,parentScope:V,startEvent:Be,initiator:ft}))}for(const ee of J)Oa(ee)&&!Wa(ee)&&E(V,ee,Pe=>d({element:ee,parentScope:V.parent,hostScope:V,initiator:Pe}));return V}function Ln(R){return r[R.id||R]||{}}function oe(R,G){if(!G.length)return;const V={type:"all-completed",persistent:!1},ce=new Set(G),J=ee=>{ce.delete(ee.scope),ce.size===0&&(tt("destroyScope",J),v({scope:R,event:V}))};return fe("destroyScope",J),V}function j(R,G=!0){xt(R,{wait:G})}function Y(){for(const R of l)Ie(R);for(const R of wt())l.add(R);ae("tick"),ae("reset")}this.createScope=A,this.destroyScope=Ie,this.findScope=Q,this.findScopes=X,this.findSubscription=B,this.findSubscriptions=k,this.waitAtElement=j,this.waitForScopes=oe,this.setConfig=xt,this.getConfig=Ln,this.signal=d,this.enter=h,this.exit=m,this.subscribe=E,this.trigger=v,this.reset=Y,this.on=fe,this.off=tt,this.registerBehavior=function(R,G){o[R]=G}}Bg.$inject=["injector","eventBus","elementRegistry"];function ZC(){this.signal=function(e){console.log("ignored #exit",e.element)},this.exit=function(e){console.log("ignored #exit",e.element)},this.enter=function(e){console.log("ignored #enter",e.element)}}function JC(e,t){return e.type===t.type&&e.boundary&&!t.boundary}function QC(e){return g(e,"bpmn:ReceiveTask")||e.incoming.some(t=>g(t,"bpmn:MessageFlow"))}function eT(e){if(!Oa(e))return!1;const t=$g(e);return!t[0]||To(t[0],["bpmn:ConditionalEventDefinition","bpmn:TimerEventDefinition"])}function $g(e){return e.businessObject.get("eventDefinitions")||[]}function Vs(e,t){this._simulator=e,this._activityBehavior=t,e.registerBehavior("bpmn:StartEvent",this)}Vs.prototype.signal=function(e){this._simulator.exit(e)};Vs.prototype.exit=function(e){this._activityBehavior.exit(e)};Vs.$inject=["simulator","activityBehavior"];function Po(e,t,n){this._intermediateThrowEventBehavior=n,this._scopeBehavior=t,e.registerBehavior("bpmn:EndEvent",this)}Po.$inject=["simulator","scopeBehavior","intermediateThrowEventBehavior"];Po.prototype.enter=function(e){this._intermediateThrowEventBehavior.enter(e)};Po.prototype.signal=function(e){this._intermediateThrowEventBehavior.signal(e)};Po.prototype.exit=function(e){const{scope:t}=e;this._scopeBehavior.tryExit(t.parent,t)};function Us(e,t,n){this._simulator=e,this._activityBehavior=t,this._scopeBehavior=n,e.registerBehavior("bpmn:BoundaryEvent",this)}Us.prototype.signal=function(e){const{element:t,scope:n,hostScope:i=this._simulator.findScope({parent:n.parent,element:t.host})}=e;if(!i)throw new Error("host scope not found");if(z(t).cancelActivity){this._scopeBehavior.interrupt(i,n);const o=this._scopeBehavior.tryExit(i,n);if(o){const a=this._simulator.subscribe(i,o,s=>(a.remove(),this._simulator.exit(e)));return}}this._simulator.exit(e)};Us.prototype.exit=function(e){this._activityBehavior.exit(e)};Us.$inject=["simulator","activityBehavior","scopeBehavior"];function Ro(e,t){this._activityBehavior=t,this._simulator=e,e.registerBehavior("bpmn:IntermediateCatchEvent",this),e.registerBehavior("bpmn:ReceiveTask",this)}Ro.$inject=["simulator","activityBehavior"];Ro.prototype.signal=function(e){return this._simulator.exit(e)};Ro.prototype.enter=function(e){const{element:t}=e;return this._activityBehavior.signalOnEvent(e,t)};Ro.prototype.exit=function(e){this._activityBehavior.exit(e)};function Ao(e,t,n){this._simulator=e,this._activityBehavior=t,this._eventBehaviors=n,e.registerBehavior("bpmn:IntermediateThrowEvent",this),e.registerBehavior("bpmn:SendTask",this)}Ao.prototype.enter=function(e){const{element:t}=e,n=this._eventBehaviors.get(t);if(n){const i=n(e);if(i)return this._activityBehavior.signalOnEvent(e,i)}this._activityBehavior.enter(e)};Ao.prototype.signal=function(e){this._activityBehavior.signal(e)};Ao.prototype.exit=function(e){this._activityBehavior.exit(e)};Ao.$inject=["simulator","activityBehavior","eventBehaviors"];function Ws(e,t){this._scopeBehavior=t,this._simulator=e,e.registerBehavior("bpmn:ExclusiveGateway",this)}Ws.prototype.enter=function(e){this._simulator.exit(e)};Ws.prototype.exit=function(e){const{element:t,scope:n}=e,i=Gs(t.outgoing);if(i.length===1)return this._simulator.enter({element:i[0],scope:n.parent});const{activeOutgoing:r}=this._simulator.getConfig(t),o=i.find(a=>a===r);return o?this._simulator.enter({element:o,scope:n.parent}):this._scopeBehavior.tryExit(n.parent,n)};Ws.$inject=["simulator","scopeBehavior"];function Ys(e,t){this._simulator=e,this._activityBehavior=t,e.registerBehavior("bpmn:ParallelGateway",this)}Ys.prototype.enter=function(e){const{scope:t,element:n}=e,i=Gs(n.incoming),{parent:r}=t,o=this._simulator.findScopes({parent:r,element:n});if(o.length===i.length){for(const a of o)a!==t&&this._simulator.destroyScope(a.complete(),t);this._simulator.exit(e)}};Ys.prototype.exit=function(e){this._activityBehavior.exit(e)};Ys.$inject=["simulator","activityBehavior"];function up(e){this._simulator=e,e.registerBehavior("bpmn:EventBasedGateway",this)}up.$inject=["simulator"];up.prototype.enter=function(e){const{element:t,scope:n}=e,i=n.parent,o=tT(t).map(a=>this._simulator.subscribe(i,a,s=>(o.forEach(c=>c.remove()),this._simulator.destroyScope(n,s),this._simulator.signal({element:a,parentScope:i,initiator:s}))))};function tT(e){return e.outgoing.map(t=>t.target).filter(t=>To(t,["bpmn:IntermediateCatchEvent","bpmn:ReceiveTask"]))}function Mn(e,t){this._simulator=e,this._activityBehavior=t,e.registerBehavior("bpmn:InclusiveGateway",this)}Mn.prototype.enter=function(e){this._tryJoin(e)};Mn.prototype.exit=function(e){const{element:t,scope:n}=e;if(Gs(t.outgoing).length>1){const{activeOutgoing:r=[]}=this._simulator.getConfig(t);if(!r.length)throw new Error("no outgoing configured");for(const o of r)this._simulator.enter({element:o,scope:n.parent})}else this._activityBehavior.exit(e)};Mn.prototype._tryJoin=function(e){const t=this._getRemainingScopes(e),n=t.map(s=>s.element);if(!this._canReachAnyElement(n,e.element))return this._join(e);const i=this._getElementScopes(e),{scope:r}=e;if(i[0]!==r)return;const o=this._simulator.waitForScopes(r,t),a=this._simulator.subscribe(r,o,()=>{a.remove(),this._tryJoin(e)})};Mn.prototype._getRemainingScopes=function(e){const{scope:t,element:n}=e,{parent:i}=t;return this._simulator.findScopes(r=>r.parent===i&&r.element!==n)};Mn.prototype._join=function(e){const t=this._getElementScopes(e);for(const n of t)n!==e.scope&&this._simulator.destroyScope(n.complete(),e.scope);this._simulator.exit(e)};Mn.prototype._getElementScopes=function(e){const{element:t,scope:n}=e;return this._simulator.findScopes({parent:n.parent,element:t})};Mn.prototype._canReachAnyElement=function(e,t,n=new Set){if(!e.length||n.has(t))return!1;if(n.add(t),e.some(r=>r===t))return!0;if(ui(t))return this._canReachAnyElement(e,t.source,n);const i=Gs(t.incoming);for(const r of i)if(this._canReachAnyElement(e,r,n))return!0;return!1};Mn.$inject=["simulator","activityBehavior"];function Dn(e,t,n){this._simulator=e,this._scopeBehavior=t,this._transactionBehavior=n;const i=["bpmn:BusinessRuleTask","bpmn:CallActivity","bpmn:ManualTask","bpmn:ScriptTask","bpmn:ServiceTask","bpmn:Task","bpmn:UserTask"];for(const r of i)e.registerBehavior(r,this)}Dn.$inject=["simulator","scopeBehavior","transactionBehavior"];Dn.prototype.signal=function(e){const t=this._triggerMessages(e);if(t)return this.signalOnEvent(e,t);this._simulator.exit(e)};Dn.prototype.enter=function(e){const{element:t}=e,n=this.waitAtElement(t);if(n)return this.signalOnEvent(e,n);const i=this._triggerMessages(e);if(i)return this.signalOnEvent(e,i);this._simulator.exit(e)};Dn.prototype.exit=function(e){const{element:t,scope:n}=e,i=n.parent,r=!n.failed;r&&!Xn(t)&&this._transactionBehavior.registerCompensation(n);const o=r?t.outgoing.filter(ui):[];o.forEach(a=>this._simulator.enter({element:a,scope:i})),o.length===0&&this._scopeBehavior.tryExit(i,n)};Dn.prototype.signalOnEvent=function(e,t){const{scope:n,element:i}=e,r=this._simulator.subscribe(n,t,o=>(r.remove(),this._simulator.signal({scope:n,element:i,initiator:o})))};Dn.prototype.waitAtElement=function(e){return this._simulator.getConfig(e).wait&&{element:e,type:"continue",interrupting:!1,boundary:!1}};Dn.prototype._getMessageContexts=function(e,t=null){const n=t?r=>r.referencePoint.x>t.x:()=>!0,i=(r,o)=>r.referencePoint.x-o.referencePoint.x;return[...e.incoming.filter(ml).map(r=>({incoming:r,referencePoint:iT(r.waypoints)})),...e.outgoing.filter(ml).map(r=>({outgoing:r,referencePoint:nT(r.waypoints)}))].sort(i).filter(n)};Dn.prototype._triggerMessages=function(e){const{element:t,initiator:n,scope:i}=e;let r=i.messageContexts;r||(r=i.messageContexts=this._getMessageContexts(t));const o=n&&n.element;if(ml(o)&&i.expectedIncoming!==o){console.debug("Simulator :: ActivityBehavior :: ignoring out-of-bounds message");return}for(;r.length;){const{incoming:a,outgoing:s}=r.shift();if(a){if(!n)continue;return i.expectedIncoming=a,{element:t,type:"message",name:a.id,interrupting:!1,boundary:!1}}this._simulator.signal({element:s})}};function nT(e){return e&&e[0]}function iT(e){return e&&e[e.length-1]}function Li(e,t,n,i,r){this._simulator=e,this._activityBehavior=t,this._scopeBehavior=n,this._transactionBehavior=i,this._elementRegistry=r,e.registerBehavior("bpmn:SubProcess",this),e.registerBehavior("bpmn:Transaction",this),e.registerBehavior("bpmn:AdHocSubProcess",this)}Li.$inject=["simulator","activityBehavior","scopeBehavior","transactionBehavior","elementRegistry"];Li.prototype.signal=function(e){this._start(e)};Li.prototype.enter=function(e){const{element:t}=e,n=this._activityBehavior.waitAtElement(t);if(n)return this._activityBehavior.signalOnEvent(e,n);this._start(e)};Li.prototype.exit=function(e){const{scope:t}=e,n=t.parent;n.failInitiator===t&&n.complete(),this._activityBehavior.exit(e)};Li.prototype._start=function(e){const{element:t,startEvent:n,scope:i}=e,r=i.parent;if(Xn(t)){if(!n)throw new Error("missing <startEvent>: required for event sub-process")}else if(n)throw new Error("unexpected <startEvent>: not allowed for sub-process");if(r.destroyed)throw new Error(`target scope <${r.id}> destroyed`);rT(t)&&this._transactionBehavior.setup(e),n&&Lg(n)&&this._scopeBehavior.interrupt(r,i);const o=this._findStarts(t,n);for(const a of o)Pi(a)?this._simulator.signal({element:a,parentScope:i,initiator:i}):this._simulator.enter({element:a,scope:i,initiator:i})};Li.prototype._findStarts=function(e,t){e=this._elementRegistry.get(e.id+"_plane")||e;const n=t?i=>t===i:i=>Ng(i);return e.children.filter(i=>n(i)||cp(i))};function rT(e){return g(e,"bpmn:Transaction")}const vl={type:"cancel",interrupting:!0,boundary:!1,persistent:!0};function pi(e,t){this._simulator=e,this._scopeBehavior=t}pi.$inject=["simulator","scopeBehavior"];pi.prototype.setup=function(e){const{scope:t}=e,n=this._simulator.subscribe(t,vl,o=>(n.remove(),this.cancel({scope:t,initiator:o}))),i={type:"compensate",ref:t.element,persistent:!0,traits:he.NOT_DEAD},r=this._simulator.subscribe(t,i,o=>t.canceled?(r.remove(),this.compensate({scope:t,element:t.element,initiator:o})):this._simulator.trigger({event:vl,scope:t}))};pi.prototype.cancel=function(e){const{scope:t,initiator:n}=e;if(!t.destroyed)return t.cancel(n),this._simulator.trigger({event:{type:"compensate",ref:t.element},initiator:n,scope:t}),this._simulator.trigger({scope:t,initiator:n,event:vl})};pi.prototype.registerCompensation=function(e){const{element:t}=e,n=t.children.filter(Xn).map(o=>o.children.find(a=>Pi(a)&&Wa(a))).filter(o=>o),i=t.attachers.filter(Wa);if(!n.length&&!i.length)return;const r=this.findTransactionScope(e.parent);g(r.element,"bpmn:Transaction")||this.makeCompensable(r);for(const o of n){const a={element:o,type:"compensate",persistent:!0,interrupting:!0,ref:t,traits:he.NOT_DEAD},s=o.parent,c=this._simulator.subscribe(e,a,l=>(c.remove(),this._simulator.signal({initiator:l,element:s,startEvent:o,parentScope:e})))}for(const o of i){const a={element:o,type:"compensate",persistent:!0,ref:t,traits:he.NOT_DEAD},s=o.outgoing.map(l=>l.target).find(Og);if(!s)continue;const c=this._simulator.subscribe(r,a,l=>(c.remove(),this._simulator.enter({initiator:l,element:s,scope:r})))}};pi.prototype.makeCompensable=function(e){if(e.hasTrait(he.COMPENSABLE)||!e.parent)return;const t={type:"compensate",ref:e.element,interrupting:!0,persistent:!0,traits:he.NOT_DEAD};e.compensable();const n=this._simulator.subscribe(e,t,o=>(n.remove(),e.fail(o),this.compensate({scope:e,element:e.element,initiator:o}),this._scopeBehavior.tryExit(e,o),e)),i=e.parent;if(!i)return;const r=this._simulator.subscribe(i,t,o=>(r.remove(),this._simulator.trigger({scope:e,event:t,initiator:o})));this.makeCompensable(i)};pi.prototype.findTransactionScope=function(e){let t=e;for(;t;){const n=t.element;if(g(n,"bpmn:SubProcess")&&!Xn(n)||To(n,["bpmn:Transaction","bpmn:Process","bpmn:Participant"]))return t;t=t.parent}throw oT(e)};pi.prototype.compensate=function(e){const{scope:t,element:n}=e,i=Lr(t.subscriptions,a=>hl({type:"compensate"},a.event)),r=i.filter(a=>a.event.ref===n),o=i.filter(a=>a.event.ref!==n);for(const a of r)this._scopeBehavior.preExit(t,s=>this._simulator.trigger(a));for(const a of o.reverse())this._scopeBehavior.preExit(t,s=>this._simulator.trigger(a))};function oT(e){throw new Error(`no transaction context for <${e.id}>`)}function Bi(e,t){this._simulator=e,this._scopeBehavior=t,e.registerBehavior("bpmn:SequenceFlow",this)}Bi.prototype.enter=function(e){this._simulator.exit(e)};Bi.prototype.exit=function(e){const{element:t,scope:n}=e;this._simulator.enter({element:t.target,scope:n.parent})};Bi.$inject=["simulator","scopeBehavior"];function $i(e){this._simulator=e,e.registerBehavior("bpmn:MessageFlow",this)}$i.$inject=["simulator"];$i.prototype.signal=function(e){this._simulator.exit(e)};$i.prototype.exit=function(e){const{element:t,scope:n}=e,i=t.target,r=sp(i)?i:{type:"message",element:t,name:t.id},o=this._simulator.findSubscription({event:r,elements:[i,i.parent]});o&&this._simulator.trigger({event:r,initiator:n,scope:o.scope})};function De(e,t){return e.type==="label"?!1:(Array.isArray(t)||(t=[t]),t.some(function(n){return g(e,n)}))}function aT(e,t){return ke(z(e).eventDefinitions,n=>De(n,t))}function Fg(e,t){return Mi(z(e).eventDefinitions,n=>De(n,t))}function pp(e,t,n){this._simulator=e,this._elementRegistry=t,this._scopeBehavior=n}pp.$inject=["simulator","elementRegistry","scopeBehavior"];pp.prototype.get=function(e){const n=Object.entries({"bpmn:LinkEventDefinition":i=>{const{element:r,scope:o}=i,a=yh(r),s=o.parent,l=s.element.children.filter(p=>kg(p)&&yh(p).name===a.name);for(const p of l)this._simulator.signal({element:p,parentScope:s,initiator:o})},"bpmn:SignalEventDefinition":i=>{const{element:r,scope:o}=i,a=this._simulator.findSubscriptions({event:r}),s=new Set;for(const c of a){const l=c.scope;s.has(l)||(s.add(l),this._simulator.trigger({event:r,scope:l,initiator:o}))}},"bpmn:EscalationEventDefinition":i=>{const{element:r,scope:o}=i,a=this._simulator.findScopes({subscribedTo:{event:r},trait:he.ACTIVE});let s=o;for(;s=s.parent;)if(a.includes(s)){this._simulator.trigger({event:r,scope:s,initiator:o});break}},"bpmn:ErrorEventDefinition":i=>{const{element:r,scope:o}=i;this._simulator.trigger({event:r,initiator:o,scope:Dc(o)})},"bpmn:TerminateEventDefinition":i=>{const{scope:r}=i;this._scopeBehavior.terminate(r.parent,r)},"bpmn:CancelEventDefinition":i=>{const{scope:r,element:o}=i;this._simulator.trigger({event:o,initiator:r,scope:Dc(r)})},"bpmn:CompensateEventDefinition":i=>{const{scope:r,element:o}=i;return this._simulator.waitForScopes(r,this._simulator.trigger({event:o,scope:Dc(r)}))}}).find(i=>Fg(e,i[0]));return n&&n[1]};function yh(e){return aT(e,"bpmn:LinkEventDefinition")}function Dc(e){for(;Xn(e.parent.element);)e=e.parent;return e.parent}const jg={type:"pre-exit",persistent:!0,interrupting:!0,boundary:!1},kc={type:"exit",interrupting:!0,boundary:!1,persistent:!0};function kn(e){this._simulator=e}kn.$inject=["simulator"];kn.prototype.isFinished=function(e,t=null){return t=Hg(t),e.children.every(n=>n.destroyed||n.completed||t(n))};kn.prototype.destroyChildren=function(e,t,n=null){n=Hg(n),e.children.filter(i=>!i.destroyed&&!n(i)).map(i=>{this._simulator.destroyScope(i,t)})};kn.prototype.terminate=function(e,t){this.destroyChildren(e,t),e.terminate(t),this.tryExit(e,t)};kn.prototype.interrupt=function(e,t){this.destroyChildren(e,t,t),e.fail(t)};kn.prototype.tryExit=function(e,t){if(!e)throw new Error("missing <scope>");if(t||(t=e),!this.isFinished(e,t))return kc;const n=this._simulator.findSubscriptions({event:jg,scope:e});for(const i of n){const{event:r,scope:o}=i;if(this._simulator.trigger({event:r,scope:o,initiator:t}).length)return kc}this._simulator.trigger({event:kc,scope:e,initiator:t}),this.exit({scope:e,initiator:t})};kn.prototype.exit=function(e){const{scope:t,initiator:n}=e;if(!n)throw new Error("missing <initiator>");this._simulator.exit({element:t.element,scope:t,initiator:n})};kn.prototype.preExit=function(e,t){const n=this._simulator.subscribe(e,jg,i=>(n.remove(),t(i)));return n};function Hg(e){return typeof e=="function"?e:t=>t===e}function Io(e,t){this._simulator=e,this._scopeBehavior=t,e.registerBehavior("bpmn:Process",this),e.registerBehavior("bpmn:Participant",this)}Io.prototype.signal=function(e){const{element:t,startEvent:n,startNodes:i=this._findStarts(t,n),scope:r}=e;if(!i.length)throw new Error("missing <startNodes> or <startEvent>");for(const o of i)Pi(o)?this._simulator.signal({element:o,parentScope:r}):this._simulator.enter({element:o,scope:r})};Io.prototype.exit=function(e){const{scope:t,initiator:n}=e;this._scopeBehavior.destroyChildren(t,n)};Io.prototype._findStarts=function(e,t){const n=t?i=>t===i:i=>Ng(i);return e.children.filter(i=>n(i)||cp(i))};Io.$inject=["simulator","scopeBehavior"];const sT={__init__:["startEventBehavior","endEventBehavior","boundaryEventBehavior","intermediateCatchEventBehavior","intermediateThrowEventBehavior","exclusiveGatewayBehavior","parallelGatewayBehavior","eventBasedGatewayBehavior","inclusiveGatewayBehavior","subProcessBehavior","sequenceFlowBehavior","messageFlowBehavior","processBehavior"],startEventBehavior:["type",Vs],endEventBehavior:["type",Po],boundaryEventBehavior:["type",Us],intermediateCatchEventBehavior:["type",Ro],intermediateThrowEventBehavior:["type",Ao],exclusiveGatewayBehavior:["type",Ws],parallelGatewayBehavior:["type",Ys],eventBasedGatewayBehavior:["type",up],inclusiveGatewayBehavior:["type",Mn],activityBehavior:["type",Dn],subProcessBehavior:["type",Li],sequenceFlowBehavior:["type",Bi],messageFlowBehavior:["type",$i],eventBehaviors:["type",pp],scopeBehavior:["type",kn],processBehavior:["type",Io],transactionBehavior:["type",pi]},cT=5e3,Gg={__depends__:[sT],__init__:[["eventBus","simulator",function(e,t){e.on(["tokenSimulation.toggleMode","tokenSimulation.resetSimulation"],cT,n=>{t.reset()})}]],simulator:["type",Bg]};function qs(e,t){e.invoke($i,this),this._animation=t}q(qs,$i);qs.$inject=["injector","animation"];qs.prototype.signal=function(e){const{element:t,scope:n}=e;this._animation.animate(t,n,()=>{$i.prototype.signal.call(this,e)})};function Ks(e,t){e.invoke(Bi,this),this._animation=t}q(Ks,Bi);Ks.$inject=["injector","animation"];Ks.prototype.enter=function(e){const{element:t,scope:n}=e;this._animation.animate(t,n,()=>{Bi.prototype.enter.call(this,e)})};const lT={sequenceFlowBehavior:["type",Ks],messageFlowBehavior:["type",qs]},et="tokenSimulation.toggleMode",zg="tokenSimulation.playSimulation",Vg="tokenSimulation.pauseSimulation",On="tokenSimulation.resetSimulation",uT="tokenSimulation.animationCreated",Ug="tokenSimulation.animationSpeedChanged",Wg="tokenSimulation.simulator.elementChanged",Mo="tokenSimulation.simulator.destroyScope",pT="tokenSimulation.simulator.scopeChanged",Fi="tokenSimulation.simulator.createScope",_r="tokenSimulation.scopeFilterChanged",Yg="tokenSimulation.simulator.trace",_h=e=>!0;function Do(e,t){this._eventBus=e,this._simulator=t,this._filter=_h,e.on([et,On],()=>{this._filter=_h}),e.on(Mo,n=>{const{scope:i}=n;this._scope===i&&i.parent&&this.toggle(i.parent)}),e.on(Fi,n=>{const{scope:i}=n;!i.parent&&this._scope&&!qg(this._scope,i)&&this.toggle(null)})}Do.prototype.toggle=function(e){const t=this._scope!==e;this._scope=t?e:null,this._filter=this._scope?n=>qg(this._scope,n):n=>!0,this._eventBus.fire(_r,{filter:this._filter,scope:this._scope})};Do.prototype.isShown=function(e){return typeof e=="string"&&(e=this._simulator.findScope(t=>t.id===e)),e&&this._filter(e)};Do.prototype.findScope=function(e){return this._simulator.findScopes(e).filter(t=>this.isShown(t))[0]};Do.$inject=["eventBus","simulator"];function qg(e,t){do if(e===t)return!0;while(t=t.parent);return!1}const br={scopeFilter:["type",Do]},Kg=getComputedStyle(document.documentElement),fT=Kg.getPropertyValue("--token-simulation-green-base-44"),dT=Kg.getPropertyValue("--token-simulation-white");function hT(){}function mT(e,t){return t.length===2?_T:e===1?gT:e===t.length-1?yT:vT}const vT=function(e){return e},gT=function(e){return-Math.cos(e*Math.PI/2)+1},yT=function(e){return Math.sin(e*Math.PI/2)},_T=function(e){return-Math.cos(e*Math.PI)/2+.5},jr=20;function Ot(e,t,n,i){this._eventBus=n,this._scopeFilter=i,this._canvas=t,this._randomize=e&&e.randomize!==!1,this._animations=new Set,this._speed=1,n.on(On,()=>{this.clearAnimations()}),n.on(Vg,()=>{this.pause()}),n.on(zg,()=>{this.play()}),n.on(_r,r=>{this.each(o=>{this._scopeFilter.isShown(o.scope)?o.show():o.hide()})}),n.on(Mo,r=>{const{scope:o}=r;this.clearAnimations(o)})}Ot.prototype.animate=function(e,t,n){this.createAnimation(e,t,n)};Ot.prototype.pause=function(){this.each(e=>e.pause())};Ot.prototype.play=function(){this.each(e=>e.play())};Ot.prototype.each=function(e){this._animations.forEach(e)};Ot.prototype.createAnimation=function(e,t,n=hT){const i=this._getGroup(t);if(!i)return;const r=this._createTokenGfx(i,t),o=new Jt(r,e.waypoints,this._randomize,()=>{this._animations.delete(o),n()});return o.setSpeed(this.getAnimationSpeed()),this._scopeFilter.isShown(t)||o.hide(),o.scope=t,o.element=e,this._animations.add(o),this._eventBus.fire(uT,{animation:o}),o.play(),o};Ot.prototype.setAnimationSpeed=function(e){this._speed=e,this.each(t=>t.setSpeed(e)),this._eventBus.fire(Ug,{speed:e})};Ot.prototype.getAnimationSpeed=function(){return this._speed};Ot.prototype.clearAnimations=function(e){this.each(t=>{(!e||t.scope===e)&&t.remove()})};Ot.prototype._createTokenGfx=function(e,t){const n=de(this._getTokenSVG(t).trim());return Vh(n,e)};Ot.prototype._getTokenSVG=function(e){const t=e.colors||{primary:fT,auxiliary:dT};return`
    <g class="bts-token">
      <circle
        class="bts-circle"
        r="${jr/2}"
        cx="${jr/2}"
        cy="${jr/2}"
        fill="${t.primary}"
      />
      <text
        class="bts-text"
        transform="translate(10, 14)"
        text-anchor="middle"
        fill="${t.auxiliary}"
      >1</text>
    </g>
  `};Ot.prototype._getGroup=function(e){var t=this._canvas,n,i;"findRoot"in t?(i=t.findRoot(e.element),n=t._findPlaneForRoot(i).layer):n=we(".viewport",t._svg);var r=we(".bts-animation-tokens",n);return r||(r=de('<g class="bts-animation-tokens" />'),Vh(r,n)),r};Ot.$inject=["config.animation","canvas","eventBus","scopeFilter"];function Jt(e,t,n,i){this.gfx=e,this.waypoints=t,this.done=i,this.randomize=n,this._paused=!0,this._t=0,this._parts=[],this.create()}Jt.prototype.pause=function(){this._paused=!0};Jt.prototype.play=function(){this._paused&&(this._paused=!1,this.tick(0)),this.schedule()};Jt.prototype.schedule=function(){if(this._paused||this._scheduled)return;const e=Date.now();this._scheduled=!0,requestAnimationFrame(()=>{this._scheduled=!1,!this._paused&&(this.tick((Date.now()-e)*this._speed),this.schedule())})};Jt.prototype.tick=function(e){const t=this._t=this._t+e,n=this._parts.find(s=>s.startTime<=t&&s.endTime>t);if(!n)return this.remove();const i=t-n.startTime,r=n.length*n.easing(i/n.duration),o=n.startLength+r,a=this._path.getPointAtLength(o);this.move(a.x,a.y)};Jt.prototype.move=function(e,t){ie(this.gfx,"transform",`translate(${e}, ${t})`)};Jt.prototype.create=function(){const e=this.waypoints,t=e.reduce((o,a,s)=>{const c=e[s-1];if(c){const l=o[o.length-1],p=l&&l.endLength||0,u=xT(c,a);o.push({startLength:p,endLength:p+u,length:u,easing:mT(s,e)})}return o},[]),n=t.reduce(function(o,a){return o+a.length},0),i=e.reduce((o,a,s)=>{const c=a.x-jr/2,l=a.y-jr/2;return o.push([s>0?"L":"M",c,l]),o},[]).flat().join(" "),r=bT(n,this._randomize);this._parts=t.reduce((o,a,s)=>{const c=r/n*a.length,l=s>0?o[s-1].endTime:0,p=l+c;return[...o,Re(re({},a),{startTime:l,endTime:p,duration:c})]},[]),this._path=de(`<path d="${i}" />`),this._t=0};Jt.prototype.show=function(){ie(this.gfx,"display","")};Jt.prototype.hide=function(){ie(this.gfx,"display","none")};Jt.prototype.remove=function(){this.pause(),Qe(this.gfx),this.done()};Jt.prototype.setSpeed=function(e){this._speed=e};function bT(e,t=!1){return Math.log(e)*(t?ET(250,300):250)}function ET(e,t){return e+Math.floor(Math.random()*(t-e))}function xT(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}const wT={__depends__:[Gg,lT,br],animation:["type",Ot]};var gl={exports:{}};(function(e,t){(function(n,i){{var r=i();e&&e.exports&&(t=e.exports=r),t.randomColor=r}})(k_,function(){var n=null,i={};E();var r=[],o=function(C){if(C=C||{},C.seed!==void 0&&C.seed!==null&&C.seed===parseInt(C.seed,10))n=C.seed;else if(typeof C.seed=="string")n=P(C.seed);else{if(C.seed!==void 0&&C.seed!==null)throw new TypeError("The seed value must be an integer or string");n=null}var I,T,k;if(C.count!==null&&C.count!==void 0){for(var B=C.count,X=[],Q=0;Q<C.count;Q++)r.push(!1);for(C.count=null;B>X.length;){var Ie=o(C);n!==null&&(C.seed=n),X.push(Ie)}return C.count=B,X}return I=a(C),T=s(I,C),k=c(I,T,C),l([I,T,k],C)};function a(C){if(r.length>0){var I=A(C.hue),T=h(I),k=(I[1]-I[0])/r.length,B=parseInt((T-I[0])/k);r[B]===!0?B=(B+2)%r.length:r[B]=!0;var X=(I[0]+B*k)%359,Q=(I[0]+(B+1)*k)%359;return I=[X,Q],T=h(I),T<0&&(T=360+T),T}else{var I=u(C.hue);return T=h(I),T<0&&(T=360+T),T}}function s(C,I){if(I.hue==="monochrome")return 0;if(I.luminosity==="random")return h([0,100]);var T=f(C),k=T[0],B=T[1];switch(I.luminosity){case"bright":k=55;break;case"dark":k=B-10;break;case"light":B=55;break}return h([k,B])}function c(C,I,T){var k=p(C,I),B=100;switch(T.luminosity){case"dark":B=k+20;break;case"light":k=(B+k)/2;break;case"random":k=0,B=100;break}return h([k,B])}function l(C,I){switch(I.format){case"hsvArray":return C;case"hslArray":return x(C);case"hsl":var T=x(C);return"hsl("+T[0]+", "+T[1]+"%, "+T[2]+"%)";case"hsla":var k=x(C),Q=I.alpha||Math.random();return"hsla("+k[0]+", "+k[1]+"%, "+k[2]+"%, "+Q+")";case"rgbArray":return w(C);case"rgb":var B=w(C);return"rgb("+B.join(", ")+")";case"rgba":var X=w(C),Q=I.alpha||Math.random();return"rgba("+X.join(", ")+", "+Q+")";default:return m(C)}}function p(C,I){for(var T=d(C).lowerBounds,k=0;k<T.length-1;k++){var B=T[k][0],X=T[k][1],Q=T[k+1][0],Ie=T[k+1][1];if(I>=B&&I<=Q){var We=(Ie-X)/(Q-B),Me=X-We*B;return We*I+Me}}return 0}function u(C){if(typeof parseInt(C)=="number"){var I=parseInt(C);if(I<360&&I>0)return[I,I]}if(typeof C=="string"){if(i[C]){var T=i[C];if(T.hueRange)return T.hueRange}else if(C.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var k=_(C)[0];return[k,k]}}return[0,360]}function f(C){return d(C).saturationRange}function d(C){C>=334&&C<=360&&(C-=360);for(var I in i){var T=i[I];if(T.hueRange&&C>=T.hueRange[0]&&C<=T.hueRange[1])return i[I]}return"Color not found"}function h(C){if(n===null){var I=.618033988749895,T=Math.random();return T+=I,T%=1,Math.floor(C[0]+T*(C[1]+1-C[0]))}else{var k=C[1]||1,B=C[0]||0;n=(n*9301+49297)%233280;var X=n/233280;return Math.floor(B+X*(k-B))}}function m(C){var I=w(C);function T(B){var X=B.toString(16);return X.length==1?"0"+X:X}var k="#"+T(I[0])+T(I[1])+T(I[2]);return k}function v(C,I,T){var k=T[0][0],B=T[T.length-1][0],X=T[T.length-1][1],Q=T[0][1];i[C]={hueRange:I,lowerBounds:T,saturationRange:[k,B],brightnessRange:[X,Q]}}function E(){v("monochrome",null,[[0,0],[100,0]]),v("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),v("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),v("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),v("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),v("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),v("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),v("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function w(C){var I=C[0];I===0&&(I=1),I===360&&(I=359),I=I/360;var T=C[1]/100,k=C[2]/100,B=Math.floor(I*6),X=I*6-B,Q=k*(1-T),Ie=k*(1-X*T),We=k*(1-(1-X)*T),Me=256,U=256,ae=256;switch(B){case 0:Me=k,U=We,ae=Q;break;case 1:Me=Ie,U=k,ae=Q;break;case 2:Me=Q,U=k,ae=We;break;case 3:Me=Q,U=Ie,ae=k;break;case 4:Me=We,U=Q,ae=k;break;case 5:Me=k,U=Q,ae=Ie;break}var fe=[Math.floor(Me*255),Math.floor(U*255),Math.floor(ae*255)];return fe}function _(C){C=C.replace(/^#/,""),C=C.length===3?C.replace(/(.)/g,"$1$1"):C;var I=parseInt(C.substr(0,2),16)/255,T=parseInt(C.substr(2,2),16)/255,k=parseInt(C.substr(4,2),16)/255,B=Math.max(I,T,k),X=B-Math.min(I,T,k),Q=B?X/B:0;switch(B){case I:return[60*((T-k)/X%6)||0,Q,B];case T:return[60*((k-I)/X+2)||0,Q,B];case k:return[60*((I-T)/X+4)||0,Q,B]}}function x(C){var I=C[0],T=C[1]/100,k=C[2]/100,B=(2-T)*k;return[I,Math.round(T*k/(B<1?B:2-B)*1e4)/100,B/2*100]}function P(C){for(var I=0,T=0;T!==C.length&&!(I>=Number.MAX_SAFE_INTEGER);T++)I+=C.charCodeAt(T);return I}function A(C){if(isNaN(C)){if(typeof C=="string"){if(i[C]){var T=i[C];if(T.hueRange)return T.hueRange}else if(C.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var k=_(C)[0];return d(k).hueRange}}}else{var I=parseInt(C);if(I<360&&I>0)return d(C).hueRange}return[0,360]}return o})})(gl,gl.exports);var ST=gl.exports;const CT=Wh(ST),TT=1500;function Xg(e){const t=CT({count:60}).filter(o=>n(o.substring(1))<200);function n(o){var a=parseInt(o.substr(0,2),16),s=parseInt(o.substr(2,2),16),c=parseInt(o.substr(4,2),16),l=(a*299+s*587+c*114)/1e3;return l}let i=0;function r(o){const{element:a}=o;if(a&&a.type==="bpmn:MessageFlow")return{primary:"#999",auxiliary:"#FFF"};if(o.parent)return o.parent.colors;const s=t[i++%t.length];return{primary:s,auxiliary:n(s)>=128?"#111":"#fff"}}e.on(Fi,TT,o=>{const{scope:a}=o;a.colors=r(a)})}Xg.$inject=["eventBus"];const PT={__init__:["coloredScopes"],coloredScopes:["type",Xg]};var RT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M12.83 352h262.34A12.82 12.82 0 0 0 288 339.17v-38.34A12.82 12.82 0 0 0 275.17 288H12.83A12.82 12.82 0 0 0 0 300.83v38.34A12.82 12.82 0 0 0 12.83 352zm0-256h262.34A12.82 12.82 0 0 0 288 83.17V44.83A12.82 12.82 0 0 0 275.17 32H12.83A12.82 12.82 0 0 0 0 44.83v38.34A12.82 12.82 0 0 0 12.83 96zM432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"/></svg>',AT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg>',IT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></svg>',MT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3 0-44.2-35.8-80-80-80S0 35.8 0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9 0 396.2 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg>',DT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>',kT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"/></svg>',OT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"/></svg>',NT=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 580.5 448">
  <path fill="currentColor" d="M112 0C85 0 64 22 64 48v196l192-89V48c0-26-22-48-48-48zm256 0c-27 0-48 22-48 48v77l190-89c-5-21-24-36-46-36Zm144 105-192 89v70l192-89zM256 224 64 314v70l192-90zm256 21-192 89v66c0 27 21 48 48 48h96c26 0 48-21 48-48zM256 364 89 442c7 4 14 6 23 6h96c26 0 48-21 48-48z"/>
  <rect fill="currentColor" width="63.3" height="618.2" x="311.5" y="-469.4" transform="rotate(65)" rx="10"/>
</svg>
`,LT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Adapted from Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"/></svg>',BT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"/></svg>',$T='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M288 32C128.94 32 0 160.94 0 320c0 52.8 14.25 102.26 39.06 144.8 5.61 9.62 16.3 15.2 27.44 15.2h443c11.14 0 21.83-5.58 27.44-15.2C561.75 422.26 576 372.8 576 320c0-159.06-128.94-288-288-288zm0 64c14.71 0 26.58 10.13 30.32 23.65-1.11 2.26-2.64 4.23-3.45 6.67l-9.22 27.67c-5.13 3.49-10.97 6.01-17.64 6.01-17.67 0-32-14.33-32-32S270.33 96 288 96zM96 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm48-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm246.77-72.41l-61.33 184C343.13 347.33 352 364.54 352 384c0 11.72-3.38 22.55-8.88 32H232.88c-5.5-9.45-8.88-20.28-8.88-32 0-33.94 26.5-61.43 59.9-63.59l61.34-184.01c4.17-12.56 17.73-19.45 30.36-15.17 12.57 4.19 19.35 17.79 15.17 30.36zm14.66 57.2l15.52-46.55c3.47-1.29 7.13-2.23 11.05-2.23 17.67 0 32 14.33 32 32s-14.33 32-32 32c-11.38-.01-20.89-6.28-26.57-15.22zM480 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"/></svg>',FT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>',jT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>',HT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M384 64H192C85.961 64 0 149.961 0 256s85.961 192 192 192h192c106.039 0 192-85.961 192-192S490.039 64 384 64zM64 256c0-70.741 57.249-128 128-128 70.741 0 128 57.249 128 128 0 70.741-57.249 128-128 128-70.741 0-128-57.249-128-128zm320 128h-48.905c65.217-72.858 65.236-183.12 0-256H384c70.741 0 128 57.249 128 128 0 70.74-57.249 128-128 128z"/></svg>',GT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M384 64H192C86 64 0 150 0 256s86 192 192 192h192c106 0 192-86 192-192S490 64 384 64zm0 320c-70.8 0-128-57.3-128-128 0-70.8 57.3-128 128-128 70.8 0 128 57.3 128 128 0 70.8-57.3 128-128 128z"/></svg>';function bt(e){return function(n=""){return`<span class="bts-icon ${n}">${e}</span>`}}const bh=bt(RT),Zg=bt(AT),yl=bt(IT),zT=bt(NT),Jg=bt(MT),Qg=bt(DT),ey=bt(kT),_l=bt(OT),ty=bt(LT),VT=bt(BT),UT=bt($T),WT=bt(FT),YT=bt(jT),ny=bt(HT),qT=bt(GT);function fp(e){this._exclusiveGatewaySettings=e}fp.prototype.createContextPads=function(e){if(e.outgoing.filter(function(r){return De(r,"bpmn:SequenceFlow")}).length<2)return;const n=`
    <div class="bts-context-pad" title="Set Sequence Flow">
      ${Jg()}
    </div>
  `;return[{action:()=>{this._exclusiveGatewaySettings.setSequenceFlow(e)},element:e,html:n}]};fp.$inject=["exclusiveGatewaySettings"];function dp(e){this._inclusiveGatewaySettings=e}dp.prototype.createContextPads=function(e){const t=e.outgoing.filter(ui);if(t.length<2)return;const n=t.filter(r=>{const o=z(r);return z(e).default!==o}),i=`
    <div class="bts-context-pad" title="Set Sequence Flow">
      ${Jg()}
    </div>
  `;return n.map(r=>({action:()=>{this._inclusiveGatewaySettings.toggleSequenceFlow(e,r)},element:r,html:i}))};dp.$inject=["inclusiveGatewaySettings"];function ji(e){this._simulator=e}ji.prototype.createContextPads=function(e){return De(e,"bpmn:ReceiveTask")||De(e,"bpmn:SubProcess")&&z(e).triggeredByEvent?[]:[this.createPauseContextPad(e)]};ji.prototype.createPauseContextPad=function(e){const t=()=>this._findSubscriptions({element:e}),n=this._isPaused(e),i=`
    <div class="bts-context-pad ${n?"":"show-hover"}" title="${n?"Remove":"Add"} pause point">
      ${(n?zT:_l)("show-hover")}
      ${_l("hide-hover")}
    </div>
  `;return{action:()=>{this._togglePaused(e)},element:e,hideContexts:t,html:i}};ji.prototype._isPaused=function(e){const{wait:t}=this._simulator.getConfig(e);return t};ji.prototype._togglePaused=function(e){const t=!this._isPaused(e);this._simulator.waitAtElement(e,t)};ji.prototype._findSubscriptions=function(e){return this._simulator.findSubscriptions(e)};ji.$inject=["simulator"];function Ri(e){this._simulator=e}Ri.$inject=["simulator"];Ri.prototype.createContextPads=function(e){return[this.createTriggerContextPad(e)]};Ri.prototype.createTriggerContextPad=function(e){const t=()=>this._findSubscriptions({element:e}).slice().sort((a,s)=>a.event.type==="none"?1:-1),n=`
    <div class="bts-context-pad" title="Trigger Event">
      ${ty()}
    </div>
  `;return{action:r=>{const{event:o,scope:a}=r[0];return this._simulator.trigger({event:o,scope:a})},element:e,html:n,contexts:t}};Ri.prototype._findSubscriptions=function(e){return this._simulator.findSubscriptions(e)};const Oc=500,KT=-15,XT=-15;function Yt(e,t,n,i,r,o){this._elementRegistry=t,this._overlays=n,this._injector=i,this._canvas=r,this._scopeFilter=o,this._overlayCache=new Map,this._handlerIdx=0,this._handlers=[],this.registerHandler("bpmn:ExclusiveGateway",fp),this.registerHandler("bpmn:InclusiveGateway",dp),this.registerHandler("bpmn:Activity",ji),this.registerHandler("bpmn:Event",Ri),this.registerHandler("bpmn:Gateway",Ri),this.registerHandler("bpmn:Activity",Ri),e.on(et,Oc,a=>{a.active?this.openContextPads():this.closeContextPads()}),e.on(On,Oc,()=>{this.closeContextPads(),this.openContextPads()}),e.on(_r,a=>{const s=Yn(".djs-overlay-ts-context-menu [data-scope-ids]",n._overlayRoot);for(const l of s){const u=l.dataset.scopeIds.split(",").some(f=>o.isShown(f));Z(l).toggle("hidden",!u)}const c=Yn(".djs-overlay-ts-context-menu [data-hide-scope-ids]",n._overlayRoot);for(const l of c){const u=l.dataset.hideScopeIds.split(",").some(f=>o.isShown(f));Z(l).toggle("hidden",u)}}),e.on(Wg,Oc,a=>{const{element:s}=a;this.updateElementContextPads(s)})}Yt.prototype.registerHandler=function(e,t){const n=this._injector.instantiate(t);n.hash=String(this._handlerIdx++),this._handlers.push({handler:n,type:e})};Yt.prototype.getHandlers=function(e){return this._handlers.filter(({type:t})=>De(e,t)).map(({handler:t})=>t)};Yt.prototype.openContextPads=function(e){e||(e=this._canvas.getRootElement()),this._elementRegistry.forEach(t=>{ZT(e,t)&&this.updateElementContextPads(t)})};Yt.prototype._getOverlays=function(e){return this._overlayCache.get(e)||[]};Yt.prototype._addOverlay=function(e,t){const{handlerHash:n}=t;if(!n)throw new Error("<handlerHash> required");const i=this._overlays.add(e,"bts-context-menu",Re(re({},t),{position:{top:KT,left:XT},show:{minZoom:.5}})),r=this._overlays.get(i),o=this._overlayCache;o.has(n)||o.set(n,[]),o.get(n).push(r)};Yt.prototype._removeOverlay=function(e){const{id:t,handlerHash:n}=e;this._overlays.remove(t);const i=this._overlayCache.get(n)||[],r=i.indexOf(e);r!==-1&&i.splice(r,1)};Yt.prototype.updateElementContextPads=function(e){for(const t of this.getHandlers(e))this._updateElementContextPads(e,t)};Yt.prototype._updateElementContextPads=function(e,t){const n=(t.createContextPads(e)||[]).filter(a=>a),i=`${e.id}------${t.hash}`,r=this._getOverlays(i),o=[];for(const a of n){const{element:s,contexts:c,hideContexts:l,action:p,html:u}=a,f=`${a.element.id}-------${u}`;let d=r.find(m=>m.hash===f);const h=d&&d.html||_e(u);if(c){const m=c();h.dataset.scopeIds=m.map(E=>E.scope.id).join(",");const v=m.filter(E=>this._scopeFilter.isShown(E.scope));Z(h).toggle("hidden",v.length===0)}if(l){const m=l();h.dataset.hideScopeIds=m.map(E=>E.scope.id).join(",");const v=m.filter(E=>this._scopeFilter.isShown(E.scope));Z(h).toggle("hidden",v.length>0)}if(d){o.push(d);continue}p&&K.bind(h,"click",m=>{m.preventDefault();const v=c?c().filter(E=>this._scopeFilter.isShown(E.scope)):null;p(v)}),this._addOverlay(s,{hash:f,handlerHash:i,html:h})}for(const a of r)o.includes(a)||this._removeOverlay(a)};Yt.prototype.closeContextPads=function(){for(const e of this._overlayCache.values())for(const t of e)this._closeOverlay(t);this._overlayCache.clear()};Yt.prototype._closeOverlay=function(e){this._overlays.remove(e.id)};Yt.$inject=["eventBus","elementRegistry","overlays","injector","canvas","scopeFilter"];function ZT(e,t){do{if(e===t)return!0;t=t.parent}while(t);return!1}const JT={__depends__:[br],__init__:["contextPads"],contextPads:["type",Yt]};function iy(e,t,n){e.on(Mo,i=>{const{scope:r}=i,{destroyInitiator:o,element:a}=r;!r.completed||!o||!["bpmn:Process","bpmn:Participant"].includes(a.type)||n.addElementNotification(o.element,{type:"success",icon:yl(),text:"Finished",scope:r})})}iy.$inject=["eventBus","simulator","elementNotifications"];const QT=-15,eP=15;function ko(e,t){this._overlays=e,t.on([On,Fi,et],()=>{this.clear()})}ko.prototype.addElementNotification=function(e,t){const n={top:QT,right:eP},{type:i,icon:r,text:o,scope:a={}}=t,s=a.colors,c=s?`style="color: ${s.auxiliary}; background: ${s.primary}"`:"",l=_e(`
    <div class="bts-element-notification ${i||""}" ${c}>
      ${r||""}
      <span class="bts-text">${o}</span>
    </div>
  `);this._overlays.add(e,"bts-element-notification",{position:n,html:l,show:{minZoom:.5}})};ko.prototype.clear=function(){this._overlays.remove({type:"bts-element-notification"})};ko.prototype.removeElementNotification=function(e){this._overlays.remove({element:e})};ko.$inject=["overlays","eventBus"];const ry={elementNotifications:["type",ko]},tP=2e3,nP=ey();function Oo(e,t,n){this._eventBus=e,this._canvas=t,this._scopeFilter=n,this._init(),e.on([et,On],i=>{this.clear()})}Oo.prototype._init=function(){this.container=_e('<div class="bts-notifications"></div>'),this._canvas.getContainer().appendChild(this.container)};Oo.prototype.showNotification=function(e){const{text:t,type:n="info",icon:i=nP,scope:r,ttl:o=tP}=e;if(r&&!this._scopeFilter.isShown(r))return;const a=i.startsWith("<")?i:`<i class="${i}"></i>`,s=r&&r.colors,c=s?`style="color: ${s.auxiliary}; background: ${s.primary}"`:"",l=_e(`
    <div class="bts-notification ${n}">
      <span class="bts-icon">${a}</span>
      <span class="bts-text" title="${t}">${t}</span>
      ${r?`<span class="bts-scope" ${c}>${r.id}</span>`:""}
    </div>
  `);for(this.container.appendChild(l);this.container.children.length>5;)this.container.children[0].remove();setTimeout(function(){l.remove()},o)};Oo.prototype.clear=function(){for(;this.container.children.length;)this.container.children[0].remove()};Oo.$inject=["eventBus","canvas","scopeFilter"];const No={__depends__:[br],notifications:["type",Oo]},iP={__depends__:[ry,No],__init__:["simulationState"],simulationState:["type",iy]},rP="--token-simulation-silver-base-97",oP="--token-simulation-green-base-44",oy="show-scopes",aP=3e3;function qt(e,t,n,i,r){this._eventBus=e,this._canvas=t,this._scopeFilter=n,this._elementColors=i,this._simulationStyles=r,this._highlight=null,this._init(),e.on(et,o=>{o.active?Z(this._container).remove("hidden"):(Z(this._container).add("hidden"),Il(this._container),this.unhighlightScope())}),e.on(_r,o=>{const a=this.getScopeElements();for(const s of a){const c=s.dataset.scopeId;Z(s).toggle("inactive",!this._scopeFilter.isShown(c))}}),e.on(Fi,o=>{this.addScope(o.scope)}),e.on(Mo,o=>{this.removeScope(o.scope)}),e.on(pT,o=>{this.updateScope(o.scope)}),e.on(On,()=>{this.removeAllInstances()})}qt.prototype._init=function(){this._container=_e('<div class="bts-scopes hidden"></div>'),this._canvas.getContainer().appendChild(this._container)};qt.prototype.addScope=function(e){const t=["bpmn:Process","bpmn:SubProcess","bpmn:Participant"],{element:n}=e;if(!t.includes(n.type))return;const i=e.colors,r=i?`style="color: ${i.auxiliary}; background: ${i.primary}"`:"",o=_e(`
    <div data-scope-id="${e.id}" class="bts-scope"
         title="View Process Instance ${e.id}" ${r}>
      ${e.getTokens()}
    </div>
  `);K.bind(o,"click",()=>{this._scopeFilter.toggle(e)}),K.bind(o,"mouseenter",()=>{this.highlightScope(n)}),K.bind(o,"mouseleave",()=>{this.unhighlightScope()}),this._scopeFilter.isShown(e)||Z(o).add("inactive"),this._container.appendChild(o)};qt.prototype.getScopeElements=function(){return Yn("[data-scope-id]",this._container)};qt.prototype.getScopeElement=function(e){return we(`[data-scope-id="${e.id}"]`,this._container)};qt.prototype.updateScope=function(e){const t=this.getScopeElement(e);t&&(t.textContent=e.getTokens())};qt.prototype.removeScope=function(e){const t=this.getScopeElement(e);t&&t.remove()};qt.prototype.removeAllInstances=function(){this._container.innerHTML=""};qt.prototype.highlightScope=function(e){this.unhighlightScope(),this._highlight=e,this._elementColors.add(e,oy,this._getHighlightColors(),aP),e.parent||Z(this._canvas.getContainer()).add("highlight")};qt.prototype.unhighlightScope=function(){if(!this._highlight)return;const e=this._highlight;this._elementColors.remove(e,oy),e.parent||Z(this._canvas.getContainer()).remove("highlight"),this._highlight=null};qt.prototype._getHighlightColors=function(){return{fill:this._simulationStyles.get(rP),stroke:this._simulationStyles.get(oP)}};qt.$inject=["eventBus","canvas","scopeFilter","elementColors","simulationStyles"];function Xs(){this._cache={}}Xs.$inject=[];Xs.prototype.get=function(e){const t=this._cache[e];return t||(this._computedStyle||(this._computedStyle=this._getComputedStyle()),this._cache[e]=this._computedStyle.getPropertyValue(e).trim())};Xs.prototype._getComputedStyle=function(){const e=typeof getComputedStyle=="function"?getComputedStyle:sP,t=typeof document!="undefined"?document.documentElement:{};return e(t)};function sP(){return{getPropertyValue(){return""}}}const Zs={simulationStyles:["type",Xs]},cP={__depends__:[br,Zs],__init__:["showScopes"],showScopes:["type",qt]},lP=ey();function ya(e){const t=e&&e.businessObject.name;return t&&Hc(t)}function Hi(e,t,n,i,r,o){this._notifications=t,this._tokenSimulationPalette=n,this._canvas=i,this._scopeFilter=r,this._init(),e.on(_r,a=>{const s=Yn(".bts-entry[data-scope-id]",this._container);for(const c of s){const l=c.dataset.scopeId;Z(c).toggle("inactive",!this._scopeFilter.isShown(l))}}),e.on(Mo,a=>{const{scope:s}=a,{element:c}=s,l=s.completed;if(!["bpmn:Process","bpmn:Participant","bpmn:SubProcess"].includes(c.type))return;const f=`${De(c,"bpmn:SubProcess")?ya(c)||"SubProcess":"Process"} ${l?"finished":"canceled"}`;this.log({text:f,icon:l?yl():WT(),scope:s})}),e.on(Fi,a=>{const{scope:s}=a,{element:c}=s;if(!["bpmn:Process","bpmn:Participant","bpmn:SubProcess"].includes(c.type))return;const u=`${De(c,"bpmn:SubProcess")?ya(c)||"SubProcess":"Process"} started`;this.log({text:u,icon:yl(),scope:s})}),e.on(Yg,a=>{const{action:s,scope:c,element:l}=a;if(s!=="exit")return;const p=c.parent,u=ya(l);if(De(l,"bpmn:BusinessRuleTask")?this.log({text:u||"Business Rule Task",icon:"bpmn-icon-business-rule",scope:p}):De(l,"bpmn:CallActivity")?this.log({text:u||"Call Activity",icon:"bpmn-icon-call-activity",scope:p}):(De(l,"bpmn:IntermediateCatchEvent")||De(l,"bpmn:IntermediateThrowEvent"))&&this.log({text:u||"Intermediate Event",icon:"bpmn-icon-intermediate-event-none",scope:p}),De(l,"bpmn:BoundaryEvent"))this.log({text:u||"Boundary Event",icon:"bpmn-icon-intermediate-event-none",scope:p});else if(De(l,"bpmn:ManualTask"))this.log({text:u||"Manual Task",icon:"bpmn-icon-manual",scope:p});else if(De(l,"bpmn:ScriptTask"))this.log({text:u||"Script Task",icon:"bpmn-icon-script",scope:p});else if(De(l,"bpmn:ServiceTask"))this.log({text:u||"Service Task",icon:"bpmn-icon-service",scope:p});else if(De(l,"bpmn:Task"))this.log({text:u||"Task",icon:"bpmn-icon-task",scope:p});else if(De(l,"bpmn:UserTask"))this.log({text:u||"User Task",icon:"bpmn-icon-user",scope:p});else if(De(l,"bpmn:ExclusiveGateway")){if(l.outgoing.length<2)return;const f=ya(l.sequenceFlow);let d=u||"Gateway";f&&(d=d.concat(` ${Zg()} ${f}`)),this.log({text:d,icon:"bpmn-icon-gateway-xor",scope:p})}else De(l,"bpmn:EndEvent")?Fg(z(l),"bpmn:TerminateEventDefinition")?this.log({text:u||"Terminate End Event",icon:"bpmn-icon-end-event-terminate",scope:p}):this.log({text:u||"End Event",icon:"bpmn-icon-end-event-none",scope:p}):De(l,"bpmn:StartEvent")&&this.log({text:u||"Start Event",icon:"bpmn-icon-start-event-none",scope:p})}),e.on([et,On],a=>{this.clear(),this.toggle(!1)})}Hi.prototype._init=function(){this._container=_e(`
    <div class="bts-log hidden djs-scrollable">
      <div class="bts-header">
        ${bh("bts-log-icon")}
        Simulation Log
        <button class="bts-close">
          ${YT()}
        </button>
      </div>
      <div class="bts-content">
        <p class="bts-entry placeholder">No Entries</p>
      </div>
    </div>
  `),this._placeholder=we(".bts-placeholder",this._container),this._content=we(".bts-content",this._container),K.bind(this._content,"mousedown",e=>{e.stopPropagation()}),this._close=we(".bts-close",this._container),K.bind(this._close,"click",()=>{this.toggle(!1)}),this._icon=we(".bts-log-icon",this._container),K.bind(this._icon,"click",()=>{this.toggle()}),this._canvas.getContainer().appendChild(this._container),this.paletteEntry=_e(`
    <div class="bts-entry" title="Toggle Simulation Log">
      ${bh()}
    </div>
  `),K.bind(this.paletteEntry,"click",()=>{this.toggle()}),this._tokenSimulationPalette.addEntry(this.paletteEntry,3)};Hi.prototype.isShown=function(){const e=this._container;return!Z(e).has("hidden")};Hi.prototype.toggle=function(e=!this.isShown()){const t=this._container;e?Z(t).remove("hidden"):Z(t).add("hidden")};Hi.prototype.log=function(e){const{text:t,type:n="info",icon:i=lP,scope:r}=e,o=this._content;Z(this._placeholder).add("hidden"),this.isShown()||this._notifications.showNotification(e);const a=i.startsWith("<")?i:`<i class="${i}"></i>`,s=r&&r.colors,c=s?`style="background: ${s.primary}; color: ${s.auxiliary}"`:"",l=_e(`
    <p class="bts-entry ${n} ${r&&this._scopeFilter.isShown(r)?"":"inactive"}" ${r?`data-scope-id="${r.id}"`:""}>
      <span class="bts-icon">${a}</span>
      <span class="bts-text" title="${t}">${t}</span>
      ${r?`<span class="bts-scope" data-scope-id="${r.id}" ${c}>${r.id}</span>`:""}
    </p>
  `);Rt.bind(l,".bts-scope[data-scope-id]","click",u=>{this._scopeFilter.toggle(r)});const p=Math.abs(o.clientHeight+o.scrollTop-o.scrollHeight)<2;o.appendChild(l),p&&(o.scrollTop=o.scrollHeight)};Hi.prototype.clear=function(){for(;this._content.firstChild;)this._content.removeChild(this._content.firstChild);this._placeholder=_e('<p class="bts-entry placeholder">No Entries</p>'),this._content.appendChild(this._placeholder)};Hi.$inject=["eventBus","notifications","tokenSimulationPalette","canvas","scopeFilter","simulator"];const uP={__depends__:[No,br],__init__:["log"],log:["type",Hi]},pP=["bpmn:ComplexGateway"];function fP(e){return e.labelTarget}function Er(e,t,n,i,r){this._eventBus=e,this._elementRegistry=t,this._elementNotifications=r,this._notifications=i,this._canvasParent=n.getContainer().parentNode,e.on(et,o=>{o.active?this.enable():this.clear()})}Er.prototype.getUnsupportedElements=function(){return this._unsupportedElements};Er.prototype.enable=function(){const e=[];this._elementRegistry.forEach(t=>{fP(t)||De(t,pP)&&(this.showWarning(t),e.push(t))}),e.length&&this._notifications.showNotification({text:"Found unsupported elements",icon:Qg(),type:"warning",ttl:5e3}),this._unsupportedElements=e};Er.prototype.clear=function(){Z(this._canvasParent).remove("warning")};Er.prototype.showWarning=function(e){this._elementNotifications.addElementNotification(e,{type:"warning",icon:Qg(),text:"Not supported"})};Er.$inject=["eventBus","elementRegistry","canvas","notifications","elementNotifications"];const dP={__depends__:[ry,No],__init__:["elementSupport"],elementSupport:["type",Er]},ay=ty(),hP=_l(),Eh=1500;function fi(e,t,n,i){this._eventBus=e,this._tokenSimulationPalette=t,this._notifications=n,this.canvasParent=i.getContainer().parentNode,this.isActive=!1,this.isPaused=!0,this._init(),e.on(Fi,Eh,r=>{this.activate(),this.unpause()}),e.on([On,et],()=>{this.deactivate(),this.pause()}),e.on(Yg,Eh,r=>{this.unpause()})}fi.prototype._init=function(){this.paletteEntry=_e(`
    <div class="bts-entry disabled" title="Play/Pause Simulation">
      ${ay}
    </div>
  `),K.bind(this.paletteEntry,"click",this.toggle.bind(this)),this._tokenSimulationPalette.addEntry(this.paletteEntry,1)};fi.prototype.toggle=function(){this.isPaused?this.unpause():this.pause()};fi.prototype.pause=function(){this.isActive&&(Z(this.paletteEntry).remove("active"),Z(this.canvasParent).add("paused"),this.paletteEntry.innerHTML=ay,this._eventBus.fire(Vg),this._notifications.showNotification({text:"Pause Simulation"}),this.isPaused=!0)};fi.prototype.unpause=function(){!this.isActive||!this.isPaused||(Z(this.paletteEntry).add("active"),Z(this.canvasParent).remove("paused"),this.paletteEntry.innerHTML=hP,this._eventBus.fire(zg),this._notifications.showNotification({text:"Play Simulation"}),this.isPaused=!1)};fi.prototype.activate=function(){this.isActive=!0,Z(this.paletteEntry).remove("disabled")};fi.prototype.deactivate=function(){this.isActive=!1,Z(this.paletteEntry).remove("active"),Z(this.paletteEntry).add("disabled")};fi.$inject=["eventBus","tokenSimulationPalette","notifications","canvas"];const mP={__depends__:[No],__init__:["pauseSimulation"],pauseSimulation:["type",fi]};function Js(e,t,n){this._eventBus=e,this._tokenSimulationPalette=t,this._notifications=n,this._init(),e.on(Fi,()=>{Z(this._paletteEntry).remove("disabled")}),e.on(et,i=>{(this._active=i.active)||this.resetSimulation()})}Js.prototype._init=function(){this._paletteEntry=_e(`
    <div class="bts-entry disabled" title="Reset Simulation">
      ${VT()}
    </div>
  `),K.bind(this._paletteEntry,"click",()=>{this.resetSimulation(),this._notifications.showNotification({text:"Reset Simulation",type:"info"})}),this._tokenSimulationPalette.addEntry(this._paletteEntry,2)};Js.prototype.resetSimulation=function(){Z(this._paletteEntry).add("disabled"),this._eventBus.fire(On)};Js.$inject=["eventBus","tokenSimulationPalette","notifications"];const vP={__depends__:[No],__init__:["resetSimulation"],resetSimulation:["type",Js]},gP=10,yP=-15,_P=500,bP="--token-simulation-green-base-44",EP="--token-simulation-white";function di(e,t,n,i,r){this._overlays=t,this._scopeFilter=i,this._simulator=n,this._simulationStyles=r,this.overlayIds={},e.on(Wg,_P,o=>{const{element:a}=o;this.removeTokenCounts(a),this.addTokenCounts(a)}),e.on(_r,o=>{const a=Yn(".bts-token-count[data-scope-id]",t._overlayRoot);for(const s of a){const c=s.dataset.scopeId;Z(s).toggle("inactive",!this._scopeFilter.isShown(c))}})}di.prototype.addTokenCounts=function(e){if(De(e,"bpmn:MessageFlow")||De(e,"bpmn:SequenceFlow"))return;const t=this._simulator.findScopes(n=>!n.destroyed&&n.children.some(i=>!i.destroyed&&i.element===e&&!i.children.length));this.addTokenCount(e,t)};di.prototype.addTokenCount=function(e,t){if(!t.length)return;const n=t.map(a=>this._getTokenHTML(e,a)).join(""),i=_e(`
    <div class="bts-token-count-parent">
      ${n}
    </div>
  `),r={bottom:gP,left:yP},o=this._overlays.add(e,"bts-token-count",{position:r,html:i,show:{minZoom:.5}});this.overlayIds[e.id]=o};di.prototype.removeTokenCounts=function(e){this.removeTokenCount(e)};di.prototype.removeTokenCount=function(e){const t=this.overlayIds[e.id];t&&(this._overlays.remove(t),delete this.overlayIds[e.id])};di.prototype._getTokenHTML=function(e,t){const n=t.colors||this._getDefaultColors();return`
    <div data-scope-id="${t.id}" class="bts-token-count waiting ${this._scopeFilter.isShown(t)?"":"inactive"}"
         style="color: ${n.auxiliary}; background: ${n.primary}">
      ${t.getTokensByElement(e)}
    </div>
  `};di.prototype._getDefaultColors=function(){return{primary:this._simulationStyles.get(bP),auxiliary:this._simuationStyles.get(EP)}};di.$inject=["eventBus","overlays","simulator","scopeFilter","simulationStyles"];const xP={__depends__:[br,Zs],__init__:["tokenCount"],tokenCount:["type",di]},wP=[["Slow",.5],["Normal",1],["Fast",2]];function Lo(e,t,n){this._canvas=e,this._animation=t,this._eventBus=n,this._init(t.getAnimationSpeed()),n.on(et,i=>{i.active?Z(this._container).remove("hidden"):Z(this._container).add("hidden")}),n.on(Ug,i=>{this.setActive(i.speed)})}Lo.prototype.getToggleSpeed=function(e){return parseFloat(e.dataset.speed)};Lo.prototype._init=function(e){this._container=_e(`
    <div class="bts-set-animation-speed hidden">
      ${UT()}
      <div class="bts-animation-speed-buttons">
        ${wP.map(([t,n],i)=>`
            <button title="Set animation speed = ${t}" data-speed="${n}" class="bts-animation-speed-button ${n===e?"active":""}">
              ${Array.from({length:i+1}).map(()=>Zg()).join("")}
            </button>
          `).join("")}
      </div>
    </div>
  `),Rt.bind(this._container,"[data-speed]","click",t=>{const n=t.delegateTarget,i=this.getToggleSpeed(n);this._animation.setAnimationSpeed(i)}),this._canvas.getContainer().appendChild(this._container)};Lo.prototype.setActive=function(e){Yn("[data-speed]",this._container).forEach(t=>{const n=this.getToggleSpeed(t)===e;Z(t)[n?"add":"remove"]("active")})};Lo.$inject=["canvas","animation","eventBus"];const SP={__init__:["setAnimationSpeed"],setAnimationSpeed:["type",Lo]},CP="--token-simulation-grey-darken-30",TP="--token-simulation-grey-lighten-56";function PP(e,t){var n=e.outgoing.filter(hp),i=n.indexOf(t||e.sequenceFlow);return n[i+1]?n[i+1]:n[0]}function hp(e){return De(e,"bpmn:SequenceFlow")}const RP="exclusive-gateway-settings",AP=2e3;function xr(e,t,n,i,r){this._elementRegistry=t,this._elementColors=n,this._simulator=i,this._simulationStyles=r,e.on(et,o=>{o.active?this.setSequenceFlowsDefault():this.resetSequenceFlows()})}xr.prototype.setSequenceFlowsDefault=function(){const e=this._elementRegistry.filter(t=>De(t,"bpmn:ExclusiveGateway"));for(const t of e)this.setSequenceFlow(t)};xr.prototype.resetSequenceFlows=function(){this._elementRegistry.filter(t=>De(t,"bpmn:ExclusiveGateway")).forEach(t=>{t.outgoing.filter(hp).length&&this.resetSequenceFlow(t)})};xr.prototype.resetSequenceFlow=function(e){this._simulator.setConfig(e,{activeOutgoing:void 0})};xr.prototype.setSequenceFlow=function(e){const t=e.outgoing.filter(hp);if(t.length<2)return;const{activeOutgoing:n}=this._simulator.getConfig(e);let i;n?i=PP(e,n):i=t[0],this._simulator.setConfig(e,{activeOutgoing:i}),e.outgoing.forEach(r=>{const o=r===i?CP:TP,a=this._simulationStyles.get(o);this._elementColors.add(r,RP,{stroke:a},AP)})};xr.$inject=["eventBus","elementRegistry","elementColors","simulator","simulationStyles"];const xh=5e4;function Qt(e,t,n){this._elementRegistry=e,this._eventBus=t,this._graphicsFactory=n,this._originalColors={},this._customColors={},t.on(et,xh,i=>{i.active?this._saveOriginalColors():(this._applyOriginalColors(),this._originalColors={},this._customColors={})}),t.on("saveXML.start",xh,()=>{this._applyOriginalColors(),t.once("saveXML.done",()=>this._applyCustomColors())})}Qt.$inject=["elementRegistry","eventBus","graphicsFactory"];Qt.prototype.add=function(e,t,n,i=1e3){let r=this._customColors[e.id];r||(r=this._customColors[e.id]={}),r[t]=Re(re({},n),{priority:i}),this._applyHighestPriorityColor(e)};Qt.prototype.remove=function(e,t){const n=this._customColors[e.id];n&&(delete n[t],Object.keys(n)||delete this._customColors[e.id]),this._applyHighestPriorityColor(e)};Qt.prototype._get=function(e){const t=Se(e);if(t){if(sy(e))return{stroke:t.label&&t.label.get("color")};if(le(t,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return{fill:t.get("background-color"),stroke:t.get("border-color")}}};Qt.prototype._set=function(e,t={}){const{fill:n,stroke:i}=t,r=Se(e);r&&(sy(e)?r.label&&r.label.set("color",i):le(r,["bpmndi:BPMNEdge","bpmndi:BPMNShape"])&&(r.set("background-color",n),r.set("border-color",i)),this._forceRedraw(e))};Qt.prototype._saveOriginalColors=function(){this._originalColors={},this._elementRegistry.forEach(e=>{this._originalColors[e.id]=this._get(e)})};Qt.prototype._applyOriginalColors=function(){this._elementRegistry.forEach(e=>{const t=this._originalColors[e.id];t&&this._set(e,t)})};Qt.prototype._applyCustomColors=function(){this._elementRegistry.forEach(e=>{const t=this._customColors[e.id];t&&this._set(e,cy(t))})};Qt.prototype._applyHighestPriorityColor=function(e){const t=this._customColors[e.id];if(!t){this._set(e,this._originalColors[e.id]);return}this._set(e,cy(t))};Qt.prototype._forceRedraw=function(e){const t=this._elementRegistry.getGraphics(e),n=e.waypoints?"connection":"shape";this._graphicsFactory.update(n,e,t)};function sy(e){return"labelTarget"in e}function cy(e={}){const t=Object.values(e).reduce((i,r)=>{const{priority:o=1e3}=r;return!i||o>i.priority?r:i},void 0);if(t){const n=t,{priority:i}=n;return fc(n,["priority"])}}const mp={elementColors:["type",Qt]},IP={__depends__:[mp,Zs],exclusiveGatewaySettings:["type",xr]},MP="neutral-element-colors";function vp(e,t,n){this._elementRegistry=t,this._elementColors=n,e.on(et,i=>{const{active:r}=i;r&&this._setNeutralColors()})}vp.prototype._setNeutralColors=function(){this._elementRegistry.forEach(e=>{this._elementColors.add(e,MP,{stroke:"#212121",fill:"#fff"})})};vp.$inject=["eventBus","elementRegistry","elementColors"];const DP={__depends__:[mp],__init__:["neutralElementColors"],neutralElementColors:["type",vp]},kP="--token-simulation-grey-darken-30",OP="--token-simulation-grey-lighten-56",NP="inclusive-gateway-settings";function Nn(e,t,n,i,r){this._elementRegistry=t,this._elementColors=n,this._simulator=i,this._simulationStyles=r,e.on(et,o=>{o.active?this.setDefaults():this.reset()})}Nn.prototype.setDefaults=function(){this._elementRegistry.filter(t=>g(t,"bpmn:InclusiveGateway")).forEach(t=>{t.outgoing.filter(ui).length>1&&this._setGatewayDefaults(t)})};Nn.prototype.reset=function(){this._elementRegistry.filter(t=>g(t,"bpmn:InclusiveGateway")).forEach(t=>{t.outgoing.filter(ui).length>1&&this._resetGateway(t)})};Nn.prototype.toggleSequenceFlow=function(e,t){const n=this._getActiveOutgoing(e),i=gp(e),r=LP(e);let o;n.includes(t)?o=bl(n,t):o=bl(n,i).concat(t),o.length||(i?o=[i]:o=[r.find(a=>a!==t)]),this._setActiveOutgoing(e,o)};Nn.prototype._getActiveOutgoing=function(e){const{activeOutgoing:t}=this._simulator.getConfig(e);return t};Nn.prototype._setActiveOutgoing=function(e,t){this._simulator.setConfig(e,{activeOutgoing:t}),e.outgoing.filter(ui).forEach(i=>{const r=!t||t.includes(i)?kP:OP,o=this._simulationStyles.get(r);this._elementColors.add(i,NP,{stroke:o})})};Nn.prototype._setGatewayDefaults=function(e){const t=e.outgoing.filter(ui),n=gp(e),i=bl(t,n);this._setActiveOutgoing(e,i)};Nn.prototype._resetGateway=function(e){this._setActiveOutgoing(e,void 0)};Nn.$inject=["eventBus","elementRegistry","elementColors","simulator","simulationStyles"];function gp(e){const t=z(e).default;if(t)return e.outgoing.find(n=>z(n)===t)}function LP(e){const t=gp(e);return e.outgoing.filter(n=>z(n)!==t)}function bl(e,t){return e.filter(n=>n!==t)}const BP={__depends__:[mp,Zs],inclusiveGatewaySettings:["type",Nn]};function Qs(e,t){var n=this;this._canvas=t,this.entries=[],this._init(),e.on(et,function(i){var r=i.active;r?Z(n.container).remove("hidden"):Z(n.container).add("hidden")})}Qs.prototype._init=function(){this.container=_e('<div class="bts-palette hidden"></div>'),this._canvas.getContainer().appendChild(this.container)};Qs.prototype.addEntry=function(e,t){var n=0;this.entries.forEach(function(i){t>=i.index&&n++}),this.container.insertBefore(e,this.container.childNodes[n]),this.entries.push({entry:e,index:t})};Qs.$inject=["eventBus","canvas"];const $P={__init__:["tokenSimulationPalette"],tokenSimulationPalette:["type",Qs]},FP={__depends__:[Gg,wT,PT,JT,iP,cP,uP,dP,mP,vP,xP,SP,IP,DP,BP,$P]},jP=10001;function ly(e,t,n,i,r,o,a){let s=!1;e.on(et,jP,u=>{s=u.active,s&&(i.cancel(),n.cancel()),a._update()});function c(u,f,d){const h=u[f];u[f]=function(){return d.call(this,h,arguments)}}function l(u,f){c(u,f,function(d,h){if(!s)return d.apply(this,h)})}function p(u,f){c(u,f,function(d,h){if(s)throw new Error("model is read-only");return d.apply(this,h)})}l(n,"init"),l(i,"activate"),l(n,"init"),l(i,"activate"),p(o,"moveShape"),p(o,"updateAttachment"),p(o,"moveElements"),p(o,"moveConnection"),p(o,"layoutConnection"),p(o,"createConnection"),p(o,"createShape"),p(o,"createLabel"),p(o,"appendShape"),p(o,"removeElements"),p(o,"distributeElements"),p(o,"removeShape"),p(o,"removeConnection"),p(o,"replaceShape"),p(o,"pasteElements"),p(o,"alignElements"),p(o,"resizeShape"),p(o,"createSpace"),p(o,"updateWaypoints"),p(o,"reconnectStart"),p(o,"reconnectEnd"),c(r,"trigger",function(u,f){const d=f[0];if(!(s&&HP(["undo","redo","copy","paste","removeSelection","spaceTool","lassoTool","globalConnectTool","distributeElements","alignElements","directEditing"],d)))return u.apply(this,f)})}ly.$inject=["eventBus","contextPad","dragging","directEditing","editorActions","modeling","palette"];function HP(e,t){return e.indexOf(t)>-1}const GP={__init__:["disableModeling"],disableModeling:["type",ly]};function ec(e,t,n,i){this._eventBus=e,this._canvas=t,this._selection=n,this._contextPad=i,this._active=!1,e.on("import.parse.start",()=>{this._active&&(this.toggleMode(!1),e.once("import.done",()=>{this.toggleMode(!0)}))}),e.on("diagram.init",()=>{this._canvasParent=this._canvas.getContainer().parentNode,this._palette=we(".djs-palette",this._canvas.getContainer()),this._init()})}ec.prototype._init=function(){this._container=_e(`
    <div class="bts-toggle-mode">
      Token Simulation <span class="bts-toggle">${ny()}</span>
    </div>
  `),K.bind(this._container,"click",()=>this.toggleMode()),this._canvas.getContainer().appendChild(this._container)};ec.prototype.toggleMode=function(e=!this._active){if(e!==this._active){if(e)this._container.innerHTML=`Token Simulation <span class="bts-toggle">${qT()}</span>`,Z(this._canvasParent).add("simulation"),Z(this._palette).add("hidden");else{this._container.innerHTML=`Token Simulation <span class="bts-toggle">${ny()}</span>`,Z(this._canvasParent).remove("simulation"),Z(this._palette).remove("hidden");const t=this._selection.get();t.length===1&&this._contextPad.open(t[0])}this._eventBus.fire(et,{active:e}),this._active=e}};ec.$inject=["eventBus","canvas","selection","contextPad"];const zP={__init__:["toggleMode"],toggleMode:["type",ec]};function uy(e,t,n,i,r,o){var a=!1;r.register({toggleTokenSimulation:function(){t.toggleMode()}}),r.register({togglePauseTokenSimulation:function(){a&&n.toggle()}}),r.register({resetTokenSimulation:function(){a&&i.resetSimulation()}});const s=o.get("log",!1);s&&r.register({toggleTokenSimulationLog:function(){s.toggle()}}),e.on(et,c=>{a=c.active})}uy.$inject=["eventBus","toggleMode","pauseSimulation","resetSimulation","editorActions","injector"];const VP={__init__:["tokenSimulationEditorActions"],tokenSimulationEditorActions:["type",uy]},UP=1e4;function py(e,t){var n=t.get("editorActions",!1),i=t.get("keyboard",!1);if(!i||!n)return;var r=!1;function o(a){if(_a(["t","T"],a))return n.trigger("toggleTokenSimulation"),!0;if(r){if(_a(["l","L"],a))return n.trigger("toggleTokenSimulationLog"),!0;if(_a([" ","Spacebar"],a))return n.trigger("togglePauseTokenSimulation"),!0;if(_a(["r","R"],a))return n.trigger("resetTokenSimulation"),!0}}e.on("keyboard.init",function(){i.addListener(UP,function(a){var s=a.keyEvent;o(s)})}),e.on(et,function(a){var s=a.active;s?r=!0:r=!1})}py.$inject=["eventBus","injector"];function _a(e,t){return e.indexOf(t.key)>-1}const WP={__init__:["tokenSimulationKeyboardBindings"],tokenSimulationKeyboardBindings:["type",py]},YP={__depends__:[FP,GP,zP,VP,WP]};var fy={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,n,i,r){var o=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),s="function",c=Math.round,l=Math.abs,p=Date.now;function u(y,b,S){return setTimeout(_(y,S),b)}function f(y,b,S){return Array.isArray(y)?(d(y,S[b],S),!0):!1}function d(y,b,S){var M;if(y)if(y.forEach)y.forEach(b,S);else if(y.length!==r)for(M=0;M<y.length;)b.call(S,y[M],M,y),M++;else for(M in y)y.hasOwnProperty(M)&&b.call(S,y[M],M,y)}function h(y,b,S){var M="DEPRECATED METHOD: "+b+`
`+S+` AT 
`;return function(){var F=new Error("get-stack-trace"),W=F&&F.stack?F.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",me=t.console&&(t.console.warn||t.console.log);return me&&me.call(t.console,M,W),y.apply(this,arguments)}}var m;typeof Object.assign!="function"?m=function(b){if(b===r||b===null)throw new TypeError("Cannot convert undefined or null to object");for(var S=Object(b),M=1;M<arguments.length;M++){var F=arguments[M];if(F!==r&&F!==null)for(var W in F)F.hasOwnProperty(W)&&(S[W]=F[W])}return S}:m=Object.assign;var v=h(function(b,S,M){for(var F=Object.keys(S),W=0;W<F.length;)(!M||M&&b[F[W]]===r)&&(b[F[W]]=S[F[W]]),W++;return b},"extend","Use `assign`."),E=h(function(b,S){return v(b,S,!0)},"merge","Use `assign`.");function w(y,b,S){var M=b.prototype,F;F=y.prototype=Object.create(M),F.constructor=y,F._super=M,S&&m(F,S)}function _(y,b){return function(){return y.apply(b,arguments)}}function x(y,b){return typeof y==s?y.apply(b&&b[0]||r,b):y}function P(y,b){return y===r?b:y}function A(y,b,S){d(k(b),function(M){y.addEventListener(M,S,!1)})}function C(y,b,S){d(k(b),function(M){y.removeEventListener(M,S,!1)})}function I(y,b){for(;y;){if(y==b)return!0;y=y.parentNode}return!1}function T(y,b){return y.indexOf(b)>-1}function k(y){return y.trim().split(/\s+/g)}function B(y,b,S){if(y.indexOf&&!S)return y.indexOf(b);for(var M=0;M<y.length;){if(S&&y[M][S]==b||!S&&y[M]===b)return M;M++}return-1}function X(y){return Array.prototype.slice.call(y,0)}function Q(y,b,S){for(var M=[],F=[],W=0;W<y.length;){var me=y[W][b];B(F,me)<0&&M.push(y[W]),F[W]=me,W++}return M=M.sort(function(at,vt){return at[b]>vt[b]}),M}function Ie(y,b){for(var S,M,F=b[0].toUpperCase()+b.slice(1),W=0;W<o.length;){if(S=o[W],M=S?S+F:b,M in y)return M;W++}return r}var We=1;function Me(){return We++}function U(y){var b=y.ownerDocument||y;return b.defaultView||b.parentWindow||t}var ae=/mobile|tablet|ip(ad|hone|od)|android/i,fe="ontouchstart"in t,tt=Ie(t,"PointerEvent")!==r,xt=fe&&ae.test(navigator.userAgent),wt="touch",vn="pen",Ln="mouse",oe="kinect",j=25,Y=1,R=2,G=4,V=8,ce=1,J=2,ee=4,Pe=8,Be=16,ft=J|ee,en=Pe|Be,Fo=ft|en,Ye=["x","y"],jo=["clientX","clientY"];function Nt(y,b){var S=this;this.manager=y,this.callback=b,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(M){x(y.options.enable,[y])&&S.handler(M)},this.init()}Nt.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(U(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(U(this.element),this.evWin,this.domHandler)}};function yy(y){var b,S=y.options.inputClass;return S?b=S:tt?b=nc:xt?b=zo:fe?b=ic:b=Go,new b(y,_y)}function _y(y,b,S){var M=S.pointers.length,F=S.changedPointers.length,W=b&Y&&M-F===0,me=b&(G|V)&&M-F===0;S.isFirst=!!W,S.isFinal=!!me,W&&(y.session={}),S.eventType=b,by(y,S),y.emit("hammer.input",S),y.recognize(S),y.session.prevInput=S}function by(y,b){var S=y.session,M=b.pointers,F=M.length;S.firstInput||(S.firstInput=_p(b)),F>1&&!S.firstMultiple?S.firstMultiple=_p(b):F===1&&(S.firstMultiple=!1);var W=S.firstInput,me=S.firstMultiple,nt=me?me.center:W.center,at=b.center=bp(M);b.timeStamp=p(),b.deltaTime=b.timeStamp-W.timeStamp,b.angle=tc(nt,at),b.distance=Ho(nt,at),Ey(S,b),b.offsetDirection=xp(b.deltaX,b.deltaY);var vt=Ep(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=vt.x,b.overallVelocityY=vt.y,b.overallVelocity=l(vt.x)>l(vt.y)?vt.x:vt.y,b.scale=me?Sy(me.pointers,M):1,b.rotation=me?wy(me.pointers,M):0,b.maxPointers=S.prevInput?b.pointers.length>S.prevInput.maxPointers?b.pointers.length:S.prevInput.maxPointers:b.pointers.length,xy(S,b);var nn=y.element;I(b.srcEvent.target,nn)&&(nn=b.srcEvent.target),b.target=nn}function Ey(y,b){var S=b.center,M=y.offsetDelta||{},F=y.prevDelta||{},W=y.prevInput||{};(b.eventType===Y||W.eventType===G)&&(F=y.prevDelta={x:W.deltaX||0,y:W.deltaY||0},M=y.offsetDelta={x:S.x,y:S.y}),b.deltaX=F.x+(S.x-M.x),b.deltaY=F.y+(S.y-M.y)}function xy(y,b){var S=y.lastInterval||b,M=b.timeStamp-S.timeStamp,F,W,me,nt;if(b.eventType!=V&&(M>j||S.velocity===r)){var at=b.deltaX-S.deltaX,vt=b.deltaY-S.deltaY,nn=Ep(M,at,vt);W=nn.x,me=nn.y,F=l(nn.x)>l(nn.y)?nn.x:nn.y,nt=xp(at,vt),y.lastInterval=b}else F=S.velocity,W=S.velocityX,me=S.velocityY,nt=S.direction;b.velocity=F,b.velocityX=W,b.velocityY=me,b.direction=nt}function _p(y){for(var b=[],S=0;S<y.pointers.length;)b[S]={clientX:c(y.pointers[S].clientX),clientY:c(y.pointers[S].clientY)},S++;return{timeStamp:p(),pointers:b,center:bp(b),deltaX:y.deltaX,deltaY:y.deltaY}}function bp(y){var b=y.length;if(b===1)return{x:c(y[0].clientX),y:c(y[0].clientY)};for(var S=0,M=0,F=0;F<b;)S+=y[F].clientX,M+=y[F].clientY,F++;return{x:c(S/b),y:c(M/b)}}function Ep(y,b,S){return{x:b/y||0,y:S/y||0}}function xp(y,b){return y===b?ce:l(y)>=l(b)?y<0?J:ee:b<0?Pe:Be}function Ho(y,b,S){S||(S=Ye);var M=b[S[0]]-y[S[0]],F=b[S[1]]-y[S[1]];return Math.sqrt(M*M+F*F)}function tc(y,b,S){S||(S=Ye);var M=b[S[0]]-y[S[0]],F=b[S[1]]-y[S[1]];return Math.atan2(F,M)*180/Math.PI}function wy(y,b){return tc(b[1],b[0],jo)+tc(y[1],y[0],jo)}function Sy(y,b){return Ho(b[0],b[1],jo)/Ho(y[0],y[1],jo)}var Cy={mousedown:Y,mousemove:R,mouseup:G},Ty="mousedown",Py="mousemove mouseup";function Go(){this.evEl=Ty,this.evWin=Py,this.pressed=!1,Nt.apply(this,arguments)}w(Go,Nt,{handler:function(b){var S=Cy[b.type];S&Y&&b.button===0&&(this.pressed=!0),S&R&&b.which!==1&&(S=G),this.pressed&&(S&G&&(this.pressed=!1),this.callback(this.manager,S,{pointers:[b],changedPointers:[b],pointerType:Ln,srcEvent:b}))}});var Ry={pointerdown:Y,pointermove:R,pointerup:G,pointercancel:V,pointerout:V},Ay={2:wt,3:vn,4:Ln,5:oe},wp="pointerdown",Sp="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(wp="MSPointerDown",Sp="MSPointerMove MSPointerUp MSPointerCancel");function nc(){this.evEl=wp,this.evWin=Sp,Nt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}w(nc,Nt,{handler:function(b){var S=this.store,M=!1,F=b.type.toLowerCase().replace("ms",""),W=Ry[F],me=Ay[b.pointerType]||b.pointerType,nt=me==wt,at=B(S,b.pointerId,"pointerId");W&Y&&(b.button===0||nt)?at<0&&(S.push(b),at=S.length-1):W&(G|V)&&(M=!0),!(at<0)&&(S[at]=b,this.callback(this.manager,W,{pointers:S,changedPointers:[b],pointerType:me,srcEvent:b}),M&&S.splice(at,1))}});var Iy={touchstart:Y,touchmove:R,touchend:G,touchcancel:V},My="touchstart",Dy="touchstart touchmove touchend touchcancel";function Cp(){this.evTarget=My,this.evWin=Dy,this.started=!1,Nt.apply(this,arguments)}w(Cp,Nt,{handler:function(b){var S=Iy[b.type];if(S===Y&&(this.started=!0),!!this.started){var M=ky.call(this,b,S);S&(G|V)&&M[0].length-M[1].length===0&&(this.started=!1),this.callback(this.manager,S,{pointers:M[0],changedPointers:M[1],pointerType:wt,srcEvent:b})}}});function ky(y,b){var S=X(y.touches),M=X(y.changedTouches);return b&(G|V)&&(S=Q(S.concat(M),"identifier")),[S,M]}var Oy={touchstart:Y,touchmove:R,touchend:G,touchcancel:V},Ny="touchstart touchmove touchend touchcancel";function zo(){this.evTarget=Ny,this.targetIds={},Nt.apply(this,arguments)}w(zo,Nt,{handler:function(b){var S=Oy[b.type],M=Ly.call(this,b,S);M&&this.callback(this.manager,S,{pointers:M[0],changedPointers:M[1],pointerType:wt,srcEvent:b})}});function Ly(y,b){var S=X(y.touches),M=this.targetIds;if(b&(Y|R)&&S.length===1)return M[S[0].identifier]=!0,[S,S];var F,W,me=X(y.changedTouches),nt=[],at=this.target;if(W=S.filter(function(vt){return I(vt.target,at)}),b===Y)for(F=0;F<W.length;)M[W[F].identifier]=!0,F++;for(F=0;F<me.length;)M[me[F].identifier]&&nt.push(me[F]),b&(G|V)&&delete M[me[F].identifier],F++;if(nt.length)return[Q(W.concat(nt),"identifier"),nt]}var By=2500,Tp=25;function ic(){Nt.apply(this,arguments);var y=_(this.handler,this);this.touch=new zo(this.manager,y),this.mouse=new Go(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}w(ic,Nt,{handler:function(b,S,M){var F=M.pointerType==wt,W=M.pointerType==Ln;if(!(W&&M.sourceCapabilities&&M.sourceCapabilities.firesTouchEvents)){if(F)$y.call(this,S,M);else if(W&&Fy.call(this,M))return;this.callback(b,S,M)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $y(y,b){y&Y?(this.primaryTouch=b.changedPointers[0].identifier,Pp.call(this,b)):y&(G|V)&&Pp.call(this,b)}function Pp(y){var b=y.changedPointers[0];if(b.identifier===this.primaryTouch){var S={x:b.clientX,y:b.clientY};this.lastTouches.push(S);var M=this.lastTouches,F=function(){var W=M.indexOf(S);W>-1&&M.splice(W,1)};setTimeout(F,By)}}function Fy(y){for(var b=y.srcEvent.clientX,S=y.srcEvent.clientY,M=0;M<this.lastTouches.length;M++){var F=this.lastTouches[M],W=Math.abs(b-F.x),me=Math.abs(S-F.y);if(W<=Tp&&me<=Tp)return!0}return!1}var Rp=Ie(a.style,"touchAction"),Ap=Rp!==r,Ip="compute",Mp="auto",rc="manipulation",hi="none",wr="pan-x",Sr="pan-y",Vo=Hy();function oc(y,b){this.manager=y,this.set(b)}oc.prototype={set:function(y){y==Ip&&(y=this.compute()),Ap&&this.manager.element.style&&Vo[y]&&(this.manager.element.style[Rp]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return d(this.manager.recognizers,function(b){x(b.options.enable,[b])&&(y=y.concat(b.getTouchAction()))}),jy(y.join(" "))},preventDefaults:function(y){var b=y.srcEvent,S=y.offsetDirection;if(this.manager.session.prevented){b.preventDefault();return}var M=this.actions,F=T(M,hi)&&!Vo[hi],W=T(M,Sr)&&!Vo[Sr],me=T(M,wr)&&!Vo[wr];if(F){var nt=y.pointers.length===1,at=y.distance<2,vt=y.deltaTime<250;if(nt&&at&&vt)return}if(!(me&&W)&&(F||W&&S&ft||me&&S&en))return this.preventSrc(b)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function jy(y){if(T(y,hi))return hi;var b=T(y,wr),S=T(y,Sr);return b&&S?hi:b||S?b?wr:Sr:T(y,rc)?rc:Mp}function Hy(){if(!Ap)return!1;var y={},b=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(S){y[S]=b?t.CSS.supports("touch-action",S):!0}),y}var Uo=1,Lt=2,zi=4,Bn=8,gn=Bn,Cr=16,tn=32;function yn(y){this.options=m({},this.defaults,y||{}),this.id=Me(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=Uo,this.simultaneous={},this.requireFail=[]}yn.prototype={defaults:{},set:function(y){return m(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(f(y,"recognizeWith",this))return this;var b=this.simultaneous;return y=Wo(y,this),b[y.id]||(b[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return f(y,"dropRecognizeWith",this)?this:(y=Wo(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(f(y,"requireFailure",this))return this;var b=this.requireFail;return y=Wo(y,this),B(b,y)===-1&&(b.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(f(y,"dropRequireFailure",this))return this;y=Wo(y,this);var b=B(this.requireFail,y);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var b=this,S=this.state;function M(F){b.manager.emit(F,y)}S<Bn&&M(b.options.event+Dp(S)),M(b.options.event),y.additionalEvent&&M(y.additionalEvent),S>=Bn&&M(b.options.event+Dp(S))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=tn},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(tn|Uo)))return!1;y++}return!0},recognize:function(y){var b=m({},y);if(!x(this.options.enable,[this,b])){this.reset(),this.state=tn;return}this.state&(gn|Cr|tn)&&(this.state=Uo),this.state=this.process(b),this.state&(Lt|zi|Bn|Cr)&&this.tryEmit(b)},process:function(y){},getTouchAction:function(){},reset:function(){}};function Dp(y){return y&Cr?"cancel":y&Bn?"end":y&zi?"move":y&Lt?"start":""}function kp(y){return y==Be?"down":y==Pe?"up":y==J?"left":y==ee?"right":""}function Wo(y,b){var S=b.manager;return S?S.get(y):y}function Kt(){yn.apply(this,arguments)}w(Kt,yn,{defaults:{pointers:1},attrTest:function(y){var b=this.options.pointers;return b===0||y.pointers.length===b},process:function(y){var b=this.state,S=y.eventType,M=b&(Lt|zi),F=this.attrTest(y);return M&&(S&V||!F)?b|Cr:M||F?S&G?b|Bn:b&Lt?b|zi:Lt:tn}});function Yo(){Kt.apply(this,arguments),this.pX=null,this.pY=null}w(Yo,Kt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Fo},getTouchAction:function(){var y=this.options.direction,b=[];return y&ft&&b.push(Sr),y&en&&b.push(wr),b},directionTest:function(y){var b=this.options,S=!0,M=y.distance,F=y.direction,W=y.deltaX,me=y.deltaY;return F&b.direction||(b.direction&ft?(F=W===0?ce:W<0?J:ee,S=W!=this.pX,M=Math.abs(y.deltaX)):(F=me===0?ce:me<0?Pe:Be,S=me!=this.pY,M=Math.abs(y.deltaY))),y.direction=F,S&&M>b.threshold&&F&b.direction},attrTest:function(y){return Kt.prototype.attrTest.call(this,y)&&(this.state&Lt||!(this.state&Lt)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var b=kp(y.direction);b&&(y.additionalEvent=this.options.event+b),this._super.emit.call(this,y)}});function ac(){Kt.apply(this,arguments)}w(ac,Kt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&Lt)},emit:function(y){if(y.scale!==1){var b=y.scale<1?"in":"out";y.additionalEvent=this.options.event+b}this._super.emit.call(this,y)}});function sc(){yn.apply(this,arguments),this._timer=null,this._input=null}w(sc,yn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Mp]},process:function(y){var b=this.options,S=y.pointers.length===b.pointers,M=y.distance<b.threshold,F=y.deltaTime>b.time;if(this._input=y,!M||!S||y.eventType&(G|V)&&!F)this.reset();else if(y.eventType&Y)this.reset(),this._timer=u(function(){this.state=gn,this.tryEmit()},b.time,this);else if(y.eventType&G)return gn;return tn},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===gn&&(y&&y.eventType&G?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}});function cc(){Kt.apply(this,arguments)}w(cc,Kt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&Lt)}});function lc(){Kt.apply(this,arguments)}w(lc,Kt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ft|en,pointers:1},getTouchAction:function(){return Yo.prototype.getTouchAction.call(this)},attrTest:function(y){var b=this.options.direction,S;return b&(ft|en)?S=y.overallVelocity:b&ft?S=y.overallVelocityX:b&en&&(S=y.overallVelocityY),this._super.attrTest.call(this,y)&&b&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&l(S)>this.options.velocity&&y.eventType&G},emit:function(y){var b=kp(y.offsetDirection);b&&this.manager.emit(this.options.event+b,y),this.manager.emit(this.options.event,y)}});function qo(){yn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}w(qo,yn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[rc]},process:function(y){var b=this.options,S=y.pointers.length===b.pointers,M=y.distance<b.threshold,F=y.deltaTime<b.time;if(this.reset(),y.eventType&Y&&this.count===0)return this.failTimeout();if(M&&F&&S){if(y.eventType!=G)return this.failTimeout();var W=this.pTime?y.timeStamp-this.pTime<b.interval:!0,me=!this.pCenter||Ho(this.pCenter,y.center)<b.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!me||!W?this.count=1:this.count+=1,this._input=y;var nt=this.count%b.taps;if(nt===0)return this.hasRequireFailures()?(this._timer=u(function(){this.state=gn,this.tryEmit()},b.interval,this),Lt):gn}return tn},failTimeout:function(){return this._timer=u(function(){this.state=tn},this.options.interval,this),tn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==gn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function $n(y,b){return b=b||{},b.recognizers=P(b.recognizers,$n.defaults.preset),new uc(y,b)}$n.VERSION="2.0.7",$n.defaults={domEvents:!1,touchAction:Ip,enable:!0,inputTarget:null,inputClass:null,preset:[[cc,{enable:!1}],[ac,{enable:!1},["rotate"]],[lc,{direction:ft}],[Yo,{direction:ft},["swipe"]],[qo],[qo,{event:"doubletap",taps:2},["tap"]],[sc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Gy=1,Op=2;function uc(y,b){this.options=m({},$n.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=yy(this),this.touchAction=new oc(this,this.options.touchAction),Np(this,!0),d(this.options.recognizers,function(S){var M=this.add(new S[0](S[1]));S[2]&&M.recognizeWith(S[2]),S[3]&&M.requireFailure(S[3])},this)}uc.prototype={set:function(y){return m(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?Op:Gy},recognize:function(y){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(y);var S,M=this.recognizers,F=b.curRecognizer;(!F||F&&F.state&gn)&&(F=b.curRecognizer=null);for(var W=0;W<M.length;)S=M[W],b.stopped!==Op&&(!F||S==F||S.canRecognizeWith(F))?S.recognize(y):S.reset(),!F&&S.state&(Lt|zi|Bn)&&(F=b.curRecognizer=S),W++}},get:function(y){if(y instanceof yn)return y;for(var b=this.recognizers,S=0;S<b.length;S++)if(b[S].options.event==y)return b[S];return null},add:function(y){if(f(y,"add",this))return this;var b=this.get(y.options.event);return b&&this.remove(b),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(f(y,"remove",this))return this;if(y=this.get(y),y){var b=this.recognizers,S=B(b,y);S!==-1&&(b.splice(S,1),this.touchAction.update())}return this},on:function(y,b){if(y!==r&&b!==r){var S=this.handlers;return d(k(y),function(M){S[M]=S[M]||[],S[M].push(b)}),this}},off:function(y,b){if(y!==r){var S=this.handlers;return d(k(y),function(M){b?S[M]&&S[M].splice(B(S[M],b),1):delete S[M]}),this}},emit:function(y,b){this.options.domEvents&&zy(y,b);var S=this.handlers[y]&&this.handlers[y].slice();if(!(!S||!S.length)){b.type=y,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var M=0;M<S.length;)S[M](b),M++}},destroy:function(){this.element&&Np(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Np(y,b){var S=y.element;if(S.style){var M;d(y.options.cssProps,function(F,W){M=Ie(S.style,W),b?(y.oldCssProps[M]=S.style[M],S.style[M]=F):S.style[M]=y.oldCssProps[M]||""}),b||(y.oldCssProps={})}}function zy(y,b){var S=n.createEvent("Event");S.initEvent(y,!0,!0),S.gesture=b,b.target.dispatchEvent(S)}m($n,{INPUT_START:Y,INPUT_MOVE:R,INPUT_END:G,INPUT_CANCEL:V,STATE_POSSIBLE:Uo,STATE_BEGAN:Lt,STATE_CHANGED:zi,STATE_ENDED:Bn,STATE_RECOGNIZED:gn,STATE_CANCELLED:Cr,STATE_FAILED:tn,DIRECTION_NONE:ce,DIRECTION_LEFT:J,DIRECTION_RIGHT:ee,DIRECTION_UP:Pe,DIRECTION_DOWN:Be,DIRECTION_HORIZONTAL:ft,DIRECTION_VERTICAL:en,DIRECTION_ALL:Fo,Manager:uc,Input:Nt,TouchAction:oc,TouchInput:zo,MouseInput:Go,PointerEventInput:nc,TouchMouseInput:ic,SingleTouchInput:Cp,Recognizer:yn,AttrRecognizer:Kt,Tap:qo,Pan:Yo,Swipe:lc,Pinch:ac,Rotate:cc,Press:sc,on:A,off:C,each:d,merge:E,extend:v,assign:m,inherit:w,bindFn:_,prefixed:Ie});var Vy=typeof t!="undefined"?t:typeof self!="undefined"?self:{};Vy.Hammer=$n,e.exports?e.exports=$n:t[i]=$n})(window,document,"Hammer")})(fy);var qP=fy.exports;const bi=Wh(qP);var ba=50,wh={min:.2,max:4},KP=10,XP=.1,ZP=250;function Et(e,t,n,i,r){var o=this;this._canvas=i,this._elementRegistry=r,this._eventBus=n,this._injector=t,this._state={isOpen:void 0,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0},this._init();var a=new bi.Manager(document);a.add(new bi.Pan),a.on("panmove",u),a.on("panend",f);var s=new bi.Manager(this._svg);s.add(new bi.Pan),s.on("panstart",p(!0)),s.add(new bi.Tap),s.on("tap",function(d){l(wa(d))});var c=new bi.Manager(this._viewportDom);c.add(new bi.Pan),c.on("panstart",p(!1)),this.toggle(e&&e.open||!1);function l(d){(!o._state._svgClientRect||xa(o._state._svgClientRect))&&(o._state._svgClientRect=o._svg.getBoundingClientRect());var h=Ea({x:d.x-o._state._svgClientRect.left,y:d.y-o._state._svgClientRect.top},o._svg,o._lastViewbox);Nc(h,o._canvas),o._update()}function p(d){return function(m){var v=wa(m);(!o._state._svgClientRect||xa(o._state._svgClientRect))&&(o._state._svgClientRect=o._svg.getBoundingClientRect()),d&&l(v);var E=Ea({x:v.x-o._state._svgClientRect.left,y:v.y-o._state._svgClientRect.top},o._svg,o._lastViewbox),w=i.viewbox(),_=QP(E,w),x=o._viewportDom.getBoundingClientRect(),P={x:v.x-x.left+1,y:v.y-x.top+1};N(o._state,{cachedViewbox:w,initialDragPosition:{x:v.x,y:v.y},isDragging:!0,offsetViewport:_,offsetViewportDom:P,viewportClientRect:o._viewport.getBoundingClientRect(),parentClientRect:o._parent.getBoundingClientRect()}),K.bind(document,"mousemove",u),K.bind(document,"mouseup",f)}}function u(d){var h=wa(d);if(o._state.isDragging){(!o._state._svgClientRect||xa(o._state._svgClientRect))&&(o._state._svgClientRect=o._svg.getBoundingClientRect());var m=o._state.offsetViewportDom,v=o._state.viewportClientRect,E=o._state.parentClientRect;N(o._viewportDom.style,{top:h.y-m.y-E.top+"px",left:h.x-m.x-E.left+"px"});var w=dy(E,{top:h.y-m.y-E.top,left:h.x-m.x-E.left,width:v.width,height:v.height});N(o._overlay.style,{clipPath:w});var _=Ea({x:h.x-o._state._svgClientRect.left,y:h.y-o._state._svgClientRect.top},o._svg,o._lastViewbox);Nc({x:_.x-o._state.offsetViewport.x,y:_.y-o._state.offsetViewport.y},o._canvas)}}function f(d){var h=wa(d);o._state.isDragging&&(o._state.initialDragPosition.x===h.x&&o._state.initialDragPosition.y===h.y&&l(d),o._update(),N(o._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),K.unbind(document,"mousemove",u),K.unbind(document,"mouseup",f))}K.bind(this._viewportDom,"mousedown",p(!1)),K.bind(this._svg,"mousedown",p(!0)),K.bind(this._parent,"wheel",function(d){if(d.preventDefault(),d.stopPropagation(),!!d.ctrlKey&&((!o._state._svgClientRect||xa(o._state._svgClientRect))&&(o._state._svgClientRect=o._svg.getBoundingClientRect()),!!iR(d,o._state._svgClientRect))){var h=d.deltaMode===0?.02:.32,m=Math.sqrt(Math.pow(d.deltaY,2)+Math.pow(d.deltaX,2))*rR(d.deltaY)*-h;if(o._state.zoomDelta+=m,Math.abs(o._state.zoomDelta)>XP){var v=m>0?1:-1,E=Math.log(i.zoom())/Math.log(10),w=oR(wh,KP*2),_=Math.round(E/w)*w;_+=w*v;var x=Math.pow(10,_);i.zoom(aR(wh,x),P),o._state.zoomDelta=0;var P=Ea({x:d.clientX-o._state._svgClientRect.left,y:d.clientY-o._state._svgClientRect.top},o._svg,o._lastViewbox);Nc(P,o._canvas),o._update()}}}),K.bind(this._toggle,"click",function(d){d.preventDefault(),d.stopPropagation(),o.toggle()}),n.on(["shape.added","connection.added"],function(d){var h=d.element;o._addElement(h),o._update()}),n.on(["shape.removed","connection.removed"],function(d){var h=d.element;o._removeElement(h),o._update()}),n.on("elements.changed",ZP,function(d){var h=d.elements;h.forEach(function(m){o._updateElement(m)}),o._update()}),n.on("element.updateId",function(d){var h=d.element,m=d.newId;o._updateElementId(h,m)}),n.on("canvas.viewbox.changed",function(){o._state.isDragging||o._update()}),n.on("canvas.resized",function(){document.body.contains(o._parent)&&(o._state.isDragging||o._update(),o._state._svgClientRect=o._svg.getBoundingClientRect())}),n.on(["root.set","plane.set"],function(d){o._clear();var h=d.element||d.plane.rootElement;h.children.forEach(function(m){o._addElement(m)}),o._update()})}Et.$inject=["config.minimap","injector","eventBus","canvas","elementRegistry"];Et.prototype._init=function(){var e=this._canvas,t=e.getContainer(),n=this._parent=document.createElement("div");Z(n).add("djs-minimap"),t.appendChild(n);var i=this._toggle=document.createElement("div");Z(i).add("toggle"),n.appendChild(i);var r=this._map=document.createElement("div");Z(r).add("map"),n.appendChild(r);var o=this._svg=de("svg");ie(o,{width:"100%",height:"100%"}),ge(r,o);var a=this._elementsGroup=de("g");ge(o,a);var s=this._viewportGroup=de("g");ge(o,s);var c=this._viewport=de("rect");Ae(c).add("viewport"),ge(s,c),K.bind(n,"mousedown",function(u){u.stopPropagation()});var l=this._viewportDom=document.createElement("div");Z(l).add("viewport-dom"),this._parent.appendChild(l);var p=this._overlay=document.createElement("div");Z(p).add("overlay"),this._parent.appendChild(p)};Et.prototype._update=function(){var e=this._canvas.viewbox(),t=e.inner,n=e.outer;if(hy(e)){var i,r,o,a,s=n.width-t.width,c=n.height-t.height;t.width<n.width?(i=t.x-s/2,o=n.width,t.x+t.width<n.width&&(i=Math.min(0,t.x))):(i=t.x,o=t.width),t.height<n.height?(r=t.y-c/2,a=n.height,t.y+t.height<n.height&&(r=Math.min(0,t.y))):(r=t.y,a=t.height),i=i-ba,r=r-ba,o=o+ba*2,a=a+ba*2,this._lastViewbox={x:i,y:r,width:o,height:a},ie(this._svg,{viewBox:i+", "+r+", "+o+", "+a}),ie(this._viewport,{x:e.x,y:e.y,width:e.width,height:e.height});var l=this._state._parentClientRect=this._parent.getBoundingClientRect(),p=this._viewport.getBoundingClientRect(),u={top:p.top-l.top,left:p.left-l.left,width:p.width,height:p.height};N(this._viewportDom.style,{top:u.top+"px",left:u.left+"px",width:u.width+"px",height:u.height+"px"});var f=dy(l,u);N(this._overlay.style,{clipPath:f})}};Et.prototype.open=function(){N(this._state,{isOpen:!0}),Z(this._parent).add("open");var e=this._injector.get("translate",!1)||function(t){return t};ct(this._toggle,"title",e("Close minimap")),this._update(),this._eventBus.fire("minimap.toggle",{open:!0})};Et.prototype.close=function(){N(this._state,{isOpen:!1}),Z(this._parent).remove("open");var e=this._injector.get("translate",!1)||function(t){return t};ct(this._toggle,"title",e("Open minimap")),this._eventBus.fire("minimap.toggle",{open:!1})};Et.prototype.toggle=function(e){var t=this.isOpen();typeof e=="undefined"&&(e=!t),e!=t&&(e?this.open():this.close())};Et.prototype.isOpen=function(){return this._state.isOpen};Et.prototype._updateElement=function(e){try{e.parent!==void 0&&e.parent!==null&&(this._removeElement(e),this._addElement(e))}catch(t){console.warn("Minimap#_updateElement errored",t)}};Et.prototype._updateElementId=function(e,t){try{var n=we("#"+Ai(e.id),this._elementsGroup);n&&(n.id=t)}catch(i){console.warn("Minimap#_updateElementId errored",i)}};Et.prototype.isOnActivePlane=function(e){var t=this._canvas;return t.findRoot?t.findRoot(e)===t.getRootElement():t.findPlane?t.findPlane(e)===t.getActivePlane():!0};Et.prototype._addElement=function(e){var t=this;if(this._removeElement(e),!!this.isOnActivePlane(e)){var n,i,r,o=this._createElement(e),a=we("#"+Ai(e.parent.id),this._elementsGroup);if(o){var s=this._elementRegistry.getGraphics(e),c=this._elementRegistry.getGraphics(e.parent),l=tR(s,c);return l!=="undefined"?a?a.childNodes.length>l?Ch(o,a,l):Ch(o,a,a.childNodes.length-1):this._elementsGroup.appendChild(o):this._elementsGroup.appendChild(o),JP(e)?(n=e.parent,i=0,r=0,typeof n.x!="undefined"&&typeof n.y!="undefined"&&(i=-n.x,r=-n.y),ie(o,{transform:"translate("+i+" "+r+")"})):(i=e.x,r=e.y,a&&(n=e.parent,i-=n.x,r-=n.y),ie(o,{transform:"translate("+i+" "+r+")"})),e.children&&e.children.length&&e.children.forEach(function(p){t._addElement(p)}),o}}};Et.prototype._removeElement=function(e){var t=this._svg.getElementById(e.id);t&&Qe(t)};Et.prototype._createElement=function(e){var t=this._elementRegistry.getGraphics(e),n;if(t&&(n=Ti(t),n)){var i=Pl(n);return ie(i,{id:e.id}),i}};Et.prototype._clear=function(){Za(this._elementsGroup)};function JP(e){return e.waypoints}function QP(e,t){var n={x:t.x+t.width/2,y:t.y+t.height/2};return{x:e.x-n.x,y:e.y-n.y}}function Ea(e,t,n){var i=t.getBoundingClientRect(),r=eR(n,i.width/i.height),o=Sh(e.x,0,i.width,r.x,r.x+r.width),a=Sh(e.y,0,i.height,r.y,r.y+r.height);return{x:o,y:a}}function Nc(e,t){var n=t.viewbox(),i=n.width,r=n.height;t.viewbox({x:e.x-i/2,y:e.y-r/2,width:i,height:r})}function eR(e,t){var n=e.width/e.height,i=N({},{x:e.x,y:e.y,width:e.width,height:e.height});if(n>t){var r=i.width*(1/t),o=i.y-(r-i.height)/2;N(i,{y:o,height:r})}else if(n<t){var a=i.height*t,s=i.x-(a-i.width)/2;N(i,{x:s,width:a})}return i}function Sh(e,t,n,i,r){var o=n-t,a=r-i;return(e-t)*a/o+i}function tR(e,t){var n=we(".djs-children",t.parentNode);if(n){var i=[].slice.call(n.childNodes),r=-1;return i.forEach(function(o,a){we(".djs-element",o)===e&&(r=a)}),r}}function Ch(e,t,n){var i=nR(t),r=[].slice.call(i.childNodes),o=r[n];o?t.insertBefore(e,o.nextSibling):t.appendChild(e)}function nR(e){var t=we(".children",e);return t||(t=de("g",{class:"children"}),ge(e,t)),t}function xa(e){return e.width===0&&e.height===0}function iR(e,t){return e.x>t.left&&e.x<t.left+t.width&&e.y>t.top&&e.y<t.top+t.height}var rR=Math.sign||function(e){return e>=0?1:-1};function oR(e,t){var n=Math.log(e.min)/Math.log(10),i=Math.log(e.max)/Math.log(10),r=Math.abs(n)+Math.abs(i);return r/t}function aR(e,t){return Math.max(e.min,Math.min(e.max,t))}function dy(e,t){var n=[rn(t.left,t.top),rn(t.left+t.width,t.top),rn(t.left+t.width,t.top+t.height),rn(t.left,t.top+t.height),rn(t.left,e.height),rn(e.width,e.height),rn(e.width,0),rn(0,0),rn(0,e.height),rn(t.left,e.height)].join(", ");return"polygon("+n+")"}function rn(e,t){return e+"px "+t+"px"}function hy(e){return Qr(e,function(t){return fn(t)?hy(t):ue(t)&&isFinite(t)})}function wa(e){return e.center?e.center:{x:e.clientX,y:e.clientY}}var sR={__init__:["minimap"],minimap:["type",Et]};const cR=[{__init__:["customPaletteProvider","customContextPadProvider","customRenderer"],customPaletteProvider:["type",Tg],customRenderer:["type",Pg],customContextPadProvider:["type",LC]},kC,YP,sR],lR=cR,uR={name:"Flowable",uri:"http://flowable.org/bpmn",prefix:"flowable",xml:{tagAlias:"lowerCase"},associations:[],types:[{name:"flowable:extCandidateUsers",isAbstract:!0,extends:[],superClass:["Element"],meta:{allowedIn:["*"]},properties:[{name:"body",type:"String",isBody:!0}]},{name:"flowable:extAssignee",isAbstract:!0,extends:[],superClass:["Element"],meta:{allowedIn:["*"]},properties:[{name:"body",type:"String",isBody:!0}]},{name:"flowable:property",superClass:["Element"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"name",isAttr:!0,type:"String"},{name:"value",isAttr:!0,type:"String"}]},{name:"flowable:properties",isAbstract:!0,extends:[],superClass:["Element"],meta:{allowedIn:["*"]},properties:[{name:"values",type:"flowable:property",isMany:!0}]},{name:"InOutBinding",superClass:["Element"],isAbstract:!0,properties:[{name:"source",isAttr:!0,type:"String"},{name:"sourceExpression",isAttr:!0,type:"String"},{name:"target",isAttr:!0,type:"String"},{name:"businessKey",isAttr:!0,type:"String"},{name:"local",isAttr:!0,type:"Boolean",default:!1},{name:"variables",isAttr:!0,type:"String"}]},{name:"In",superClass:["InOutBinding"],meta:{allowedIn:["bpmn:CallActivity"]}},{name:"Out",superClass:["InOutBinding"],meta:{allowedIn:["bpmn:CallActivity"]}},{name:"AsyncCapable",isAbstract:!0,extends:["bpmn:Activity","bpmn:Gateway","bpmn:Event"],properties:[{name:"async",isAttr:!0,type:"Boolean",default:!1},{name:"asyncBefore",isAttr:!0,type:"Boolean",default:!1},{name:"asyncAfter",isAttr:!0,type:"Boolean",default:!1},{name:"exclusive",isAttr:!0,type:"Boolean",default:!0}]},{name:"flowable:in",superClass:["Element"],properties:[{name:"source",type:"string",isAttr:!0},{name:"target",type:"string",isAttr:!0}]},{name:"flowable:out",superClass:["Element"],properties:[{name:"source",type:"string",isAttr:!0},{name:"target",type:"string",isAttr:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity",default:!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"JobPriorized",isAbstract:!0,extends:["bpmn:Process","flowable:AsyncCapable"],properties:[{name:"jobPriority",isAttr:!0,type:"String"}]},{name:"SignalEventDefinition",isAbstract:!0,extends:["bpmn:SignalEventDefinition"],properties:[{name:"async",isAttr:!0,type:"Boolean",default:!1}]},{name:"ErrorEventDefinition",isAbstract:!0,extends:["bpmn:ErrorEventDefinition"],properties:[{name:"errorCodeVariable",isAttr:!0,type:"String"},{name:"errorMessageVariable",isAttr:!0,type:"String"}]},{name:"Error",isAbstract:!0,extends:["bpmn:Error"],properties:[{name:"flowable:errorMessage",isAttr:!0,type:"String"}]},{name:"PotentialStarter",superClass:["Element"],properties:[{name:"resourceAssignmentExpression",type:"bpmn:ResourceAssignmentExpression"}]},{name:"UserTask",isAbstract:!0,extends:["bpmn:UserTask"],properties:[{name:"timerEventDefinition",type:"Expression"},{name:"multiInstanceLoopCharacteristics",type:"MultiInstanceLoopCharacteristics"}]},{name:"StartEvent",isAbstract:!0,extends:["bpmn:StartEvent"],properties:[{name:"timerEventDefinition",type:"Expression"}]},{name:"FormSupported",isAbstract:!0,extends:["bpmn:StartEvent","bpmn:UserTask"],properties:[{name:"formHandlerClass",isAttr:!0,type:"String"},{name:"formKey",isAttr:!0,type:"String"}]},{name:"TemplateSupported",isAbstract:!0,extends:["bpmn:Process","bpmn:FlowElement"],properties:[{name:"modelerTemplate",isAttr:!0,type:"String"}]},{name:"Initiator",isAbstract:!0,extends:["bpmn:StartEvent"],properties:[{name:"initiator",isAttr:!0,type:"String"}]},{name:"ScriptTask",isAbstract:!0,extends:["bpmn:ScriptTask"],properties:[{name:"resultVariable",isAttr:!0,type:"String"},{name:"resource",isAttr:!0,type:"String"}]},{name:"Process",isAbstract:!0,extends:["bpmn:Process"],properties:[{name:"candidateStarterGroups",isAttr:!0,type:"String"},{name:"candidateStarterUsers",isAttr:!0,type:"String"},{name:"versionTag",isAttr:!0,type:"String"},{name:"historyTimeToLive",isAttr:!0,type:"String"},{name:"isStartableInTasklist",isAttr:!0,type:"Boolean",default:!0}]},{name:"EscalationEventDefinition",isAbstract:!0,extends:["bpmn:EscalationEventDefinition"],properties:[{name:"escalationCodeVariable",isAttr:!0,type:"String"}]},{name:"FormalExpression",isAbstract:!0,extends:["bpmn:FormalExpression"],properties:[{name:"resource",isAttr:!0,type:"String"}]},{name:"Assignable",extends:["bpmn:UserTask"],properties:[{name:"candidateGroups",isAttr:!0,type:"String"},{name:"dueDate",isAttr:!0,type:"String"},{name:"followUpDate",isAttr:!0,type:"String"},{name:"priority",isAttr:!0,type:"String"}]},{name:"CallActivity",extends:["bpmn:CallActivity"],properties:[{name:"calledElementBinding",isAttr:!0,type:"String",default:"latest"},{name:"calledElementVersion",isAttr:!0,type:"String"},{name:"calledElementVersionTag",isAttr:!0,type:"String"},{name:"calledElementTenantId",isAttr:!0,type:"String"},{name:"caseRef",isAttr:!0,type:"String"},{name:"caseBinding",isAttr:!0,type:"String",default:"latest"},{name:"caseVersion",isAttr:!0,type:"String"},{name:"caseTenantId",isAttr:!0,type:"String"},{name:"variableMappingClass",isAttr:!0,type:"String"},{name:"variableMappingDelegateExpression",isAttr:!0,type:"String"}]},{name:"ServiceTaskLike",extends:["bpmn:ServiceTask","bpmn:BusinessRuleTask","bpmn:SendTask","bpmn:MessageEventDefinition"],properties:[{name:"expression",isAttr:!0,type:"String"},{name:"class",isAttr:!0,type:"String"},{name:"delegateExpression",isAttr:!0,type:"String"},{name:"resultVariable",isAttr:!0,type:"String"}]},{name:"ExclusiveGateway",isAbstract:!0,extends:["bpmn:ExclusiveGateway"],properties:[{name:"serviceClass",isAttr:!0,type:"String"}]},{name:"DmnCapable",extends:["bpmn:BusinessRuleTask"],properties:[{name:"decisionRef",isAttr:!0,type:"String"},{name:"decisionRefBinding",isAttr:!0,type:"String",default:"latest"},{name:"decisionRefVersion",isAttr:!0,type:"String"},{name:"mapDecisionResult",isAttr:!0,type:"String",default:"resultList"},{name:"decisionRefTenantId",isAttr:!0,type:"String"}]},{name:"ExternalCapable",extends:["flowable:ServiceTaskLike"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"topic",isAttr:!0,type:"String"}]},{name:"TaskPriorized",extends:["bpmn:Process","flowable:ExternalCapable"],properties:[{name:"taskPriority",isAttr:!0,type:"String"}]},{name:"Properties",superClass:["Element"],meta:{allowedIn:["*"]},properties:[{name:"values",type:"Property",isMany:!0}]},{name:"Property",superClass:["Element"],properties:[{name:"id",type:"String",isAttr:!0},{name:"name",type:"String",isAttr:!0},{name:"value",type:"String",isAttr:!0}]},{name:"Connector",superClass:["Element"],meta:{allowedIn:["flowable:ServiceTaskLike"]},properties:[{name:"inputOutput",type:"InputOutput"},{name:"connectorId",type:"String"}]},{name:"InputOutput",superClass:["Element"],meta:{allowedIn:["bpmn:FlowNode","flowable:Connector"]},properties:[{name:"inputOutput",type:"InputOutput"},{name:"connectorId",type:"String"},{name:"inputParameters",isMany:!0,type:"InputParameter"},{name:"outputParameters",isMany:!0,type:"OutputParameter"}]},{name:"InputOutputParameter",properties:[{name:"name",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"},{name:"definition",type:"InputOutputParameterDefinition"}]},{name:"InputOutputParameterDefinition",isAbstract:!0},{name:"List",superClass:["InputOutputParameterDefinition"],properties:[{name:"items",isMany:!0,type:"InputOutputParameterDefinition"}]},{name:"Map",superClass:["InputOutputParameterDefinition"],properties:[{name:"entries",isMany:!0,type:"Entry"}]},{name:"Entry",properties:[{name:"key",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"},{name:"definition",type:"InputOutputParameterDefinition"}]},{name:"Value",superClass:["InputOutputParameterDefinition"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"name",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"}]},{name:"Script",superClass:["InputOutputParameterDefinition"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"resource",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"}]},{name:"Field",superClass:["Element"],meta:{allowedIn:["flowable:ServiceTaskLike","flowable:ExecutionListener","flowable:TaskListener"]},properties:[{name:"name",isAttr:!0,type:"String"},{name:"expression",isAttr:!0,type:"expression"},{name:"string",type:"string"},{name:"stringValue",isAttr:!0,type:"String"}]},{name:"string",superClass:["Element"],meta:{allowedIn:["flowable:Field"]},properties:[{name:"body",isBody:!0,type:"String"}]},{name:"expression",superClass:["Element"],meta:{allowedIn:["flowable:Field"]},properties:[{name:"body",isBody:!0,type:"String"}]},{name:"InputParameter",superClass:["InputOutputParameter"]},{name:"OutputParameter",superClass:["InputOutputParameter"]},{name:"Collectable",isAbstract:!0,extends:["bpmn:MultiInstanceLoopCharacteristics"],superClass:["flowable:AsyncCapable"],properties:[{name:"collection",isAttr:!0,type:"String"},{name:"elementVariable",isAttr:!0,type:"String"}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression"},{name:"sourceRef",type:"FlowNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",isAttr:!0,isReference:!0}]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential",default:!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior",default:"All",isAttr:!0},{name:"loopCardinality",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopDataInputRef",type:"ItemAwareElement",isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",isReference:!0},{name:"inputDataItem",type:"DataInput",xml:{serialize:"property"}},{name:"outputDataItem",type:"DataOutput",xml:{serialize:"property"}},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",isMany:!0},{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"oneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0}]},{name:"FailedJobRetryTimeCycle",superClass:["Element"],meta:{allowedIn:["flowable:AsyncCapable","bpmn:MultiInstanceLoopCharacteristics"]},properties:[{name:"body",isBody:!0,type:"String"}]},{name:"ExecutionListener",superClass:["Element"],meta:{allowedIn:["bpmn:Task","bpmn:ServiceTask","bpmn:UserTask","bpmn:BusinessRuleTask","bpmn:ScriptTask","bpmn:ReceiveTask","bpmn:ManualTask","bpmn:ExclusiveGateway","bpmn:SequenceFlow","bpmn:ParallelGateway","bpmn:InclusiveGateway","bpmn:EventBasedGateway","bpmn:StartEvent","bpmn:IntermediateCatchEvent","bpmn:IntermediateThrowEvent","bpmn:EndEvent","bpmn:BoundaryEvent","bpmn:CallActivity","bpmn:SubProcess","bpmn:Process"]},properties:[{name:"expression",isAttr:!0,type:"String"},{name:"class",isAttr:!0,type:"String"},{name:"delegateExpression",isAttr:!0,type:"String"},{name:"event",isAttr:!0,type:"String"},{name:"script",type:"Script"},{name:"fields",type:"Field",isMany:!0}]},{name:"TaskListener",superClass:["Element"],meta:{allowedIn:["bpmn:UserTask"]},properties:[{name:"expression",isAttr:!0,type:"String"},{name:"class",isAttr:!0,type:"String"},{name:"delegateExpression",isAttr:!0,type:"String"},{name:"event",isAttr:!0,type:"String"},{name:"script",type:"Script"},{name:"fields",type:"Field",isMany:!0}]},{name:"FormProperty",superClass:["Element"],meta:{allowedIn:["bpmn:StartEvent","bpmn:UserTask"]},properties:[{name:"id",type:"String",isAttr:!0},{name:"name",type:"String",isAttr:!0},{name:"type",type:"String",isAttr:!0},{name:"required",type:"String",isAttr:!0},{name:"readable",type:"String",isAttr:!0},{name:"writable",type:"String",isAttr:!0},{name:"variable",type:"String",isAttr:!0},{name:"expression",type:"String",isAttr:!0},{name:"datePattern",type:"String",isAttr:!0},{name:"default",type:"String",isAttr:!0},{name:"values",type:"Value",isMany:!0}]},{name:"FormData",superClass:["Element"],meta:{allowedIn:["bpmn:StartEvent","bpmn:UserTask"]},properties:[{name:"fields",type:"FormField",isMany:!0},{name:"businessKey",type:"String",isAttr:!0}]},{name:"FormField",superClass:["Element"],properties:[{name:"id",type:"String",isAttr:!0},{name:"label",type:"String",isAttr:!0},{name:"type",type:"String",isAttr:!0},{name:"datePattern",type:"String",isAttr:!0},{name:"defaultValue",type:"String",isAttr:!0},{name:"properties",type:"Properties"},{name:"validation",type:"Validation"},{name:"values",type:"Value",isMany:!0}]},{name:"Validation",superClass:["Element"],properties:[{name:"constraints",type:"Constraint",isMany:!0}]},{name:"Constraint",superClass:["Element"],properties:[{name:"name",type:"String",isAttr:!0},{name:"config",type:"String",isAttr:!0}]},{name:"ConditionalEventDefinition",isAbstract:!0,extends:["bpmn:ConditionalEventDefinition"],properties:[{name:"variableName",isAttr:!0,type:"String"},{name:"variableEvent",isAttr:!0,type:"String"}]}],emumerations:[]};function Th(){return`Process_${Math.random().toString(36).slice(2,12)}`}const Ph=`<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" targetNamespace="http://www.flowable.org/processdef">
  <process id="process_${Th()}" name="name_${Th()}">
    <startEvent id="startNode1" name="开始" />
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_flow">
    <bpmndi:BPMNPlane id="BPMNPlane_flow" bpmnElement="T-2d89e7a3-ba79-4abd-9f64-ea59621c258c">
      <bpmndi:BPMNShape id="BPMNShape_startNode1" bpmnElement="startNode1" bioc:stroke="">
        <omgdc:Bounds x="240" y="200" width="30" height="30" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="242" y="237" width="23" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>`,pR=["innerHTML"],fR=Ct({__name:"PreviewModal",setup(e){const t=Ee("xml"),n=Ee(""),[i,{closeModal:r}]=Ml(a=>{console.log(a),t.value=a.type,n.value=a.content});function o(){t.value="xml",n.value="",r()}return(a,s)=>(xe(),Ze(O(Dl),Vr(a.$attrs,{title:"预览",width:800,showCancelBtn:!1,showOkBtn:!1,onRegister:O(i),onCancel:o}),{default:$(()=>[t.value==="xml"?(xe(),Ze(O(H_),{key:0,value:n.value,"read-only":"",mode:O(G_).XML},null,8,["value","mode"])):gt("",!0),lt("div",null,[t.value==="svg"?(xe(),Mt("svg",{key:0,class:"w-full h-100vh",innerHTML:n.value},null,8,pR)):gt("",!0)])]),_:1},16,["onRegister"]))}});var Zi=(e=>(e.USER="user",e.CANDIDATE="candidate",e.YOURSELF="yourself",e.SPECIFY="specify",e))(Zi||{}),my=(e=>(e.SPECIFY_MULTIPLE="specifyMultiple",e.SPECIFY_SINGLE="specifySingle",e))(my||{}),on=(e=>(e.SERIAL="serial",e.PARALLEL="parallel",e.NONE="none",e))(on||{});const dR={"bpmn:EndEvent":{},"bpmn:StartEvent":{initiator:!0,formKey:!0},"bpmn:UserTask":{allocationType:!0,specifyDesc:!0,multipleUserAuditType:!0,async:!0,priority:!0,skipExpression:!0,dueDate:!0,taskListener:!0,executionListener:!0},"bpmn:ServiceTask":{async:!0,skipExpression:!0,isForCompensation:!0,triggerable:!0,class:!0},"bpmn:ScriptTask":{async:!0,isForCompensation:!0,autoStoreVariables:!0},"bpmn:ManualTask":{async:!0,isForCompensation:!0},"bpmn:ReceiveTask":{async:!0,isForCompensation:!0},"bpmn:SendTask":{async:!0,isForCompensation:!0},"bpmn:BusinessRuleTask":{async:!0,isForCompensation:!0,ruleVariablesInput:!0,rules:!0,resultVariable:!0,exclude:!0}},Gi=e=>{const{element:t}=e,{getModeling:n,getModdle:i}=Kn(),r=n(),o=i(),a=sn(()=>{const E=t.businessObject;return E.eventDefinitions?E.eventDefinitions[0].$type:E.$type}),s=sn(()=>dR[a.value]||{}),c=(E,w,_)=>{const x=o==null?void 0:o.create(E,w);return _&&x&&(x.$parent=_),x},l=(E=!0)=>{let w=t.businessObject.get("extensionElements");return!w&&E&&(w=c("bpmn:ExtensionElements",{values:[]},t.businessObject),r==null||r.updateModdleProperties(t,t.businessObject,{extensionElements:w})),w},p=E=>{E||(E=l());let w=E.values.find(_=>_.$type==="flowable:properties");return w||(w=c("flowable:properties",{values:[]},E),r==null||r.updateModdleProperties(t,E,{values:[...E.get("values"),w]})),w},u=E=>{r==null||r.updateProperties(t,E)};return{elementType:a,showConfig:s,updateProperties:u,updateProperty:(E,w)=>{const _=p();let x=_.values.find(P=>P.name===E);return x?(x.name=E,x.value=w):(x=c("flowable:property",{name:E,value:w},_),r==null||r.updateModdleProperties(t,_,{values:[..._.get("values"),x]})),x},updateModdleProperties:(E,w)=>{r==null||r.updateModdleProperties(t,E,w)},createModdleElement:c,idChange:E=>{var _;const w=(_=E.target)==null?void 0:_.value;w&&u({id:w})},nameChange:E=>{var _;const w=(_=E.target)==null?void 0:_.value;w&&u({name:w})},formKeyChange:E=>{u({formKey:E})},getExtensionElements:l,getPropertiesElements:p}},Bo=e=>{const{element:t}=e;return{parseData:()=>{const i=re(re({},t.businessObject),t.businessObject.$attrs);for(const r in i)if(r.indexOf("flowable:")===0){const o=r.replace("flowable:","");i[o]=i[r],delete i[r]}return re({},i)}}},hR=Ct({name:"RoleSelectModal",__name:"RoleSelectModal",emits:["register","selectDone"],setup(e,{emit:t}){const n=t,i=Ee(),r=Ee([]),o=Ee([]),a=Ee({width:"250px",height:"300px"}),[s,{modalLoading:c,closeModal:l}]=Ml(p);function p(d){return it(this,arguments,function*({roleIds:f}){if(c(!0),f){const m=f.split(",").map(String);o.value=m}const h=yield V_();i.value=h.map(m=>({key:String(m.roleId),title:m.roleName})),c(!1)})}function u(){n("selectDone",o.value),l()}return(f,d)=>(xe(),Ze(O(Dl),Vr(f.$attrs,{title:"选择组",canFullscreen:!1,width:600,onOk:u,onRegister:O(s)}),{default:$(()=>[L(O(O_),{"target-keys":o.value,"onUpdate:targetKeys":d[0]||(d[0]=h=>o.value=h),"selected-keys":r.value,"onUpdate:selectedKeys":d[1]||(d[1]=h=>r.value=h),titles:["列表","已选中"],operations:["选中","取消"],"data-source":i.value,render:h=>h.title,"list-style":a.value,"show-search":""},null,8,["target-keys","selected-keys","data-source","render","list-style"])]),_:1},16,["onRegister"]))}}),El=[{label:"Java类",value:"class",placeholder:"填写全限定Java类名, 如: com.a.Test",rules:[{required:!0,message:"输入正确的Java类名",trigger:["change","blur"],pattern:/^([a-zA-Z_$][a-zA-Z\d_$]*\.)*[a-zA-Z_$][a-zA-Z\d_$]*$/}]},{label:"表达式",value:"expression",placeholder:"如: ${beanClass.doSomething(execution)}",rules:[{required:!0,message:"输入正确的表达式",trigger:["change","blur"],pattern:/\$\{\S+\.\S+(\(\S+\))?}/}]},{label:"委托表达式",value:"delegateExpression",placeholder:"如: ${beanClass}",rules:[{required:!0,message:"输入正确的委托表达式",trigger:["change","blur"],pattern:/\$\{\S+\}/}]}],yp=[{label:"开始事件",value:"start"},{label:"结束事件",value:"end"},{label:"启用事件",value:"take"}],mR=[{label:"创建",value:"create"},{label:"指派",value:"assignment"},{label:"完成",value:"complete"},{label:"删除",value:"delete"}],Rh=[{label:"字符串",value:"stringValue"},{label:"表达式",value:"expression"}],vR=[{label:"事件",field:"event",component:"Select",required:!0,componentProps:{allowClear:!1,options:yp}},{label:"类型",field:"type",required:!0,component:"Select",componentProps({formActionType:e}){const{updateSchema:t,clearValidate:n}=e;return{allowClear:!1,options:El,onSelect:i=>it(this,null,function*(){const r=El.find(o=>o.value===i);r&&(yield n(),yield t({field:"className",label:r.label,rules:r.rules,componentProps:{placeholder:r.placeholder}}))})}}},{label:"表达式",field:"className",component:"Input",show({model:e}){return!!e.type}}],gR={type:[{required:!0,message:"请选择"}],name:[{required:!0,message:"请输入"}],value:[{required:!0,message:"请输入"}]},yR=[{type:"checkbox",align:"center",width:60},{title:"类型",field:"type",align:"center",slots:{default:({row:e})=>{const t=Rh.find(n=>n.value===e.type);return t?t.label:e.type},edit:({row:e})=>L(zc,{value:e.type,"onUpdate:value":t=>e.type=t,options:Rh,placeholder:"选择类型"},null)},editRender:{}},{title:"名称",field:"name",align:"center",slots:{edit:({row:e})=>L(Je,{value:e.name,"onUpdate:value":t=>e.name=t,placeholder:"输入名称"},null)},editRender:{}},{title:"值",field:"value",align:"center",slots:{edit:({row:e})=>L(Je,{value:e.value,"onUpdate:value":t=>e.value=t,placeholder:"输入值"},null)},editRender:{}},{title:"操作",align:"center",slots:{default:({$table:e,row:t})=>{function n(){e.remove(t)}return L(cn("a-button"),{danger:!0,size:"small",onClick:n},{default:()=>[st("删除")]})}}}],_R={class:"w-full px-6 mb-16px flex gap-8px"},bR=Ct({name:"ListenerModal",__name:"ListenerModal",props:{type:{type:String,default:"executionListener"}},emits:["register","add","edit"],setup(e,{emit:t}){const n=e,i=t,r=Ee(""),[o,{closeModal:a}]=Ml(_=>it(this,null,function*(){s();const{isEdit:x,record:P}=_;if(x&&P){const A=N_(P,["params","key"]);yield l(A);const C=P.params;d.value&&(h.data=C),r.value=P.key}f({field:"event",componentProps:{options:n.type==="executionListener"?yp:mR}})}));function s(){return it(this,null,function*(){yield u(),r.value="",h.data=[]})}const[c,{setFieldsValue:l,validate:p,resetForm:u,updateSchema:f}]=U_({name:"listener_form",labelWidth:100,showActionButtonGroup:!1,baseColProps:{span:24},schemas:vR}),d=Ee(),h=S_({id:"VxeTable",keepSource:!0,border:!0,editConfig:{trigger:"click",mode:"row",showStatus:!0},columns:yR,toolbarConfig:{enabled:!1},columnConfig:{resizable:!0},data:[],proxyConfig:{enabled:!1},editRules:gR});function m(){return it(this,null,function*(){const _=d.value;if(_){const x={type:"",name:"",value:""},{row:P}=yield _.insertAt(x,-1);yield _.setEditCell(P,"name")}})}function v(){const _=d.value;_&&_.removeCheckboxRow()}function E(){return it(this,null,function*(){const _=d.value;if(!_)return;if(yield _.validate())return Promise.reject(new Error("编辑表格校验失败"));const P=_.getTableData();return Promise.resolve(L_(P.fullData))})}function w(){return it(this,null,function*(){try{const _=yield p(),x=yield E(),P=Re(re({},_),{params:x});O(r)?i("edit",P,O(r)):i("add",P),a()}catch(_){console.warn(_)}})}return(_,x)=>{const P=cn("a-button");return xe(),Ze(O(Dl),Vr(_.$attrs,{title:"监听器",width:700,onRegister:O(o),onOk:w}),{default:$(()=>[L(O(W_),{onRegister:O(c)},null,8,["onRegister"]),lt("div",_R,[L(P,{onClick:m},{default:$(()=>[st("新增")]),_:1}),L(P,{onClick:v},{default:$(()=>[st("选中删除")]),_:1})]),L(O(Y_),Vr({ref_key:"tableRef",ref:d},h),null,16)]),_:1},16,["onRegister"])}}}),vy=Ah(bR,[["__scopeId","data-v-a064e3f4"]]),gy=[{dataIndex:"event",title:"事件",width:80,customRender({value:e}){const t=yp.find(n=>n.value===e);return t?t.label:e}},{dataIndex:"type",title:"类型",width:100,customRender({value:e}){const t=El.find(n=>n.value===e);return t?t.label:e}},{dataIndex:"className",ifShow:!1,title:"表达式",width:120}],ER=Ct({name:"TaskListener",__name:"TaskListener",props:{element:{}},setup(e){const t=e,[n,{openModal:i}]=Ji();function r(){i(!0,{isEdit:!1})}function o(E){const w=u();w.push(E),m(w)}function a(E){i(!0,{isEdit:!0,record:E})}function s(E,w){const _=u(),x=_.findIndex(P=>P.key===w);x!==-1&&(_[x]=E,m(_))}function c(E){const w=u(),{key:_=""}=E,x=w.findIndex(P=>P.key===_);x!==-1&&(w.splice(x,1),m(w))}const[l,{setTableData:p,getDataSource:u}]=Kh({clickToRowSelect:!1,size:"small",showIndexColumn:!1,showTableSetting:!1,inset:!0,bordered:!0,columns:gy,pagination:!1,scroll:{y:300},actionColumn:{title:"操作",dataIndex:"action",width:100}}),{updateProperties:f}=Gi({element:Ht(t.element)}),{getModdle:d}=Kn(),h=d();function m(E){var w,_,x,P;if(E.length){let A=t.element.businessObject.get("extensionElements");A||(A=h==null?void 0:h.create("bpmn:ExtensionElements")),A.values=(_=(w=A.values)==null?void 0:w.filter(C=>C.$type!=="flowable:TaskListener"))!=null?_:[],E.forEach(C=>{const I=h==null?void 0:h.create("flowable:TaskListener");I.event=C.event,I[C.type]=C.className,C.params&&C.params.length&&C.params.forEach(T=>{const k=h==null?void 0:h.create("flowable:Field");k&&(k.name=T.name,k[T.type]=T.value,I.get("fields").push(k))}),A.get("values").push(I)}),f({extensionElements:A})}else{const A=t.element.businessObject.extensionElements;A&&(A.values=(P=(x=A.values)==null?void 0:x.filter(C=>C.$type!=="flowable:TaskListener"))!=null?P:[])}}function v(){var _,x,P;if(!((_=t.element.businessObject.extensionElements)==null?void 0:_.values))return;const w=(P=(x=t.element.businessObject.extensionElements)==null?void 0:x.values.filter(A=>A.$type==="flowable:TaskListener").map(A=>{var I,T;let C;return"class"in A&&(C="class"),"expression"in A&&(C="expression"),"delegateExpression"in A&&(C="delegateExpression"),{event:A.event,type:C,className:A[C],params:(T=(I=A.fields)==null?void 0:I.map(k=>{let B;return"stringValue"in k&&(B="stringValue"),"expression"in k&&(B="expression"),{name:k.name,type:B,value:k[B]}}))!=null?T:[]}}))!=null?P:[];p(w)}return to(()=>{v()}),(E,w)=>{const _=cn("a-button");return xe(),Mt("div",null,[L(O(Xh),{"expand-column-width":30,onRegister:O(l)},{bodyCell:$(({record:x,column:P})=>[P.key==="action"?(xe(),Ze(O(Zh),{key:0,actions:[{label:"编辑",onClick:a.bind(null,x)},{label:"删除",danger:!0,popConfirm:{placement:"left",title:"是否确认删除",confirm:c.bind(null,x)}}]},null,8,["actions"])):gt("",!0)]),expandedRowRender:$(({record:x})=>[lt("p",null,"表达式/类名: "+ts(x.className),1)]),_:1},8,["onRegister"]),L(_,{class:"mt-8px",onClick:r,block:""},{default:$(()=>[st("新增监听器")]),_:1}),L(vy,{type:"taskListener",onRegister:O(n),onAdd:o,onEdit:s},null,8,["onRegister"])])}}}),$o=Ct({name:"ExecutionListener",__name:"ExecutionListener",props:{element:{}},setup(e){const t=e,[n,{openModal:i}]=Ji();function r(){i(!0,{isEdit:!1})}function o(E){const w=u();w.push(E),m(w)}function a(E){i(!0,{isEdit:!0,record:E})}function s(E,w){const _=u(),x=_.findIndex(P=>P.key===w);x!==-1&&(_[x]=E,m(_))}function c(E){const w=u(),{key:_=""}=E,x=w.findIndex(P=>P.key===_);x!==-1&&(w.splice(x,1),m(w))}const[l,{setTableData:p,getDataSource:u}]=Kh({clickToRowSelect:!1,size:"small",showIndexColumn:!1,showTableSetting:!1,inset:!0,bordered:!0,columns:gy,pagination:!1,scroll:{y:300},actionColumn:{title:"操作",dataIndex:"action",width:100}}),{updateProperties:f}=Gi({element:Ht(t.element)}),{getModdle:d}=Kn(),h=d();function m(E){var w,_,x,P;if(E.length){let A=t.element.businessObject.get("extensionElements");A||(A=h==null?void 0:h.create("bpmn:ExtensionElements")),A.values=(_=(w=A.values)==null?void 0:w.filter(C=>C.$type!=="flowable:ExecutionListener"))!=null?_:[],E.forEach(C=>{const I=h==null?void 0:h.create("flowable:ExecutionListener");I&&(I.event=C.event,I[C.type]=C.className,C.params&&C.params.length&&C.params.forEach(T=>{const k=h==null?void 0:h.create("flowable:Field");k&&(k.name=T.name,k[T.type]=T.value,I.get("fields").push(k))}),A.get("values").push(I))}),f({extensionElements:A})}else{const A=t.element.businessObject.extensionElements;A&&(A.values=(P=(x=A.values)==null?void 0:x.filter(C=>C.$type!=="flowable:ExecutionListener"))!=null?P:[])}}function v(){var _,x,P;if(!((_=t.element.businessObject.extensionElements)==null?void 0:_.values))return;const w=(P=(x=t.element.businessObject.extensionElements)==null?void 0:x.values.filter(A=>A.$type==="flowable:ExecutionListener").map(A=>{var I,T;let C;return"class"in A&&(C="class"),"expression"in A&&(C="expression"),"delegateExpression"in A&&(C="delegateExpression"),{event:A.event,type:C,className:A[C],params:(T=(I=A.fields)==null?void 0:I.map(k=>{let B;return"stringValue"in k&&(B="stringValue"),"expression"in k&&(B="expression"),{name:k.name,type:B,value:k[B]}}))!=null?T:[]}}))!=null?P:[];p(w)}return to(()=>{v()}),(E,w)=>{const _=cn("a-button");return xe(),Mt("div",null,[L(O(Xh),{"expand-column-width":30,onRegister:O(l)},{bodyCell:$(({record:x,column:P})=>[P.key==="action"?(xe(),Ze(O(Zh),{key:0,actions:[{label:"编辑",onClick:a.bind(null,x)},{label:"删除",danger:!0,popConfirm:{placement:"left",title:"是否确认删除",confirm:c.bind(null,x)}}]},null,8,["actions"])):gt("",!0)]),expandedRowRender:$(({record:x})=>[lt("p",null,"表达式/类名: "+ts(x.className),1)]),_:1},8,["onRegister"]),L(_,{class:"mt-8px",onClick:r,block:""},{default:$(()=>[st("新增监听器")]),_:1}),L(vy,{onRegister:O(n),onAdd:o,onEdit:s},null,8,["onRegister"])])}}}),xR=Ct({name:"DueDateInput",components:{InputNumber:Yh,RadioButton:B_,RadioGroup:$_},props:{value:{type:String,required:!0}},emits:["change"],setup(e,{emit:t}){function n(){const c=/\d+/,l=e.value.match(c);if(l)return Number(l[0])}function i(){if(e.value){if(e.value.endsWith("H"))return"PT{v}H";if(e.value.endsWith("D"))return"P{v}D";if(e.value.endsWith("W"))return"P{v}W";if(e.value.endsWith("M"))return"P{v}M"}return"PT{v}H"}const r=[{label:"小时",value:"PT{v}H"},{label:"天",value:"P{v}D"},{label:"周",value:"P{v}W"},{label:"月",value:"P{v}M"}],o=Ee(i()),a=Ee(n());function s(){const c=a.value,l=o.value,p={target:{value:""}};if(c){const u=l.replace("{v}",String(c));p.target.value=u}console.log(p),t("change",p)}return{options:r,currentSelect:o,currentNumber:a,handleOnChange:s}}});function wR(e,t,n,i,r,o){const a=cn("RadioButton"),s=cn("RadioGroup"),c=cn("InputNumber");return xe(),Ze(c,Vr(e.$attrs,{min:1,value:e.currentNumber,"onUpdate:value":t[2]||(t[2]=l=>e.currentNumber=l),onChange:t[3]||(t[3]=l=>e.handleOnChange())}),{addonAfter:$(()=>[L(s,{value:e.currentSelect,"onUpdate:value":t[0]||(t[0]=l=>e.currentSelect=l),"button-style":"solid",onChange:t[1]||(t[1]=l=>e.handleOnChange())},{default:$(()=>[(xe(!0),Mt(T_,null,C_(e.options,l=>(xe(),Ze(a,{key:l.value,value:l.value},{default:$(()=>[st(ts(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16,["value"])}const SR=Ah(xR,[["render",wR],["__scopeId","data-v-42bb51ec"]]),CR={class:"h-[calc(100vh-180px)] overflow-scroll"},TR={key:0},PR=Ct({__name:"TaskPanel",props:{element:{}},setup(e){const t=dn.Panel,n=Gp.TabPane,[i,{openModal:r}]=Ji(),[o,{openModal:a}]=Ji(),[s,{openModal:c}]=Ji();function l(oe){return Number(oe)>$p(2,53)?oe:Number(oe)}function p(oe){var j;if(oe){const Y=[];T.value.candidateUsers&&T.value.candidateUsers.split(",").forEach(G=>{const V=l(G);return Y.push(V)}),c(!0,Y)}else{const Y=(j=T.value.assignee)!=null?j:"0",R=l(Y);a(!0,[R])}}function u(oe){console.log(oe);let j=x();if(j.values=j.values.filter(Y=>Y.$type!=="flowable:extCandidateUsers"),oe.length===0)T.value.candidateUsers=void 0,_({"flowable:candidateUsers":void 0});else{const Y=oe.map(V=>V.userId).join(",");T.value.candidateUsers=Y,_({"flowable:candidateUsers":Y});const R=P("flowable:extCandidateUsers",{body:""},j);j.values.push(R);const G=oe.map(V=>({userId:V.userId,userName:V.userName}));R.body=JSON.stringify(G)}j.values.length===0&&(j=void 0),_({extensionElements:j})}function f(oe){console.log(oe);const j=oe.length!==0?oe[0]:void 0;_({"flowable:assignee":j==null?void 0:j.userId}),k.value=j||{userName:""},T.value.assignee=String(j==null?void 0:j.userId);let Y=x();if(Y.values=Y.get("values").filter(R=>R.$type!=="flowable:extAssignee"),j){const R=P("flowable:extAssignee",{body:""},Y);Y.get("values").push(R),R.body=JSON.stringify({userName:j.userName,userId:j.userId})}Y.values.length===0&&(Y=void 0),_({extensionElements:Y})}function d(){const oe=T.value.candidateGroups||"";r(!0,{roleIds:oe})}function h(oe){if(console.log(oe),oe.length===0)T.value.candidateGroups="",_({"flowable:candidateGroups":void 0});else{const j=oe.join(",");T.value.candidateGroups=j,_({"flowable:candidateGroups":j})}}const m=e,{showConfig:v,nameChange:E,idChange:w,updateProperties:_,getExtensionElements:x,createModdleElement:P,formKeyChange:A}=Gi({element:Ht(m.element)}),{parseData:C}=Bo({element:Ht(m.element)}),I={id:"",name:"",dueDate:"",multiInstanceType:on.NONE,allocationType:Zi.USER,specifyDesc:my.SPECIFY_SINGLE},T=Ee(re(re({},I),C())),k=Ee({userName:""}),B=Ee([]);Gc(()=>it(this,null,function*(){const j=(yield z_()).map(Y=>({label:Y.formName+" - "+Y.router,value:Y.formType+":"+Y.id}));B.value=j}));const X=Ee(["1"]);Zi.USER,Zi.CANDIDATE,Zi.YOURSELF,Zi.SPECIFY;const Q=[{label:"无",value:on.NONE},{label:"串行(顺序收到审批)",value:on.SERIAL},{label:"并行(同时收到审批)",value:on.PARALLEL}],Ie=oe=>{const j=oe.target.value;_({"flowable:skipExpression":j&&j.length>0?j:void 0})},We=oe=>{_({"flowable:async":oe})},Me=oe=>{_({"flowable:priority":oe})},U=oe=>{const j=oe.target.value;_({"flowable:assignee":j&&j.length>0?j:void 0})},ae=oe=>{if(oe!==on.NONE){let j=m.element.businessObject.get("loopCharacteristics");j||(j=P("bpmn:MultiInstanceLoopCharacteristics",{},m.element.businessObject)),j.isSequential=oe===on.SERIAL,_({loopCharacteristics:j})}else _({loopCharacteristics:void 0})},fe=oe=>{const j=oe.target.value;let Y=m.element.businessObject.get("loopCharacteristics");Y||(Y=P("bpmn:MultiInstanceLoopCharacteristics",{},m.element.businessObject)),Y.collection=j&&j.length>0?j:void 0,_({loopCharacteristics:Y})},tt=oe=>{const j=oe.target.value;let Y=m.element.businessObject.get("loopCharacteristics");Y||(Y=P("bpmn:MultiInstanceLoopCharacteristics",{},m.element.businessObject)),Y.elementVariable=j&&j.length>0?j:void 0,_({loopCharacteristics:Y})},xt=oe=>{let j=m.element.businessObject.get("loopCharacteristics");j||(j=P("bpmn:MultiInstanceLoopCharacteristics",{},m.element.businessObject));const Y=oe.target.value;Y&&Y.length>0?j.completionCondition?j.completionCondition.body=Y:j.completionCondition=P("bpmn:Expression",{body:Y},j):j.completionCondition=void 0,_({loopCharacteristics:j})},wt=oe=>{const j=oe.target.value;_({"flowable:dueDate":j&&j.length>0?j:void 0})},vn=sn(()=>T.value.candidateUsers?T.value.candidateUsers.split(",").length:0),Ln=sn(()=>T.value.candidateGroups?T.value.candidateGroups.split(",").length:0);return Gc(()=>{var j;const oe=x(!1);if(oe&&oe.get("values")){let Y=oe.get("values").find(R=>R.$type==="flowable:extAssignee");Y&&(k.value=JSON.parse(Y.body))}if(T.value.loopCharacteristics){const Y=T.value.loopCharacteristics;T.value.collection=Y.collection||"",T.value.elementVariable=Y.elementVariable||"",T.value.completionCondition=((j=Y.completionCondition)==null?void 0:j.body)||"",T.value.multiInstanceType=Y.isSequential?on.SERIAL:on.PARALLEL}T.value.assignee&&(T.value.fixedAssignee=T.value.assignee)}),(oe,j)=>{const Y=cn("a-button");return xe(),Mt("div",CR,[L(O(no),{model:T.value,colon:!1,name:"basic","label-align":"left","label-col":{span:6},autocomplete:"off"},{default:$(()=>[L(O(dn),{activeKey:X.value,"onUpdate:activeKey":j[13]||(j[13]=R=>X.value=R),accordion:""},{default:$(()=>[L(O(t),{key:"1",header:"常规"},{default:$(()=>[L(O(Le),{label:"节点id",name:"id",rules:[{required:!0,message:"输入节点ID"}]},{default:$(()=>[L(O(Je),{value:T.value.id,"onUpdate:value":j[0]||(j[0]=R=>T.value.id=R),placeholder:"输入节点ID",onChange:O(w)},null,8,["value","onChange"])]),_:1}),L(O(Le),{label:"节点名称",name:"name",rules:[{required:!1}]},{default:$(()=>[L(O(Je),{value:T.value.name,"onUpdate:value":j[1]||(j[1]=R=>T.value.name=R),placeholder:"输入节点名称",onChange:O(E)},null,8,["value","onChange"])]),_:1}),O(v).skipExpression?(xe(),Ze(O(Le),{key:0,label:"跳过表达式",name:"skipExpression",rules:[{required:!1}]},{default:$(()=>[L(O(Je),{value:T.value.skipExpression,"onUpdate:value":j[2]||(j[2]=R=>T.value.skipExpression=R),placeholder:"输入跳过表达式",onChange:Ie},null,8,["value"])]),_:1})):gt("",!0),O(v).skipExpression?(xe(),Ze(O(Le),{key:1,label:"关联表单",name:"formKey",rules:[{required:!1}]},{default:$(()=>[L(O(zc),{value:T.value.formKey,"onUpdate:value":j[3]||(j[3]=R=>T.value.formKey=R),options:B.value,placeholder:"请选择表单","allow-clear":"",onSelect:O(A)},null,8,["value","options","onSelect"])]),_:1})):gt("",!0)]),_:1}),L(O(t),{key:"2",header:"任务"},{default:$(()=>[O(v).async?(xe(),Ze(O(Le),{key:0,label:"是否异步",name:"async"},{default:$(()=>[L(O(F_),{checked:T.value.async,"onUpdate:checked":j[4]||(j[4]=R=>T.value.async=R),checkedChildren:"是",unCheckedChildren:"否",onChange:We},null,8,["checked"])]),_:1})):gt("",!0),L(O(Gp),{class:"h-200px mb-24px","tab-position":"left"},{default:$(()=>[L(O(n),{key:"save",tab:"身份存储"},{default:$(()=>[L(O(Le),{label:"分配人员"},{default:$(()=>[L(O(Je),{value:T.value.assignee,"onUpdate:value":j[5]||(j[5]=R=>T.value.assignee=R),readonly:"",onClick:j[6]||(j[6]=R=>p(!1)),placeholder:"点击选择人员(单选)",onChange:U},null,8,["value"])]),_:1}),L(O(Le),{label:"候选人员"},{default:$(()=>[L(O(zp),{count:vn.value},{default:$(()=>[L(Y,{type:"primary",size:"small",onClick:j[7]||(j[7]=R=>p(!0))},{default:$(()=>[st("选择人员")]),_:1})]),_:1},8,["count"])]),_:1}),L(O(Le),{label:"候选组"},{default:$(()=>[L(O(zp),{count:Ln.value},{default:$(()=>[L(Y,{type:"primary",size:"small",onClick:d},{default:$(()=>[st("选择组")]),_:1})]),_:1},8,["count"])]),_:1})]),_:1})]),_:1}),O(v).dueDate?(xe(),Ze(O(Le),{key:1,label:"到期时间",name:"dueDate"},{default:$(()=>[L(SR,{value:T.value.dueDate,placeholder:"选择到期时间",onChange:wt},null,8,["value"])]),_:1})):gt("",!0),O(v).priority?(xe(),Ze(O(Le),{key:2,label:"优先级",name:"priority"},{default:$(()=>[L(O(Yh),{modelValue:T.value.priority,"onUpdate:modelValue":j[8]||(j[8]=R=>T.value.priority=R),placeholder:"请输入",onChange:Me},null,8,["modelValue"])]),_:1})):gt("",!0)]),_:1}),L(O(t),{key:"3",header:"多实例"},{default:$(()=>[L(O(Le),{label:"多实例类型"},{default:$(()=>[L(O(zc),{value:T.value.multiInstanceType,"onUpdate:value":j[9]||(j[9]=R=>T.value.multiInstanceType=R),options:Q,onChange:ae},null,8,["value"])]),_:1}),T.value.multiInstanceType!==O(on).NONE?(xe(),Mt("div",TR,[L(O(Le),{label:"集合",tooltip:`属性会作为表达式进行解析。如果表达式解析为字符串而不是一个集合 
                不论是因为本身配置的就是静态字符串值，还是表达式计算结果为字符串
                这个字符串都会被当做变量名，并从流程变量中用于获取实际的集合。`},{default:$(()=>[L(O(Je),{value:T.value.collection,"onUpdate:value":j[10]||(j[10]=R=>T.value.collection=R),placeholder:"请输入",onChange:fe},null,8,["value"])]),_:1}),L(O(Le),{label:"元素变量",tooltip:`每创建一个用户任务前，先以该元素变量为label，集合中的一项为value，
                        创建（局部）流程变量，该局部流程变量被用于指派用户任务。
                        一般来说，该字符串应与指定人员变量相同。`},{default:$(()=>[L(O(Je),{value:T.value.elementVariable,"onUpdate:value":j[11]||(j[11]=R=>T.value.elementVariable=R),placeholder:"请输入",onChange:tt},null,8,["value"])]),_:1}),L(O(Le),{label:"完成条件",tooltip:`多实例活动在所有实例都完成时结束，然而也可以指定一个表达式，在每个实例
                        结束时进行计算。当表达式计算为true时，将销毁所有剩余的实例，并结束多实例
                        活动，继续执行流程。例如 \${nrOfCompletedInstances/nrOfInstances >= 0.6 }，
                        表示当任务完成60%时，该节点就算完成`},{default:$(()=>[L(O(Je),{value:T.value.completionCondition,"onUpdate:value":j[12]||(j[12]=R=>T.value.completionCondition=R),placeholder:"请输入",onChange:xt},null,8,["value"])]),_:1})])):gt("",!0)]),_:1}),L(O(t),{key:"4",header:"任务监听器"},{default:$(()=>[O(v).taskListener?(xe(),Ze(ER,{key:0,element:oe.element},null,8,["element"])):gt("",!0)]),_:1}),L(O(t),{key:"5",header:"执行监听器"},{default:$(()=>[O(v).executionListener?(xe(),Ze($o,{key:0,element:oe.element},null,8,["element"])):gt("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["model"]),L(Yp,{multiple:!0,onRegister:O(s),onSelectDone:u},null,8,["onRegister"]),L(Yp,{multiple:!1,onRegister:O(o),onSelectDone:f},null,8,["onRegister"]),L(hR,{onRegister:O(i),onSelectDone:h},null,8,["onRegister"])])}}}),RR=Ct({__name:"ProcessPanel",props:{element:{}},setup(e){const t=dn.Panel,n=e,{parseData:i}=Bo({element:Ht(n.element)}),{idChange:r,nameChange:o}=Gi({element:Ht(n.element)}),a=Ee(["1","2"]),s=Ee(i());return(c,l)=>(xe(),Mt("div",null,[L(O(dn),{activeKey:a.value,"onUpdate:activeKey":l[2]||(l[2]=p=>a.value=p)},{default:$(()=>[L(O(t),{key:"1",header:"常规"},{default:$(()=>[L(O(no),{model:s.value,colon:!1,name:"basic","label-align":"left","label-col":{span:6},"wrapper-col":{span:16},autocomplete:"off"},{default:$(()=>[L(O(Le),{label:"流程标识",name:"id",rules:[{required:!0,message:"请输入流程标识"}]},{default:$(()=>[L(O(Je),{value:s.value.id,"onUpdate:value":l[0]||(l[0]=p=>s.value.id=p),placeholder:"输入ID",onChange:O(r)},null,8,["value","onChange"])]),_:1}),L(O(Le),{label:"流程名称",name:"name",rules:[{required:!0,message:"请输入节点名称"}]},{default:$(()=>[L(O(Je),{value:s.value.name,"onUpdate:value":l[1]||(l[1]=p=>s.value.name=p),placeholder:"输入节点名称",onChange:O(o)},null,8,["value","onChange"])]),_:1})]),_:1},8,["model"])]),_:1}),L(O(t),{key:"2",header:"执行监听器"},{default:$(()=>[L($o,{element:c.element},null,8,["element"])]),_:1})]),_:1},8,["activeKey"])]))}}),AR=Ct({__name:"StartEndPanel",props:{element:{}},setup(e){const t=dn.Panel,n=e,{nameChange:i,idChange:r}=Gi({element:Ht(n.element)}),{parseData:o}=Bo({element:Ht(n.element)}),a=Ee(o()),s=Ee(["1","2"]);return(c,l)=>(xe(),Mt("div",null,[L(O(dn),{activeKey:s.value,"onUpdate:activeKey":l[2]||(l[2]=p=>s.value=p)},{default:$(()=>[L(O(t),{key:"1",header:"常规"},{default:$(()=>[L(O(no),{model:a.value,colon:!1,name:"basic","label-align":"left","label-col":{span:6},"wrapper-col":{span:16},autocomplete:"off"},{default:$(()=>[L(O(Le),{label:"节点ID",name:"id",rules:[{required:!0,message:"请输入节点ID"}]},{default:$(()=>[L(O(Je),{value:a.value.id,"onUpdate:value":l[0]||(l[0]=p=>a.value.id=p),placeholder:"输入节点ID",onChange:O(r)},null,8,["value","onChange"])]),_:1}),L(O(Le),{label:"节点名称",name:"name"},{default:$(()=>[L(O(Je),{value:a.value.name,"onUpdate:value":l[1]||(l[1]=p=>a.value.name=p),placeholder:"输入节点名称",onChange:O(i)},null,8,["value","onChange"])]),_:1})]),_:1},8,["model"])]),_:1}),L(O(t),{key:"2",header:"执行监听器"},{default:$(()=>[L($o,{element:c.element},null,8,["element"])]),_:1})]),_:1},8,["activeKey"])]))}}),IR=Ct({__name:"GatewayPanel",props:{element:{}},setup(e){const t=dn.Panel,n=e,{nameChange:i,idChange:r}=Gi({element:Ht(n.element)}),{parseData:o}=Bo({element:Ht(n.element)}),a=Ee(["1","2"]),s=Ee(o());return(c,l)=>(xe(),Mt("div",null,[L(O(dn),{activeKey:a.value,"onUpdate:activeKey":l[2]||(l[2]=p=>a.value=p)},{default:$(()=>[L(O(t),{key:"1",header:"常规"},{default:$(()=>[L(O(no),{model:s.value,colon:!1,name:"basic","label-align":"left","label-col":{span:6},"wrapper-col":{span:16},autocomplete:"off"},{default:$(()=>[L(O(Le),{label:"节点标识",name:"id",rules:[{required:!0,message:"输入节点标识"}]},{default:$(()=>[L(O(Je),{value:s.value.id,"onUpdate:value":l[0]||(l[0]=p=>s.value.id=p),placeholder:"请输入",onChange:O(r)},null,8,["value","onChange"])]),_:1}),L(O(Le),{label:"节点名称",name:"name"},{default:$(()=>[L(O(Je),{value:s.value.name,"onUpdate:value":l[1]||(l[1]=p=>s.value.name=p),placeholder:"请输入",onChange:O(i)},null,8,["value","onChange"])]),_:1})]),_:1},8,["model"])]),_:1}),L(O(t),{key:"2",header:"执行监听器"},{default:$(()=>[L($o,{element:c.element},null,8,["element"])]),_:1})]),_:1},8,["activeKey"])]))}}),MR=Ct({__name:"SequenceFlowPanel",props:{element:{}},setup(e){const t=dn.Panel,n=e,{nameChange:i,idChange:r,updateProperties:o}=Gi({element:Ht(n.element)}),{parseData:a}=Bo({element:Ht(n.element)}),s=Kn().getModdle(),c=Ee(["1","2"]),l=Ee(a()),p=f=>{const d=f.target.value;if(d){const h=s==null?void 0:s.create("bpmn:FormalExpression",{body:d});o({conditionExpression:h})}else o({conditionExpression:null})},u=f=>{const d=f.target.value;o({"flowable:skipExpression":d&&d.length>0?d:void 0})};return Gc(()=>{l.value.conditionExpression&&(l.value.conditionExpressionValue=l.value.conditionExpression.body)}),(f,d)=>(xe(),Mt("div",null,[L(O(dn),{activeKey:c.value,"onUpdate:activeKey":d[4]||(d[4]=h=>c.value=h)},{default:$(()=>[L(O(t),{key:"1",header:"常规"},{default:$(()=>[L(O(no),{model:l.value,colon:!1,name:"basic","label-align":"left","label-col":{span:6},"wrapper-col":{span:16},autocomplete:"off"},{default:$(()=>[L(O(Le),{label:"节点ID",name:"id",rules:[{required:!0,message:"输入节点ID"}]},{default:$(()=>[L(O(Je),{value:l.value.id,"onUpdate:value":d[0]||(d[0]=h=>l.value.id=h),placeholder:"输入节点ID",onChange:O(r)},null,8,["value","onChange"])]),_:1}),L(O(Le),{label:"节点名称",name:"name"},{default:$(()=>[L(O(Je),{value:l.value.name,"onUpdate:value":d[1]||(d[1]=h=>l.value.name=h),placeholder:"输入节点名称",onChange:O(i)},null,8,["value","onChange"])]),_:1}),L(O(Le),{label:"跳转条件",name:"conditionExpression"},{default:$(()=>[L(O(Je),{value:l.value.conditionExpressionValue,"onUpdate:value":d[2]||(d[2]=h=>l.value.conditionExpressionValue=h),placeholder:"输入跳转条件",onChange:p},null,8,["value"])]),_:1}),l.value.skipExpression?(xe(),Ze(O(Le),{key:0,label:"跳过表达式",name:"skipExpression"},{default:$(()=>[L(O(Je),{value:l.value.skipExpression,"onUpdate:value":d[3]||(d[3]=h=>l.value.skipExpression=h),placeholder:"输入跳过表达式",onChange:u},null,8,["value"])]),_:1})):gt("",!0)]),_:1},8,["model"])]),_:1}),L(O(t),{key:"2",header:"执行监听器"},{default:$(()=>[L($o,{element:f.element},null,8,["element"])]),_:1})]),_:1},8,["activeKey"])]))}}),DR=Ct({__name:"index",props:{modeler:{},panelVisible:{type:Boolean},enableTransition:{type:Boolean}},setup(e){const t=Ee({padding:0}),n=e,i=Ee(!0);P_(()=>n.panelVisible,m=>{n.enableTransition&&(m?setTimeout(()=>{i.value=m},200):i.value=m)},{immediate:!0});const r=sn(()=>n.enableTransition?"transition-width duration-200":""),o=Ee(),a=Ee(),s=["bpmn:IntermediateThrowEvent","bpmn:StartEvent","bpmn:EndEvent"],c=["bpmn:UserTask","bpmn:Task","bpmn:SendTask","bpmn:ReceiveTask","bpmn:ManualTask","bpmn:BusinessRuleTask","bpmn:ServiceTask","bpmn:ScriptTask"],l=["bpmn:SequenceFlow"],p=["bpmn:InclusiveGateway","bpmn:ExclusiveGateway","bpmn:ParallelGateway","bpmn:EventBasedGateway","bpmn:ComplexGateway"],u=["bpmn:Process"],f=sn(()=>{if(!o.value)return null;const m=o.value.type;return s.includes(m)?AR:c.includes(m)?PR:l.includes(m)?MR:p.includes(m)?IR:u.includes(m)?RR:null}),d=sn(()=>{if(o.value){const m=o.value.businessObject,v=m!=null&&m.eventDefinitions&&(m==null?void 0:m.eventDefinitions.length)>0?m.eventDefinitions[0].$type:m.$type;return IC[v]||v}return null}),h=()=>{n.modeler.on("root.added",m=>{o.value=null,m.element.type==="bpmn:Process"&&Zo(()=>{o.value=m.element,a.value=m.element})}),n.modeler.on("element.click",m=>{m.element.type==="bpmn:Process"&&Zo(()=>{o.value=m.element,a.value=m.element})}),n.modeler.on("selection.changed",m=>{o.value=null;const v=m.newSelection[0];v?Zo(()=>{o.value=v}):Zo(()=>{o.value=a.value})})};return to(()=>{h()}),(m,v)=>(xe(),Ze(O(j_),{class:Uh(r.value),title:d.value,bodyStyle:t.value},{default:$(()=>[o.value?R_((xe(),Ze(I_(f.value),{key:0,element:o.value},null,8,["element"])),[[A_,i.value]]):gt("",!0)]),_:1},8,["class","title","bodyStyle"]))}}),kR={class:"bpmn-page"},OR={width:"0",height:"0",style:{position:"absolute"}},NR=lt("defs",null,[lt("marker",{id:"markerArrow-dark-mode",viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[lt("path",{d:"M 1 5 L 11 10 L 1 15 Z",class:"arrow-dark"})])],-1),LR=[NR],BR={class:"flex justify-between p-2"},$R=lt("span",null,"适应屏幕(居中)",-1),FR=lt("span",null,"缩小视图",-1),jR=lt("span",null,"放大视图",-1),HR=lt("span",null,"撤销",-1),GR=lt("span",null,"恢复",-1),zR=lt("span",null,"开启/关闭流程模拟",-1),VR=lt("span",null,"展开/收起小地图",-1),UR={class:"flex flex-row h-full w-full"},WR=Ct({name:"BpmnDesign",__name:"index",props:{xml:{type:String,default:Ph}},emits:["save"],setup(e,{expose:t,emit:n}){const i=e,r=n,o=Ee(),a=Ee(),s=Ee(1),c=Kn(),l=qy("__bpmn_design_properties_panel_visible__",!0),p=sn(()=>l.value);function u(){l.value=!l.value}const f=sn(()=>l.value?"隐藏属性栏":"显示属性栏"),d=sn(()=>l.value?"w-460px h-full":"w-0");to(()=>{a.value=new ln({container:o.value,keyboard:{bindTo:window},additionalModules:lR,moddleExtensions:{flowable:uR}}),h(),m(i.xml)});function h(){var U;c.getModeler()&&((U=c.getModeler())==null||U.destroy(),c.setModeler(void 0)),c.setModeler(a.value)}function m(U){var ae;U||(U=Ph),(ae=a.value)==null||ae.importXML(U)}function v(){var tt,xt,wt,vn;s.value=((tt=a.value)==null?void 0:tt.get("canvas").zoom("fit-viewport"))||1;const U=(xt=document.querySelector(".bpmn-page .viewport"))==null?void 0:xt.getBBox();if(!U){console.warn(".bpmn-page .viewport getBBox fail");return}const ae=(wt=a.value)==null?void 0:wt.get("canvas").viewbox(),fe={x:U.x+U.width/2-65,y:U.y+U.height/2};if(!ae){console.warn("viewbox fail");return}(vn=a.value)==null||vn.get("canvas").viewbox({x:fe.x-ae.width/2,y:fe.y-ae.height/2,width:ae.width,height:ae.height}),s.value=U.width/ae.width*1.8}function E(U=!0){var ae,fe;s.value=((ae=a.value)==null?void 0:ae.get("canvas").zoom())||1,s.value+=U?.1:-.1,(fe=a.value)==null||fe.get("canvas").zoom(s.value)}function w(){var U;(U=a.value)==null||U.get("commandStack").undo()}function _(){var U;(U=a.value)==null||U.get("commandStack").redo()}function x(){var ae;const U=(ae=a.value)==null?void 0:ae.getDefinitions().rootElements;for(let fe=0;fe<U.length;fe++)if(U[fe].$type==="bpmn:Process")return U[fe]}function P(){return it(this,null,function*(){var U;try{if(!a.value)return;const{xml:ae=""}=yield a.value.saveXML({format:!0}),tt=`${(U=x().name)!=null?U:"unknown"}.bpmn20.xml`,xt="application/xml",wt=new Blob([ae],{type:xt});Wp(wt,tt,xt)}catch(ae){}})}function A(){return it(this,null,function*(){var U;try{if(!a.value)return;const{svg:ae}=yield a.value.saveSVG(),fe=(U=x().name)!=null?U:"unknown",tt="image/svg+xml",xt=new Blob([ae],{type:tt});Wp(xt,fe,tt)}catch(ae){}})}function C(U){return it(this,null,function*(){switch(U.key){case"exportXml":yield P();break;case"exportSvg":yield A();break}})}function I(){return it(this,null,function*(){if(!a.value)return;const{xml:U=""}=yield a.value.saveXML({format:!0});B(!0,{type:"xml",content:U})})}function T(){return it(this,null,function*(){if(!a.value)return;const{svg:U}=yield a.value.saveSVG();B(!0,{type:"svg",content:U})})}const[k,{openModal:B}]=Ji();function X(U){return it(this,null,function*(){switch(U.key){case"xml":yield I();break;case"svg":yield T();break}})}function Q(){a.value&&a.value.get("toggleMode").toggleMode()}function Ie(){var U;(U=a.value)==null||U.get("minimap").toggle()}function We(){const U=x();return{id:U.id,name:U.name}}function Me(){return it(this,null,function*(){if(!a.value)return;const{xml:U}=yield a.value.saveXML({format:!0}),{svg:ae}=yield a.value.saveSVG(),fe=We(),tt={xml:U,svg:ae,key:fe.id,name:fe.name};r("save",tt)})}return t({initDiagram:m}),(U,ae)=>{const fe=cn("a-button");return xe(),Mt("div",kR,[(xe(),Mt("svg",OR,LR)),lt("div",BR,[L(O(qh),null,{default:$(()=>[L(fe,{type:"primary",onClick:Me},{default:$(()=>[st(" 保存 ")]),_:1}),L(O(Vp),null,{overlay:$(()=>[L(O(Up),{onClick:C},{default:$(()=>[L(O(Jo),{key:"exportXml"},{default:$(()=>[L(Xo,{icon:"carbon:xml",class:"mr-1"}),st("导出xml")]),_:1}),L(O(Jo),{key:"exportSvg"},{default:$(()=>[L(Xo,{icon:"teenyicons:svg-outline",class:"mr-1"}),st("导出svg")]),_:1})]),_:1})]),default:$(()=>[L(fe,{"pre-icon":"ph:export-light"},{default:$(()=>[st(" 导出 ")]),_:1})]),_:1}),L(O(Vp),null,{overlay:$(()=>[L(O(Up),{onClick:X},{default:$(()=>[L(O(Jo),{key:"xml"},{default:$(()=>[L(Xo,{icon:"carbon:xml",class:"mr-1"}),st("预览xml")]),_:1}),L(O(Jo),{key:"svg"},{default:$(()=>[L(Xo,{icon:"carbon:json",class:"mr-1"}),st("预览svg")]),_:1})]),_:1})]),default:$(()=>[L(fe,{"pre-icon":"mage:preview"},{default:$(()=>[st(" 预览 ")]),_:1})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[$R]),default:$(()=>[L(fe,{"pre-icon":"material-symbols:center-focus-strong-outline",onClick:v})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[FR]),default:$(()=>[L(fe,{"pre-icon":"ooui:zoom-out",onClick:ae[0]||(ae[0]=tt=>E(!1))})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[jR]),default:$(()=>[L(fe,{"pre-icon":"ooui:zoom-in",onClick:ae[1]||(ae[1]=tt=>E(!0))})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[HR]),default:$(()=>[L(fe,{"pre-icon":"grommet-icons:link-previous",onClick:w})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[GR]),default:$(()=>[L(fe,{"pre-icon":"grommet-icons:link-next",onClick:_})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[zR]),default:$(()=>[L(fe,{"pre-icon":"fluent:desktop-flow-20-regular",onClick:Q})]),_:1}),L(O(vi),{placement:"bottom"},{title:$(()=>[VR]),default:$(()=>[L(fe,{"pre-icon":"gis:map-rm",onClick:Ie})]),_:1}),L(fe,{"pre-icon":"akar-icons:panel-right",onClick:u},{default:$(()=>[st(ts(f.value),1)]),_:1})]),_:1}),M_(U.$slots,"menuRight")]),lt("div",UR,[lt("div",{id:"container",ref_key:"containerRef",ref:o,class:"flex-1 h-[calc(100%-48px)]"},null,512),a.value?(xe(),Ze(DR,{key:0,enableTransition:!0,panelVisible:p.value,modeler:a.value,class:Uh(d.value)},null,8,["panelVisible","modeler","class"])):gt("",!0)]),L(fR,{onRegister:O(k)},null,8,["onRegister"])])}}}),YR={class:"w-full h-full overflow-hidden"},T2=Ct({name:"WorkflowDesignPage",__name:"index",setup(e){const n=D_().params.id||"0",i=Ee(),r=Ee(),{setTitle:o,closeCurrent:a}=Ky();to(()=>it(this,null,function*(){var u;const p=yield q_(n);console.log(p),r.value=p,o("流程设计: "+p.name),(u=i.value)==null||u.initDiagram(p.xml)}));const{createConfirm:s}=Xy();function c(p){if(!r.value)return;const u=re(re({},r.value),p);console.log(u);const f=s({iconType:"warning",title:"提示",content:"是否确认保存",onOk(){return it(this,null,function*(){try{yield K_(u),a()}catch(h){f.destroy()}})}})}function l(){s({iconType:"warning",title:"提示",content:"是否确认关闭当前页面",onOk(){a()}})}return(p,u)=>{const f=cn("a-button");return xe(),Mt("div",YR,[L(WR,{ref_key:"bpmnRef",ref:i,onSave:c},{menuRight:$(()=>[L(O(qh),null,{default:$(()=>[L(f,{onClick:l},{default:$(()=>[st("关闭页面")]),_:1})]),_:1})]),_:1},512)])}}});export{T2 as default};
