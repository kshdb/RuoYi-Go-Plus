var p=(M,C,d)=>new Promise((f,m)=>{var w=c=>{try{g(d.next(c))}catch(v){m(v)}},R=c=>{try{g(d.throw(c))}catch(v){m(v)}},g=c=>c.done?f(c.value):Promise.resolve(c.value).then(w,R);g((d=d.apply(M,C)).next())});import{u as y}from"./index-CMSTH4sS.js";import{u as le,_ as re}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{_ as ce,m as ie}from"./RejectModal.vue_vue_type_script_setup_true_lang-BGCtAQaM.js";import{aa as de,e as ue,I as pe,h as fe}from"./entry/index-CMepwc5X-1716790511191.js";import S from"./index-BMkdtMeE.js";import{g as me,c as ge,t as ke,d as _e,a as ve}from"./index-D8V_F1G-.js";import{O as Ie,aF as xe,P as $,ad as he}from"./antd-BRjMhd0C.js";import{d as ye,f as b,o as be,aa as Me,_ as N,$ as A,k as t,a9 as n,a0 as x,F as Ce,ab as we,a8 as Re,G as r,a1 as E,u as l}from"./vue-Bw3NQgLF.js";const Te={class:"flex flex-col gap-4px"},Se=x("p",{class:"mt-4"},[r(" 请上传 大小不超过 "),x("span",{class:"text-red-500"},"20MB"),r(" 格式为 "),x("span",{class:"text-red-500"},"doc/xls/ppt/txt/pdf/xlsx/docx/zip"),r(" 的文件 ")],-1),Ne=".doc,.docx,.xls,.xlsx,.ppt, .pptx, .pdf, .txt, .zip",Pe=ye({name:"ApprovalContent",__name:"index",props:{taskId:{type:String,required:!0}},emits:["register","reload"],setup(M,{emit:C}){const d=C,f=M,m=b(null);be(()=>p(this,null,function*(){yield c({taskId:f.taskId});const e=yield me(f.taskId);m.value=e}));const[w,{resetFields:R,getFieldsValue:g,setFieldsValue:c}]=le({name:"approval_content",schemas:ie,showActionButtonGroup:!1,labelWidth:100,baseColProps:{span:24}}),{apiUrl:v,clientId:O}=de(),V=`${v}/resource/oss/upload`,L={Authorization:"Bearer "+ue(),clientId:O},I=b([]),h=b([]),{createMessage:U,createConfirm:j}=fe();function P(e){console.log(e);const a=e.file,o=a==null?void 0:a.status;if(o==="done"){const{response:s}=a,{code:k,msg:u="服务器错误",data:_}=s;if(k===200){const{ossId:T}=_;I.value.push(T)}else U.error(u)}if(o==="removed"){const{response:s}=a,{code:k,msg:u="服务器错误",data:_}=s;if(k===200){const{ossId:T}=_,B=I.value.indexOf(T);B!==-1&&I.value.splice(B,1)}else U.error(u)}}const[q,{openModal:z}]=y();function G(){z(!0)}const[W,{openModal:H}]=y();function J(){if(!m.value)return;const e=m.value.processInstanceId,a=f.taskId;H(!0,{taskId:a,processInstanceId:e})}function K(e){console.log(e),h.value=e.map(a=>({userId:a.userId,userName:a.userName,nickName:a.nickName}))}const i=b(!1);function Q(){return p(this,null,function*(){try{i.value=!0;const e=g();e.fileId=I.value.join(","),e.wfCopyList=h.value,console.log(e),yield ge(e),yield F(),d("reload")}catch(e){console.warn(e)}finally{i.value=!1}})}function X(){return p(this,null,function*(){try{i.value=!0;const e=g(),a={taskId:f.taskId,comment:e.message};yield ke(a),yield F(),d("reload")}catch(e){console.warn(e)}finally{i.value=!1}})}const[Y,{openModal:Z}]=y();function ee(){return p(this,null,function*(){Z(!0)})}function D(e,a,o){if(Array.isArray(a)&&a.length===0)return;const s=a[0];j({title:"提示",iconType:"warning",content:`是否${e}给用户[${s.nickName}]?`,onOk(){return p(this,null,function*(){const u={nickName:s.nickName,userId:s.userId,taskId:f.taskId},_=g();_.message&&(u.comment=_.message),yield o(u),d("reload")})}})}function ae(e){D("委托",e,_e)}const[te,{openModal:se}]=y();function ne(){return p(this,null,function*(){se(!0)})}function oe(e){D("转办",e,ve)}function F(){return p(this,null,function*(){yield R(),I.value=[],h.value=[],m.value=null})}return(e,a)=>{const o=Me("a-button");return N(),A("div",null,[t(l(re),{onRegister:l(w)},{wfCopyList:n(()=>[x("div",Te,[x("div",null,[(N(!0),A(Ce,null,we(h.value,s=>(N(),Re(l(Ie),{key:s.userId},{default:n(()=>[r(E(s.nickName)+"/"+E(s.userName),1)]),_:2},1024))),128))]),t(o,{class:"w-fit","pre-icon":"bi:cc-square-fill",onClick:G},{default:n(()=>[r("选择抄送人")]),_:1})])]),fileId:n(({model:s,field:k})=>[t(l(xe),{"file-list":s[k],"onUpdate:fileList":u=>s[k]=u,name:"file",multiple:!0,action:V,headers:L,accept:Ne,onChange:P},{default:n(()=>[t(o,{"pre-icon":l(pe).UPLOAD},{default:n(()=>[r("上传附件")]),_:1},8,["pre-icon"])]),_:2},1032,["file-list","onUpdate:fileList"]),Se]),_:1},8,["onRegister"]),t(l(he),{class:"ml-100px"},{default:n(()=>[t(l($),{placement:"top",title:"确认提交吗?","ok-text":"确认","cancel-text":"再想想",onConfirm:Q},{default:n(()=>[t(o,{disabled:i.value,type:"primary"},{default:n(()=>[r("通过")]),_:1},8,["disabled"])]),_:1}),t(o,{disabled:i.value,onClick:ee},{default:n(()=>[r("委托")]),_:1},8,["disabled"]),t(o,{disabled:i.value,onClick:ne},{default:n(()=>[r("转办")]),_:1},8,["disabled"]),t(o,{disabled:i.value,onClick:J},{default:n(()=>[r("驳回")]),_:1},8,["disabled"]),t(l($),{placement:"top",title:"确认终止吗?","ok-text":"确认","cancel-text":"再想想",onConfirm:X},{default:n(()=>[t(o,{disabled:i.value},{default:n(()=>[r("终止")]),_:1},8,["disabled"])]),_:1})]),_:1}),t(S,{onRegister:l(q),onSelectDone:K},null,8,["onRegister"]),t(ce,{onRegister:l(W),onReload:a[0]||(a[0]=s=>e.$emit("reload"))},null,8,["onRegister"]),t(S,{multiple:!1,onRegister:l(Y),onSelectDone:ae},null,8,["onRegister"]),t(S,{multiple:!1,onRegister:l(te),onSelectDone:oe},null,8,["onRegister"])])}}});export{Pe as _};
