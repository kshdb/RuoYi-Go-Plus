var m=(e,o,a)=>new Promise((i,c)=>{var f=r=>{try{u(a.next(r))}catch(l){c(l)}},h=r=>{try{u(a.throw(r))}catch(l){c(l)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(f,h);u((a=a.apply(e,o)).next())});import{a as _,B as v}from"./index-ov0mgIjt.js";import{u as R,_ as V}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import{$ as g,bp as C,bq as N,aT as q,b as B}from"./entry/index-CMepwc5X-1716790511191.js";import"./componentMap-DPcekmXH.js";import{a as x,m as L,b as k,c as A}from"./index-Bz-s2yf4.js";import{g as w}from"./dict-C9gNHjAh.js";import{D as b}from"./dictEnum-DeC8h6ZR.js";import{u as G}from"./useSize-tRF5RUOv.js";import{d as W,f as E,c as O,_ as H,a8 as U,a9 as $,k as j,u as n,ad as K}from"./vue-Bw3NQgLF.js";const z=[{field:"menuId",label:"菜单ID",component:"Input",show:!1},{field:"parentId",label:"上级菜单 ",required:!0,defaultValue:0,component:"TreeSelect",colProps:{span:24}},{field:"menuType",label:"菜单类型 ",component:"RadioButtonGroup",defaultValue:"M",componentProps({formActionType:e}){return{options:[{label:"目录",value:"M"},{label:"菜单",value:"C"},{label:"按钮",value:"F"}],onChange:()=>m(this,null,function*(){e&&(yield e.clearValidate())})}},colProps:{span:12}},{field:"icon",label:"菜单图标 ",component:"IconPicker",helpMessage:"选择或者从 https://icon-sets.iconify.design/ 查找名称粘贴",colProps:{span:12},ifShow:({values:e})=>e.menuType!=="F"},{field:"menuName",label:"菜单名称 ",helpMessage:"显示在菜单栏的名称",component:"Input",required:!0,colProps:{span:12}},{field:"orderNum",label:"显示排序 ",component:"InputNumber",helpMessage:"排序, 数字越小越靠前",required:!0,colProps:{span:12}},{field:"path",label:"路由地址",component:"Input",helpMessage:["路由地址不带/, 如: menu, user","链接为http(s)://开头","链接默认使用内部iframe打开, 可通过{是否外链}控制打开方式"],required:!0,colProps:{span:24},ifShow:({values:e})=>e.menuType!=="F",dynamicRules({model:e}){return e.isFrame!=="0"?[{required:!0,message:"请输入路由地址",trigger:"change",whitespace:!0},{required:!1,message:"路由地址不需要带/",validator:(o,a)=>a&&(a.startsWith("/")||a.startsWith("\\"))?Promise.reject("路由地址不需要带/"):Promise.resolve(),trigger:"change"}]:[{required:!0,message:"输入正确的链接",type:"url",trigger:"change"}]},componentProps({formModel:e,formActionType:o}){return g(e.path)&&o.clearValidate("component"),e.isFrame==="0"?{placeholder:"填写链接地址http(s)://  使用新页面打开"}:{placeholder:"填写`路由地址`或者`链接地址`  链接默认使用内部iframe内嵌打开"}}},{field:"component",label:"组件路径",component:"Input",defaultValue:"",helpMessage:"填写./src/views下的组件路径, 如system/menu/index",colProps:{span:24},ifShow:({values:e})=>e.menuType==="C",dynamicDisabled:({values:e})=>e.isFrame==="0",dynamicRules({model:e}){return e.path&&!g(e.path)?[{required:!0,message:"非链接时必填组件路径",trigger:"change"}]:[]}},{field:"isFrame",label:"是否外链",component:"RadioButtonGroup",helpMessage:["外链为http(s)://开头","选择否时, 使用iframe从内部打开页面, 否则新窗口打开"],defaultValue:"1",componentProps:{options:[{label:"是",value:"0"},{label:"否",value:"1"}]},colProps:{span:12},ifShow:({values:e})=>e.menuType!=="F"},{field:"visible",label:"显示状态",component:"RadioButtonGroup",defaultValue:"0",helpMessage:"隐藏后不会出现在菜单栏, 但仍然可以访问",colProps:{span:12},ifShow:({values:e})=>e.menuType!=="F",componentProps:{options:w(b.SHOW_HIDE)}},{field:"status",label:"菜单状态",component:"RadioButtonGroup",defaultValue:"0",helpMessage:"停用后不会出现在菜单栏, 也无法访问",colProps:{span:12},componentProps:{options:w(b.NORMAL_DISABLE)},ifShow:({values:e})=>e.menuType!=="F"},{field:"perms",label:"需要权限",component:"Input",defaultValue:"",helpMessage:'控制器中定义的权限字符, 如: @SaCheckPermission("system:user:import")',colProps:{span:12},ifShow:({values:e})=>e.menuType==="C"||e.menuType==="F"},{field:"query",label:"路由参数",component:"Input",defaultValue:"",helpMessage:"vue-router中的query属性, 如{name: 'xxx', age: '16'}",colProps:{span:12},ifShow:({values:e})=>e.menuType==="C",dynamicDisabled:({values:e})=>e.isFrame==="0"},{field:"isCache",label:"是否缓存",component:"RadioButtonGroup",helpMessage:"路由的keepAlive属性",defaultValue:"0",componentProps:{options:[{label:"是",value:"0"},{label:"否",value:"1"}]},colProps:{span:12},ifShow:({values:e})=>e.menuType==="C"}],oe=W({name:"MenuDrawer",__name:"MenuDrawer",emits:["reload","register"],setup(e,{emit:o}){const a=o,i=E(!1),c=G(800),f=O(()=>i.value?"修改菜单":"添加菜单"),[h,{validate:u,setFieldsValue:r,resetForm:l,updateSchema:y}]=R({schemas:z,showActionButtonGroup:!1,labelWidth:120,name:"menu_drawer"}),[P,{drawerLoading:d,closeDrawer:I}]=_(t=>m(this,null,function*(){d(!0);const{record:s,update:p}=t;if(i.value=p,s&&s.parentId&&(yield r({parentId:s.parentId})),p&&s){const F=yield x(s.menuId);yield r(F)}yield M(),d(!1)}));function M(){return m(this,null,function*(){const t=yield L(),p=[{menuName:"根目录",menuId:0,children:C(t,{id:"menuId",pid:"parentId"})}];N(p,"menuName"," / "),yield y({field:"parentId",componentProps:{treeData:p,fieldNames:{label:"menuName",value:"menuId"},treeDefaultExpandAll:!1,treeNodeLabelProp:"fullName",treeLine:{showLeafIcon:!1},treeDefaultExpandedKeys:[0],listHeight:300}})})}const{refreshMenu:D}=q(),S=B("refreshMenu",!0);function T(){return m(this,null,function*(){try{d(!0);const t=yield u();n(i)?yield k(t):yield A(t),a("reload"),I(),yield l(),n(S)&&(yield D())}catch(t){}finally{d(!1)}})}return(t,s)=>(H(),U(n(v),K(t.$attrs,{title:f.value,width:n(c),"show-footer":!0,onRegister:n(P),onOk:T,onClose:n(l)}),{default:$(()=>[j(n(V),{onRegister:n(h)},null,8,["onRegister"])]),_:1},16,["title","width","onRegister","onClose"]))}});export{oe as _};
