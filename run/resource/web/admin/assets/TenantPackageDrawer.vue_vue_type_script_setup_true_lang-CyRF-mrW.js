var k=(_,y,i)=>new Promise((u,p)=>{var v=a=>{try{r(i.next(a))}catch(m){p(m)}},d=a=>{try{r(i.throw(a))}catch(m){p(m)}},r=a=>a.done?u(a.value):Promise.resolve(a.value).then(v,d);r((i=i.apply(_,y)).next())});import{a as L,B as V}from"./index-ov0mgIjt.js";import{u as W,_ as $}from"./useForm-uR1ZVBCA.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./componentMap-DPcekmXH.js";import{e as O,m as E}from"./tenantPackage.data-3RzivsLS.js";import{a as G,b as j,c as q}from"./index-De2oYrBu.js";import{_ as z}from"./index-CwwL6bPg.js";import{t as H,e as J}from"./index-Bz-s2yf4.js";import{bn as Q,bB as X}from"./entry/index-CMepwc5X-1716790511191.js";import{u as Y}from"./useSize-tRF5RUOv.js";import{b7 as Z,R as ee}from"./antd-BRjMhd0C.js";import{d as ae,f,c as te,y as ne,u as n,_ as b,a8 as S,a9 as g,k as w,ac as re,ad as se}from"./vue-Bw3NQgLF.js";const oe=1,we=ae({name:"TenantPackageDrawer",__name:"TenantPackageDrawer",emits:["register","reload"],setup(_,{emit:y}){const i=y,u=f(!1),p=te(()=>u.value?"编辑租户套餐":"新增租户套餐"),v=Y(700),d=f(),r=f([]),a=f(!1),[m,{closeDrawer:T,drawerLoading:h}]=L(e=>k(this,null,function*(){h(!0),a.value=!1;const{record:t,update:l}=e;if(u.value=l,l&&t){const s=yield G(t.packageId),c=x(s.menuIds);o.value=c,a.value=!s.menuCheckStrictly;const{checkedKeys:U,menus:K}=yield H(t.packageId),N=C(K);r.value=N,s.menuIds=U,yield B(s)}else{const s=yield J(),c=C(s);r.value=c}ne(()=>{n(d)&&n(d).filterByLevel(oe)}),h(!1)}));function C(e){return Q(e,t=>!O.includes(t.id),{id:"id",pid:"parentId",children:"children"})}function x(e){return e?e.split(", "):[]}const[R,{setFieldsValue:B,validate:D,resetForm:F}]=W({layout:"vertical",labelWidth:80,name:"tenant_package_drawer",showActionButtonGroup:!1,baseColProps:{span:24},schemas:E}),o=f([]);function M(e,t){if(e instanceof Array){const l=t.halfCheckedKeys||[];o.value=[...l,...e]}else o.value=[...e.checked]}function A(e){if(e instanceof Array){const t=X(r.value);e.length===0&&(console.log("取消全部"),o.value=[]),e.length===t.length&&(console.log("选择全部"),o.value=t)}}function P(){return k(this,null,function*(){try{h(!0);const e=yield D();e.menuIds=o.value.sort(),e.menuCheckStrictly=!n(a),n(u)?yield j(e):yield q(e),i("reload"),T(),yield I()}catch(e){}finally{h(!1)}})}function I(){return k(this,null,function*(){yield F(),o.value=[]})}return(e,t)=>(b(),S(n(V),se(e.$attrs,{title:p.value,width:n(v),"show-footer":!0,onRegister:n(m),onOk:P,onClose:I}),{default:g(()=>[w(n($),{onRegister:n(R)},{menuIds:g(({model:l,field:s})=>[w(n(Z),null,{default:g(()=>[w(n(ee),{"body-style":{padding:0}},{default:g(()=>[r.value.length?(b(),S(n(z),{key:0,ref_key:"menuTreeRef",ref:d,title:"菜单分配","tree-data":r.value,fieldNames:{title:"label",key:"id"},checkable:!0,selectable:!1,enableCustomTool:!0,checkStrictly:a.value,"onUpdate:checkStrictly":t[0]||(t[0]=c=>a.value=c),checkedKeys:l[s],"onUpdate:checkedKeys":c=>l[s]=c,onCheck:M,onChange:A},null,8,["tree-data","checkStrictly","checkedKeys","onUpdate:checkedKeys"])):re("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["title","width","onRegister"]))}});export{we as _};
