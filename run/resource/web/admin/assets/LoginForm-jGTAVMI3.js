var oe=Object.defineProperty,ne=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var K=(u,n,r)=>n in u?oe(u,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[n]=r,V=(u,n)=>{for(var r in n||(n={}))le.call(n,r)&&K(u,r,n[r]);if(U)for(var r of U(n))ce.call(n,r)&&K(u,r,n[r]);return u},G=(u,n)=>ne(u,re(n));var S=(u,n,r)=>new Promise((p,k)=>{var d=m=>{try{b(r.next(m))}catch(I){k(I)}},F=m=>{try{b(r.throw(m))}catch(I){k(I)}},b=m=>m.done?p(m.value):Promise.resolve(m.value).then(d,F);b((r=r.apply(u,n)).next())});import{d as ie,f as E,r as D,c as j,o as de,u as e,aa as ue,_ as Q,$ as me,m as W,A as H,k as s,a9 as o,aq as J,a8 as fe,ac as pe,G as v,a1 as y,F as ge}from"./vue-Bw3NQgLF.js";import{u as ve,a as ye,b as be,L as _,_ as Ie}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-Twa-pAtz.js";import{k as we,o as Se,a as _e,b as ke,aA as Ce,aB as he,h as xe,j as Ee}from"./entry/index-CMepwc5X-1716790511191.js";import{c as Le}from"./captcha-R_hS6ymY.js";import{ab as X,A,av as Re,aw as Fe,B as L,au as Te,at as Me}from"./antd-BRjMhd0C.js";import"./componentMap-DPcekmXH.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-DgvCFV63.js";import"./index-Rv_3g2e8.js";import"./index-CMSTH4sS.js";import"./useWindowSizeFn-Ba6K9eqp.js";import"./useSortable-CwI952Jx.js";import"./download-CYeVxFqw.js";import"./useLoading-iCq4GOHr.js";import"./copyTextToClipboard-BLtSw0o7.js";import"./onMountedOrActivated-B2y-oH2N.js";import"./helper-CfJJkrf5.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BxZ9HtKh.js";import"./rules-Boel_RXz.js";const g="000000",R="rememberMe",Be=ie({__name:"LoginForm",setup(u){const n=Te,r=Me,p=X.Item,k=A.Password,{t:d}=we(),{notification:F,createErrorModal:b}=xe(),{prefixCls:m}=Se("login"),I=_e(),{setLoginState:C,getLoginState:Y}=ve(),{getFormRules:Z}=ye(),z=E(),T=E(!1),i=D({account:"admin",password:"admin123",code:"",uuid:"",tenantId:g}),f=D({requiredCaptcha:!1,imageInfo:"",loadSuccess:!1}),w=D({tenantEnabled:!1,voList:[],loadSuccess:!1});function M(){return S(this,null,function*(){var l;try{const a=yield Le();i.uuid=a.uuid,f.requiredCaptcha=a.captchaEnabled,f.imageInfo=`data:image/gif;base64,${a.img}`,i.code="",(l=e($))==null||l.focus(),f.loadSuccess=!0}catch(a){console.error("验证码异常"),f.loadSuccess=!1}})}const N=ke("tenantId",g);function ee(){return S(this,null,function*(){try{const l=yield he(),{tenantEnabled:a,voList:c}=l;if(a){const t=c.length?c[0].tenantId:g;i.tenantId=t,N.value=t}Object.assign(w,l),w.loadSuccess=!0}catch(l){console.error("租户选择异常"),w.loadSuccess=!1}})}const O=j(()=>w.loadSuccess&&f.loadSuccess),h=Ce(),B=E(!!h.get(R));function ae(l){const{tenantId:a=g,username:c,password:t}=l,x={tenantId:a,username:c,password:t};B.value?h.set(R,x):h.remove(R)}function te(){const l=h.get(R);if(l){console.log(l);const{tenantId:a=g,username:c="",password:t=""}=l;i.tenantId=a,i.account=c,i.password=t}}de(()=>S(this,null,function*(){yield M(),yield ee(),te()}));const{validForm:se}=be(z),P=j(()=>e(Y)===_.LOGIN),$=E();function q(){return S(this,null,function*(){var a;if(!O.value)return;const l=yield se();if(l)try{T.value=!0;const c={username:l.account,password:l.password,grantType:"password"};f.requiredCaptcha&&(c.uuid=i.uuid,c.code=l.code),w.tenantEnabled?c.tenantId=i.tenantId:c.tenantId=g;const t=yield I.login(G(V({},c),{mode:"none"}));t&&(N.value=(a=c.tenantId)!=null?a:g,ae(c),F.success({message:d("sys.login.loginSuccessTitle"),description:`${d("sys.login.loginSuccessDesc")}: ${t.nickName}`,duration:3}))}catch(c){yield M();const t=c.message||d("sys.api.networkExceptionMsg");b({title:d("sys.api.errorTip"),content:t,getContainer:()=>document.body.querySelector(`.${m}`)||document.body,onOk(){var x;f.requiredCaptcha&&(t.includes("验证码")||t.includes("Captcha"))&&(i.code="",(x=e($))==null||x.focus())}})}finally{T.value=!1}})}return(l,a)=>{const c=ue("a-button");return Q(),me(ge,null,[W(s(Ie,{class:"enter-x"},null,512),[[H,P.value]]),W(s(e(X),{class:"p-4 enter-x",model:i,rules:e(Z),ref_key:"formRef",ref:z},{default:o(()=>[s(e(p),{name:"account",class:"enter-x"},{default:o(()=>[s(e(A),{size:"large",value:i.account,"onUpdate:value":a[0]||(a[0]=t=>i.account=t),placeholder:e(d)("sys.login.userName")},null,8,["value","placeholder"])]),_:1}),s(e(p),{name:"password",class:"enter-x"},{default:o(()=>[s(e(k),{size:"large",visibilityToggle:"",value:i.password,"onUpdate:value":a[1]||(a[1]=t=>i.password=t),placeholder:e(d)("sys.login.password"),onKeypress:J(q,["enter"])},null,8,["value","placeholder"])]),_:1}),f.requiredCaptcha?(Q(),fe(e(p),{key:0,name:"code",class:"enter-x"},{default:o(()=>[s(e(A),{ref_key:"imageCodeRef",ref:$,size:"large",value:i.code,"onUpdate:value":a[2]||(a[2]=t=>i.code=t),placeholder:"输入验证码",onKeypress:J(q,["enter"])},{addonAfter:o(()=>[s(e(Re),{class:"rounded-r-lg",preview:!1,height:40,width:105,src:f.imageInfo,onClick:M},null,8,["src"])]),_:1},8,["value"])]),_:1})):pe("",!0),s(e(r),{class:"enter-x"},{default:o(()=>[s(e(n),{span:12},{default:o(()=>[s(e(p),null,{default:o(()=>[s(e(Fe),{checked:B.value,"onUpdate:checked":a[3]||(a[3]=t=>B.value=t),size:"small"},{default:o(()=>[v(y(e(d)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(n),{span:12},{default:o(()=>[s(e(p),{style:{"text-align":"right"}},{default:o(()=>[s(e(L),{disabled:!0,type:"link",size:"small",onClick:a[4]||(a[4]=t=>e(C)(e(_).RESET_PASSWORD))},{default:o(()=>[v(y(e(d)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(p),{class:"enter-x"},{default:o(()=>[s(c,{type:"primary",size:"large",block:"",disabled:!O.value,onClick:q,loading:T.value},{default:o(()=>[v(y(e(d)("sys.login.loginButton")),1)]),_:1},8,["disabled","loading"])]),_:1}),s(e(r),{class:"enter-x",gutter:[16,16]},{default:o(()=>[s(e(n),{md:8,xs:24},{default:o(()=>[s(e(L),{block:"",onClick:a[5]||(a[5]=t=>e(C)(e(_).MOBILE))},{default:o(()=>[v(y(e(d)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(n),{md:8,xs:24},{default:o(()=>[s(e(L),{block:"",onClick:a[6]||(a[6]=t=>e(C)(e(_).QR_CODE)),disabled:""},{default:o(()=>[v(y(e(d)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(n),{md:8,xs:24},{default:o(()=>[s(e(L),{block:"",onClick:a[7]||(a[7]=t=>e(C)(e(_).REGISTER)),disabled:""},{default:o(()=>[v(y(e(d)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),[[H,P.value]])],64)}}}),Ze=Ee(Be,[["__scopeId","data-v-b280ec72"]]);export{Ze as default};
